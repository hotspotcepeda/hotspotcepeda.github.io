[{"content":"Voy a intentar explicar como he hecho esta web. En la asociación quieren tener una web y creo que de esta manera se puede hacer bien, rápido, fiable, colaborativa, segura \u0026hellip;\nIngredientes HUGO https://gohugo.io/\nComo generador de sitio web estático escrito en Go, básicamente escribes los contenidos en Markdown (lenguaje humano) y HUGO lo transforma en HTML y CCS\nhugo server --\u0026gt; Crea un servidor local con tu web en http://localhost:1313/ es LIVE.\rhugo - d docs/ --\u0026gt; Vuelca tu contenido a HTML CCS.\rGitHub https://github.com/hotspotcepeda/hotspotcepeda.github.io\nComo controlador de versiones en nube.\nChuleta con comandos y resumen git aquí\n\rgit clone https://github.com/hotspotcepeda/cepeda.git --\u0026gt; Clona a local el repositorio\rgit pull --\u0026gt; Compara diferencias entre local y en repositorio\rgit add . --\u0026gt; marca para subir a repositorio los cambios\rgit commit -m \u0026quot;mensaje para control de versiones\u0026quot;\rgit push --\u0026gt; Sube los cambios marcados de local a repositorio\rGoogle Una cuenta de correo google o el correo que sea va ha hacer falta, para logarse en github, para hacer el posicionamiento, de contacto del sitio, etc\u0026hellip;\nVisual Code Studio https://code.visualstudio.com/\nEsto es lo mejor para perderle el respeto a la programación, Cuando está instalado y configurado se pueden hacer los post en 1 minuto, y muchas cosas más.\nAprendizaje Yo lo que hice fue pillar una plantilla de HUGO, descargarla a una carpeta de mi máquina, trabajarla con el Visual Code, subirla a github e ir modificando con mi contenido. Que te equivocas y te los cargas todo, pues no pasa nada, pasito para atrás y a probar de nuevo, es lo bueno de git.\nEstos videos me vinieron muy bien para empezar.\n HUGO\nhttps://www.youtube.com/playlist?list=PLIcuwIrm4rKe5VEaiD59Ix3AklqYxiG2f Git\nhttps://www.youtube.com/playlist?list=PLIcuwIrm4rKddeIBeA_8HrXE27ZaDZoQE Visual Studio Code\nhttps://www.youtube.com/watch?v=HVzFLw5r2EM\nhttps://www.youtube.com/watch?v=AYbgqmyg7dk  La página también tiene el Brave Rewards para donaciones en BAT.\nEl posicionamiento de google y microsoft, Google Analytics\u0026hellip;\r","description":"La Web","id":2,"section":"posts","tags":["github","Visual Studio Code","markdown","cepeda la mora","HUGO","hotspotcepeda"],"title":"La Web","uri":"https://hotspotcepeda.github.io/es/posts/la_web/"},{"content":"Por si alguien se lo quiere montar por su cuenta.\n¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r Material necesario Antena Puedes usar cualquier antena de la lista http://fw.qmp.cat/ que trabaje en 802.11a/ wifi 5GHz\nNosotros empezamos desplegando con NanoStation Loco M5 Pero como cada vez hay más problemas para cargar el qMp ahora usamos como CPE las COMFAST CF-E120A\nhttp://en.comfast.com.cn/index.php?m=content\u0026amp;c=index\u0026amp;a=show\u0026amp;catid=19\u0026amp;id=23\nhttps://openwrt.org/toh/comfast/cf-e120a\nhttp://fw.qmp.cat/experimental/qMp_trunk-Kalimotxo_Comfast_CF-E120A-v3_sysupgrade_20210325-2110.bin\nLas antenas se han comportado muy bien, aguantan frio y calor, hielo, agua, nieve\u0026hellip; estamos a unos 1500 msnm y sin problema.\nRouter neutro Para tener señal dentro de casa sirve cualquier router neutro, ya va a depender de nuestras necesidades la capacidad del router.\n Sirve cualquier router de operadoras reciclado con firmware OpenWrt. Lista de hardware compatible https://openwrt.org/toh/start Hemos usado también los Next 3020 (que admiten qMp) https://openwrt.org/toh/nexx/wt3020 Los Mikrotik hAP lite TC / RB941-2nD-TC https://mikrotik.com/product/RB941-2nD-TC Y los que más por calidad precio TP-Link TL-WR841N https://www.tp-link.com/es/home-networking/wifi-router/tl-wr841n/ (ojo con la versión) En el mercado de segunda mano siempre se pueden encontrar routers a buen precio.  Herramientas Las herramientas necesarias dependen de cada escenario, si vamos a poner el CPE en el tejado se puede usar el mástil de la antena de TV, también se pueden usar soportes de pared o de ventana con una ventosa. Hay que poner la antena en una posición en la que se vea físicamente con al menos otra antena de la red. Se tiene que trabajar con las herramientas adecuadas y con los materiales adecuados, para cableados expuestos a la intemperie hay que usar cable especifico que soporte intemperie, buena crimpadora, conectores RJ-45 fiables \u0026hellip;\nAlta de nodo en la web guifi.net Registro Lo primero hay que crearse un usuario en la web guifi.net en caso de que no lo tengamos ya.\nCrear el nodo Vamos a la web guifi.net, disponibilidad, https://guifi.net/es/node/66713/view/availability y nos fijamos la última red que se esté usado, nos vamos a adueñar de la siguiente red (asegurando que esté libre y que no se esté usando ya en otro nodo).\nSi no tenemos habilidades de subneting vamos a una web de subneting y ponemos la ip. Por ejemplo en http://jodies.de/\nAddress: 10.0.21.144 00001010.00000000.00010101.10010 000\rNetmask: 255.255.255.248 = 29 11111111.11111111.11111111.11111 000\rWildcard: 0.0.0.7 00000000.00000000.00000000.00000 111\r=\u0026gt;\rNetwork: 10.0.21.144/29 00001010.00000000.00010101.10010 000 (Class A)\rBroadcast: 10.0.21.151 00001010.00000000.00010101.10010 111\rHostMin: 10.0.21.145 00001010.00000000.00010101.10010 001\rHostMax: 10.0.21.150 00001010.00000000.00010101.10010 110\rHosts/Net: 6 (Private Internet)\rVemos que la primera ip de la siguiente red es la 10.0.21.145/29 esta será la ip de nuestra antena.\nVamos a agregar el nodo, click en Crear contenido y se nos abre el menú de crear contenido, ahora click en Nodo guifi.net.\nPara poner el nombre de la ubicación seguimos este criterio:\nmunicipio-callenúmero-qmp\nLo siguiente y mínimo indispensable es la ubicación, leemos y aceptamos la Licencia y acuerdo de utilización, el Pro-Común de la Red Abierta, Libre y Neutral \u0026ldquo;XOLN\u0026rdquo; https://guifi.net/es/ProcomunXOLN, Vamos a la zona que nos corresponde 66713-Cepeda la Mora y en el mapa buscamos la ubicación en el mapa de nuestro nodo, hacemos click en la posición y se autocompletaran las coordenadas, también se puede poner una descripción del sitio y obligatoriamente hay que poner la elevación que tendrá la antena en metros, la distancia al suelo.\nHacemos click en GUARDAR y ya está creado el nodo!\nLo siguiente es agregar la antena al nodo.\nVamos a Añadir nuevo dispositivo: y añadimos un router.\nEn el router vamos a poner como nombre corto el mismo que pusimos en la ubicación del nodo \u0026ldquo;cpd-Fe10-qmp\u0026rdquo;\nRellenamos la seccion \u0026ldquo;Modelo de dispositivo, firmware y dirección MAC ()\u0026quot; , Wireless networking section y Parámetros de antena Tal cual, con las mismas MAC, igual si usamos NanoStation Loco M5 ó Comfast\nPor último fijamos la ip y la red de la antena, la que habíamos previsto en el primer paso, dejo un comentario para acordarme que en realidad es Comfast.\nClick en guardar y salir y ya está, ya tenemos presencia en la web guifi.net\nEste es el nodo que hemos creado, https://guifi.net/es/node/129487, es para una amiga y espero ponerlo en producción muy pronto.\nConfiguración de equipos Una vez que tenemos el trasto con el firmware qMp configuramos lo primero el modo de trabajo, nosotros estamos en modo Community.\nAsignamos los parámetros de configuración que tenemos en la web guifi.net\nIP y red, SSID, Canal y codificación de país.\nCon esto sería suficiente para que la antena de manera autónoma se conectara con la red y se pusiera a prestar servicio.\nEs conveniente establecer hostname y SSID según web guifi.net.\nHay un otro camino para hacer la configuración de los equipos, una vez hemos creado el nodo y el equipo en la web guifi.net, se puede descargar y aplicar en en el router un archivo de configuración, es un script que nos asignará todos los parámetros de la web a nuestro equipo físico. Se llama UNSOLOCLICK. También configurar NTP y Cron con reinicio nocturno para evitar bloqueos.\nPara el router de la wifi interior, la WAN es cliente de DHCP, lo conectaremos directamente al POE de la antena y la LAN será servidor de DHCP por wifi o cable.\nEstablecer password y hacer backup de las configuraciones de los equipos.\nConectar a la red comunitaria Una vez que los equipos están configurados si todo va bien, tendremos visibilidad de la toda la red y salida a internet en unos segundos. No hay que hacer nada más. Es routig es transparente, no necesita configuración a menos que se se quiera tomar un camino en concreto.\nAntes de subir al tejado para hacer la instalación definitiva es importante tener la seguridad de que el equipo funciona. No cuesta más de 10 minutos hacer una instalación provisional para comprobar y nos ahorrará muchos quebraderos de cabeza y tiempo.\nNo hay un esquema de red fijo. Depende de las antenas que estén operativas. Un nodo se conecta con todos los nodos que que puede alcanzar y a su vez extiende la red dando cobertura, por eso en el mapa de Cepeda no salen las líneas de los enlaces, esto solo aparece en los enlaces punto a punto.\n","description":"Autoprovisión de nodo qMp","id":3,"section":"posts","tags":["guifi.net","qMp","mesh","cepeda la mora","wifi","autoprovision"],"title":"Autoprovisión","uri":"https://hotspotcepeda.github.io/es/posts/autoprovision_nodo_qmp/"},{"content":"Voy a intentar explicar como funciona la red en Cepeda, en resumidas cuentas es fácil, solo hay que asignar a los nodos ó antenas, las ips de la web guifi.net para que darle un poco de orden y la frecuencia de trabajo para que se entiendan, el canal y el país en el que está trabajando la red comunitaria.\nLos enlaces los negocia el qMp en base a lo que tenga al alcance. Es una red con vida propia.\n¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r Esquema de red No hay un esquema de red fijo. Depende de las antenas que estén operativas. Un nodo se conecta con todos los nodos que que puede alcanzar y a su vez extiende la red dando cobertura, por eso en el mapa de Cepeda no salen las líneas de los enlaces, esto solo aparece en los enlaces punto a punto.\nEn la página de guifi.net lo normal es ver lineas verdes de un nodo a otro para ver los enlaces, pero con la red en mesh las antenas se conectan con todas las antenas que tienen disponibles. Se conectan todas con todas y llevan el tráfico por el camino más conveniente según protocolo de routing. Los tiempos de respuesta entre nodos son muy buenos, 1 ms. El routig es transparente, es dinámico y no hay que configurarlo de manera manual a no ser que queramos tomar un camino especial.\nEl qMp también está pensado para despliegues en caso de emergencia como catástrofes usando el modo roaming. Es autoconfigurable.\nNosotros en Cepeda estamos en modo community los nodos se ven entre si para poder compartir servicios.\nCuando agregamos un nuevo nodo a la red solo tenemos que configurar manualmente la frecuencia de trabajo, el canal. Para agregar un nodo de manera ordenada especificamos ip, mascara, frecuencia, país, hostname y SSID.\nIPs La asignación de ip para los nodos se hace según https://guifi.net/es/node/66713/view/availability para cada nodo se están reservando 8 ips, 6 host, /29. Cuando se agrega un nodo vamos a la web guifi.net de Cepeda y asignamos la siguiente /29 siguiendo el orden, por defecto al agregar un nodo y solicitar ip se asigna una IP máscara /24 de 255 direcciones, esto se puede modificar a máscara /29 manualmente.\nEl direccionamiento que estamos usando es 10.0.20.0/23 para los nodos y 10.228.150.0/24 para los servidores y salida internet, según el direccionamiento guifi.net https://guifi.net/es/node/66713/view/ipv4\n","description":"Topología de la red","id":4,"section":"posts","tags":["guifi.net","qMp","mesh","cepeda la mora","wifi"],"title":"Topología","uri":"https://hotspotcepeda.github.io/es/posts/topologia/"},{"content":"El propósito de este sitio es:\n Compartir la experiencia del proyecto de red comunitaria en Cepeda. Archivar y mantener disponible la documentación técnica. Dar las gracias por la ayuda recibida e intentar ayudar al que lo necesite para replicar este proyecto de red comunitaria en otros lugares.  Si quiere colaborar en el proyecto de red comunitaria en Cepeda la Mora, en este sitio para aportar contenido, como redactor, traductor o simplemente para expresar su opinión, le invito a contactar mediante el canal de matrix creado para esto y contribuir en github.\nPienso que las telecomunicaciones en nuestra sociedad actual tienen que estar al alcance de todas las personas y por ello las considero un derecho fundamental, como lo son la educación o la sanidad pública. Quiero agradecer a todas esas personas que comparten su experiencia, conocimientos e información para ponerlas al servicio del desarrollo de la humanidad de manera desinteresada.\nTambién quiero añadir que no soy programador profesional y que no hago esto con fines lucrativos, solo hago esto porque me gustan las telecomunicaciones y la tecnología. Si de alguna manera me equivoco acepte mis más sinceras disculpas y no dude en corregirme.\r ","description":"Archivo de documentación técnica del proyecto de red comunitaria de Cepeda la Mora, Ávila","id":5,"section":"","tags":null,"title":"Sitio","uri":"https://hotspotcepeda.github.io/es/sitio/"},{"content":"Fotos de Cepeda la Mora, panorámica desde el Ayto.\n","description":"Fotos de Cepeda la Mora, panorámica desde el Ayto.","id":6,"section":"gallery","tags":null,"title":"Paisaje","uri":"https://hotspotcepeda.github.io/es/gallery/paisaje/"},{"content":"Equipamiento e instalaciones.\n","description":"Fotos de equipamiento de Red","id":7,"section":"gallery","tags":null,"title":"Red","uri":"https://hotspotcepeda.github.io/es/gallery/red/"},{"content":"¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r Comfast http://en.comfast.com.cn/index.php?m=content\u0026amp;c=index\u0026amp;a=show\u0026amp;catid=19\u0026amp;id=23\nOpenWRT https://openwrt.org/toh/comfast/cf-e120a\nqMp http://fw.qmp.cat/experimental/qMp_trunk-Kalimotxo_Comfast_CF-E120A-v3_sysupgrade_20210325-2110.bin\n  ","description":"COMFAST CF-E120A v3 modo Bootloader","id":8,"section":"posts","tags":["OpenWRT","qMp","COMFAST","wifi","CF-E120A"],"title":"COMFAST CF-E120A v3 Bootloader","uri":"https://hotspotcepeda.github.io/es/posts/comfast_cf-e120a_v3_bootloader/"},{"content":"BBDD\n1 2 3 4 5 6  docker run -d \\ -v `pwd`/mysql:/var/lib/mysql \\ -v `pwd`/50-server.cnf:/etc/mysql/mariadb.conf.d/50-server.cnf:ro \\ -e MYSQL_ROOT_PASSWORD=mysqlPASWORD \\ –name librenms-db \\ mariadb:latest   Lanza librenms, se asocia a la BBDD\n1 2 3 4 5 6 7 8 9 10 11 12 13  docker run -d \\ -v `pwd`/data:/data \\ -p 888:80 \\ -e TZ=»Europe/Madrid» \\ –link 0bd3a3993581(id container BBDD):mysql \\ -e POLLER=24 \\ -e DB_TYPE=mysql \\ -e DB_HOST=mysql \\ -e DB_NAME=librenms \\ -e DB_USER=root \\ -e DB_PASS=mysqlPASWORD \\ –name librenms \\ seti/librenms   Al navegador http://ipserver:888/install.php\n","description":"Instalar LibreNMS en un contenedor de Docker","id":14,"section":"posts","tags":["docker","librenms","debian"],"title":"Librenms Docker install","uri":"https://hotspotcepeda.github.io/es/posts/librenms_docker_install/"},{"content":"https://ralph-ng.readthedocs.io/\nRalph es un sistema de gestión de activos, DCIM y CMDB simple pero potente para centros de datos y back office.\nCaracterísticas:\n realizar un seguimiento de las compras de activos y su ciclo de vida sistema de flujo flexible para el ciclo de vida de los activos centro de datos y soporte de back office Visualización dc incorporada  Ralph en Docker 1 2 3  docker run -i -t --name=\u0026#34;mysql_ralph\u0026#34; -v /var/lib/mysql -v /home/ralph/.ralph busybox /bin/sh -c \u0026#34;chown root /home/ralph; chown root /home/ralph/.ralph\u0026#34; docker run -P -t -i --volumes-from mysql_ralph allegrogroup/ralph:latest /bin/bash /home/ralph/init.sh docker run -P -p 8000:8000 -t -i --name ralph --mac-address=02:42:ac:11:ff:ff --volumes-from mysql_ralph allegrogroup/ralph:latest   Compose\nhttps://ralph-ng.readthedocs.io/en/stable/\nInstall\nInstall docker and docker-compose first.\nCreate compose configuration\nCopy docker-compose.yml.tmpl outside ralph sources to docker-compose.yml and tweak it.\nBuild\nThen build ralph:\n1  docker-compose build   To initialize database run:\n1  docker-compose run --rm web /root/init.sh   Notice that this command should be executed only once, at the very beginning.\nIf you need to populate Ralph with some demonstration data run:\n1  docker-compose run --rm web ralph demodata   Run ralph at the end:\n1  docker-compose up -d   Ralph should be accessible at http://127.0.0.1 (or if you are using boot2docker at $(boot2docker ip)). Documentation is available at http://127.0.0.1/docs.\nIf you are upgrading ralph image (source code) run:\n1  docker-compose run --rm web /root/upgrade.sh   ","description":"Ralph Docker install","id":15,"section":"posts","tags":["ralph","docker","cdp","isp","gestion"],"title":"Ralph en Docker","uri":"https://hotspotcepeda.github.io/es/posts/ralph/"},{"content":"ADD NEXTCLOUD REPOSITORY\nAdd the Nextcloud repository in the /etc/apt/sources.d/nextcloud.list\n1  echo \u0026#39;deb http://apt.jurisic.org/debian/ jessie main contrib non-free\u0026#39; \u0026gt;\u0026gt; /etc/apt/sources.list.d/nextcloud.list   Install release key of Nextcloud repository:\n1  wget -q http://apt.jurisic.org/Release.key -O- | apt-key add -   And run apt-get update to download the list of packages.\n1  apt-get update   INSTALL NEXTCLOUD CLIENT\nInstall Nextcloud server with:\n1  apt-get install nextcloud-client   INSTALL NEXTCLOUD SERVER\nINSTALL POSTGRESQL AND SETUP NEW USER \u0026amp; DATABASE\nInstall PostgreSQL with:\n1  apt-get install postgresql    The PostgreSQL package will install all required dependencies. Choose «y» to start the installation. Add a PostgreSQL database The next step is to create a PostgreSQL database for nextcloud. Login to PostgreSQL on the commandline by running this command:  1 2  su - postgres psql   Enter the following commands to create a database user with the name «nextuser» and and a database name «nextcloud». Replace the word «StorngPasswordHere» with your own password in the commands.\n1 2 3  CREATE DATABASE nextcloud; CREATE USER nextuser WITH PASSWORD \u0026#39;StorngPasswordHere\u0026#39;; GRANT ALL PRIVILEGES ON DATABASE nextcloud to nextuser;   Install Nextcloud server with:\n1  apt-get install nextcloud-server   When the shell part of the installation is finished, proceed by opening the Nextcloud web installer in your browser. The URL is http://[YOURIP]/nextcloud. In my case the IP is 192.168.1.100 so I enter http://192.168.1.100/nextcloud in my browser to get the installer:\nEnter the desired administrator username and password in the login fields. Please choose a secure password and also a username that is not «admin» or «administrator» might be a good choice to make it less easy for attackers to guess your admin login.\nNextcloud is using sqlite as storage engine by default. This is not a good choice performace wise, so I will choose PostgreSQL as database backend. We have created a PostgreSQL database above, enter the details of that database now:\nUsername: nextuser\nPassword: The password that you have choosen for the database.\nDatabase name: nextcloud\nHostname: localhost\nACCESS NEXTCLOUD WITH SSL (HTTPS)\nThe default installation of Nextcloud is not secured by SSL. To enable SSL in your webserver, run these commands:\n1 2 3  a2enmod ssl a2ensite default-ssl service apache2 restart   Now you can access the web interface with https://[YOURIP]/nextcloud. You will probably get a SSL warning, this warning should be accepted. To avoid such warnings, get a free officially signed SSL certificate e.g. from Startssl (or check LetsEncrypt).\nLETSENCRYPT\nSTEP 1 — DOWNLOAD THE LET’S ENCRYPT CLIENT\nThe first step to using Let’s Encrypt to obtain an SSL certificate is to install the certbot software on your server. The Certbot developers maintain their own Ubuntu software repository with up-to-date versions of the software. Because Certbot is in such active development it’s worth using this repository to install a newer Certbot than provided by Ubuntu.\nFirst, add the repository:\n1  sudo add-apt-repository ppa:certbot/certbot   You’ll need to press ENTER to accept. Afterwards, update the package list to pick up the new repository’s package information:\n1  sudo apt-get update   And finally, install Certbot from the new repository with apt-get:\n1  sudo apt-get install python-certbot-apache   The certbot Let’s Encrypt client is now ready to use.\nSTEP 2 — SET UP THE SSL CERTIFICATE\n1  letsencrypt --apache   ","description":"Servidor NEXTCLOUD DEBIAN y CLIENTE","id":16,"section":"posts","tags":["docker","nextcloud","debian","linux"],"title":"NEXTCLOUD DEBIAN SERVER AND CLIENT","uri":"https://hotspotcepeda.github.io/es/posts/nextcloud_debian/"},{"content":"Listar imagenes\n#docker images REPOSITORY TAG IMAGE ID CREATED SIZE borrar imagenes\n#docker images #docker rmi IMAGEN-ID Borra todas la imagenes\n#docker rmi $(docker images -q) Entrar en la consola de una imagen  docker run -t -i debian /bin/bash listar contenedores\n#docker ps -a borra contenedor\n#docker rm -f ad287f00940b borra todos los contenedores\n#docker stop $(docker ps -a -q) #docker rm $(docker ps -a -q) borra volúmenes huerfanos\n#docker volume rm $(docker volume ls -qf dangling=true) Cada vez que se lanza una imagen con docker run -t -i debian /bin/bash se crea un contenedor asociado, ver con:\n#docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\neb714a2b0b90 1b8740b73d63 \u0026quot;/bin/bash\u0026quot; 3 minutes ago Up 3 minutes jolly_spence 72eabf0db5d5 1b8740b73d63 \u0026quot;/bin/bash\u0026quot; 7 minutes ago Exited (0) 3 minutes ago affectionate_jang dec292ad6ef4 debian \u0026quot;/bin/bash\u0026quot; 21 minutes ago Exited (0) 10 minutes ago suspicious_babbage Para salir del contenedor en el que estamos trabajando y dejarlo funcionando lo hacemos con la teclas\nCtrt+p+q\nPara volver a un contenedor que está corriendo\n#docker attach CONTAINER ID Para guardar los cambios en el contenedor donde hemos estado trabajando tecleamos\n#docker commit CONTAINER ID #docker commit dec292ad6ef4 sha256:1b8740b73d63b18d701b2964b8953e33635aeee39b0fa474981fffaf3b451d18 #docker images REPOSITORY TAG IMAGE ID CREATED SIZE \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; 1b8740b73d63 16 minutes ago 116MB debian latest a2ff708b7413 8 days ago 100MB para guardar una imagen de nuestro contenedor\n# docker commit CONTAINER ID pull:TAG # docker commit dec292ad6ef4 jv4nj0/juanjo:test sha256:a5f831c9b55167935094995005c837866499d76ada585629735a28630f496caf para guardar una imagen de nuestro contenedor en nuestro repositorio de docker https://hub.docker.com\n#docker login user /pass de la cuenta docker #docker images REPOSITORY TAG IMAGE ID CREATED SIZE xxxxx/yyyyy test 82efda58c6f 12 seconds ago 116MB xxxxx/yyyyy latest 19c1de4a47d0 48 seconds ago 116MB \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; a5f831c9b551 31 minutes ago 116MB \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; 1b8740b73d63 About an hour ago 116MB debian latest a2ff708b7413 8 days ago 100MB #docker push IMAGE ID:TAG #docker history imagen entrega todas las modificaciones de la imagen\n#dcoker inspect imagen entrega info de configuracion de de la imagen firma cuando fue creado imegen de la que depende. hostname puertos gw mac Busca imagenes relacionadas\n#docker search nembre de imagen ALMACENAMIENTO\ndata volumen Directorios del host montados en un directorio del docker contenedores Data volumen LOGS docker logs id RUN image docker run -ti -d --name prueba IMAGEN conectar a docker\ndocker exec -ti prueba /bin/bash VOLUMENES\ndocker create docker volume create NOMBRE docker volume ls docker volume rm docker volume ls ej\ndocker create -v /tmp --name datacontainer ubuntu Network9000/#/ docker network connect/disconnect | create | inspect * construir docker: dos vias docker file o docker compose evitar modificar contenedor y guardarlo como imagen se usa un docker file para crear el contenedor nano dockerfile\nFROM nombre /nombre:version MANTAINER xxxxxxx RUN apt-get update etc despues para guardar\ndocker buid -t nombrenuevo/nombrenuevo:version ./ BRIDGE HOST NONE interface equipo fisico solo loopback docker0 ","description":"Guía Docker","id":18,"section":"posts","tags":["docker","debian"],"title":"Docker","uri":"https://hotspotcepeda.github.io/es/posts/docker/"},{"content":"Gráficas luci-app-vnstat A parte de las gráficas en tiempo real que vienen de serie \u0026ldquo;Realtime Traffic\u0026rdquo; he puesto el \u0026ldquo;VnStat Graphs\u0026rdquo; que almacena en el router gráficas de trafico en las interfaces.\nMas gráficas, CPU, memoria, temperatura\u0026hellip; luci-app-statistics https://echt.guth.so/persistent-traffic-log-and-more-in-openwrt/\nSmart Queue Management  luci-app-sqm\nSe configura por luci , sirve para limitar el trafico de las interfaces, se instala con varios script de gestión de trafico, en este caso se usa para limitar el caudal de salida a internet se puede usar por ejemplo, para reservar un caudal máximo en la wifi y otro en las interfaces físicas. O para asignar un caudal fijo a las conexiones de la LAN.\nDinamic DNS luci-app-ddns Se puede configurar por luci o en el archivo /etc/config/ddns en este caso va a preguntar la ip pública a http://checkip.dyndns.com y se la dice a changeip.com donde tenemos configurado un nombre de dominio asociado.\nconfig ddns 'global'\roption date_format '%F %R'\roption log_lines '250'\roption allow_local_ip '0'\rconfig service 'myddns_ipv4'\roption interface 'wan'\roption enabled '1'\roption service_name 'changeip.com'\roption domain 'dominio.changeip'\roption username 'user_changeip'\roption password 'password_changeip'\roption use_syslog '2'\roption use_logfile '1'\roption ip_source 'web'\roption ip_url 'http://checkip.dyndns.com'\roption force_interval '72'\roption force_unit 'minutes'\rconfig service 'myddns_ipv6'\roption update_url 'http://[USERNAME]:[PASSWORD]@your.provider.net/nic/update?hostname=[DOMAIN]\u0026amp;myip=[IP]'\roption domain 'yourhost.example.com'\roption username 'your_username'\roption password 'your_password'\roption use_ipv6 '1'\roption interface 'wan6'\roption ip_source 'network'\roption ip_network 'wan6'\rCliente mail ssmtp Para enviar log y alarmas de reinicios. Se configura según el enlace y funciona ok, /etc/ssmtp/ssmtp.conf.\nroot=tu_mail@gmail.com\rhostname=localhost\rmailhub=smtp.gmail.com:587\rFromLineOverride=YES\rUseTLS=YES\rUSESTARTTLS=YES\rAuthUser=tu_mail@gmail.com\rAuthPass=tu_password\rY enn /etc/ssmtp/revaliases:\r# sSMTP aliases\r#\r# Format: local_account:outgoing_address:mailhub\r#\r# Example: root:your_login@your.domain:mailhub.your.domain[:port]\r# where [:port] is an optional port number that defaults to 25.\rroot:tu_mail@gmail.com:smtp.gmail.com:587\rScript reboot. https://wiki.openwrt.org/doc/techref/initscripts Preparamos un script para que se envíe un correo de alarma cuando esté arrancando el router. Seguir los pasos de Automatic email sending.\nScript log diario. Envío de ficheros con mpack\nmaillog.txt mpack maillog.txt tu_mail@gmail.com\rSubject: asunto\rCRON Programar que nos envíe un correo con el log diario.\n","description":"Configuraciones y gestión de tráfico en OpenWRT","id":19,"section":"posts","tags":["OpenWRT"],"title":"Gestión OpenWRT","uri":"https://hotspotcepeda.github.io/es/posts/gestion_openwrt/"},{"content":"Configuración en MikroTik Configuración en servidor debian jessie: # apt-get update \u0026amp;\u0026amp; apt-get upgrade\rwget http://apt-stable.ntop.org/14.04/all/apt-ntop-stable.deb\rsudo dpkg -i apt-ntop-stable.deb\rsudo apt-get update\rsudo apt-get install nprobe\rconfig nProbe\rsudo nano /etc/nprobe/nprobe-none.conf\r--zmq=\u0026quot;tcp://127.0.0.1:1234\u0026quot;\r--collector-port=5556\r-n=none\r-i=none\rsudo touch /etc/nprobe/nprobe-none.start\rsudo service nprobe start\rInstalacion de ntopng\nwget http://apt-stable.ntop.org/14.04/all/apt-ntop-stable.deb\rsudo dpkg -i apt-ntop-stable.deb\rapt-get install topng\rconfig ntopng\rnano /etc/ntopng/ntopng.conf\r-G=/var/run/ntopng.pid\r-i tcp://127.0.0.1:1234\rsudo touch /etc/ntopng/ntopng.start\rsudo service ntopng start\rreboot\r DOCKER docker run -d --name nprobe --net=host xdrum/nprobe nprobe --collector-port 5556 --zmq tcp://*:1234 -i none\rdocker run -d --name ntopng --net=host -p 3000:3000 vostro/ntopng ntopng -i tcp://127.0.0.1:1234\r","description":"Configuracion de netflow en MikroTik servidor Debian nprobe","id":20,"section":"posts","tags":["mikrotik","nprobe","debian","netflow"],"title":"MikroTik netflow","uri":"https://hotspotcepeda.github.io/es/posts/mikrotik_netflow/"},{"content":"SERVIDOR Agregar en\n# nano /etc/ssh/sshd_config\rX11Forwarding yes\r# service ssh restart\rCLIENTE $ ssh -X -Y user@maquina -p puerto aplicación\r","description":"Como ejecutar aplicaciones por ssh de manera remota","id":21,"section":"posts","tags":["debian","linux","ssh","gestion"],"title":"Ejecutar aplicación por ssh","uri":"https://hotspotcepeda.github.io/es/posts/ssh_remote_comand/"},{"content":"http://wiki.mikrotik.com/wiki/Manual:CRS_examples\r\npara una RB850\n/interface ethernet\rset ether3 master-port=ether2\rset ether4 master-port=ether2\r/interface ethernet switch vlan\radd ports=ether2,ether3 switch=switch1 vlan-id=200\radd ports=ether2,ether4 switch=switch1 vlan-id=300\r/interface ethernet switch port\rset ether2 vlan-mode=secure vlan-header=add-if-missing\rset ether3 vlan-mode=secure vlan-header=always-strip default-vlan-id=200\rset ether4 vlan-mode=secure vlan-header=always-strip default-vlan-id=300\r","description":"Configuracion de vlan en nodo MikroTik","id":22,"section":"posts","tags":["mikrotik","guifi.net"],"title":"Nodo MikroTik vlan","uri":"https://hotspotcepeda.github.io/es/posts/mikrotik_nodo/"},{"content":"http://ca.wiki.guifi.net/wiki/Gestio_de_antenes_ubnt_a_trav%C3%A9s_de_VLAN_de_gesti%C3%B3\r Lo que queremos es mantener gestión de las antenas de manera directa. En los equipos Ubiquiti se permiten hacer vlans, desde la version 5.5.\nSe define una VLAN de gestión: vlan666\nSe define una VLAN de tráfico general: vlan10\nSe configura la antena en bridge, se le añade dos interfaces VLANs, y se configura la IP manual en la LAN0.X X = vlan ID (en nuestro caso 666)\nSe configura la VLAN de gestión a la RB: añadir VLAN a la interfaz de la antena\nSe añade la VLAN de gestión de una o todas las antenas al bridge WLAN / Lan. De esta manera podremos darle direccionamiento 10.x de gestión del supernodo\nEste modelo lleva una ventaja muy interesante, y es que podemos configurar un servidor DHCP para todo el management de las antenas, ya que las integramos al bridge WLAN / LAN\n","description":"Configurar vlan de gestión en Ubiquiti","id":23,"section":"posts","tags":["ubiquiti","gestión"],"title":"Configurar vlan de gestión en Ubiquiti","uri":"https://hotspotcepeda.github.io/es/posts/vlan_gestion_ubiquiti/"},{"content":"https://github.com/brndnmtthws/conky\r\n# apt-get install conky conky-all\r# apt-get install curl lm-sensors hddtemp\rPara autoarranque agregar en programas al inicio:\nconky p -15\nstart conky -d\rstop\npkill conky\rrestart\npkill -HUP conky\rConfig nano /etc/conky/conky.conf\nbackground yes\rfont Zekton:size=8\rxftfont Zekton:size=8\ruse_xft yes\rxftalpha 0.4\rupdate_interval 1.0\rtotal_run_times 0\rown_window yes\rown_window_type override\rown_window_transparent yes\rown_window_hints undecorated,below,skip_taskbar,skip_pager\rdouble_buffer yes\rdraw_shades no\rdraw_outline no\rdraw_borders no\rdraw_graph_borders no\rminimum_size 220 5\rmaximum_width 220\rdefault_color ffffff\rdefault_shade_color black\rdefault_outline_color black\ralignment top_right\rgap_x 10\rgap_y 90\rno_buffers yes\rcpu_avg_samples 2\roverride_utf8_locale no\ruppercase no # set to yes if you want all text to be in uppercase\ruse_spacer no\rTEXT\r${font Zekton:style=Bold:pixelsize=42}${alignc}${time %H:%M:%S}${font Zekton:size=8}\rlenovo T430s ${hr 1 }\rHostname: $alignr$nodename\rIP: $alignr${addr eth0}\rKernel: $alignr$kernel\rUptime: $alignr$uptime\rProcesses: ${alignr}$processes ($running_processes running)\rLoad: ${alignr}$loadavg\rCPU0 ${alignc} ${freq}MHz ${alignr}(${cpu cpu0}%)\r${cpubar cpu0 4}\rCPU1 ${alignc} ${freq}MHz ${alignr}(${cpu cpu1}%)\r${cpubar 4 cpu1}\rCPU2 ${alignc} ${freq}MHz ${alignr}(${cpu cpu2}%)\r${cpubar 4 cpu2}\rCPU3 ${alignc} ${freq}MHz ${alignr}(${cpu cpu3}%)\r${cpubar 4 cpu3}\rCPU AVG\r${cpugraph}\rRAM ${alignr}$mem / $memmax ($memperc%)\r${membar 4}\rSWAP ${alignr}$swap / $swapmax ($swapperc%)\r${swapbar 4}\rMaximos de CPU $alignr CPU% MEM%\r${top name 1}$alignr${top cpu 1}${top mem 1}\r${top name 2}$alignr${top cpu 2}${top mem 2}\r${top name 3}$alignr${top cpu 3}${top mem 3}\rMaximos de MEM $alignr CPU% MEM%\r${top_mem name 1}$alignr${top_mem cpu 1}${top_mem mem 1}\r${top_mem name 2}$alignr${top_mem cpu 2}${top_mem mem 2}\r${top_mem name 3}$alignr${top_mem cpu 3}${top_mem mem 3}\rHDD FREE ${hr 1}${color}\r/ : ${alignr}${fs_free /} / ${fs_size /}\r${fs_bar 4 /}\reth0 ${hr 1}${color}\rDown ${downspeed eth0} k/s ${alignr}Up ${upspeed eth0} k/s\r${downspeedgraph eth0 25,107} ${alignr}${upspeedgraph eth0 25,107}\rTotal ${totaldown eth0} ${alignr}Total ${totalup eth0}\rwlan0 ${hr 1}${color}\rIntensidad WIFI $alignr ${wireless_link_qual wlan0}%\rDown ${downspeed wlan0} k/s ${alignr}Up ${upspeed wlan0} k/s\r${downspeedgraph wlan0 25,107} ${alignr}${upspeedgraph wlan0 25,107}\rTotal ${totaldown wlan0} ${alignr}Total ${totalup wlan0}\rBATERIA${hr 1}${color}\r${battery_bar BAT0}\r${font Arial:style=Bold:size=12}\r","description":"Instalación de conky system monitor en Debian","id":24,"section":"posts","tags":["debian","conky","linux"],"title":"Instalar conky en Debian","uri":"https://hotspotcepeda.github.io/es/posts/debian_conky/"},{"content":"https://github.com/LibVNC/x11vnc\r\nInstalamos servidor:\n$ sudo apt-get update\r$ sudo apt-get install x11vnc\rPoner el password:\n$ x11vnc -storepasswd\rEnter VNC password: *********\rVerify password: *********\rWrite password to /home/USUARIO/.vnc/passwd? [y]/n y\rPassword written to: /home/USUARIO/.vnc/passwd\rOpciones para lanzar el servidor en\n$ man x11vnc :\r-forever : Mantiene el servidor en funcionamiento después de la sesion.\r-rfbauth /home/USUARIO/.vnc/passwd : Para que pida el password de la ruta que queramos.\r-usepw : pide el password default ~/.vnc/passwd\r-rfbport 5900 : Indicamos el puerto de trabajo, el que queramos, si no ponemos nada es el :5900\r-display :0 : Display independiente del puerto 0 1 2 3 4 5\r-bg : Lanza el server en background, segundo plano.\r-auth : indicamos el gestor de escritorio que queremos usar, si no lo sabemos lanzar: $ x11vnc -findauth\rOpciones para arrancar el servidor x11vnc: - Entrar por SSH y lanzarlo para una vez o para que se quede abierto.\nEjemplo para conectarse usando cliente vinagre, remmina, tincvnc \u0026hellip; En el servidor ejecutamos:\n# iptables -A INPUT -p tcp -s 0.0.0.0/0 --dport 5900 -j ACCEPT # Abrimos el puerto si fuera necesario\rx11vnc -findauth # Buscamos la ruta del XAUTHORITY\rXAUTHORITY=/var/lib/xdm/authdir/authfiles/A:0-w1exWB\rTiene que haber escritorio para tener escritorio remoto de algo\u0026hellip;\napt-get install xfce4 xorg\rsi no arranca el entorno gráfico arrancar con startx comprobar con\necho $DISPLAY\rlocalhost:10.0\ren el caso de no tener .Xauthority entrar un par de veces por SSH $ ssh -X myname@somehost y se generará\nUSUARIO@Cldy1:/home/USUARIO# xauth\rxauth: file /USUARIO/.Xauthority does not exist\rUsing authority file /USUARIO/.Xauthority\rxauth\u0026gt;\r$xauth\rUsing authority file /home/pi/.Xauthority\rempezamos,\nx11vnc -bg -usepw -auth /var/lib/xdm/authdir/authfiles/A:0-w1exWB -display :0 # Arrancamos el servicio en display :0 que corresponde con puerto 5900\r# netstat -tulpn # Comprobar si el servicio está arrancado en el puerto\rOtro ejemplo\nx11vnc -bg -usepw -auth /var/lib/xdm/authdir/authfiles/A:0-53cTfA -display :0\rEjemplo para conectarse con un navegador web https, con Java, (con OpenJRE funciona ok).\nx11vnc -rfbport 5901 -http_ssl -svc -usepw -env FD_GEOM=1280x720 -loop -auth /var/lib/xdm/authdir/authfiles/A:0-53cTfA -display :0\rOtros ejemplos:\nx11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1280x720 -auth guess -loop --display :0\rx11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1599x1196 -auth guess -loop --display :0 -o /var/log/x11vnc.log\rx11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1599x1196 -loop -auth /usr/bin/xauth -display :0\rx11vnc -rfbport 33334 -http_ssl -svc -usepw -clip 1280x720+0+0 -scale 1280x720 -loop -auth /var/lib/xdm/authdir/authfiles/A:0-Da2eQG -display :0\rJava SSL viewer URL: https://ip:5901/ (single port)\rJava SSL viewer URL: http://ip:5801/\rComprobar si el servicio abre el puerto con:\n# netstat -tulpn\rPodemos ver el log en: /var/log/upstart/x11vnc.log\n","description":"Instalación de servidor de escritorio remoto en Debian con x11vnc","id":25,"section":"posts","tags":["debian","x11vnc","linux"],"title":"Escritorio remoto debian con x11vnc","uri":"https://hotspotcepeda.github.io/es/posts/debian_escritorio_remoto/"},{"content":"Unninstall DESINSTALACION TOTAL de todo lo relacionado con Java, Sun, Oracle, OpenJDK, IcedTea plugins, GIJ\ndpkg-query -W -f='${binary:Package}\\n' | grep -E -e '^(ia32-)?(sun|oracle)-java' -e '^openjdk-' -e '^icedtea' -e '^(default|gcj)-j(re|dk)' -e '^gcj-(.*)-j(re|dk)' -e '^java-common' | xargs sudo apt-get -y remove\rsudo apt-get -y autoremove\rPurge config files:\ndpkg -l | grep ^rc | awk '{print($2)}' | xargs sudo apt-get -y purge\rRemove Java config and cache directory:\nsudo bash -c 'ls -d /home/*/.java' | xargs sudo rm -rf\rRemove manually installed JVMs:\nsudo rm -rf /usr/lib/jvm/*\rRemove Java entries, if there is still any, from the alternatives:\nfor g in ControlPanel java java_vm javaws jcontrol jexec keytool mozilla-javaplugin.so orbd pack200 policytool rmid rmiregistry servertool tnameserv unpack200 appletviewer apt extcheck HtmlConverter idlj jar jarsigner javac javadoc javah javap jconsole jdb jhat jinfo jmap jps jrunscript jsadebugd jstack jstat jstatd native2ascii rmic schemagen serialver wsgen wsimport xjc xulrunner-1.9-javaplugin.so; do sudo update-alternatives --remove-all $g; done\rSearch for possible remaining Java directories:\rsudo updatedb\rsudo locate -b '\\pack200'\rIf the command above produces any output like /path/to/jre1.6.0_34/bin/pack200 remove the directory that is parent of bin, like\nthis: sudo rm -rf /path/to/jre1.6.0_34.\rInstall OpenJRE\nsudo apt-get install openjdk-7-jre\rIcedTea Plugin\nsudo apt-get install icedtea-plugin\rVer que java está activo:\n# update-alternatives --config java\rExisten 2 opciones para la alternativa java (que provee /usr/bin/java).\rSelección Ruta Prioridad Estado\r------------------------------------------------------------\r0 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1071 modo automático\r* 1 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1071 modo manual\r2 /usr/lib/jvm/java-8-oracle/jre/bin/java 1001 modo manual\rPulse \u0026lt;Intro\u0026gt; para mantener el valor por omisión [*] o pulse un número de selección: 0\r# java -version\rjava version \u0026quot;1.7.0_131\u0026quot;\rOpenJDK Runtime Environment (IcedTea 2.6.9) (7u131-2.6.9-2~deb8u1)\rOpenJDK 64-Bit Server VM (build 24.131-b00, mixed mode)\rCambiar prioridad\n# update-alternatives --install \u0026quot;/usr/bin/javac\u0026quot; \u0026quot;javac\u0026quot; \u0026quot;/usr/lib/jvm/java-8-oracle/jre/bin/java\u0026quot; 1001\rupdate-alternatives: utilizando /usr/lib/jvm/java-8-oracle/jre/bin/java para proveer /usr/bin/javac (javac) en modo automático\r```\r","description":"Instalación de Java en Linux Debian 8","id":26,"section":"posts","tags":["debian","fotos"],"title":"Instalación de Java en Linux Debian","uri":"https://hotspotcepeda.github.io/es/posts/instalar_java_linux_debian/"},{"content":"   ","description":"Configuración LAN WAN en NanoStation M5 para GW internet","id":27,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","mesh","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 GW","uri":"https://hotspotcepeda.github.io/es/posts/nanostationm5_cliente_qmp/"},{"content":"Pasos para usar una antena Ubiquiti Nano Station en una red qmp con Lan y Wan. Las configuraciones de Vlan las vamos a hacer desde el menú de administración en el apartado de switch e interfaces.\nLa Lan es servidor de dhcp, con la configuración inicial tiene la ip 172.30.22.1/24 user/password root/13f y nos proporciona una IP de ese rango al conectarnos. Tenemos conectado en el POE que va a la boca Main del router y viene como la Vlan1\nLa Wan es cliente de dhcp, conectamos la boca Secondary a un servidor de dhcp como nuestro router domestico de ASDL o Fibra. Vamos a crear una nueva Vlan2 y asociarla a la Wan.\nPartimos de la configuracion inicial que tenemos nada mas instalar el firmware de qmp.cat\nqMp-Guifi_3.2-Clearance_Ubiquiti_NanoStation-M5-XW_sysupgrade_20151026-1823\nModificación en switch.\nPara que funcione la Wan no vale con agregar una nueva Vlan a eth0.2 al port 1,\nSolo me funciona con normalidad cuando se elimina la Vlan 12 y se agrega una nueva Vlan 2 , revisar la parte de interfaces y firewall. Untagged.\nModificación de interfaces.\nAsegurarse que la interface se está conectando a internet por la interface física Secondary eth0.2 = Vlan 2\n","description":"Configuración qMp para antena gateway con salida a internet","id":28,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 gateway internet","uri":"https://hotspotcepeda.github.io/es/posts/nanostationm5_gw/"},{"content":"La idea es poner un ap en 2.4 Ghz con un portal cautivo para tratar de dar a conocer el proyecto y ver si se anima alguien en el barrio a compartir la salida a internet.\r\nAntes de empezar vamos a configurar los servicios básicos.\nDNS Para sacarle partido a la RouterBoard se configura una cache DNS\n/ip dns\rset allow-remote-requests=yes cache-size=4096KiB servers=91.239.100.100,89.233.43.71\rRechaza peticiones dns externas:\n/ip firewall filter\radd chain=input in-interface=ether1 protocol=udp dst-port=53 action=drop\radd chain=input in-interface=ether1 protocol=tcp dst-port=53 action=drop\rY en el firewall una nueva redirección interna del puerto 53\n/ip firewall nat\radd action=redirect chain=dstnat comment=\u0026quot;Cacheo de DNS\u0026quot; dst-port=53 protocol=udp to-ports=53\rNTP /system ntp client\rset enabled=yes primary-ntp=130.206.0.1 secondary-ntp=130.206.3.166\rUSB Como vamos a montar un proxy que lo que hace básicamente es cachear las conexiones y almacenarlas para entregar inmediatamente, vamos a preparar el espacio de almacenamiento, en este caso un pendrive de 1Gb conectado a una RB951.\nPara que la RB se entienda con la memoria USB tenemos que formatearlo desde la propia RB, en Fat32, con ext3 no funcionara. Conectamos nuestro pendrive. System-\u0026gt;Disks\nProxy Ahora vamos a preparar la parte del proxy en IP-\u0026gt;Web Proxy, con el Proxy ya trabajando lo vamos a hacer transparente, pasamos las peticiones del puerto 80 al 8080.\nIP-\u0026gt;Firewall pestaña de NAT Nueva regla\nREDIRECCIÓN DE PETICIONES :80 AL :8080 (puerto del proxy cache TRANSPARENTE), SOLO PARA ether5 (puerto de captación del hotspot)\nProxy cache:\n \u0026gt; ip proxy print enabled: yes\rsrc-address: ::\rport: 8080\ranonymous: no\rparent-proxy: ::\rparent-proxy-port: 0\rcache-administrator: webmaster\rmax-cache-size: unlimited\rmax-cache-object-size: 2048KiB\rcache-on-disk: yes\rmax-client-connections: 600\rmax-server-connections: 600\rmax-fresh-time: 3d\rserialize-connections: no\ralways-from-cache: no\rcache-hit-dscp: 4\rcache-path: disk1\r/ip proxy\rset cache-on-disk=yes cache-path=disk1 enabled=yes\rY en el firewall una nueva redirección del puerto 80 al 8080\n/ip firewall nat\radd action=redirect chain=dstnat dst-port=80 protocol=tcp to-ports=8080\rHotspot Generamos el hotspot IP -\u0026gt; HOTSPOT\nYo antes de hacer el SETUP del hotspot asigno IP a la interface de captación, en este caso ether5, le he asignado la ip 192.168.100.1/24 que será la gateway de los clientes del hotspot. Creo un pool por ejemplo de 192.168.100.100-192.168.100.200 y un servidor DHCP que use el pool que hemos creado.\nDespués en el wizard del hotspot, solo hay que pulsar en todo siguiente, cuando nos pregunta el nombre del DNS ponemos \u0026ldquo;guifi.net_Acceso_Abierto\u0026rdquo; será la dirección que aparezca en la página de redirección, el archivo login.html que encontraremos en FILES.\nCuando termina el wizard del hotspot vemos que se han creado una serie de regla en IP-\u0026gt;Firewal Filter Rules, Nat y en más sitios\u0026hellip;\nTener en cuenta que si el usuario no pasa por el portal cautivo no va a tener salida a internet.\nSecurizar Es conveniente seguir las indicaciones de seguridad.\nhttps://wiki.mikrotik.com/wiki/Manual:Securing_Your_Router\nhttps://hotspotcepeda.github.io/es/posts/mikrotik_seguridad_basico/\n","description":"Un hotspot es una buena manera para encontrar alguien con quien compartir salida a internet","id":29,"section":"posts","tags":["mikrotik","hotspot","wifi"],"title":"Hotspot MikroTik con proxy transparente","uri":"https://hotspotcepeda.github.io/es/posts/mikrotik_hotspot/"},{"content":"Antes de instalar: Llevar los equipos configurados. Si a la hora de poner en funcionamiento el enlace surgen problemas: como que el equipo no enciende, mala transferencia de datos\u0026hellip; será más fácil localizar averías en el cableado, conectores y alimentación, POE.\nPlanificar el enlace: Si es posible hacer una primera visita para saber como planificar la instalación y saber que material puede hacer falta, cableados, herramienta que tenemos que llevar, accesos a zonas comunes bajo llave, etc\u0026hellip; tomar notas y fotos, ortofotos, línea de visión directa entre antenas, referencias para orientar las anteas.\nDocumentar Es muy importante mantener la documentación actualizada durante toda la vida del enlace.\nEn la instalación: Alimentación eléctrica. Mantener el uso de buenas practicas trabajado con electricidad.\nCajas estancas, diferenciales de rearme automático en instalaciones que tienen cortes en el suministro, UPS como estabilizadores de corriente, regletas de corriente con protectores de sobrecarga.\nCableado. Usar cable y conectores de buena calidad y adaptado a las necesidades de la instalación.\nCables para interior/exterior, FTP, TFTP, Cat.5, Cat6. Rotular conectores.\nTiempo. Si es posible calcular el tiempo necesario y limitarse a llevar a cavo la instalación. Hay instalaciones que se complican y se alargan, algo que nos puede ahorrar mucho tiempo es volver al día siguiente con una nueva estrategia.\nSeguridad. Mantener buenas prácticas en todo, no correr, cuidado con los trabajos en altura, precauciones con las herramientas eléctricas\u0026hellip;\nFactor humano. Mantener un horario planificado con descansos cada 2 horas nos ayuda a mantener la atención y el control en el trabajo.\nMantener buenas relaciones con todos los actores de la instalación. \u0026ldquo;CCCC\u0026rdquo;: Conserjes, Clientes, Contactos, Curiosos\u0026hellip;\nEn explotación: Monitores de red. SNMP, netflow, ICMP. Mantener control de caudales y tráfico de datos.\nMantenimiento. Comprobar con periodicidad, mantenimiento preventivo: herrajes, óxidos, cableados, orientaciones, torres y vientos. Prestar especial atención durante la primera etapa de la instalación.\nDocumentar. Documentar, documentar y documentar.\nOtros recursos. BUENAS PRACTICAS EN TORRES Y EMPLAZAMIENTOS DE TELECOMUNICACIONES Parece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rRadioenlaces analógicos y digitales: Una buena solución cuando no es posible tender cables http://fibraoptica.blog.tartanga.eus/2014/02/27/enlaces-de-microondas-una-buena-solucion-cuando-no-es-posible-tender-un-cable/\nMejores Prácticas para un Enlace Inalámbrico con Ubiquiti   ","description":"A tener en cuenta para los despliegues de radio","id":30,"section":"posts","tags":["guifi.net","hotspot","mikrotik","cepeda la mora","Ubiquiti"],"title":"Buenas practicas en la realizacion de tus radioenlaces","uri":"https://hotspotcepeda.github.io/es/posts/buenas_practicas_radioenlaces/"},{"content":"Muy fácil, para tener la vista en miniatura de archivos de imagen NEF, RAW y demás en Nautilus primero instalamos el UFRaw, si es que no lo tenemos ya:\n# apt-get update\r# apt-get install ufraw\rAhora generamos este archivo /usr/share/thumbnailers/raw.thumbnailer\n# nano /usr/share/thumbnailers/raw.thumbnailer\rCopiamos este contenido en el archivo:\n[Thumbnailer Entry]\rExec=/usr/bin/ufraw-batch --embedded-image --out-type=png --size=%s %u --overwrite --silent --output=%o\rMimeType=image/x-3fr;image/x-adobe-dng;image/x-arw;image/x-bay;image/x-canon-cr2;image/x-canon-crw;image/x-cap;image/x-cr2;image/x-crw;image/x-dcr;image/x-dcraw;image/x-dcs;image/x-dng;image/x-drf;image/x-eip;image/x-erf;image/x-fff;image/x-fuji-raf;image/x-iiq;image/x-k25;image/x-kdc;image/x-mef;image/x-minolta-mrw;image/x-mos;image/x-mrw;image/x-nef;image/x-nikon-nef;image/x-nrw;image/x-olympus-orf;image/x-orf;image/x-panasonic-raw;image/x-pef;image/x-pentax-pef;image/x-ptx;image/x-pxn;image/x-r3d;image/x-raf;image/x-raw;image/x-rw2;image/x-rwl;image/x-rwz;image/x-sigma-x3f;image/x-sony-arw;image/x-sony-sr2;image/x-sony-srf;image/x-sr2;image/x-srf;image/x-x3f;\rSalvar el archivo y ya está.\n","description":"Para ver una foto en miniatura de los archivos raw y nef en el navegador","id":31,"section":"posts","tags":["debian","fotos"],"title":"VISTA EN MINIATURA DE ARCHIVOS DE IMAGEN NEF, RAW","uri":"https://hotspotcepeda.github.io/es/posts/imagen_raw_nef_miniatura/"},{"content":"Script /system/script new and paste:\r# Written by Sam Norris, ChangeIP.com\r# Copyright ChangeIP.com 2009\r# For support send mail to Support@ChangeIP.com\r#\r# 2009-06-22 RouterOS 3.25 Tested\r# 2009-10-05 RouterOS 4.01rc1 Tested\r#\r# OVERVIEW: %\r# This script will update a ChangeIP.com dynamic dns hostname\r# with an ip address located directly on an interface.\r# %\r# NOTES: %\r# IF THIS SCRIPT DOES NOT PRODUCE ANY OUTPUT PLEASE COPY AND PASTE IT\r# AGAIN. THERE PROBABLY IS A LINE BREAK IN THE WRONG PLACE! Once you\r# have created this script and tested that it works by running it\r# manually you can schedule it to run every few minutes.\r# %\r# CONFIGURATION FIELD DEFINITIONS:\r# ddnsuser: Enter your ChangeIP.com user id.\r# ddnspass: Enter your ChangeIP.com password.\r# ddnshost: Enter the hostname (www.example.com) to update.\r# ddnsinterface: Enter an interface name to watch - case sensative.\r# %\r# %\r# %\r# %\r# % % %\r# % % %\r# % % %\r# %\r# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r# EDIT YOUR DETAILS / CONFIGURATION HERE\r# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r:global ddnsuser \u0026quot;user\u0026quot;\r:global ddnspass \u0026quot;pass\u0026quot;\r:global ddnshost \u0026quot;ddnsname.net\u0026quot;\r# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r# END OF USER DEFINED CONFIGURATION\r# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r:global ddnssystem (\u0026quot;mt-\u0026quot; . [/system package get [/system package find name=system] version] )\r/tool fetch url=\u0026quot;http://myip.dnsomatic.com/\u0026quot; mode=http dst-path=mypublicip.txt\r:global ddnsip [file get mypublicip.txt contents ]\r:global ddnslastip\r:if ([ :typeof $ddnslastip ] = \u0026quot;nothing\u0026quot; ) do={ :global ddnslastip 0.0.0.0/0 }\r:if ([ :typeof $ddnsip ] = \u0026quot;nothing\u0026quot; ) do={\r:log info (\u0026quot;DDNS: No ip address present on contents , please check.\u0026quot;)\r} else={\r:if ($ddnsip != $ddnslastip) do={\r:log info \u0026quot;DDNS: Sending UPDATE!\u0026quot;\r:log info [ :put [/tool dns-update name=$ddnshost address= $ddnsip key-name=$ddnsuser key=$ddnspass ] ]\r:log info $ddnsip\r:global ddnslastip $ddnsip\r} else={ :log info \u0026quot;DDNS: No changes necessary.\u0026quot;\r}\r}\rSchedule /system/schedule Interval: 00:10:00\r","description":"Script para renovar IP DDNS MikroTik","id":32,"section":"posts","tags":["mikrotik","debian","ddsns"],"title":"DDNS Change IP MikroTik script","uri":"https://hotspotcepeda.github.io/es/posts/ddns_change_ip_script_mikrotik/"},{"content":"https://aacable.wordpress.com/2011/11/29/howto-save-mikrotik-logs-to-remote-syslog-server/\nConviene tener los trastos en hora, configure NTP en todas sus máquinas.\r Cliente Mikrotik Con ip 10.38.15.10\n/system logging action\rset 0 memory-lines=100\rset 1 disk-file-count=30 disk-file-name=MT-log-zaib disk-lines-per-file=500\rset 3 remote=10.38.15.3\r# 10.38.15.3 ip del servidor syslog-ng :514 default port\r/system logging\radd action=remote topics=critical\radd action=remote topics=error\radd action=remote topics=info\radd action=remote topics=warning\r# registro remoto de lo que se quiera\rCliente Ubiquiti Con ip 10.38.15.1\nServidor IP 10.38.15.3 servidor donde se almacenan los LOG\n#apt-get install syslog-ng\r#mkdir /var/log/mikrotik\r#mkdir /var/log/ubnt\ren nano /etc/syslog-ng/syslog-ng.conf agregar y después reiniciar con \u0026ldquo;service syslog-ng restart\u0026rdquo;\nAccept connection on UDP\rsource s_net { udp (); };\r# MIKROTIK ########### esto genera de manera automática un fichero tipo \u0026quot;mikrotik.2016.11.01.log\u0026quot;\r# Add Filter to add our mikrotik\rfilter f_mikrotik { host( \u0026quot;10.38.15.10\u0026quot; ); };\r# Add destination file where logs will be stored\r#destination df_mikrotik { file(\u0026quot;/var/log/mikrotik.log\u0026quot;); };\rlog { source ( s_net ); filter( f_mikrotik ); destination ( df_mikrotik ); };\rdestination df_mikrotik {\rfile(\u0026quot;/var/log/mikrotik/mikrotik.${YEAR}.${MONTH}.${DAY}.log\u0026quot;\r# template(\u0026quot;${HOUR}:${MIN}:${SEC} ${HOST} ${MSG} ${MSG}\\n\u0026quot;)\rtemplate-escape(no));\r};\r# UBNT ########### esto genera de manera automática un fichero tipo \u0026quot;ubnt.2016.11.01.log\u0026quot;\r# Add Filter to add our ubnt\rfilter f_ubnt { host( \u0026quot;10.38.15.1\u0026quot; ); };\r# Add destination file where logs will be stored\r#destination df_ubnt { file(\u0026quot;/var/log/ubnt.log\u0026quot;); };\rlog { source ( s_net ); filter( f_ubnt ); destination ( df_ubnt ); };\rdestination df_ubnt {\rfile(\u0026quot;/var/log/ubnt/ubnt.${YEAR}.${MONTH}.${DAY}.log\u0026quot;\r# template(\u0026quot;${HOUR}:${MIN}:${SEC} ${HOST} ${MSG} ${MSG}\\n\u0026quot;)\rtemplate-escape(no));\r};\rVer log live tail -f /var/log/mikrotik/mikrotik*.log\r","description":"Guardar log de MikroTik y Ubiqiti en servidor remoto Linux Debian","id":34,"section":"posts","tags":["mikrotik","debian","linux","log","Ubiquiti"],"title":"Guardar log de MikroTik y Ubiqiti en servidor","uri":"https://hotspotcepeda.github.io/es/posts/log_remoto_syslog-ng/"},{"content":"Instalación # apt-get install snmp snmpd snmp-mibs-downloader\rConfiguracón Cambiar en nano /etc/snmp/snmpd.conf:\nagentAddress udp:127.0.0.1:161\r...\rrocommunity public default -V systemonly\rpor:\nagentAddress udp::161\r...\rrocommunity public\rcambiar en nano /etc/snmp/snmp.conf:\nmibs :\rpor:\n#mibs :\rReiniciar snmpd\n# service snmpd restart\rComprobar: snmpwalk -v 2c -c public IP\r","description":"Configuracion de cliente SNMP en linux Debian","id":35,"section":"posts","tags":["debian","jessie","SNMP","linux"],"title":"Cliente SNMP linux","uri":"https://hotspotcepeda.github.io/es/posts/cliente_snmp_linux/"},{"content":"http://gregsowell.com/classes/mtk-security/GregSowell-mikrotik-security.pdf\nSi el router está conectado a internet puedes tener seguro que lo van a intentar dominar de todas las maneras posibles.\r System -\u0026gt; Password Poner una contraseña segura, con PassGen se pueden generar passwords seguras, pero no olvidar !\nSystem -\u0026gt; Users Es buena idea cambiar el nombre del usuario administrador, Cambiar admin por lo que sea. Los zombis están todo el santo día dando la matraca y probando con usuarios y password default. no olvidar !\nIp -\u0026gt; Services Aquí es donde se abren y cierran las puertas de gestión de la RB. Es recomendable deshabilitar todo lo que no se use y personalizar lo que se use. Es buena idea cambiar el puerto por defecto del winbox :8291 a otro puerto no olvidar !. Para invocar al equipo desde winbox por otro puerto IP_DE_LA_RB:PUERTO.. También se pueden permitir gestión solo a ip o redes concretas. Si queremos activar el FTP o otro servicio hacerlo solo cuando se valla a usar y por un puerto distinto para que no se identifique el servicio, porque si estás conectado a internet te van a escanear los puertos todo el rato.\nHay configuraciones para detectar y parar los escaneos de puertos, ataques Syn Flod y los ataques ssh.\nIp -\u0026gt; Neighborgs Deshabilitar las interfaces no confiables, se genera broadcast para descubrir equipos.\nTools -\u0026gt; BTest Server Deshábilitar todo y habilitar solo cuando se use.\nSystem Logging EL log que guarda la RB es limitado, lo recomendable es usar otro servidor para ir guardando los log.\nhttps://aacable.wordpress.com/2011/11/29/howto-save-mikrotik-logs-to-remote-syslog-server/\nEn el router indicar la ip del servidor de logs y los temas que queremos enviar al servidor.\nEn el servidor:\n# apt-get update\r# apt-get install syslog-ng\r# mkdir /var/log/mikrotik\r# touch /var/log/mikrotik/mikrotik.log\r# nano /etc/syslog-ng/syslog-ng.conf\rAgregamos esto antes de la sección de sources\n##\r# Aceptar conexiones UDP\rsource s_net { udp (); };\r# agragar filtro de la mikrotik\rfilter f_mikrotik { host( \u0026quot;IP_DE_MIKROTIK\u0026quot; ); };\r# lugar donde se van a ir guardando los log\rdestination df_mikrotik { file(\u0026quot;/var/log/mikrotik/mikrotik.log\u0026quot;); };\rlog { source ( s_net ); filter( f_mikrotik ); destination ( df_mikrotik ); };\r##\r```\rGuardar archivo y reiniciar servicio\r```\r# service syslog-ng restart\r```\rPara ver si nos funciona el invento hacer algo en la RB y ver el archivo.\r```\r# cat /var/log/mikrotik/mikrotik.log\r```\rPara ver en live el log de la mikrotik\r```\r# tail -f /var/log/mikrotik/mikrotik.log\r```\rPara hacer rotación diaria de log, editar y agregar al principio del archivo.\r```\r# nano /etc/logrotate.d/syslog-ng\r/var/log/mikrotik/mikrotik.log\r{\rdaily\rrotate 90\rcompress\rnotifempty\rmissingok\rsharedscripts\r/etc/init.d/syslog-ng restart\rendscript\r}\r```\rGuardar archivo y reiniciar servicio\r```\r# service syslog-ng restart\r```","description":"Medidas básicas de seguridad con MikroTik al poner en producción","id":36,"section":"posts","tags":["mikrotik"],"title":"Seguridad básica con MikroTik","uri":"https://hotspotcepeda.github.io/es/posts/mikrotik_seguridad_basico/"},{"content":"¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r\n27/03/2021 Ojo con las nuevas remesas de de equipamiento Ubiquiti, las nuevas revisiones 2000K y superiores de NanoStation Loco M5 no funcionan ni con OpenWRT ar71xx ni con OpenWRT ath79, ni tan siquiera probando OpenWRT ath79 para Bullet M XW que sí funciona en las Rocket M XW. Al parecer hay dos arquitecturas distintas que sirven para distintas revisiones de hardware de Ubiquiti .La ar71xx es la de siempre, antes funcionaba, la ath79 es la nueva. No sé sabe todavía la manera de flashearlas.\r\nPreparación Si el trasto viene con un firmware XW.v5.5.10-u2.28005.150723.1358 hacer ftp de qmp directamente.\nSi viene con un firmware superior hacer downgrade a la versión XW.v5.5.10-u2.28005.150723.1358 desde el menú de la web.\nA tener en cuenta:\n Conectar más de 1 router como gw a la red qMp no funciona bien, si se quiere conectar a otra wan vale, pero no a la misma, hace bucle y asigna pipa 169. Despues de flasear y configurar el router para añadirlo a la red qMp es recomendable apagar y encender. Kalimotxo + Kalimotxo ok, pero no funciona bien kalimotxo + RC2 o RC3  # apt-get install tftp-hpa # para poder hacer ftp\rCargar el firmware:  Con el trasto apagado pisar el reset y encender = TRENECITO \u0026ndash;\u0026gt; PARPADEO X3 LUCES Y SOLTAR RESET entramos en modo bootloader ftp. Fijar una IP en el rango del trasto que es 192.168.1.20/24 http://fw.qmp.cat/stable/ para seleccionar el FW ir a directorio que corresponda. Selecionar el .bin guifi master factory del cacharro M2 o M5 (presta gráficas de ping a mayores de consumo), descargarlo como qMp.bin  \u0026gt;tftp 192.168.1.20 desde el directorio donde esta el qMp.bin\r\u0026gt;mode binary\r\u0026gt;trace on\r\u0026gt;put qMp.bin\rSi se interrumpe la alimentación cuando estamos editando el firmware despídete del aparato.\r Se instala el nuevo FW, pasado un tiempo el cacharro se reinicia con el nuevo FW\nPoner la interface en auto DHCP, entrarle al cacharro desde el navegador 172.30.22.1 root – 13f\nLos dispositivos se conectan a la red sin hacer nada más quie configurar los parámetros de la wifi, país, canal, hostname e IP.\nIr a configuración del nodo qMp \u0026ndash;\u0026gt; qMp easy setup Cambiamos el modo de roadming a comunity\nPoner el nombre del nodo de acuerdo al nombre del nodo guifi.net o hacer el 1 solo click dede el menu guifi.net de la web qmp.\nIP address de acuerdo a la de guifi.net con su mascara.\nAtento a la denominación del nodo = hostname es qMpX-YYYY\nAtención Si queremos separar la red en dos o mas:\n Cada red usará un canal, en un primer momento todos están en el mismo canal y misma red. Ir a configuración del nodo wireless setings para cambiar canal a los equipos que queramos que estén en otra red. Hay dos menus de administración del qMp y del WRT / Para descubrir redes qMp hacemos un SCAN desde las redes qMp, son ad-Hoc.  ","description":"Instalar qMp en NanoStation M5","id":37,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","internet","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 qMp","uri":"https://hotspotcepeda.github.io/es/posts/qmp_nanostation_m5/"},{"content":"Modos de trabajo,\n Client configuration for an ethernet bridge VPN tap Client configuration for a routed multi-client VPN tun Simple client configuration for a routed point-to-point VPN tun Server configuration for an ethernet bridge VPN tap Server configuration for a routed multi-client VPN tun Simple server configuration for a routed point-to-point VPN tun Tipo de servidor opción: Server configuration for a routed multi-client VPN  ","description":"OpenVNP en OpenWRT server","id":38,"section":"posts","tags":["OpenWRT","OpenVPN"],"title":"OpenVNP en OpenWRT server","uri":"https://hotspotcepeda.github.io/es/posts/openwrt_openvpn/"},{"content":"Para hacer un USB boot con varios SO ya sea de diagnostico o live la mejor herramienta que he encontrado es MULTISYSTEM.\nAdmite trabajar en modo persistente guardando los cambios o en live.\nhttp://liveusb.info/dotclear/index.php?pages/install\nEs buena cosa contar con un USB con herramientas de diagnostico y lives de SO para instalar, siempre que la maquina donde lo conectemos tenga capacidad de arrancar desde USB.\n","description":"USB MULTIBOOT MULTISYSTEM genial","id":39,"section":"posts","tags":["USB","multisystem","debian"],"title":"USB MULTIBOOT MULTISYSTEM","uri":"https://hotspotcepeda.github.io/es/posts/multiboot_multisystem/"},{"content":"https://openvpn.net/index.php/open-source/documentation/howto.html\nhttps://aula128.wordpress.com/2015/02/07/openvpn-instalacion-y-configuracion-del-servidor-en-linux-y-autentificacion-de-un-cliente-windows-7/\nhttp://www.redeszone.net/redes/openvpn/\r apt-get install easy-rsa\rapt-get install openvpn\rCopiar los DIRECTORIOS easy-rsa y sample-config-files a /etc/openvpn/\n/usr/share/doc/openvpn/examples# cp -R sample-config-files/ /etc/openvpn/\r/usr/share# cp -R easy-rsa/ /etc/openvpn/\r/etc/openvpn# ls\reasy-rsa sample-config-files update-resolv-conf\r/etc/openvpn# cd sample-config-files/\r/etc/openvpn/sample-config-files# ls\rclient.conf home.up loopback-server openvpn-shutdown.sh README static-home.conf tls-home.conf xinetd-client-config\rfirewall.sh loopback-client office.up openvpn-startup.sh server.conf.gz static-office.conf tls-office.conf xinetd-server-config\rCrear carpeta de claves\n/etc/openvpn/easy-rsa# mkdir keys\r/etc/openvpn/easy-rsa# ls\rbuild-ca build-key build-key-server changelog.Debian.gz inherit-inter openssl-0.9.6.cnf pkitool revoke-full whichopensslcnf\rbuild-dh build-key-pass build-req clean-all keys openssl-0.9.8.cnf README-2.0.gz sign-req\rbuild-inter build-key-pkcs12 build-req-pass copyright list-crl openssl-1.0.0.cnf README.Debian vars\rEditamos vars y modificamos KEY_COUNTRY, KEY_PROVINCE, KEY_CITY, KEY_ORG y KEY_MAIL… a nuestro gusto, También modificamos la ruta de salida de claves export KEY_DIR=”/etc/openvpn/easy-rsa/keys/” y guardamos cambios.\nLos parámetros Diffie Hellman se generar para el servidor. Si se genera en una maquina potente tarda unos segundos, si lo generamos en un router domestico más de 40 minutos.\n/etc/openvpn/easy-rsa# ./build-dh\rCertificado para la CA\n/etc/openvpn/easy-rsa# ./pkitool --initca\rCertificado y llaves para el SERVER\n/etc/openvpn/easy-rsa# ./pkitool --server servidor\rCertificado y llaves para el CLIENTE\n/etc/openvpn/easy-rsa# ./pkitool clienteA\r/etc/openvpn/easy-rsa# ./pkitool clienteB\r/etc/openvpn/easy-rsa# ./pkitool clienteX\rLlave para servidor y cliente TLS-AUTH; Las directivas tls-auth ofrecen un nivel adicional de seguridad por encima de la proporcionada por SSL / TLS\n/etc/openvpn/easy-rsa/keys# openvpn --genkey --secret sanpe.key\rSe coloca en el mismo directorio que el .key RSA y archivos .crt.\nEn la configuración del servidor, añadir:\nTLS-auth sanpe.key 0\rEn la configuración del cliente, añadir:\nTLS-auth sanpe.key 1\rNuevo contenido de la carpeta keys.\n/etc/openvpn/easy-rsa/keys# ls -sal\rtotal 336\r4 drwx------ 2 root root 4096 abr 16 14:55 .\r4 drwxr-xr-x 3 root root 4096 abr 16 14:55 ..\r8 -rw-r--r-- 1 root root 5715 abr 16 14:41 01.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:48 02.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 03.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 04.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 05.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 06.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 07.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 08.pem\r8 -rw-r--r-- 1 root root 5593 abr 16 14:51 09.pem\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0A.pem\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0B.pem\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0C.pem\r4 -rw-r--r-- 1 root root 1801 abr 16 14:40 ca.crt\r4 -rw------- 1 root root 1704 abr 16 14:40 ca.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:48 clienteA.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:48 clienteA.csr\r4 -rw------- 1 root root 1708 abr 16 14:48 clienteA.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteB.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteB.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteB.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteC.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteC.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteC.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteD.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteD.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteD.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteE.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteE.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteE.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteF.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteF.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteF.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteG.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteG.csr\r4 -rw------- 1 root root 1704 abr 16 14:50 clienteG.key\r8 -rw-r--r-- 1 root root 5593 abr 16 14:51 clienteH.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteH.csr\r4 -rw------- 1 root root 1704 abr 16 14:51 clienteH.key\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteI.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteI.csr\r4 -rw------- 1 root root 1704 abr 16 14:51 clienteI.key\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteJ.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteJ.csr\r4 -rw------- 1 root root 1708 abr 16 14:51 clienteJ.key\r8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteK.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteK.csr\r4 -rw------- 1 root root 1704 abr 16 14:51 clienteK.key\r4 -rw-r--r-- 1 root root 424 abr 16 14:38 dh2048.pem\r4 -rw-r--r-- 1 root root 1800 abr 16 14:51 index.txt\r4 -rw-r--r-- 1 root root 21 abr 16 14:51 index.txt.attr\r4 -rw-r--r-- 1 root root 21 abr 16 14:51 index.txt.attr.old\r4 -rw-r--r-- 1 root root 1650 abr 16 14:51 index.txt.old\r4 -rw------- 1 root root 636 abr 16 14:55 sanpe.key\r4 -rw-r--r-- 1 root root 3 abr 16 14:51 serial\r4 -rw-r--r-- 1 root root 3 abr 16 14:51 serial.old\r8 -rw-r--r-- 1 root root 5715 abr 16 14:41 servidor.crt\r4 -rw-r--r-- 1 root root 1102 abr 16 14:41 servidor.csr\r4 -rw------- 1 root root 1704 abr 16 14:41 servidor.key\rEl paso final en el proceso de generación de claves es copiar todos los archivos en las máquinas que los necesitan, teniendo cuidado de copiar los archivos secretos por un canal seguro.\n","description":"Crear CERTIFICADOS OPENVNP en Debian","id":40,"section":"posts","tags":["debian","openVPN","linux"],"title":"CERTIFICADOS OPENVNP","uri":"https://hotspotcepeda.github.io/es/posts/certificado_openvpn/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones. Cambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes algún router viejo por casa y es compatible. Dependiendo del router es más o menos fácil cargar el firmware, este router que tiene USB es fácil y va genial.\nhttps://wiki.openwrt.org/toh/huawei/hg556a\n1. Seleccionar firmware: Seleccionamos el firmware en base al modelo y sacamos el modelo en base al numero de serie del trasto:\nRouter version\tBoard model\tWifi chip\tVdf Version *\nSerial number (first 5 digits)\tFlash chip erasesize **\tcal_data offset\tSupported\tNotes\nA\tHG55VDFA VER.C\tAtheros AR9223\tHG556AVDFA\t30462, 30562, 30605, 30608, 30634\t0x10000\t0xf7e000\tYes\tADSL not supported\nVoIP not supported\nB\tHG556BVDFA\t30692, 30693, 31110, 31300\t0x20000\t0xefe000\nC\tHG56BZRB VER.A\tRalink RT3062F\tHG556CVDFA\t30555, 30694, 30695, 31301, 31507, 31525, 31901, 31902, 31935, 32505\t0x20000\t0xeffe00\tYes\n2. Instalar el firmware Si en algún momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que página entregarnos, la cache no coincide con la realidad.\r\nSelecionamos el .bin, como mi numero de serie de mi trasto empieza por 30692 me corresponde la versión B:\nopenwrt-15.05-brcm63xx-generic-HG556a_B-squashfs-cfe.bin\nPisamos el boton restart del trasto y le damos corriente, mantenemos pulsado unos 15 segundos para acceder a la web de carga del firmware del bootloader.\nNos conectamos en la LAN2 del router y nos ponemos una ip del rango 192.168.1.x/24\nY a cargar el Firmware… Seleccionamos el .bin y Update Software, dice que tarda unos 2 minutos, vemos que el led del power parpadea y se van encendiendo otros led, vamos a dejarlo un buen rato. Esperamos a que la luz del power se quede fija y nos entregue ip.\nSi se interrumpe la alimentación cuando estamos editando el firmware despídete del aparato.\r\n3. Configuración como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contraseña, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1  dhclient eth0   Nos conectamos a la LAN, vamos al navegador, 192.168.1.1 y ya nos aparece el user password de administración del LUCI que nos sugiere fijar un password de root.\nPrestar atención al la IP de la LAN, para que al poner router conectado al router con internet no estén los dos con los mismos rangos..\nclick en Go to password configuration… para cambiar el password de root, con esto se activa el acceso SSH por consola, si no, solo funciona telnet.\nVamos a convertirlo en router neutro, una boca wan y el resto lan.\nClick en network Switch add y lo dejamos así.\nVamos a Network interfaces y lo dejamos así:\nCon el servidor de DHCP de la LAN en un rango distinto a la WAN , interface VLAN2 eth0.2\nLa WAN cliente de DHCP conectada a aun router que entregue IP y con salida a internet, interface VLAN1 eth0.1\nEn este caso el firmware viene con los drivers WIFI y USB, si hubiera que instalarlos entrar por SSH y ejecutar:\nopkg update\nopkg install kmod-ath9k\nopkg install kmod-usb-ohci kmod-usb2\nopkg install usbutils\nreboot \u0026amp;\u0026amp; exit\nlsusb\n4 Comprobaciones Se accede a lUCI perfectamente, la wifi es muy buena. SoC Broadcom 6358 / 64MB RAM / 16MB Flash.\n","description":"OPENWRT en HUAWEI ECHOLIFE HG556A Una joya!","id":41,"section":"posts","tags":["OpenWRT","router neutro","wifi"],"title":"OPENWRT EN HUAWEI ECHOLIFE HG556A","uri":"https://hotspotcepeda.github.io/es/posts/openwrt-huawei_echolife_hg556a/"},{"content":"Repositorios: # nano /etc/apt/sources.list Instalar KEYS de los repos\ngpg --keyserver pgpkeys.mit.edu --recv-key C90F9CB90E1FAD0C\rgpg --export --armor C90F9CB90E1FAD0C | sudo apt-key add -\rapt-get install debian-keyring debian-archive-keyring\rapt-get install deb-multimedia-keyring\rRaspbian\ndeb http://mirrordirector.raspbian.org/raspbian/ jessie main contrib non-free rpi\r# Uncomment line below then 'apt-get update' to enable 'apt-get source'\r#deb-src http://archive.raspbian.org/raspbian/ jessie main contrib non-free rpi\rThe directory /etc/apt/sources.list.d contains the file\nraspi.list\n/etc/apt/sources.list.d/raspi.list\rdeb http://archive.raspberrypi.org/debian/ jessie main ui\r# Uncomment line below then 'apt-get update' to enable 'apt-get source'\r#deb-src http://archive.raspberrypi.org/debian/ jessie main ui\rJessie\n## DEBIAN OFICIAL\rdeb http://ftp.fi.debian.org/debian/ jessie main contrib non-free\r# deb-src http://ftp.fi.debian.org/debian/ jessie main contrib non-free\r## DEBIAN SECURITY\rdeb http://security.debian.org/ jessie/updates main contrib non-free\r# deb-src http://security.debian.org/ jessie/updates main contrib non-free\r## Debian JESSIE-UPDATES\rdeb http://ftp.fi.debian.org/debian/ jessie-updates main contrib non-free\r# deb-src http://ftp.fi.debian.org/debian/ jessie-updates main contrib non-free\r## DEBIAN JESSIE BACKPORTS\rdeb http://ftp.fi.debian.org/debian/ jessie-backports main contrib non-free\r# deb-src http://ftp.fi.debian.org/debian/ jessie-backports main contrib non-free\r## MULTIMEDIA ## Instalar key # apt-get install deb-multimedia-keyring\rdeb http://www.deb-multimedia.org jessie main non-free\r# i2p\r# deb http://deb.i2p2.no/ jessie main\r# deb-src http://deb.i2p2.no/ jessie main\r# VirtualBox\r# deb http://httpredir.debian.org/debian/ jessie main contrib\r# winehq\r# deb https://dl.winehq.org/wine-builds/debian/ jessie main\r# virtualBox\r# deb http://download.virtualbox.org/virtualbox/debian jessie non-free contrib\r# Multisystem para hacer USB multiboot\r# deb http://liveusb.info/multisystem/depot all main\r# Ubiquiti UniFi updates\r# deb http://www.ubnt.com/downloads/unifi/debian stable ubiquiti\r# Java 8 9 siempre update deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main\r## Firefox Debian Mozilla team # Instalar key # apt-get install pkg-mozilla-archive-keyring# Instalar Firefox # apt-get update \u0026amp;\u0026amp; apt-get install -t jessie-backports firefox firefox-l10n-es-$\r# deb http://mozilla.debian.net/ jessie-backports firefox-release\r# Repositorios guifi.net\r# deb http://serveis.guifi.net/debian guifi/\r# repositorios webmin\r# deb http://download.webmin.com/download/repository jessie contrib\r# Repositorios AirControl ubiquiti\r# deb http://ftp.uk.debian.org/debian squeeze main non-free\rDriver de la tarjeta wifi: # apt-get update \u0026amp;\u0026amp; apt-get install firmware-iwlwifi\r# modprobe -r iwlwifi ; modprobe iwlwifi\rAuto login\nhttp://www.linuxserve.com/2015/06/how-to-enable-automatic-login-on-debian.html\rCon GDM3\r# nano /etc/gdm3/daemon.conf\rAutomaticLoginEnable = true\rAutomaticLogin = USUARIO\rCon LightDM\rnano /etc/lightdm/lightdm.conf\rautologin-user=USUARIO\rautologin-user-timeout=0\rAutocompletar con tabulador # apt-get install bash-completion\r# vi /etc/bash.bashrc\r# enable bash completion in interactive shells\rif ! shopt -oq posix; then\rif [ -f /usr/share/bash-completion/bash_completion ]; then\r. /usr/share/bash-completion/bash_completion\relif [ -f /etc/bash_completion ]; then\r. /etc/bash_completion\rfi\rfi\rInterfaces de red # nano /etc/network/interfaces\r# cat /etc/network/interfaces\r# This file describes the network interfaces available on your system\r# and how to activate them. For more information, see interfaces(5).\r# source /etc/network/interfaces.d/*\r# The loopback network interface\rauto lo\riface lo inet loopback\r# The eth0 network interface\rauto eth0\rallow-hotplug eth0\riface eth0 inet dhcp\r# Static IP address\r# auto eth0\r# iface eth0 inet static\r# address 192.168.1.100\r# netmask 255.255.255.0\r# network 192.168.1.0\r# broadcast 192.168.1.255\r# gateway 192.168.1.1\rMantiene DNS con reinicio # apt-get install resolvconf\r# cat /etc/resolv.conf\r# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)\r# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN\rnameserver 80.58.61.250\rnameserver 80.58.61.254\rsearch Home\r# nano /etc/resolvconf/resolv.conf.d/base\rPoner aquí los DNS que queramos guardar permanentemente y actualizar con resolvconf -u\rnameserver 8.8.8.8\rnameserver 8.8.4.4\rRetoques en grub # nano /etc/default/grub\r# sudo update-grub\rMigrar correo icedove o thunderbird Se copia la carpeta del profile y se borra la que tenga, para ver la ruta de la carpeta del profile\nmenu help -\u0026gt; Troubleshooting Information\n","description":"Rutina para después de instalar Debian Jessie ","id":42,"section":"posts","tags":["debian","jessie","linux"],"title":"Rutina para después de instalar Debian","uri":"https://hotspotcepeda.github.io/es/posts/postinstalacion_debian/"},{"content":"VirtualBox Vamos a virtualizar RouterOS en una vieja maquina para convertirlo en hotspot MikroTik.\nNecesitamos una maquina que tenga más de una interfaz de red, un router con una sola interfaz no tiene mucho sentido.\nUn PC Pentium 4 completo se puede encontrar de segunda mano por 50 euros, y tarjetas de red 10/100 las regalan.\nEn el servidor nos aseguramos que en la bios esté marcada la casilla de virtualización, (la máquina tiene que soportar virtualización VT-x o AMD-V) ya de paso en la sección de power management que el servidor se encienda si hay una interrupción de la alimentación eléctrica.\nTambién vamos a decirle al servidor que arranque automáticamente nuestro router virtualizado cuando se encienda.\nPara ver si nuestra maquina Linux cumple con los requisitos para virtualizar podemos ejecutar unos comandos desde la consola:\negrep -c '(vmx|svm)' /proc/cpuinfo # Nos dice el número de procesadores que soportan virtualización\r4\runame -m # Nos dice si el kernel es de 32 o de 64 bit:\rx86_64\rPrimero se instala una Debian y sobre ésta el VirtualBox.\nAhora importamos la imagen MikroTik-6.29.1.ova desde el VirtualBox.\nSe ajustan las opciones de red de la maquina virtual, en este caso se elige la opción sencilla y se pone la interfaz de red en bridge con la maquina virtual para tener salida a internet.\nMikroTik Y vamos con la configuración del MikroTik.\nPara configurar el router descargar WinBox, esto es gracioso, por que es una aplicación para windows que se usa para gestionar un sistema basado en linux, y de momento no hay WinBox para linux así que tenemos que instalar Wine para poder trabajar desde linux con WinBox.\nHotspot Aquí una guía para HotSpot guifi.net https://guifi.net/node/31382\nEn nuestro HotSpot vamos a tener 2 modelos de usuarios en “user profiles”.\n Trial, es un usuario ocasional con caudal limitado y tiempo de sesión de 1 hora al día, el contador de tiempo se resetea cada 12 horas. El usuario accede a internet con un click. Registrado, es un usuario que ha solicitado acceso mediante registro, (enviando un mail al administrador) cuenta con un usuario (mail) y una contraseña que le permite el acceso ilimitado en tiempo de sesión. También tiene el caudal limitado.  Firewall, además de las reglas básicas vamos a eliminar el uso de P2P para todos los clientes del HotSpot. https://wiki.mikrotik.com/wiki/Basic_universal_firewall_script\nLos router MikroTik pueden ejecutar script y tienen un programador de tareas. Esto viene muy bien para hacer copias de seguridad periódicas, enviar log de actividad por mail, programar reinicios automaticos, hacer limpiezas de caché, avisarnos de alarmas o alertas de funcionamiento. https://wiki.mikrotik.com/wiki/Scripts\nhttps://wiki.mikrotik.com/wiki/Manual:System/Scheduler\nLas restricciones en navegación se van ha hacer en base a la salida a internet que tengamos. El HotSpot de acceso abierto es un servicio limitado o muy limitado, dependiendo del ancho de banda con el que se cuente, está orientado a dar a conocer nuestro proyecto y fomentar el uso de las redes comunitarias como guifi.net.\n","description":"Virtualizando hotspot MikroTik RouterOS con VirtualBox","id":43,"section":"posts","tags":["mikrotik","hotspot","VirtualBox","RouterOS","wifi","guifi.net","cepeda la mora"],"title":"Virtualizar hotspot MikroTik","uri":"https://hotspotcepeda.github.io/es/posts/virtualizar_hotspot_mikrotik/"},{"content":"Vista la experiencia no soy partidario de usar hotspot con portal cautivo, entiendo que en algunos escenarios puede ser de utilidad.\r Intro La cosa es que cuando hacemos un hotspot con MikroTik una de los problemas que nos encontramos tras hacer el wizard es que el usuario que se conecta obtiene ip de manera correcta pero a la hora de ser redireccionado al portal cautivo si va a una dirección https no se le muestra la página y le sale un error 404.\nY es que dentro de la Router Board hay un servidor web donde tenemos que hacer nuestra página web.\nPara solucionar la redireecion con https hay que generar un par de archivos e importarlos en el Mikrotik, ya sea por consola o por winbox. Necesitamos un certificado y una clave, .crt y .key, para generarlos necesitamos la herramienta openssl, si no la tenemos lo primero seria instalarlos, bueno lo primero sería instalar una distribución de Linux.\n# apt-get update\r# apt-get install openssl\rClave privada Generamos una clave privada y una key, nos pedirá un password que debemos recordar.\n# openssl genrsa -des3 -out ca.key 4096\rEnter pass phrase for ca.key: (password)\rYa tenemos un archivo que se llama ca.key,\nCertificado Ahora vamos a generar el .crt con esa key en este caso es para 3650 días, 10 años.\n# openssl req -new -x509 -days 3650 -key ca.key -out ca.crt\rEmpieza el dialogo donde nos va preguntando datos y vamos poniendo lo que nos pide.\nAhora generamos la key/certificado par para el servidor, nos pide de nuevo contraseña, recordar:\n # openssl genrsa -des3 -out server.key 4096\rGenerating RSA private key, 4096 bit long modulus\r...........................................................................................................................++\r....................................++\re is 65537 (0x10001)\rEnter pass phrase for server.key: (passwor)\rVerifying - Enter pass phrase for server.key: (password)\rSe asocia la key al certificado y de nuevo el dialogo donde vamos poniendo lo que nos pida:\n # openssl req -new -key server.key -out server.csr\rEnter pass phrase for server.key: (password)\rYou are about to be asked to enter information that will be incorporated\rinto your certificate request.\rWhat you are about to enter is what is called a Distinguished Name or a DN.\rThere are quite a few fields but you can leave some blank\rFor some fields there will be a default value,\rIf you enter '.', the field will be left blank.\r-----\rCountry Name (2 letter code) [AU]:\rState or Province Name (full name) [Some-State]:\rLocality Name (eg, city) []:\rOrganization Name (eg, company) [Internet Widgits Pty Ltd]:\rOrganizational Unit Name (eg, section) []:\rCommon Name (e.g. server FQDN or YOUR name) []:\rEmail Address []:\rPlease enter the following 'extra' attributes\rto be sent with your certificate request\rA challenge password []:(password)\rAn optional company name []:\rAsociar los crs y la key al crt Ejecutamos:\n # openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt\rSignature ok\rsubject=/C= /ST= /L= /O= /OU= /CN= /emailAddress=\rGetting CA Private Key\rEnter pass phrase for ca.key: (password)\rEstos son los archivos que nos quedan al finalizar si hay algo raro o que no os guste, pues se repiten todos los pasos.\n# ls\rca.crt ca.key server.crt server.csr server.key\rImportar a la MikroTik Luego para importarlos solo tenemos que copiar 2 archivos, el server.crt y server.key en el MikroTik, los otros archivos los guardamos. Por ftp o por WinBox los pasamos a files y los importamos por consola o desde el menu SYSTEM-\u0026gt;CERTIFICATES del WinBox. Este es el ejemplo de importación desde la consola del MikroTik.\n[admin@MikroTik] /certificate\u0026gt; import file-name=server.crt\rpassphrase:(password)\rcertificates-imported: 1\rprivate-keys-imported: 0\rfiles-imported: 1\rdecryption-failures: 0\rkeys-with-no-certificate: 0\r[admin@MikroTik] /certificate\u0026gt; import file-name=server.key\rpassphrase:(password)\rcertificates-imported: 0\rprivate-keys-imported: 1\rfiles-imported: 1\rdecryption-failures: 0\rkeys-with-no-certificate: 0\rConfigurar en hotspot Ya solo nos queda marcar en la casilla del hotspot -\u0026gt; «login by» https y en services el https seleccionando el certificado que hemos importado.\nAhora cuando se conecte al hotspot y se tenga una página https como pagína de inicio en su navegador (que es lo más normal), se le redireccionará al portal cautivo donde se presentará al HotSpot y ya sea con usuario y contraseña o como invitado, podrá navegar y hacer uso del servicio.\nEste es el portal cautivo que teníamos en Cepeda.\n","description":"Portal cautivo y la redirección de https","id":44,"section":"posts","tags":["mikrotik","hotspot","wifi","cepeda la mora"],"title":"Portal cautivo hotspot mikrotik","uri":"https://hotspotcepeda.github.io/es/posts/portal_cautivo_hotspot_mikrotik/"},{"content":"Este banner bash requiere de:\n# apt-get install uprecords hddtemp lm-sensors\r\r #!/bin/bash\r$\u0026gt;\u0026gt; _\rtxtblk='\\e[0;30m' # Black - Regular\rtxtred='\\e[0;31m' # Red\rtxtgrn='\\e[0;32m' # Green\rtxtylw='\\e[0;33m' # Yellow\rtxtblu='\\e[0;34m' # Blue\rtxtpur='\\e[0;35m' # Purple\rtxtcyn='\\e[0;36m' # Cyan\rtxtwht='\\e[0;37m' # White\rbldblk='\\e[1;30m' # Black - Bold\rbldred='\\e[1;31m' # Red\rbldgrn='\\e[1;32m' # Green\rbldylw='\\e[1;33m' # Yellow\rbldblu='\\e[1;34m' # Blue\rbldpur='\\e[1;35m' # Purple\rbldcyn='\\e[1;36m' # Cyan\rbldwht='\\e[1;37m' # White\runkblk='\\e[4;30m' # Black - Underline\rundred='\\e[4;31m' # Red\rundgrn='\\e[4;32m' # Green\rundylw='\\e[4;33m' # Yellow\rundblu='\\e[4;34m' # Blue\rundpur='\\e[4;35m' # Purple\rundcyn='\\e[4;36m' # Cyan\rundwht='\\e[4;37m' # White\rbakblk='\\e[40m' # Black - Background\rbakred='\\e[41m' # Red\rbakgrn='\\e[42m' # Green\rbakylw='\\e[43m' # Yellow\rbakblu='\\e[44m' # Blue\rbakpur='\\e[45m' # Purple\rbakcyn='\\e[46m' # Cyan\rbakwht='\\e[47m' # White\rtxtrst='\\e[0m' # Text Reset\rclear\recho \u0026quot;\u0026quot;\recho -e \u0026quot;\\033[44m Welcome server Ayto Cepeda guifi.net! \u0026quot;\recho -en \u0026quot;\\033[1;32m\r\\033[0;36m+++++++++++++++++: \\033[0;37m${undylw}System Data\\033[0;36m :++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r+ \\033[0;37mHostname \\033[0;36m = \\033[1;32m`hostname`\r\\033[0;36m+ \\033[0;37mAddress \\033[0;36m = \\033[1;32mCepeda La Mora, Avila\r\\033[0;36m+ \\033[0;37mKernel \\033[0;36m = \\033[1;32m`uname -r`\r\\033[0;36m+ \\033[0;37mUptime \\033[0;36m =\\033[1;32m`uptime | awk '{ $1=$2=$(NF-6)=$(NF-5)=$(NF-4)=$(NF-3)=$(NF-2)=$(NF-1)=$NF=\u0026quot;\u0026quot;; print}'`\r\\033[0;36m+ \\033[0;37mMemory \\033[0;36m = \\033[1;32m`free -m | awk 'NR==2 {print $2}'` MB\r\\033[0;36m+\\033[0;37mFree Memory \\033[0;36m= \\033[1;32m`free -m | awk 'NR==3 {print $4}'` MB\r\\033[0;36m++++++++++++++++++: \\033[0;37m${undylw}User Data\\033[0;36m :+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\r+ \\033[0;37mUsername \\033[0;36m = \\033[1;32m`whoami`\r\\033[0;36m+++++++++++: \\033[0;31m${undred}Maintenance Information\\033[0;36m :++++++++++++++++++++++++++++++++++++++++++++++++++++\r\u0026quot;\recho -e \u0026quot;\\033[0;37msessions \\033[0;36m \\033[1;32m`w`\u0026quot;\recho -e \u0026quot;\\033[0;37mreboots \\033[0;36m \\033[1;32m`uprecords`\u0026quot;\recho -e \u0026quot;\\033[0;37mhddtemp \\033[0;36m \\033[1;32m`hddtemp /dev/sda`\u0026quot;\recho -e \u0026quot;\\033[0;37msensors \\033[0;36m \\033[1;32m`sensors`\u0026quot;\recho -e \u0026quot;\\033[0;37mcat /var/log/auth* | grep Failed #ver los fail SSH\u0026quot;\recho -e \u0026quot;\\033[0;36m++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\\033[0m\u0026quot;\recho -e \u0026quot;\\033[34mEn la calle tenemos:\u0026quot;\rMETRIC=1 # 0 for F, 1 for C\r# Fill in form to find your weather code here: # http://netweather.accuweather.com/signup-page2.asp\r# If code has a space remove it or replace it with %20 or a dash; -\rLOCCOD=\u0026quot;EUR|ES|GM002|CEPEDA-LA-MORA\u0026quot; #Example: NAM|MX|MX009|MEXICO-CITY\rif [ -z $1 ] \u0026amp;\u0026amp; [ -x $LOCCOD ] ; then\recho\recho \u0026quot;USAGE: $0 [locationcode]\u0026quot;\recho\rexit 0;\relif [ ! -z $1 ] ; then\rLOCCOD=$1\rfi\rcurl -s http://rss.accuweather.com/rss/liveweather_rss.asp\\?metric\\=${METRIC}\\\u0026amp;locCode\\=$LOCCOD \\\r| sed -n '/Currently:/ s/.*: \\(.*\\): \\([0-9]*\\)\\([CF]\\).*/\\2°\\3, \\1/p'\recho -e \u0026quot;\\e[0m\u0026quot;\rQueda cosa así:\n","description":"Banner ssh linux","id":45,"section":"posts","tags":["debian","ssh","linux"],"title":"Banner ssh","uri":"https://hotspotcepeda.github.io/es/posts/banner_ssh/"},{"content":"https://wiki.openwrt.org/doc/howto/cron\r\nMe están dando guerra una serie de router. El usuario se queja de que de vez en cuando el router pierde la salida a internet, una de las veces que estaba teniendo el problema me conecté y era como que perdía la ip WAN del cliente dhcp, la red local seguía funcionando y la wifi también,la parte lan estaba ok y he pensado que programando un reinicio diario de madrugada se podía arreglar el problema. (No será la mejor solución pero se arregló el problema)\nEs fácil solo hay que decirle al cron del router que se reinicie a una hora en la que no tenga actividad, por ejemplo las 04:30 de la madrugada. Primero hay que ponerlo en hora, activar el cliente ntp para que el trasto se ponga en hora cada vez que se encienda… si no tiene ntp configurado se va a reiniciar a lo loco, y queremos que se reinicie cada día a las 04:30.\nEste es el formato de cron:\r* * * * * comando a ejecutar\r- - - - -\r| | | | |\r| | | | +----- Día de la semana (0-7)\r| | | +----------- Mes (1 - 12)\r| | +----------------- Día del mes (1 - 31)\r| +----------------------- Hora (0 - 23)\r+----------------------------- Minuto (0 - 59)\rPara insertar una nueva tarea en el cron:\n# crontab -e\rSe nos abre un fichero en el que ponemos esto, se trata de confirmar la hora antes de hacer el reboot para no dejar un reinicio en bucle y cargarse el trasto.\n# Reinicio todos los dias a las 04:30\r# Nota: Para evitar el bucle de reinicio infinito, espera 70 segundos\r# y crea un archivo en /etc comprueba que la fecha de creación # marca las 4:31 antes de ejecutar el comando de reinicio de cron.\r30 4 * * * sleep 70 \u0026amp;\u0026amp; touch /etc/banner \u0026amp;\u0026amp; reboot\rPara salir de la edición del archivo usando vi:\nPresionar tecla Esc y escribir :wq , para salir sin guardar :q!\nArrancamos y activamos el servicio:\n# /etc/init.d/cron start\r# /etc/init.d/cron enable\rComprobamos que permanece y esperamos que funcione. Hasta mañana!\n# crontab -l\rAl día siguiente ejecutamos un:\n# uptime\rPara ver cuanto lleva funcionando.\n","description":"Programar reinicio en OpenWRT","id":46,"section":"posts","tags":["OpenWRT","router neutro","reinicio"],"title":"Programar reinicio en OpenWRT","uri":"https://hotspotcepeda.github.io/es/posts/programar_reinicio_openwrt/"},{"content":"Se trata de interconectar a tres vecinos, el escenario es una comunidad de vecinos de pisos donde se van compartir los gastos en infraestructura común de telecomunicaciones y conexión a internet. Como los tres vecinos están en el mismo edificio, se conectan con cable de red, se instala un router central junto al router de proveedor 300/30 Mb y un router de cliente para cada nodo se está usando firmware openWRT en los equipos.\nRouter central 10/100/1000 TP-Link TL-WR1043ND\nRouter cliente 10/100 Nexx WT3020\nRouter central de segunda mano 20 €, y router de cliente 15x3=45 €. Cable y conectores 20 €\nTotal unos 85 € en materiales.\nLa configuración se llevó una hora. El cableado y la instalación menos de 3 horas.\nLas viviendas están conectadas entre si con una red plana y cada una tiene una red wifi privada con salida a internet. La sensación de los vecinos es la de tener un router de proveedor propio pero están compartiendo solo una conexión, pasan de tener 3 conexiones contratadas a pagar una conexión entre 3.\nLa red está aislada, no está conectada con el resto de usuarios de la red guifi.net. Para conectar con la red guifi.net y compartir servicios comunitarios habría que hacerlo mediante tunel VPN o mediante enlace físico a un segmento de red que ya esté integrado.\nLa red se está comportando bien, pero no se le está sacando todo el rendimiento, los vecinos nunca alcanzan los 300 Mbit/s. Como los router finales son 10/100 Mbit/s solo llegan unos 80 Mbit/s a cada casa.\nLa red está limitada en cuanto a su crecimiento como red comunitaria de infraestructura común, para progresar es necesario regular el servicio de salida a internet y abrir las puertas a todas las personas que quieran formar parte de ella. Vamos con un ejemplo: Sí el día de mañana otro vecino quiere sumarse a la red comunitaria, con tirar un cable hasta el router central tendría conexión con el resto de vecinos y de manera automática salida a internet. ¿Pero que pasa el día que un vecino toma la decisión de no pagar la parte de la cuota de salida a internet que le corresponde? La solución es fácil, el vecino que tiene el router central desconecta el cable, por que no le parece bien que el resto de los vecinos sigan pagando y este no. Mal hecho, ya que cuando se desconecta al vecino moroso se le interrumpe la salida a internet pero además se le deja fuera de la red comunitaria, deja de alcanzar directamente a sus otros vecinos con los que compartía servicios, de p2p, impresoras en red o telefonía IP.\nSolución: En guifi.net el servicio de salida a internet está regulado de 3 maneras, Hotspot de acceso abierto, PROXY y tunnel VPN.\nLos hotspot son puntos de conexión directa por wifi, generalmente estos accesos están limitados en tiempo y caudal se prestan para facilitar conexiones puntuales a internet. Estas redes no tienen cifrado, los SSID de se llaman \u0026ldquo;guifi.net_AccesoAbierto\u0026rdquo;.\nLos proxys son salidas a internet que facilitan los miembros de guifi.net, ceden una porción de ancho de banda. En guifi.net son proxys federados, no están abiertos a todo el mundo, para poder acceder al servicio el propietario o el administrador del proxy tiene que facilitar una contraseña y se mira a quien se da acceso, normalmente a nodos que llevan operativos un tiempo. El caudal es limitado y solo se puede navegar desde dispositivos que admitan configuración de proxy cliente con usuario y contraseña.\nLos tunel VPN son enlaces punto a punto desde el cliente hasta la salida a internet, caminos virtuales que trabajan por debajo de los enlaces físicos. Lo ideal seria que todas las zonas tuvieran los tres servicios. Son generalmente un servicio de pago, por que salir a internet cuesta dinero. Los proveedores de servicio de guifi.net tienen servidores de tunel y venden caudales de salida a los usuarios de las redes comunitarias que lo necesitan. De esta forma al usuario que no paga el servicio se le desconecta del tunel de salida a internet, pero sigue teniendo presencia en la red comunitaria guifi.net.\nEquipamiento 350 €\nRouter 10/100/1000, como servidor se VPN para gestionar la salida a internet. RB850Gx2. + Carcasa CA150\nRouter 10/100/1000 + Wifi, como router de cliente final. RB951G-2HnD\nAl adaptar la red a Giga Bit se asegura un aprovechamiento óptimo de la salida a internet.Este equipamiento permite hacer túneles cliente servidor para salir a internet e interconexión por VPN con otras redes comunitarias como guifi.net. El router MikroTik sustituye al de proveedor eliminando el doble NAT.\nguifi.net Este es el esquema de red y servicios básicos de un super nodo integrado en guifi.net. Se agrega un servidor y un switch que puede permitir mas conexiones al supernodo, Hotspot y enlaces punto a punto con otras redes o con otros nodos.\n","description":"guifi.net y redes comunitarias en comunidades de vecinos","id":47,"section":"posts","tags":["comunidad de vecinos","guifi.net","openwrt","wifi"],"title":"Compartir salida a internet con guifi.net","uri":"https://hotspotcepeda.github.io/es/posts/compartir-internet/"},{"content":"¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r Modos de trabajo de la radio con qMp 3.2.1 Estos son los modos de trabajo en modo community, opciones de Wireless interface wlan0.\nAd_hoc_(mesh)_+_access_point_(Lan) Ad_hoc_(mesh) Access_point_(mesh) Access_point_(Lan) Client_(WAN) EXPERIMENTAL_802.11s_(mesh) EXPERIMENTAL_802.11s_(mesh)+Access_point_(Lan) Disabled la opción desaparece ","description":"Modos de trabajo de la radio con qMp","id":48,"section":"posts","tags":["OpenWRT","qMp","wifi","mesh"],"title":"Modos de trabajo qMp","uri":"https://hotspotcepeda.github.io/es/posts/modos_de_trabajo_qmp/"},{"content":"¿Que qué es qMp? Visite http://qmp.cat/Inicio para conocerlo. Esta es la página de desarrollo proyecto https://dev.qmp.cat/projects/qmp 🙌\r Este es el archivo de configuración qMp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89  /etc/config/qmp Node configuration: config \u0026#39;qmp \u0026#39; \u0026#39;node \u0026#39; option \u0026#39;community_node_id \u0026#39;\t\u0026#39;901 \u0026#39; # An number identifying the node. In this case node name will be: \u0026#34;qmp901\u0026#34;. If not specified it will be auto-configured based on the last byte of the MAC address. option \u0026#39;key \u0026#39;\t\u0026#39;/tmp/ qmp_key \u0026#39; # Path to file containing the QMP key. It is a hash generated randomly on each boot used by some QMP applications for security purposes. Interfaces config \u0026#39;qmp \u0026#39; \u0026#39;interfaces \u0026#39; option \u0026#39;lan_devices \u0026#39;\t\u0026#39;eth0 wlan1 \u0026#39; # Interfaces used for nal client connection, a bridge between them will be created and the DHCP server will be enabled. option \u0026#39;wan_device \u0026#39;\t\u0026#39;eth1 \u0026#39; # Interface connection with another network. A DHCP client will be enabled in this interface to automatically get the network con\u000cguration. option \u0026#39;mesh_devices \u0026#39;\t\u0026#39;wlan0 wlan2 \u0026#39; # Interfaces used for meshing. Several VLAN will be created and routing protocols will be enabled. Networks config \u0026#39;qmp \u0026#39; \u0026#39;networks \u0026#39; option \u0026#39;dns \u0026#39;\t\u0026#39;141.1.1.1 \u0026#39; # Nameservers used for the device and final clients option \u0026#39;lan_address \u0026#39;\t\u0026#39;172.30.22.1 \u0026#39; # lan address: IPv4 address used for final client bridge interface (see 7.3.2) option \u0026#39;lan_netmask \u0026#39;\t\u0026#39;255.255.255.0 \u0026#39; # lan netmask: IPv4 netmask used for final client bridge interface option \u0026#39;niit_prefix96 \u0026#39;\t\u0026#39;0:0:0:0:0: ffff \u0026#39; # niit prefix96: Niit is used for 4in6 tunneling, see 7.2.4 option \u0026#39;mesh_protocol_vids \u0026#39;\t\u0026#39;olsr6 :1 bmx6 :2\u0026#39; # VLAN tag suffix added for routing protocol interfaces (mesh vid - offset + mesh protocol vids) option \u0026#39;mesh_vid_offset \u0026#39;\t\u0026#39;10\u0026#39; # VLAN tag offset used for routing protocol interfaces (e. eth0.10) option \u0026#39;olsr6_mesh_prefix48 \u0026#39;\t\u0026#39;fd01 :0:0 \u0026#39; # First 48 bits used for IPv6 calculation, see IP structure chapter option \u0026#39;bmx6_mesh_prefix48 \u0026#39;\t\u0026#39;fd02 :0:0 \u0026#39; option \u0026#39;babel_mesh_prefix48 \u0026#39;\t\u0026#39;fd03 :0:0 \u0026#39; option \u0026#39;netserver \u0026#39; \u0026#39;1\u0026#39; Wireless General section config \u0026#39;qmp \u0026#39; \u0026#39;wireless \u0026#39; option \u0026#39;driver \u0026#39;\t\u0026#39;mac80211 \u0026#39; # Which driver to use: mac80211 or madwi\u000c option \u0026#39;country \u0026#39;\t\u0026#39;ES \u0026#39; # country: Country code to use for WiFi devices option \u0026#39;bssid \u0026#39;\t\u0026#39;02: CA:FF:EE:BA:BE \u0026#39; # bssid: BSSID to use for Ad-Hoc devices Specific device section looks like that: config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39;\t\u0026#39;adhoc \u0026#39; # WiFi supported modes are \u0026#34;adhoc\u0026#34;, \u0026#34;ap\u0026#34; or \u0026#34;none\u0026#34; option \u0026#39;name \u0026#39;\t\u0026#39;qMp \u0026#39; # WiFi SSID to use in this device option \u0026#39;txpower \u0026#39;\t\u0026#39;20\u0026#39; # txpower: Transmit power for this device option \u0026#39;channel \u0026#39;\t\u0026#39;48+ \u0026#39; # channel: Channel for this device. If +/- added, 802.11n in mode HT40 will be used option \u0026#39;mac \u0026#39;\t\u0026#39;00: AA:BB:CC:DD:EE \u0026#39; # mac: MAC identify the device option \u0026#39;device \u0026#39;\t\u0026#39;wlan0 \u0026#39; # device: Interface name used for this device Tunnels config \u0026#39;qmp \u0026#39; \u0026#39;tunnels \u0026#39; option \u0026#39;search_ipv4_tunnel \u0026#39;\t\u0026#39;0.0.0.0/0 \u0026#39; option \u0026#39;offer_ipv6_tunnel \u0026#39;\t\u0026#39;::/0 \u0026#39; Autoconfiguration system: /qmp_autoconf\t# se ejecuta solo en el primer arranque, si ya existe no se ejecuta  /etc/init.d/qmp_autoconf # a init script  # pasos del autoconf 1. Check if control file exist 2. Configure wireless devices 3. Configure networking 4. Restart affected services 5. Create control file Wireless config /etc/qmp/qmp_wireless.sh # dos funciones 1 qmp_configure_wifi_initial #  config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39; \u0026#39;adhoc \u0026#39; option \u0026#39;name \u0026#39; \u0026#39;qMp -MESH \u0026#39; config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39; \u0026#39;ap \u0026#39; option \u0026#39;name \u0026#39; \u0026#39;qMp -AP \u0026#39; 2 qmp_configure_wifi # in /etc/qmp/templates  wireless .# QMP_DEVICE =wifi - device wireless .# QMP_DEVICE. type = mac80211 wireless .# QMP_DEVICE. macaddr =# QMP_MAC wireless .# QMP_DEVICE. channel =# QMP_CHANNEL wireless .@wifi - iface [# QMP_INDEX ]. mode = adhoc wireless .@wifi - iface [# QMP_INDEX ]. bssid =# QMP_BSSID MANAGEMENT TOOLS qmpcontrol # is located on /etc/qmp/qmp_control.sh Usage : /usr/bin/qmpcontrol \u0026lt;function \u0026gt; [ params ] Available functions : offer_default_gw\t: Offers default gw to the network search_default_gw\t: Search for a default gw in the network configure_wifi\t: Configure and apply current wifi settings configure_network\t: Configure and apply current network settings apply_netserver\t: Start / stop netserver depending on configuration enable_ns_ppt\t: Enable POE passtrought from NanoStation M2/5 devices . Be careful with this qmpinfo # It uses the library provided by OpenWRT libiwinfo which gives information about WiFi devices. Usage : qmpinfo \u0026lt;question \u0026gt; [ options ] Available questions : modes \u0026lt;dev \u0026gt;\t: supported modes by the wireless card channels \u0026lt;dev \u0026gt;\t: supported channels and supported HT40 type (+/ -) ipv4\t: print all ipv4 from this computer ( excluding localhost ) hostname\t: print device hostname bwtest \u0026lt;ipv6 \u0026gt;\t: perform a bandwidth test nodes\t: list all nodes on MESH network key\t: print qmp key   ","description":"UCI qMp archivo de configuración","id":49,"section":"posts","tags":["OpenWRT","qMp","wifi","mesh","cepeda la mora"],"title":"UCI qMp archivo de configuración","uri":"https://hotspotcepeda.github.io/es/posts/uci_qmp_configuration_file/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones. Cambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes algún router viejo por casa y es compatible. Dependiendo del router es más o menos fácil cargar el firmware, este router no es fácil y va corto de memoria pero se puede.\nhttps://openwrt.org/toh/comtrend/ct5365\n1. Seleccionar firmware: Este es un Router muy parecido al CT-5361 es un poco más moderno, pero no deja de ser una patatilla, ojo puede dar mucho juego aunque tenga poca memoria.\nEstos son los ensayos que hice:\nAttitude Adjustment: http://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/openwrt-96348GW-generic-squashfs-cfe.bin Se reinicia el router al navegar por luci 👎\nhttp://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/openwrt-96348A-122-generic-squashfs-cfe.bin Se reinicia el router al navegar por luci. Por consola responde, se satura cuando navegas por el luci con pinchar un par de pestañas se bloquea a continuación página de tiempo agotado y termina por reiniciarse. 👎\nBackfire http://downloads.openwrt.org/backfire/10.03.1/brcm63xx/openwrt-96348GW-generic-squashfs-cfe.bin No se enciende el power después de cargar el firmware, no da ip 👎\nhttp://downloads.openwrt.org/backfire/10.03/brcm63xx/openwrt-96348GW-generic-squashfs-cfe.bin No se enciende el power después de cargar el firmware, no da ip 👎\nhttp://downloads.openwrt.org/backfire/10.03/brcm63xx/openwrt-96348GW-11-squashfs-bc300-cfe.bin No se enciende el power después de cargar el firmware, no da ip 👎\nhttps://dl.dropbox.com/u/4708147/openwrt/bcm63xx/CT-5365/openwrt-96348GW-generic-squashfs-cfe_backfire_10.03.1.bin Enlace roto, no pude probar. ✋\nBarrier Breaker http://downloads.openwrt.org/barrier_breaker/14.07-rc2/brcm63xx/generic/openwrt-96348A-122-generic-squashfs-cfe.bin Se reinicia el router al navegar por luci. 👎\nBackfire (10.03.1, unknown) Compartido por plumanegra.\nhttp://www.4shared.com/file/yGiVhj8ice/openwrt-96348GW-generic-squash.html Funciona el luci y se mantiene !!! 👍\n2. Instalar el firmware Antes de instalar el firmware conviene visitar la wiki openWRT del modelo http://wiki.openwrt.org/toh/comtrend/ct5365 para echar un vistazo.\nEncender el router con el botón de reset pulsado unos 10 segundos para entrar al modo bootloader.\nFijar una IP del rango del router\n1  ifconfig eth0 192.168.1.222   Nos conectamos al a la boca X3 por ejemplo y cargamos el .bin, desde el navegador a la ip del portal bootloader 192.168.1.1 Si en algún momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que página entregarnos, la cache no coincide con la realidad.\r\nAhora podemos acceder a la web para subir el firmware. Pasados unos minutos se solicita ip por dhcp.\n1 2  telnet 192.168.1.1 passwd root # para fijar el password y activar el SSH   Si se interrumpe la alimentación cuando estamos editando el firmware despídete del aparato.\r 3. Configuración como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contraseña, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1 2  dhclient eth0 telnet 192.168.1.1   Fijar password\n1  passwd root   Para ponerlo como router neutro editamos el /etc/config/network y lo dejamos tal que así, (prestando atención a las MAC, sumar 1 para la MAC de la WAN)\nvi /etc/config/network\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38  config ‘interface’ ‘loopback’ option ‘ifname’ ‘lo’ option ‘proto’ ‘static’ option ‘ipaddr’ ‘127.0.0.1’ option ‘netmask’ ‘255.0.0.0’ config ‘switch’ ‘eth1’ option ‘enable’ ‘1’ option ‘enable_vlan’ ‘1’ option ‘reset’ ‘1’ config ‘interface’ ‘lan’ option ‘ifname’ ‘eth1.1’ option ‘force_link’ ‘1’ option ‘type’ ‘bridge’ option ‘proto’ ‘static’ option ‘ipaddr’ ‘192.168.1.1’ option ‘netmask’ ‘255.255.255.0’ option ‘nat’ ‘1’ option ip6assign ’60’ option macaddr ’00:1D:XX:XX:XX:31′ config ‘interface’ ‘wan’ option ‘ifname’ ‘eth1.0’ option ‘force_link’ ‘1’ option ‘macaddr’ ’00:1D:XX:XX:XX:32′ option ‘proto’ ‘dhcp’ option ‘defaultroute’ ‘1’ config ‘switch_vlan’ option ‘device’ ‘eth1’ option ‘vlan’ ‘1’ option ‘ports’ ‘1 2 3 4 5t’ config ‘switch_vlan’ option ‘device’ ‘eth1’ option ‘vlan’ ‘0’ option ‘ports’ ‘0 5t’   4 Comprobaciones Guardamos los cambios y reiniciamos la configuración de red con un /etc/init.d/network reload , lo dejamos unos minutos y conectamos la WAN, tener en cuenta que ahora los puertos del router se numeran al revés, en la posición 4X está el port 0, es aquí donde conectamos el internet WAN. 3X 2X y 1X son las patas de LAN.\nApagamos y encendemos el router (al reiniciar interfaces se puede bloquear), y a navegar!. Ahora podemos configurar cómodamente la WiFi y el resto de opciones desde los menús del lUCI.\n","description":"OpenWRT en Comtrend CT-5365","id":50,"section":"posts","tags":["OpenWRT","Router neutro","wifi"],"title":"OpenWRT COMTREND CT-5365","uri":"https://hotspotcepeda.github.io/es/posts/openwrt-comtrend_ct-5365/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones. Cambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes algún router viejo por casa y es compatible. Dependiendo del router es más o menos fácil cargar el firmware, este router no es fácil y va corto de memoria pero se puede.\nhttps://openwrt.org/toh/comtrend/ct5361\n1. Seleccionar firmware: He intentado instalar un Barrier Breaker 14.07 ya compilado de seguridad wireless pero no he podido hacerlo funcionar, el router se reinicia, lo ponen como que ya tiene lUCI, pero tampoco me ha funcionado el acceso por web.\nLista de firmwares Stable:\nChaos Calmer 15.05\tDownload images\t2015 September\tr46767\nBarrier Breaker 14.07\tDownload images\t2014 October\tr42625\nAttitude Adjustment 12.09\tDownload images\t2013 April\tr36088\nBackfire 10.03.1\tDownload images\t2011 December\tr29592\nBackfire 10.03\tDownload images\t2010 April\tr20728\nKamikaze 8.09.2\tDownload images\t2010 January\tr18801\nKamikaze 8.09.1\tDownload images\t2009 June\tr16278\nKamikaze 8.09\tDownload images\t2008 September\tr14510\nKamikaze 7.09\tDownload images\t2007 September\tr7831\nKamikaze 7.07\tDownload images\t2007 July\tKamikaze 7.06\tDownload images\t2007 June\tr7204\nWhite Russian 0.9\tDownload images\t2007 January\tr6257\nAl final se han seguido los pasos de la wiki openWRT para este modelo y lo tengo funcionando con Backfire (10.03.1, r29592) el lUCI no es tan chulo como el Barrier Breaker pero sirve para trabajar igual de bien.\n2. Instalar el firmware Si en algún momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que página entregarnos, la cache no coincide con la realidad.\r\nEncender el router con el botón de reset pulsado unos 10 segundos para entrar al modo bootloader.\nFijar una IP del rango del router\n1  ifconfig eth0 192.168.1.222   Abrir en el navegador la dirección del router 192.168.1.1, seleccionar el fichero .bin cargarlo y esperar pacientemente a que se reinicie.\nSi se interrumpe la alimentación cuando estamos editando el firmware despídete del aparato.\r\n3. Configuración como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contraseña, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1 2  dhclient eth0 telnet 192.168.1.1   Fijar password\n1  passwd root   Editar /etc/config/network.\n1  vi /etc/config/network   Borramos todo el contenido del archivo y pegamos esto directamente. (Cambiar las MAC por las del router y en la mac de la wan sumar 1).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  config ‘interface’ ‘loopback’ option ‘ifname’ ‘lo’ option ‘proto’ ‘static’ option ‘ipaddr’ ‘127.0.0.1’ option ‘netmask’ ‘255.0.0.0’ config globals ‘globals’ option ula_prefix ‘xxxx:001c:xxxx::/48’ config ‘switch’ ‘eth1’ option ‘enable’ ‘1’ option ‘enable_vlan’ ‘1’ option ‘reset’ ‘1’ config ‘interface’ ‘lan’ option ‘ifname’ ‘eth1.1’ option ‘force_link’ ‘1’ option ‘type’ ‘bridge’ option ‘proto’ ‘static’ option ‘ipaddr’ ‘192.168.1.1’ option ‘netmask’ ‘255.255.255.0’ option ‘nat’ ‘1’ option ip6assign ’60’ option macaddr ’00:30:xx:xx:xx:7B’ config ‘interface’ ‘wan’ option ‘ifname’ ‘eth1.0’ option ‘force_link’ ‘1’ option ‘macaddr’ ’00:30:xx:xx:xx:7C’ option ‘proto’ ‘dhcp’ option ‘defaultroute’ ‘1’ config ‘switch_vlan’ option ‘device’ ‘eth1’ option ‘vlan’ ‘1’ option ‘ports’ ‘1 2 3 4 5t’ config ‘switch_vlan’ option ‘device’ ‘eth1’ option ‘vlan’ ‘0’ option ‘ports’ ‘0 5t’   Guardar y reiniciar la configuración de los interfaces, esto tarda:\n1  /etc/init.d/network reload   4 Comprobaciones Olvídate de la rotulación de interfaces que traía el router de origen, ahora se quedan así:\nConectar internet a la WAN 0 y pc a LAN 1 2 ó 3\n1 2  dhclient eth0 ssh 192.168.1.1   Ahora desde el router y desde nuestra maquina se alcanza internet ya se pueden actualizar o instalar paquetes.\n1 2  ping 8.8.8.8 opkg update   Para configurar la wifi y resto de opciones ya se puede hacer por lUCI.\n","description":"Instalar OpenWRT en Comtrend CT-5361","id":51,"section":"posts","tags":["OpenWRT","router neutro","wifi"],"title":"OpenWRT en Comtrend CT-5361","uri":"https://hotspotcepeda.github.io/es/posts/openwrt-comtrend_ct-5361/"},{"content":" ¿Qué es guifi.net?  guifi.net es una red libre. Los usuarios que quieren conectarse instalan dispositivos de red, normalmente inalámbricos, usando bandas de frecuencia de libre uso. Estos dispositivos de red se organizan para encaminar tráfico de otros usuarios. La organización es similar a la estructura que hace funcionar Internet. Para las direcciones IP por el momento se usan direcciones no válidas para Internet, llamadas rangos de direcciones para redes privadas. Guifi.net forma parte de una estructura a nivel nacional y mundial en el que se coordinan estas direcciones de modo que si las comunidades se conectan, la red resultante también funcione.\nDe lo anterior se deduce que guifi.net no es la única comunidad de red libre, en cambio tiene el mérito de ser la mayor en ámbito geográfico a nivel mundial, además de estar abierta a la interconexión con otras redes de forma organizada.\nLos usuarios de guifi.net deben hacerse responsables de sus actos y por tanto derimir a la propia red de esta responsabilidad. Asimismo deben comprometerse a no interferir con otras redes y a cumplir las normas legales de emisión vigentes.\nEn guifi.net pueden participar individuos, administraciones y entes privados o empresas.\nGuifi.net no pertenece exclusivamente a nadie más que a sus usuarios.\nResumiendo, guifi.net es una red formada y mantenida por los propios usuarios, desde la cual se pueden ofrecer puentes hacia Internet, pero cuyo objetivo sería más bien establecer una red propia con sus propios servicios y que conecte usuarios e intereses más locales.\nEn guifi.net no existen cuotas ni pagos, exceptuando las aportaciones voluntarias para el mantenimiento y crecimiento de la red.\nAlgunos datos sobre guifi.net:\n-Premio Nacional de Telecomunicaciones de Cataluña 2007.\n-Ha sido nombrada \u0026ldquo;Living Lab\u0026rdquo; por la Comunidad Europea.\n-13754 nodos activos y 6000 mas proyectados.\n-Ritmo crecimiento 100% anual, actualmente alrededor de 500 nodos al mes.\n-Los enlaces cubren 22197 kilómetros lineales.\nMás información sobre los nodos existentes y otra documentación a partir de guifi.net.\nSobre la legalidad  2.1- ¿Guifi.net es legal?\nLey 32/2003 General de Telecomunicaciones:\n\u0026ldquo;Artículo 6. Requisitos exigibles para la explotación de las redes y la prestación de los servicios de comunicaciones electrónicas.\u0026rdquo;\n\u0026ldquo;6.2. Los interesados en la explotación de una determinada red o en la prestación de un determinado servicio de comunicaciones electrónicas deberán, con anterioridad al inicio de la actividad, notificarlo fehacientemente a la Comisión del Mercado de las Telecomunicaciones en los términos que se determinen mediante real decreto, sometiéndose a las condiciones previstas para el ejercicio de la actividad que pretendan realizar. Quedan exentos de esta obligación quienes exploten redes y se presten servicios de comunicaciones electrónicas en régimen de auto-prestación.\u0026rdquo;\nDe la cita textual anterior se desprende que cualquiera puede por auto-prestación (los usuarios son los propietarios y se ocupan de sus tramos de red) crear una red. Tal es el caso de guifi.net y tal es el caso de miles de redes que la gente tiene en sus casas.\nLas frecuencias que no requieren licencia las puede usar todo el mundo (Cuadro Nacional de Atribución de Frecuencias: 2.4 y 5 GHz).\nSi alguien quiere explotar una frecuencia de forma exclusiva, debe pagar una licencia para otra frecuencia diferente de las no licenciadas (por ejemplo para telefonía móvil).\nEn las no licenciadas y en exteriores, conviene que haya coordinación para no molestarse entre diferentes redes. Esto significa que las administraciones no tienen preferencia sobre el uso respecto a los ciudadanos.\nLas bandas de frecuencia sin licencia tienen una limitación en la potencia usada en la emisión. En guifi.net debe respetarse estas potencias (la cumplen los aparatos estándar del mercado, homologación con etiqueta CE) y se aconseja siempre usar la menor potencia posible (existe un código de conducta de buenas prácticas).\n2.2- ¿Las administraciones pueden participar?\nLas administraciones obviamente pueden participar dado que la red es libre y no excluyente.\nSi se participa activamente en el despliegue de guifi.net, o si se decide realizar un despliegue propio para uso de los ciudadanos, conviene notificarlo a la Comisión del Mercado de las Telecomunicaciones. Se trata de una notificación y no de una solicitud. En esa notificación se debe indicar el tipo de uso o acceso a Internet que se va a realizar. Puede solicitar asesoramiento o realizar las gestiones a través de la Fundación guifi.net (http://fundacio.guifi.net/).\nPor otro lado, dado que la conexión a Internet se realiza a través de alguna empresa de comunicaciones, no es necesario llevar un registro de las conexiones realizadas.\n2.3- ¿Se puede dar acceso a Internet?\nUna cosa que permite guifi.net es que la gente puede ofrecer su acceso a Internet a otros usuarios. Se puede seleccionar el porcentaje de ancho de banda que se quiere prestar y a quién se quiere prestar. Los contratos de ADSL no pueden oponerse puesto que el acceso se haría desde el mismo ordenador o tarjeta de red. En este caso no puede haber una contrapartida económica.\nLas administraciones o ayuntamientos también pueden ofrecer ese servicio. Normalmente se ofrece un acceso autenticado y/o limitado como el que ya se aplica en telecentros, bibliotecas u otras oficinas de acceso a los ciudadanos. Estos accesos se hacen a través de un sistema proxy que limita el uso y tipo de servicios a los que se puede acceder (por ejemplo se suele eliminar las redes entre pares (p2p) sobre Internet debido al gran uso de ancho de banda).\nEn estos servicios para conectar con Internet, guifi.net no cambia la naturaleza del acceso, en cambio, gracias a la infraestructura que se puede crear con la red libre, los servicios se acercan a las casas de la gente. Por otro lado también se aumenta su disponibilidad: por ejemplo, un telecentro estaría operativo 24 horas en vez de tener un horario fijo de apertura y cierre. Hay que destacar que estos accesos son completamente legales, que ya están funcionando en diversos municipios desde hace años y que tienen un impacto muy positivo en la disminución de la brecha digital.\n2.4- ¿Puede haber actividades comerciales?, ¿pueden participar empresas privadas?\nAl igual que las administraciones no hay ningún impedimento en que las empresas usen guifi.net tanto para sus intereses propios como para ofrecer servicios, incluso en el caso de que sean con ánimo de lucro.\n¿Cómo puede participar un ayuntamiento o administración?  Hay varias formas de participación. Intentamos enumerar algunas ordenadas de menor a mayor grado de implicación:\n3.1- Ofreciendo ubicaciones donde instalar nodos.\nLas administraciones suelen disponer de ubicaciones estratégicas: edificios, depósitos de agua, farolas, torres de comunicaciones. Simplemente el hecho de prestar estas ubicaciones para ubicar alguna antena es una gran ayuda para el despliegue de la red libre.\n3.2- Conectándose a guifi.net y ofreciendo servicios e información que ya ofrecen a Internet.\nHay administraciones que ya tiene una red de libre acceso para acceder a servicios e información de la corporación. Estas redes pueden conectar con guifi.net, con lo cual esos servicios pueden llegar más lejos y ser más accesible para la gente. Se accede a una red que puede ser mucho mayor que una serie de puntos de acceso conectados y además la corporación no tiene que ocuparse del mantenimiento de esa infraestructura de comunicaciones.\n3.3- Informando a la gente. Organizando cursillos y charlas.\nGuifi.net no es una iniciativa comercial. Cualquier ayuda para difundirla y para dar una información mínima para conectarse y extender la red es bienvenida.\n3.4- Montando algunos \u0026ldquo;nodos de cobertura\u0026rdquo; y conectándolos a redes ya disponibles para los ciudadanos. Ofreciendo algunos accesos a Internet a través de proxys (telecentros, bibliotecas).\nEsta posibilidad se describe en el apartado 2.3. Como información orientativa podemos indicar que el coste de un nodo de cobertura de guifi.net puede oscilar entre 900€ y 2500€ dependiendo del ángulo de cobertura y de enlaces direccionales en los que se participe. Estos precios incluyen el material para la red pero excluyen mano de obra o infraestructura para el montaje. Un nodo normal (el que usan los usuarios domésticos) ronda los 80/100€.\nLos proxys de acceso a Internet pueden \u0026ldquo;federarse\u0026rdquo; con los de otras poblaciones. De esta forma, un usuario puede hacer uso de su cuenta en una zona más extensa. Es decir un usuario de la población A puede conectarse con su usuario en la población B ya que todos los proxys mantienen los mismos usuarios/contraseñas.\n3.5- Otros proyectos que se pueden poner en marcha sin necesidad de que la gente se conecte a través de Internet (evitando así cuotas o gastos de conexión).\nServicios propios para el ayuntamiento (conexión de centros, servicios propios de control, comunicaciones en caso de catástrofes) y servicios para la gente (radio, televisión, teleasistencia social, actividades culturales, reservas en instalaciones, información de archivos y bibliotecas). En general los mismos que Internet pero se evita la exclusión digital.\n3.6- Si después llega otra comunidad de red libre o una empresa que quiere ofrecer cosas parecidas, ¿qué debemos responder?\nHabría que coordinarse. Guifi.net es una red abierta a la interconexión con otras redes. Concesiones exclusivas son innecesarias y pueden ser ilegales ya que pueden vulnerar la libre competencia.\n3.7- Para ceder espacio o recursos necesitamos firmar un acuerdo con alguna entidad. ¿Con quién se tendría que firmar en el caso de guifi.net?\nEn realidad pensamos que no es necesario porque el material o el espacio cedido sigue siendo propiedad de la administración que lo proporciona. En cualquier caso se pueden firmar convenios con la fundación sin ánimo de lucro que respalda guifi.net: Fundació privada per a la xarxa oberta, lliure i neutral guifi.net (http://fundacio.guifi.net/). Cualquier beneficio obtenido por esta fundación se destina íntegramente a la mejora, defensa y desarrollo de la propia red. Para estudios de viabilidad o asesoramiento también se puede contactar con algunos grupos de investigación de universidades.\n¿Qué puede aportar guifi.net a los ayuntamientos y administraciones?  En general el mayor interés es que sus servicios se abren a los ciudadanos. Llegarán más lejos y a una parte mayor de la población. Todo esto a muy bajo coste porque gran parte de la red la mantiene y mejora los propios usuarios.\nSobre la red libre se pueden montar servicios que llegan más fácilmente a la gente. Para una corporación podría ser caro y complicado realizar todo el despliegue de la red hasta llegar a una gran parte de los usuarios finales.\nPor otro lado, debido al número creciente de nodos ya funcionales, hay consecuentemente un gran número de servicios disponibles. Por ejemplo, al conectar poblaciones, los servicios que se ofrecen desde un ayuntamiento también son accesibles desde sus vecinos o comarcas.\n","description":"guifi.net y redes comunitarias en colaboración con ayuntamientos","id":52,"section":"posts","tags":["guifi.net","cepeda la mora"],"title":"FAQ de ayuntamientos","uri":"https://hotspotcepeda.github.io/es/posts/ayuntamientos_y_guifi_net/"},{"content":"Me decidí a formular una propuesta para el despliegue de la red en Cepeda, como no tenia ni idea, le presenté al alcalde de aquella época Javier Garcia un pdf, a lo que el alcalde respondó:\n\u0026ldquo;Mira, a mi no me vengas con cosas técnicas, si quieres hacerlo\u0026hellip; adelante. Te voy a ayudar en lo que pueda.\u0026quot;\nIdea inicial Está era la ida que tenía para el despliegue en 2014:\nUna salida balanceada a internet con una RB-750 con un superservidor proxy para cachear a todo el que se asomara por allí y otra RB-750 para gestionar las conexiones del hotspot, ahí lo pone, 30 minutos al día con un caudal de 256 Kb en bajada y 64 Kb en subida. AP Unifi\nPara conectar las viviendas un modelo en Infraestructura AP cliente con una antena central a la que se conectan las estaciones de las casas.\nParece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rPropuesta Este es el documento que se presentó al Ayto, en nombre de la AC RASPUTIN. No me extraña que el alcalde me dijera que hiciera lo que quisiera. El logo de la cabra es lo que más me gusta, está a punto de embestir a los ISP tradicionales.\nParece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rLo que nos tenemos que tatuar es el procomún de la Red Abierta Libre y Neutral:\nEl Procomún de la RALN se fundamenta en las siguientes bases:\n Eres libre de utilizar la red para cualquier propósito mientras no perjudiques el\nfuncionamiento de la propia red, la libertad de otros usuarios, y respetes las\ncondiciones de los contenidos y servicios que circulan libremente. Eres libre de conocer como es la red, sus componentes y su funcionamiento,\ntambién puedes difundir su espíritu y funcionamiento libremente. Eres libre para incorporar servicios y contenidos a la red con las condiciones\nque quieras. Eres libre de Incorporarte a la red y ayudar a extender estas libertades y\ncondiciones.  Es este documento está detallada la autoprovisión de nodos para el despliegue en modo infraestructura en la plataforma guifi.net\nParece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rPresupuesto Se presentó un presupuesto en base a la propuesta. Creo que me salian 900 euros, esto es lo que se aprobó y lo que pagó el ayuntamiento más la salida a internet.\n600 euros para un ayuntamiento es un gasto ridículo, en las empresas que trabajan este producto el precio habitual para un proyecto así es de 6000 a 10000 euros llave en mano + el coste de la gestión y el mantenimiento de la red. ¿Lo ves caro? pues hazlo tú mismo.\nSolo necesitas tener los conocimientos adecuados, bueno también te hará falta un ordenador y una conexión a internet para hacer la gestión remota, un espacio de trabajo, carnet de conducir y un coche grande o una furgoneta para poder desplazarte y transportar el equipamiento, los tramos de las torres y los mástiles, ropa de trabajo, EPIs, herramienta de mano, escalera grande de 3 tramos y pequeña, taladro, brocas, radial, discos, atornilladora, crimpadora, conectores, herrajes, abrazaderas, bridas, tacos, tornillos, cinta aislante, guiacables, aparatos de medida, comprobador de cables, cable ftp exterior, cable ftp interior, material eléctrico, conocimientos, negociaciones con proveedores, dinero para comprar el equipamiento, desplazamientos a proveedores, desplazamientos programados para labores preventivas, desplazamientos extraordinarios por averías, conocimientos, seguro de responsabilidad civil, titulación para trabajo en altura, tasas e impuestos, combustible, dinero, conocimientos y lo más valioso de todo, TU TIEMPO.\nSAX Llegó el SAX 2015. El SAX (Salut, Amor i Xarxa), es un encuentro anual de la comunidad guifi.net, allí conocí al Sr. Roger Pueyo, le comenté la idea que teníamos para desplegar en Cepeda y después de una charla muy amena, llegue a la conclusion de que lo más económico y productivo que podia hacer era desplegar la red en modo adhoc con qMp, Quick Mesh Project.\nDesplegar en modo infraestructura puede estár bien en algunos escenarios, si tienes una ubicación con alimentación eléctrica y acceso asegurado desde la que se domine todo el área que quieras iluminar, pues genial. Tendrás un punto central al que apuntar todas las conexiones, esto es una red centralizada punto-multipunto y si falla el punto central dejará de funcionar toda la red, puedes redundar la antena central para que esto no suceda. Cuando quieras conectar una nueva antena tendrás que configurar en los 2 extremos.\nPero en el escenario que tenemos en Cepeda no hay un sítio mágico desde el que se pueda ver todo el pueblo, estuve mirando el deposito de agua, pero eran todo problemas, la alimentación eléctrica, el acceso, la ubicación expuesta a robos y sabotajes, aparte que la salida a internet está en el ayuntamiento, tenía que hacer un enlace dedicado del Ayto al depósito con 2 equipos, 4 en caso de redundancia y otro equipo bien potente para conectar con todos los nodos.\nqMp Con el despliegue en mesh la cobertura se va extendiendo con cada equipo que se incorpora a la red, se convierte en una red descentralizada que es un valor añadido.\nLo primero que hay que hacer en montar toda la red sobre una mesa, elije un espacio de trabajo y empieza a configurar equipos, ponlos en producción y sometelos durante un tiempo a un estricto seguimiento. Cuando tengas la seguridad de que los equipos funcionan como tú quieres los instalas, cuando estamos instalando no podemos hacer investigaciones ni pruebas ni otra cosa que no sea instalar, de está manera si falla algo en la instalación automáticamente se descartan problemas de configuración.\nPara comenzar con el despliegue qMp recomiendo elegir ubicaciones elevadas y que siempre estén encendidas, de está manera la cobertura de la red se irá extendiendo sin esfuerzo a medida que se van agregando nuevos nodos.\nSe puede desplegar en 2.4 GHZ 802.11bg o en 5 GHz 802.11a, dependiendo del escenario, si queremos desplegar en el interior de un edificio podemos hacerlo con equipos indoor y en 2.4 GHz, si los equipos están en la calle necesitamos CPE que soporten intemperie agua, hielo, sol y viento.\nHay que tener en cuenta que debemos elegir con mucha atención el hardware, tiene que ser compatible con OpenWRT/qMp. Esta es la lista de hardware compatible https://qmp.cat/Supported_devices\n 27/03/2021 Ojo con las nuevas remesas de equipamiento Ubiquiti, las nuevas revisiones 2000K y superiores de NanoStation Loco M5 no funcionan ni con OpenWRT ar71xx ni con OpenWRT ath79, ni tan siquiera probando OpenWRT ath79 para Bullet M XW que sí funciona en las Rocket M XW. Al parecer hay dos arquitecturas distintas que sirven para distintas revisiones de hardware de Ubiquiti .La ar71xx es la de siempre, antes funcionaba, la ath79 es la nueva. No sé sabe todavía la manera de flashearlas.  \n","description":"La Propuesta de red comunitaria que se hizo al Ayto","id":53,"section":"posts","tags":["guifi.net","qMp","guifi.net","cepeda la mora","wifi"],"title":"La propuesta","uri":"https://hotspotcepeda.github.io/es/posts/la_propuesta/"},{"content":"Y se puso en producción el hotspot, un hotspot en wifi es un dispositivo con capacidades de enrutamiento que gestiona conexiones de otros dispositivos (punto caliente) y les da salida a internet, una especie de pasarela o gateway pero en este caso con capacidades de gestión del trafico.\nLa salida a internet para toda la red comunitaria la dona el excelentísimo Ayto de Cepeda la Mora, es un router 4G de 10 Mb dedicado.\nHardware MikroTik Para hacer la gestión de los dispositivos que se conectan a pie de calle se usa una ROUTERBOARD MIKROTIK RB750GL, este router está dedicado solo para esta tarea, lleva funcionando 24x7 desde el año 2014 de la era pre-covid.\nUbiquiti La red de captación del hotspot va toda en 2.4 Ghz, APs en 802.11b para que se puedan conectar dispositivos antiguos.\nEl AP de la plaza Ubiquiti NanoStation 2 está en modo AP bridge, debe de tener mas de 10 años, es de cuando venían con un latiguillo de 3 metros de color azul, \u0026hellip; que tiempos aquellos.\nPara extender la red del hotspot hay en enlace en 2.4 del Ayto al Bar municipal \u0026ldquo;El Traite\u0026rdquo; con Ubiquiti NanoStation Loco M2.\nOpenWRT Para la captación en el Bar se usa de AP un router Comtrend AR-5387un https://openwrt.org/toh/comtrend/ar5387un liberado con OpenWRT, ni un problema, 24x7 desde 2014 más lo que llevara funcionando de antes.\nConexiones MikroTik graph TD;\rROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;WAN_ether1;\rROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;Libre_ether2;\rROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;Gestión_ether3;\rROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;bridge1_ether4;\rbridge1_ether4--\u0026gt;AP_NS2_plaza_Ayto;\rROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;bridge1_ether5;\rbridge1_ether5--\u0026gt;enl_NSlocoM2_a;\renl_NSlocoM2_a--\u0026gt;enl_NSlocoM2_b;\renl_NSlocoM2_b--\u0026gt;AP_OpenWRT_Bar_Municipal;\rConfiguración MikroTik 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480  [admin@hostname] \u0026gt; export # mar/14/2021 01:23:15 by RouterOS 6.43.2 # software id = LVV0-IUW2 # # model = 750GL # serial number = 888A02585888 /interface bridge add comment=LAN fast-forward=no mtu=1500 name=bridge1 protocol-mode=none /interface ethernet set [ find default-name=ether1 ] comment=\u0026#34;WAN ether1\u0026#34; name=Lan speed=100Mbps set [ find default-name=ether2 ] speed=100Mbps set [ find default-name=ether3 ] comment=GESTION speed=100Mbps set [ find default-name=ether4 ] comment=-AP-HOSTSPOT disabled=yes speed=100Mbps set [ find default-name=ether5 ] comment=-HS_NANO_ENL speed=100Mbps /interface list add name=mactel add name=mac-winbox /interface wireless security-profiles set [ find default=yes ] supplicant-identity=hostname /ip firewall layer7-protocol add name=youtube regexp=\u0026#34;(GET \\\\/videoplayback\\\\\\?|GET \\\\/crossdomain\\\\.xml)\u0026#34; add name=torrentsites regexp=\u0026#34;^.*(get|GET).+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|torrentz|vertor|h33t|btscene|bitunity|bittoxic|thunderbytes|entertane|zoozle|vcdq|bitnova|bitsoup|meganova|fulldls|btbot|flixflux|\\ seedpeer|fenopy|gpirate|commonbits).*\\$\u0026#34; add name=p2p_www regexp=\u0026#34;^.*(get|GET).+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|vertor|h33t|zoozle|bitnova|bitsoup|meganova|fulldls|btbot|fenopy|gpirate|commonbits).*\\$\u0026#34; add name=p2p_dns regexp=\u0026#34;^.+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|vertor|h33t|zoozle|bitnova|bitsoup|meganova|fulldls|btbot|fenopy|gpirate|commonbits).*\\$\u0026#34; /ip hotspot profile add dns-name=guifi.net_Acceso_Abierto hotspot-address=192.168.100.1 login-by=http-chap,trial name=hsprof2 trial-uptime-limit=2d trial-uptime-reset=23h59m /ip hotspot add interface=bridge1 name=hotspot1 profile=hsprof2 /ip hotspot user profile set [ find default=yes ] add-mac-cookie=no keepalive-timeout=none name=usuarios on-login=\u0026#34;#Keep alive para limitar la sesion diaria a un tiempo\u0026#34; open-status-page=http-login rate-limit=\u0026#34;1M/1M 2M/2M 320k/320k 8/8 1 320/320\u0026#34; shared-users=1000 \\  transparent-proxy=yes /ip ipsec proposal set [ find default=yes ] enc-algorithms=3des /ip pool add name=hs-pool-4 ranges=192.168.100.10-192.168.100.254 add name=pool_gestion ranges=192.168.88.100-192.168.88.200 /ip dhcp-server add add-arp=yes address-pool=hs-pool-4 authoritative=after-2sec-delay disabled=no interface=bridge1 lease-time=1d name=dhcp_HS add add-arp=yes address-pool=pool_gestion disabled=no interface=ether3 name=dhcp_gestion /ip hotspot user profile add address-pool=hs-pool-4 name=sincontrol transparent-proxy=yes /queue simple add burst-limit=3M/3M burst-threshold=256k/256k burst-time=8s/8s disabled=yes max-limit=2M/2M name=queue1 packet-marks=clientes_2M target=ether4 /queue tree add disabled=yes name=cliente_2M_up packet-mark=clientes_2M parent=ether4 priority=1 add disabled=yes name=cliente_2M_down packet-mark=clientes_2M parent=ether4 priority=1 add max-limit=5M name=Download parent=bridge1 priority=1 add max-limit=300k name=Upload parent=Lan priority=1 /queue type add kind=pcq name=PCQ_download_2mb pcq-classifier=dst-address pcq-rate=2M add kind=pcq name=PCQ_upload_300k pcq-classifier=src-address pcq-rate=300k add kind=sfq name=BAJADA add kind=sfq name=SUBIDA /queue simple add comment=\u0026#34;# l\\EDmite global (compartido por todos los usuarios):\\r\\ \\n# 5M subida\\r\\ \\n# 35M bajada\\r\\ \\n# \\r\\ \\n# segmento de red de los clientes con este paquete de datos,\\r\\ \\n# puede usarse una interfaz de ser necesario:\\r\\ \\n# 10.10.12.0/24\u0026#34; limit-at=384k/5M max-limit=384k/5M name=2MB_down_384MB_up queue=PCQ_upload_300k/PCQ_download_2mb target=bridge1 total-queue=default /queue tree add disabled=yes max-limit=32k name=P2P packet-mark=p2p-qos parent=bridge1 queue=default add comment=\u0026#34;una cola para el total del tr\\E1fico de bajada, aqu\\ED se especifica\\r\\ \\n# la interfaz desde la que se reparte el tr\\E1fico a los clientes\u0026#34; disabled=yes limit-at=8M max-limit=8M name=\u0026#34;Total download\u0026#34; parent=bridge1 priority=1 queue=default add comment=\u0026#34;una cola para el total del tr\\E1fico de subida, aqu\\ED se especifica\\r\\ \\n# la interfaz desde la que se env\\EDa el tr\\E1fico al gateway \u0026#34; disabled=yes limit-at=300k max-limit=300k name=\u0026#34;Total upload\u0026#34; parent=Lan priority=1 queue=default add comment=\u0026#34;hoja (cola hija) de bajada para el tr\\E1fico web (HTTP), utiliza\\r\\ \\n# la marca establecida en la tabla mangle del firewall\u0026#34; disabled=yes limit-at=1M max-limit=6M name=HTTP_D packet-mark=priority_packet parent=\u0026#34;Total download\u0026#34; priority=3 queue=default add comment=\u0026#34;hoja de subida para el tr\\E1fico web (HTTP), utiliza la misma marca\\r\\ \\n# de la cola anterior\u0026#34; disabled=yes limit-at=100k max-limit=200k name=HTTP_U packet-mark=priority_packet parent=\u0026#34;Total upload\u0026#34; priority=3 queue=default add comment=\u0026#34;los paquetes con marca \\\u0026#34;other-internet\\\u0026#34; tienen una menor prioridad\\r\\ \\n# que los paquetes web, es necesario especificar estas colas, de lo\\r\\ \\n# contrario el tr\\E1fico no gestionado pasar\\E1 con la mayor prioridad\u0026#34; disabled=yes limit-at=500k max-limit=1M name=OTHER_D packet-mark=no_priority_packet parent=\u0026#34;Total download\u0026#34; priority=4 queue=default add comment=\u0026#34;los paquetes con marca \\\u0026#34;other-internet\\\u0026#34; tienen una menor prioridad\\r\\ \\n# que los paquetes web, es necesario especificar estas colas, de lo\\r\\ \\n# contrario el tr\\E1fico no gestionado pasar\\E1 con la mayor prioridad\u0026#34; disabled=yes limit-at=50k max-limit=100k name=OTHER_U packet-mark=no_priority_packet parent=\u0026#34;Total upload\u0026#34; priority=4 queue=default add name=PRIO1 packet-mark=\u0026#34;PRIO 1\u0026#34; parent=Download priority=1 queue=BAJADA add name=PRIO2 packet-mark=\u0026#34;PRIO 2\u0026#34; parent=Download priority=2 queue=BAJADA add name=PRIO3 packet-mark=\u0026#34;PRIO 3\u0026#34; parent=Download priority=3 queue=BAJADA add name=PRIO4 packet-mark=\u0026#34;PRIO 4\u0026#34; parent=Download priority=4 queue=BAJADA add name=PRIO5 packet-mark=\u0026#34;PRIO 5\u0026#34; parent=Download priority=5 queue=BAJADA add name=PRIO7 packet-mark=\u0026#34;PRIO 7\u0026#34; parent=Download priority=7 queue=BAJADA add name=PRIO8 packet-mark=\u0026#34;PRIO 8\u0026#34; parent=Download queue=BAJADA add name=PRIO.1 packet-mark=\u0026#34;PRIO 1\u0026#34; parent=Upload priority=1 queue=SUBIDA add name=PRIO.2 packet-mark=\u0026#34;PRIO 2\u0026#34; parent=Upload priority=2 queue=SUBIDA add name=PRIO.3 packet-mark=\u0026#34;PRIO 3\u0026#34; parent=Upload priority=3 queue=SUBIDA add name=PRIO.4 packet-mark=\u0026#34;PRIO 4\u0026#34; parent=Upload priority=4 queue=SUBIDA add name=PRIO.5 packet-mark=\u0026#34;PRIO 5\u0026#34; parent=Upload priority=5 queue=SUBIDA add name=PRIO.7 packet-mark=\u0026#34;PRIO 7\u0026#34; parent=Upload priority=7 queue=SUBIDA add name=PRIO.8 packet-mark=\u0026#34;PRIO 8\u0026#34; parent=Upload queue=SUBIDA /snmp community set [ find default=yes ] addresses=0.0.0.0/0 /system logging action set 0 memory-lines=100 set 1 disk-lines-per-file=100 set 3 remote=192.168.1.213 /interface bridge port add bridge=bridge1 hw=no interface=ether4 add bridge=bridge1 hw=no interface=ether5 /interface bridge settings set use-ip-firewall=yes /interface list member add interface=ether2 list=mactel add interface=ether3 list=mactel add interface=ether2 list=mac-winbox add interface=ether4 list=mactel add interface=ether3 list=mac-winbox add interface=ether5 list=mactel add interface=ether4 list=mac-winbox add interface=ether5 list=mac-winbox /ip address add address=10.228.150.3/28 comment=\u0026#34;GW Ayto\u0026#34; interface=Lan network=10.228.150.0 add address=192.168.100.1/24 comment=\u0026#34;GW hotspot\u0026#34; interface=bridge1 network=192.168.100.0 add address=192.168.88.1/24 interface=ether3 network=192.168.88.0 /ip dhcp-server network add address=192.168.88.0/24 comment=\u0026#34;default configuration\u0026#34; gateway=192.168.88.1 add address=192.168.100.0/24 gateway=192.168.100.1 /ip dns set allow-remote-requests=yes cache-size=10096KiB max-udp-packet-size=512 servers=10.228.150.6,8.8.4.4 /ip firewall address-list add list=Syn_Flooder add disabled=yes list=spammers add disabled=yes list=support add address=192.168.100.0/24 list=Cliente_2M add address=10.228.150.0/28 list=guifi.net /ip firewall filter add action=accept chain=input comment=\u0026#34;Accept to established connections\u0026#34; connection-state=established add action=accept chain=input comment=\u0026#34;Accept to related connections\u0026#34; connection-state=related add action=drop chain=forward comment=\u0026#34;Filtra paquetes chungos\u0026#34; connection-state=invalid add action=passthrough chain=unused-hs-chain comment=\u0026#34;place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotsp\\ ot rules here ----------- place hotspot rules here ----------- \u0026#34; add action=jump chain=output comment=\u0026#34;Jump for icmp output\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=add-src-to-address-list address-list=Syn_Flooder address-list-timeout=30m chain=input comment=\u0026#34;Add Syn Flood IP to the list\u0026#34; connection-limit=30,32 protocol=tcp tcp-flags=syn add action=drop chain=input comment=\u0026#34;Drop to syn flood list\u0026#34; src-address-list=Syn_Flooder add action=drop chain=input comment=\u0026#34;Drop to syn flood list\u0026#34; disabled=yes src-address-list=Syn_Flooder add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;Port scanners to list \u0026#34; protocol=tcp psd=21,3s,3,1 add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp psd=21,3s,3,1 add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; disabled=yes log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp psd=21,3s,3,1 add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP FIN Stealth scan\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/FIN scan\u0026#34; protocol=tcp tcp-flags=fin,syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/RST scan\u0026#34; protocol=tcp tcp-flags=syn,rst add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/FIN scan\u0026#34; protocol=tcp tcp-flags=fin,syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/RST scan\u0026#34; protocol=tcp tcp-flags=syn,rst add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;FIN/PSH/URG scan\u0026#34; protocol=tcp tcp-flags=fin,psh,urg,!syn,!rst,!ack add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;FIN/PSH/URG scan\u0026#34; protocol=tcp tcp-flags=fin,psh,urg,!syn,!rst,!ack add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;ALL/ALL scan\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP NULL scan\u0026#34; protocol=tcp tcp-flags=!fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP FIN Stealth scan\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=Port_Scanner address-list-timeout=1w chain=input comment=\u0026#34;Port Scanner Detect\u0026#34; protocol=tcp psd=21,3s,3,1 add action=drop chain=input comment=\u0026#34;dropping port scanners\u0026#34; src-address-list=\u0026#34;port scanners\u0026#34; add action=jump chain=input comment=\u0026#34;Jump for icmp input flow\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=jump chain=forward comment=\u0026#34;Jump for icmp forward flow\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=drop chain=input comment=\u0026#34;drop ftp brute forcers\u0026#34; dst-port=21 protocol=tcp src-address-list=ftp_blacklist add action=drop chain=input comment=\u0026#34;drop ssh brute forcers\u0026#34; dst-port=22 protocol=tcp src-address-list=ssh_blacklist add action=add-src-to-address-list address-list=ssh_blacklist address-list-timeout=1w3d chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage3 add action=add-src-to-address-list address-list=ssh_stage3 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage2 add action=add-src-to-address-list address-list=ssh_stage2 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage1 add action=add-src-to-address-list address-list=ssh_stage1 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp add action=drop chain=forward comment=\u0026#34;drop ssh brute downstream\u0026#34; dst-port=22 protocol=tcp src-address-list=ssh_blacklist add action=drop chain=ICMP comment=\u0026#34;Drop to the other ICMPs\u0026#34; disabled=yes protocol=icmp add action=drop chain=forward comment=\u0026#34;Drop to bogon list\u0026#34; dst-address-list=bogons add action=add-src-to-address-list address-list=spammers address-list-timeout=3h chain=forward comment=\u0026#34;Add Spammers to the list for 3 hours\u0026#34; connection-limit=30,32 dst-port=25,587 limit=30/1m,0 protocol=tcp add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;ALL/ALL scan\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP NULL scan\u0026#34; protocol=tcp tcp-flags=!fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=Syn_Flooder address-list-timeout=30m chain=input comment=\u0026#34;Add Syn Flood IP to the list\u0026#34; connection-limit=30,32 protocol=tcp tcp-flags=syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;Port scanners to list \u0026#34; protocol=tcp psd=21,3s,3,1 add action=drop chain=forward comment=\u0026#34;DENIEGO ICMP\u0026#34; disabled=yes protocol=icmp add action=accept chain=input comment=\u0026#34;Accept DNS - UDP\u0026#34; port=53 protocol=udp add action=accept chain=input comment=\u0026#34;Accept DNS - TCP\u0026#34; port=53 protocol=tcp add action=accept chain=forward comment=\u0026#34;ACEPTAR FTP \u0026#34; connection-state=established connection-type=ftp protocol=0 add action=accept chain=input comment=\u0026#34;Full access to SUPPORT address list\u0026#34; src-address-list=support add action=accept chain=ICMP comment=\u0026#34;Echo request - Avoiding Ping Flood\u0026#34; icmp-options=8:0 limit=1,5 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Echo reply\u0026#34; icmp-options=0:0 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Time Exceeded\u0026#34; icmp-options=11:0 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Destination unreachable\u0026#34; icmp-options=3:0-1 protocol=icmp add action=accept chain=ICMP comment=PMTUD icmp-options=3:4 protocol=icmp add action=drop chain=ICMP comment=\u0026#34;Drop to the other ICMPs\u0026#34; disabled=yes protocol=icmp add action=log chain=input log-prefix=\u0026#34;PING DENEGADO\u0026#34; protocol=icmp add action=drop chain=virus comment=\u0026#34;VIRUS DE WINDOWS\u0026#34; dst-port=135-139,445 protocol=tcp add action=log chain=virus comment=\u0026#34;LOG VIRUS DE WINDOWS\u0026#34; dst-port=135-139,445 log-prefix=\u0026#34;VIRUS WINDOWS\u0026#34; protocol=tcp add action=jump chain=input jump-target=virus add action=drop chain=input comment=\u0026#34;Bloqueo DNS cache externo\u0026#34; dst-port=53 protocol=udp add action=drop chain=forward comment=\u0026#34;Todo P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;DROP INPUT P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;DROP OUTPUT P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;corta ping packetes de 99 bytes a m\\E1s.\u0026#34; packet-size=128-65535 protocol=icmp add action=log chain=input log-prefix=\u0026#34;PING DENEGADO\u0026#34; protocol=icmp add action=drop chain=input comment=\u0026#34;corta ping\u0026#34; disabled=yes protocol=icmp src-address-list=!guifi.net add action=add-src-to-address-list address-list=\u0026#34;IP\u0026#39;s totales\u0026#34; address-list-timeout=none-dynamic chain=forward disabled=yes src-address=192.168.0.0/16 add action=add-src-to-address-list address-list=acceso-winbox address-list-timeout=none-dynamic chain=input dst-port=8291 protocol=tcp add action=add-src-to-address-list address-list=Port_Scanner address-list-timeout=1w chain=input comment=\u0026#34;Port Scanner Detect PUEDE LLEGAR A CERRAR EL PUERTO FPT SI HAY MUCHA ACTIVIDAD, LO PONE EN LA LISTA COMO SCANER DE PUERTOS \u0026#34; protocol=tcp psd=\\  21,3s,3,1 add action=drop chain=forward comment=\u0026#34;Drop to bogon list\u0026#34; dst-address-list=bogons add action=add-src-to-address-list address-list=spammers address-list-timeout=3h chain=forward comment=\u0026#34;Add Spammers to the list for 3 hours\u0026#34; connection-limit=30,32 dst-port=25,587 limit=30/1m,0 protocol=tcp add action=drop chain=forward comment=\u0026#34;Avoid spammers action\u0026#34; dst-port=25,587 protocol=tcp src-address-list=spammers add action=drop chain=forward comment=\u0026#34;Limitar Numero de conexiones UDP por cliente\u0026#34; connection-state=new disabled=yes dst-port=!53,67,123 limit=30,40:packet protocol=udp add action=drop chain=forward comment=\u0026#34;default configuration\u0026#34; disabled=yes protocol=icmp add action=accept chain=input comment=\u0026#34;default configuration\u0026#34; connection-state=related disabled=yes add action=accept chain=input comment=\u0026#34;default configuration\u0026#34; connection-state=established disabled=yes add action=drop chain=input comment=\u0026#34;default configuration\u0026#34; disabled=yes in-interface=Lan add action=accept chain=input comment=\u0026#34;DENIEGO ICMP\u0026#34; disabled=yes protocol=icmp add action=accept chain=forward comment=\u0026#34;Reglas Firewall Basicas\u0026#34; connection-state=related add action=accept chain=forward connection-state=established add action=drop chain=input comment=\u0026#34;FIltra ICMP Redirect\u0026#34; icmp-options=5:0-255 protocol=icmp add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg,!syn,!rst,!ack,!urg add action=accept chain=output content=\u0026#34;530 Login incorrect\u0026#34; dst-limit=1/1m,9,dst-address/1m protocol=tcp add action=add-dst-to-address-list address-list=ftp_blacklist address-list-timeout=3h chain=output content=\u0026#34;530 Login incorrect\u0026#34; protocol=tcp add action=jump chain=input comment=\u0026#34;Jump for icmp input flow\u0026#34; jump-target=ICMP protocol=icmp add action=jump chain=forward comment=\u0026#34;Jump for icmp forward flow\u0026#34; jump-target=ICMP protocol=icmp add action=drop chain=input comment=\u0026#34;Block all access to the winbox - except to support list # DO NOT ENABLE THIS RULE BEFORE ADD YOUR SUBNET IN THE SUPPORT ADDRESS LIST\u0026#34; disabled=yes dst-port=8291 protocol=tcp src-address-list=!support add action=drop chain=input comment=\u0026#34;Drop anything else! # DO NOT ENABLE THIS RULE BEFORE YOU MAKE SURE ABOUT ALL ACCEPT RULES YOU NEED\u0026#34; disabled=yes add action=drop chain=input comment=\u0026#34;ultimo lugar todo lo que viene de fuera se descarta\u0026#34; disabled=yes in-interface=Lan add action=drop chain=input comment=\u0026#34;Block all access to the winbox - except to support list # DO NOT ENABLE THIS RULE BEFORE ADD YOUR SUBNET IN THE SUPPORT ADDRESS LIST\u0026#34; disabled=yes dst-port=8291 protocol=tcp src-address-list=!support add action=drop chain=forward disabled=yes p2p=all-p2p add action=drop chain=forward comment=\u0026#34;block p2p_www\u0026#34; layer7-protocol=p2p_www add action=drop chain=forward comment=\u0026#34;block p2p_dns\u0026#34; dst-port=53 layer7-protocol=p2p_dns protocol=udp add action=add-src-to-address-list address-list=acceso-winbox address-list-timeout=none-dynamic chain=input dst-port=8292 protocol=tcp /ip firewall mangle add action=mark-connection chain=prerouting comment=\u0026#34;PRIO - 7 MULTIDESCARGAS\u0026#34; connection-bytes=50000000-0 new-connection-mark=\u0026#34;PRIO 7\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 7\u0026#34; new-packet-mark=\u0026#34;PRIO 7\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 7\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 1\u0026#34; new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=icmp add action=mark-connection chain=output dst-port=53 new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=udp add action=mark-connection chain=prerouting dst-port=53 new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=udp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 1\u0026#34; new-packet-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 1\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 2 , STREAMING - JUEGOS,VOIP\u0026#34; dst-port=5060-5061 new-connection-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes protocol=udp add action=mark-connection chain=prerouting dst-port=1863,5190,777 new-connection-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 2\u0026#34; new-packet-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 2\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;marco prio 3 navegacion\u0026#34; dst-port=80,443,8000-9000 new-connection-mark=\u0026#34;PRIO 3\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 3\u0026#34; new-packet-mark=\u0026#34;PRIO 3\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 3\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;PRIO 4 - PUERTOS LABORALES\u0026#34; dst-port=25,110,143,3389,1723,21-23 new-connection-mark=\u0026#34;PRIO 4\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 4\u0026#34; new-packet-mark=\u0026#34;PRIO 4\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 4\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 5\u0026#34; new-connection-mark=\u0026#34;PRIO 5\u0026#34; passthrough=yes add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 5\u0026#34; new-packet-mark=\u0026#34;PRIO 5\u0026#34; passthrough=yes add action=accept chain=\u0026#34;TERMINO DE PROCESAR\u0026#34; /ip firewall nat add action=masquerade chain=srcnat comment=\u0026#34;default configuration\u0026#34; out-interface=Lan to-addresses=0.0.0.0 /ip firewall service-port set ftp disabled=yes set tftp disabled=yes set irc disabled=yes set h323 disabled=yes set sip disabled=yes set pptp disabled=yes /ip hotspot ip-binding ... ... /ip hotspot service-port set ftp disabled=yes /ip hotspot user add name=admin password=password profile=admin server=hotspot1 add name=usuario password=usuario server=hotspot1 add disabled=yes name=usuario@correo.com password=password123 server=hotspot1 /ip hotspot walled-garden add disabled=yes dst-host=www.google.es server=hotspot1 src-address=0.0.0.0 add comment=\u0026#34;place hotspot rules here\u0026#34; disabled=yes add dst-host=guifi.net add dst-host=*.guifi.net*/* add dst-host=gg.google.com add dst-host=maps.google.com add dst-host=khm0.google.com add dst-host=khm1.google.com add dst-host=khm2.google.com add dst-host=khm3.google.com add dst-host=mt0.google.com add dst-host=mt1.google.com add dst-host=mt2.google.com add dst-host=mt3.google.com add dst-host=maps.gstatic.com add dst-host=gg.google.com add dst-host=id.google.com add dst-host=www.google-analytics.com add dst-host=www.heywhatsthat.com add dst-host=ocsp.thawte.com add dst-host=https://securityinabox.org/es*/* add dst-host=http://www.eltiempo.es/* add dst-host=http://elrollodecepeda.wordpress.com/* add dst-host=http://cepedadelamora.blogspot.com/* add dst-host=https://llistes.guifi.net/sympa/info/guifi-gredos add dst-host=https://llistes.guifi.net/* add dst-host=http*://securityinabox.org/es*/* add dst-host=https://*llistes.guifi.net*/* add dst-host=https://llistes.guifi.net/sympa/subscribe/guifi-gredos add dst-host=https://llistes.guifi.net/sympa*/* add dst-host=https://llistes.guifi.net/sympa/* add dst-host=http://bin-short.whatsapp.net/ add dst-host=http://cepedadelamora.blogspot.com.es/ add dst-host=*.qui.guifi.net*/* /ip hotspot walled-garden ip add action=accept comment=10.0.0.0/8 disabled=no dst-address=10.0.0.0/8 !dst-port !protocol !src-address add action=accept comment=llistes.guifi.net disabled=no dst-address=109.69.12.15 !dst-port !protocol !src-address add action=accept comment=securityinabox.org disabled=no dst-address=88.198.62.144 !dst-port !protocol !src-address /ip ipsec policy set 0 dst-address=0.0.0.0/0 src-address=0.0.0.0/0 /ip proxy set cache-administrator=mail@gmail.com cache-path=web-proxy1 parent-proxy=0.0.0.0 /ip route add distance=1 gateway=10.228.150.1 /ip service set telnet disabled=yes set ftp address=0.0.0.0/0 disabled=yes set www address=192.168.1.0/24 set ssh address=0.0.0.0/0 disabled=yes set www-ssl address=0.0.0.0/0 certificate=cert1 disabled=no set api disabled=yes set winbox address=0.0.0.0/0 port=8291 set api-ssl disabled=yes /ip traffic-flow set active-flow-timeout=10m cache-entries=64k enabled=yes /ip traffic-flow target add dst-address=10.228.150.2 port=5556 /snmp set contact=guifi@guifi.net enabled=yes location=hostname /system clock set time-zone-autodetect=no time-zone-name=Europe/Madrid /system clock manual set dst-end=\u0026#34;feb/01/1970 00:00:00\u0026#34; dst-start=\u0026#34;feb/01/1970 00:00:00\u0026#34; /system identity set name=hostname /system logging add action=remote topics=critical add action=remote topics=error add action=remote topics=info add action=remote topics=warning add topics=e-mail add action=remote topics=e-mail add action=disk topics=critical add action=remote topics=firewall add action=disk topics=system add action=echo topics=warning /system note set note=\u0026#34;MMMMMMMMMMMMMMMMMMMMMXo,;:::;,;dXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMMWO;;OWMMWXo. :KMMMMMWKxoldkXWMMMMMMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMKc\u0026#39;lXMMMMMMX: ;KMMMXo;dk\u0026#39; .cx0KNWMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMO,,OWMMMMMMMWo ,oxxcc0WWx..\u0026#39;. .,.,dXMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMK;:XMMMMMMMMMMXc..;cokKWMMXkl:clcc, :XMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMK:lXMMMMMMMMMMMM0\u0026#39; .:cod0NWd..;,..\u0026#39;;,. oNMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMXx;oNMMMMMMMMMMMMNOl:;:::cooddl:;,,\u0026#39; .cl;.;oOKNWMMMMMMMM\\ \\nMMMMMMMMMW0olcl0WMMMMMMMMMMMMMWK0NX0OdoooolccloOKkl:dklcc,..,oddKMMMMM\\ \\nMMMMMMMMKc\u0026#39;:kXWMMMMMMMMMMMMMMMMMMMMMWx;\u0026#39;..:cclllodxolo,.\u0026#39;:. .,..oKWMM\\ \\nMMMMMMNd,:0WMMMMMMMMMMMMMMMMMMMMMMNXo. .cooll;..,codc,. .,\u0026#39;,;,\u0026#39;:ON\\ \\nMMMWXd::kWMMMMMMMMMMMMMMMMMMMMMMMM0l\u0026#39; \u0026#39;;;:oollc,,dOdl;\u0026#39;;clodoolk\\ \\nN0kdooONMMMMMMMMMMMMMMMMMMMMMMMMMWd,\u0026#39;.. \u0026#39;loldXNkolllokxookKKXWNK\\ \\nXK0XWMMMMMMMMMMMMMMMMMMMMMMMMMMWKOdccoxc. \u0026#39;dOkOXN0x0XK0NMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKx0MXxdkxl:,::dKWMMWMMMWWMMMMMMMMMMMMM\\ \\n\u0026#34; /system ntp client set enabled=yes primary-ntp=158.227.98.15 secondary-ntp=193.136.164.1 /system ntp server set enabled=yes multicast=yes /system routerboard settings set silent-boot=no /system scheduler add comment=23:42:26 interval=23h54m name=LOG_MAIL on-event=\u0026#34;:local scheduleName \\\u0026#34;LOG_MAIL\\\u0026#34;\\r\\ \\n:local emailAddress \\\u0026#34;mail@gmail.com\\\u0026#34;\\r\\ \\n:local startBuf [:toarray [/log find message~\\\u0026#34;logged in\\\u0026#34; || message~\\\u0026#34;login failure\\\u0026#34;]]\\r\\ \\n:local removeThese (\\\u0026#34;\\\u0026#34;)\\r\\ \\n \\r\\ \\n:local lastTime [/system scheduler get [find name=\\\u0026#34;\\$scheduleName\\\u0026#34;] comment]\\r\\ \\n \\r\\ \\n:local currentBuf \\\u0026#34;\\\u0026#34;; :set currentBuf [:toarray \\$currentBuf]\\r\\ \\n \\r\\ \\n:foreach i in=\\$startBuf do={\\r\\ \\n :local toggle 1\\r\\ \\n :foreach j in=[:toarray \\$removeThese] do={\\r\\ \\n :if ([:typeof [:find [/log get \\$i message] \\\u0026#34;\\$j\\\u0026#34;]] = \\\u0026#34;num\\\u0026#34;) do={\\r\\ \\n :set toggle 0\\r\\ \\n }\\r\\ \\n }\\r\\ \\n :if (\\$toggle = 1) do={\\r\\ \\n :set currentBuf (\\$currentBuf , \\$i)\\r\\ \\n }\\r\\ \\n}\\r\\ \\n \\r\\ \\n:local currentLineCount [ :len \\$currentBuf ]\\r\\ \\n \\r\\ \\nif (\\$currentLineCount \u0026gt; 0) do={\\r\\ \\n :local currentTime \\\u0026#34;\\$[ /log get [ :pick \\$currentBuf (\\$currentLineCount -1) ] time ]\\\u0026#34;\\r\\ \\n \\r\\ \\n :if ([:len \\$currentTime] = 15 ) do={\\r\\ \\n :set currentTime [ :pick \\$currentTime 7 15 ]\\r\\ \\n }\\r\\ \\n \\r\\ \\n :local output \\\u0026#34;\\$currentTime \\$[/log get [ :pick \\$currentBuf (\\$currentLineCount-1) ] message ]\\\u0026#34;\\r\\ \\n \\r\\ \\n :if (([:len \\$lastTime] \u0026lt; 1) || (([:len \\$lastTime] \u0026gt; 0) \u0026amp;\u0026amp; (\\$lastTime != \\$currentTime))) do={\\r\\ \\n /system scheduler set [find name=\\\u0026#34;\\$scheduleName\\\u0026#34;] comment=\\$currentTime\\r\\ \\n /tool e-mail send to=\\\u0026#34;mail@gmail.com\\\u0026#34; port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=\\\u0026#34;hostname_LOG \\$currentTime\\\u0026#34; body=\\\u0026#34;\\$output\\\u0026#34;\\r\\ \\n }\\r\\ \\n}\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-time=startup add interval=23h53m name=SEND_BACKUP on-event=\u0026#34;/system script run SEND_BACKUP\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-time=startup add comment=\u0026#34;REINICIO CADA DIA\u0026#34; interval=1d name=schedule1 on-event=\u0026#34;/system script run reiniciar\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-date=jun/03/2016 start-time=06:00:00 /system script add dont-require-permissions=no name=console_detail owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;:local content\\r\\ \\n:local logcontenttemp \\\u0026#34;\\\u0026#34;\\r\\ \\n:local logcontent \\\u0026#34;\\\u0026#34;\\r\\ \\n:local counter\\r\\ \\n:local v 0\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;You are logged into: \\$[/system identity get name]\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;############### system health ###############\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;Uptime: \\$[/system resource get uptime] d:h:m:s\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;CPU: \\$[/system resource get cpu-load]%\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;RAM: \\$(([/system resource get total-memory]-[/system resource get free-memory])/1024)/\\$([/system resource get total-memory]/1024)M\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n \\r\\ \\n##\\r\\ \\n#voltage and temp readout not available on x86, check for this before trying\\r\\ \\n#to record otherwise script will halt unexpectedly\\r\\ \\n##\\r\\ \\n \\r\\ \\n:if ([/system resource get architecture-name]=\\\u0026#34;x86\\\u0026#34;) do={\\r\\ \\n :set logcontenttemp \\\u0026#34;Voltage: NIL\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n :set logcontenttemp \\\u0026#34;Temp: NIL\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n} else={\\r\\ \\n :set logcontenttemp \\\u0026#34;Voltage: \\$[:pick [/system health get voltage] 0 2] v\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n :set logcontenttemp \\\u0026#34;Temp: \\$[ /system health get temperature]c\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n}\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;############# user auth details #############\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:foreach counter in=[/ip hotspot active find ] do={:set v (\\$v + 1)}\\r\\ \\n:set logcontenttemp \\\u0026#34;Hotspot online: \\$v |\\\u0026#34;\\r\\ \\n:set v 0\\r\\ \\n:foreach counter in=[/ppp active find ] do={:set v (\\$v + 1)}\\r\\ \\n:set logcontenttemp (\\\u0026#34;\\$logcontenttemp\\\u0026#34; . \\\u0026#34; PPP online: \\$v\\\u0026#34;)\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n/system note set note=\\\u0026#34;\\$logcontent\\\u0026#34;\u0026#34; add dont-require-permissions=no name=reiniciar owner=admin policy=ftp,reboot,read,write,policy,test,password source=\u0026#34;/system reboot\u0026#34; add dont-require-permissions=no name=SEND_BACKUP owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;/system backup save name=hostname_email_backup dont-encrypt=no\\r\\ \\n/log print file=hostname_logmail.txt\\r\\ \\n\\r\\ \\n/tool e-mail send file=hostname_email_backup.backup to=mail@gmail.com port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=hostname_backup_diario body=hostname_backup_diario\\r\\ \\n/tool e-mail send file=hostname_logmail.txt to=mail@gmail.com port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=hostname_log_diario body=hostname_log_diario\u0026#34; add dont-require-permissions=no name=address_list_winbox-acces owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;ip firewall address-list print\u0026#34; /tool e-mail set address=74.125.133.108 from=hostname password=password start-tls=yes user=mail@gmail.com /tool graphing interface add add interface=bridge1 add add interface=ether1 add interface=ether3 add interface=ether4 add interface=ether5 add /tool graphing queue add simple-queue=2MB_down_384MB_up add simple-queue=queue1 /tool graphing resource add /tool mac-server set allowed-interface-list=mactel /tool mac-server mac-winbox set allowed-interface-list=mac-winbox /tool romon port add *\u0026gt;   Tutorial de como montar un hotspot en MikroTik\nParece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rConclusión En este momento se intentan poner todas las facilidades posibles para que a pie de calle se pueda conectar al acceso abierto de la manera más sencilla con cualquier dispositivo que cuente al menos con 802.11b.\nAl principio estaba el portal cautivo del hotspot con acceso limitado en tiempo y caudal (creo que eran 320k simétricos para cada dispositivo por un tiempo de 2 horas al día por dispositivo), en esta gestión por MAC, el \u0026ldquo;cliente\u0026rdquo; tenía que abrir una página cualquiera con el navegador del dispositivo y se le redireccionaba a la página del hotspot, después validarse en el hotspot con un link de pincha aquí para tener acceso, en fin, un lío para cualquiera que quisiera conectarse a la wifi.\nTuve que poner un cartel en el bar con las indicaciones para conectarse: Parece que no tienes plugin para visualizar PDF en tu navegador.\rPuedes descargar el archivo aquí\n\rY se deshabilitó el hotspot. Ahora para tener conexión a internet basta con conectar a la wifi. Hay un caudal límite para el global de todas las conexiones de acceso abierto, y el \"cliente\" cuando se quiere conectar solo tiene que conectar con el SSID del AP, se conecta a una wifi que no tiene contraseña, se asigna una IP y ya le funciona el WhatsApp y cualquier servicio de su dispositivo, antes para que funcionara el WhatsApp primero había que conectase al portal cautivo con el navegador, y no valía la barra de búsqueda de Google que usan muchos usuarios. Además que tener las conexiones limitadas en tiempo y caudal no tiene sentido hacerlo cuando hay poca demanda y es un caudal que se está desaprovechando. La gestión del tráfico en el acceso abierto se hace por QoS se asignan prioridades dependiendo del servicio.\nSi tuviéramos 100 o 200 Mb de salida a internet no tendríamos estos problemas y a pie de calle el grifo estaría abierto a demanda, pero la salida a internet es limitada y requiere de gestión por QoS para evitar la congestión, llega un momento que se satura y deja de funcionar.\nLo que tenemos actualmente, en 2021, es un una salida global a internet por telefonía móvil que falla cuando quiere y que hay que repartir entre muchas conexiones. Hay un caudal limitado para el total de conexiones a pie de calle del hotspot y el resto es para las conexiones residenciales.\nEl invento funciona más o menos 335 días al año, hay 30 días cuando llegan las temporadas de máxima concurrencia de conexiones que da igual lo que tengas configurado porque la salida a internet es la misma todo el año y no da para más.\nPor ejemplo, en verano que son las temporadas de pico máximo, con 30 nodos residenciales a 4 dispositivos de media por nodo son 120 dispositivos residenciales + de 20 a 40 dispositivos del hotspot son 150 dispositivos que tienen que salir a internet por una conexión que está dimensionada para tener de 1 a 4 dispositivos.\nQue quede claro que yo no soy partidario hacer gestión del tráfico en ningún sitio y mucho menos en una red comunitaria, pero la salida a internet es la que es y hay momentos en los que hay muchas bocas que alimentar.\nSon los usuarios los que se tienen que responsabilizar de su uso.\nAhora en 2021, lo siguiente que voy a hacer es quitar el límite de caudal global de las conexiones del hotspot, porque quien soy yo para decidir que límite de datos tiene que haber en una conexión que está pagando el excelentísimo Ayto de Cepeda de la Mora para uso y disfrute de todos sus vecinos, el mismo derecho tienen los que están en el cuarto de baño de su casa que los que están en la plaza del pueblo (ahora por orden de la diputación se quitó el AP de la plaza, dicen que es para evitar aglomeraciones de adolescentes), porque a lo mejor no quieren o no se pueden permitir tener un nodo propio en su casa.\nUna posible solución a este problema de concurrencia seria aplicar QoS dinámicas en las que se hiciera la gestión del tráfico por prioridad, tiempo y caudal, basándose en el número de conexiones y demanda de cada momento, pero volvemos a lo mismo. En una red comunitaria ni yo ni nadie tiene que decidir sí un tipo de tráfico tiene más o menos prioridad que otro.\n\n","description":"hotspot","id":54,"section":"posts","tags":["guifi.net","hotspot","mikrotik","cepeda la mora","Ubiquiti","wifi"],"title":"Hotspot","uri":"https://hotspotcepeda.github.io/es/posts/hotspot/"},{"content":"En este artículo se comenta como intenté buscar el apoyo en asociaciones locales para que promovieran la iniciativa de una red de telecomunicaciones comunitaria, de alguna manera, para conseguir tener una wifi púbica, un acceso público a internet en un área rural desfavorecida. Por aquel entonces las conexiones a internet en Cepeda se hacían mediante el ISP Iberbanda (que daba conexiones de 1 2 y 3 Mb simétricos), y el 3G era un lujo.\nContactos Habían pasado unos cuantos de años desde que vi la página de guifi.net por primera vez y navegando por la internet lo volví a ver, ahora había un montón de nodos y la tela de araña se estaba extendiendo incluso fuera de Cataluña. A mí me gustaba la idea de la red libre abierta y neutral pero no tenía ni idea de como empezar.\nEn Cataluña guifi.net llevaba 10 años funcionando y el proyecto iba creciendo.\nYo acababa de ser despedido de manera improcedente de una empresa de telecomunicaciones en la que me dedicaba a instalar equipos de wifi para dar cobertura a nivel población e interconectar dependencias municipales, tenía mucha rabia acumulada y estaba viendo una sonrisa en los pueblos que tenían wifi, la verdad es que era un trabajo que me gustaba mucho y me fastidió cuando me dijeron que me dejaban en la calle.\nHubo una persona que me sugirió la idea de la wifi comunitaria y fue entonces cuando se me metió en la cabeza la idea de aportar mi experiencia al pueblo que me había visto crecer y del que estoy tan orgulloso.\nNo tenía ni idea de como empezar, así que pensé que contactar con asociaciones locales me podía iluminar y que iban a apoyar mi idea, que no era otra que compartir una salida a internet y ponerla a disposición del que la necesitara.\nAsí qué, Intenté buscar aliados, para por lo menos, presentar una propuesta.\n Lo primero contacté con la asociación El Royo de Cepeda la Mora, la asociación más potente del pueblo https://www.facebook.com/elrollodecepeda/, se enviaron 2 correos a elrollodecepeda@gmail.com comentando la idea de la wifi en el pueblo y hablando del proyecto guifi.net, sin respuesta. Contacté con ASENORG, Asociación Empresarios Gredos al mail de Isabel Sánchez Tejado isabelstejado@gmail.com, que era el que había de contacto, sin respuesta (Ahora esta persona se dedica a \u0026ldquo;el cultivo de Piornos (no te pierdas nuestro Festival del Piorno)\u0026rdquo;. Me parto. Según https://repueblo.es/cracksrurales/la-inspiradora-historia-de-una-repobladora-en-gredos). Y con voluntariadogredoslibre@gmail.com, sin respuesta, claro.  Eran las asociaciones locales que había en aquella época.\nTener el respaldo de una asociación consolidada dará fuerza al proyecto. Si no hay nada, es muy interesante contemplar la posibilidad de crear una fundación, asociación, cooperativa, grupo o colectivo de usuarios para fomentar la implicación del grupo y para repartir la carga de trabajo. Tomar de decisiones es más fácil cuando no estás solo. Pero también ten en cuenta que si viajas solo, podrás volar a donde quieras y estar el tiempo que te dé la gana.\nguifi.net También contacté con guifi.net fundacio@guifi.net, sin respuesta. Descubrí que las comunicaciones en guifi.net se hacían mediante las listas de correo https://llistes.guifi.net/sympa y tiene sentido, es interesante tener un repositorio de información para poder hacer búsquedas y navegación de hilos. Aunque las listas de correo son cada vez menos populares se siguen usando.\nY con la agrupación guifi.net Extremadura, mediante las listas de correo ya hubo algo de diálogo.\nUn día me presenté en el MediaLab Prado, un sitio maravilloso lleno de gente extraordinaria que el Ayto. de Madrid quiere desalojar para convertirlo en un museo, está claro que este país no tiene mucho interés en la cultura y que todo está orientado a vivir del turismo, un país que es el chiringuito de Europa, con sol, playa y el producto estrella: El folclore.\nFinalmente con el apoyo de Gabi y Alex, las personas que conocí en el MediaLab Prado, se presentó una propuesta al ayuntamiento de Cepeda para poner un hotspot y un par de AP en 2.4 para conexión wifi pública a pie de calle, una antena en la plaza del Ayto. y otra en el bar municipal. La salida a internet la donaba el ayuntamiento que tenía contratada una conexión de 3 Mb simétricos y que la mayoría del tiempo estaba sin uso.\nPara desplegar una red comunitaria local wireless vas a necesitar tener algúnos conocimientos.\nHay un libro publicado bajo licencia Creative Commons que a mí me gustó mucho, \u0026ldquo;Redes inalámbricas en los países en desarrollo.\u0026rdquo;\nEs gratis y está traducido al español y a muchos más idiomas, se puede descargar en http://wndw.net/book.html\nTampoco es necesario que te conviertas en un experto en telecomunicaciones, para desplegar y mantener la red puedes contratar a un profesional de tu zona, qué para eso están.\nIgualmente hay que valorar el tipo de despliegue que se quiere hacer y las necesidades que se quieren cubrir, por ejemplo, cada vez es más barato desplegar con fibra óptica.","description":"arrancando","id":55,"section":"posts","tags":["guifi.net","asociaciones","cepeda la mora","wifi"],"title":"Arrancando","uri":"https://hotspotcepeda.github.io/es/posts/arrancando/"}]