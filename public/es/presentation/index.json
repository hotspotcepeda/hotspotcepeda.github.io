[{"content":"Wazuh en UGREEN Express üöÄ Paso 1: Preparaci√≥n (SSH) Preparar Kernel y archivos:\n1 2 3 4 5 6 7 8 9 10 # 1. Ajuste del Kernel (Persistente tras reinicio) sudo sysctl -w vm.max_map_count=262144 echo \u0026#34;vm.max_map_count=262144\u0026#34; | sudo tee -a /etc/sysctl.conf # 2. Directorio de trabajo cd /volume1/Docker # 3. Clonar el repositorio oficial (v4.7.2 o la estable que corresponda) git clone https://github.com/wazuh/wazuh-docker.git -b v4.7.2 --depth=1 cd wazuh-docker/single-node Paso 2: Generaci√≥n del Stack Generador autom√°tico de certificados Wazuh.\n1 2 3 4 5 # A. Generar certificados TLS (10 segundos) docker-compose -f generate-certs.yml run --rm generator # B. Levantar el sistema completo ( 5-10 min ) docker-compose up -d Acceso: https://IP-DEL-NAS:5601(certificado auto-firmado).\nPaso 3: Integraci√≥n con Portainer (Gesti√≥n GUI) Portainer \u0026gt; Stacks. Ver√°s el stack single-node como \u0026ldquo;External\u0026rdquo;. Clic y Editor. Portainer te permitir√° tomar el control del c√≥digo. A partir de ahora, gestiona contrase√±as o actualizaciones desde aqu√≠, sin tocar m√°s el terminal. üí° Resumen: 1 2 3 4 5 6 sudo sysctl -w vm.max_map_count=262144 cd /volume1/Docker git clone https://github.com/wazuh/wazuh-docker.git -b v4.7.2 --depth=1 cd wazuh-docker/single-node docker-compose -f generate-certs.yml run --rm generator docker-compose up -d IMPORTANTE: Las credenciales por defecto est√°n en el archivo .env. Por defecto: admin / SecretPassword.\nüöÄ De esta manera tienes un SIEM de grado empresarial en lo que tarda en hacerse un caf√©.\n","description":"Desplegar Wazuh en un UGreen DXP4800 Plus git clone.","id":2,"section":"posts","tags":["wazuh","siem","seguridad","docker","homelab"],"title":"Wazuh en UGreen express","uri":"http://localhost:1313/es/posts/ugreen_wazuh_express/"},{"content":"üåê ¬øQu√© es Wazuh? Wazuh es una plataforma de seguridad de c√≥digo abierto, gratuita y universalmente reconocida. Funciona como una soluci√≥n XDR (Detecci√≥n y Respuesta Extendidas) y SIEM (Gesti√≥n de Eventos e Informaci√≥n de Seguridad) todo en uno.\nWazuh centraliza, analiza y responde a eventos de seguridad de toda tu infraestructura, desde servidores y PCs hasta dispositivos m√≥viles.\n¬øQu√© Hace? Detecci√≥n de Intrusiones (HIDS): Monitoriza tus sistemas en busca de actividad sospechosa, cambios no autorizados en ficheros y malware. An√°lisis de Logs: Recopila y analiza logs de cualquier fuente (aplicaciones, sistemas operativos, firewalls) para detectar patrones de ataque. Monitorizaci√≥n de Integridad de Ficheros (FIM): Te alerta si ficheros cr√≠ticos del sistema o de tus aplicaciones son modificados. Evaluaci√≥n de Vulnerabilidades: Detecta software obsoleto o con vulnerabilidades conocidas en tus equipos. Cumplimiento Normativo: Ayuda a cumplir con est√°ndares de seguridad como PCI DSS, GDPR o HIPAA mediante reglas predefinidas. Respuesta Activa: Puede tomar acciones autom√°ticas, como bloquear una direcci√≥n IP en el firewall o detener un proceso malicioso. üõ†Ô∏è Instalaci√≥n del servidor Wazuh en Docker Instalar Wazuh en un NAS UGREEN es un salto de nivel importante. No es un contenedor ligero (como Pi-hole o Home Assistant); es un SIEM (Gesti√≥n de Eventos e Informaci√≥n de Seguridad) completo que demanda recursos y configuraciones espec√≠ficas del kernel de Linux.\nDespliegue de Wazuh en UGREEN NASync Gu√≠a t√©cnica y las consideraciones cr√≠ticas para desplegarlo en un DXP4800 Plus.\n1. Consideraciones de Hardware (Cr√≠tico) Wazuh se compone de tres partes: el Indexer (basado en OpenSearch), el Server y el Dashboard.\nMemoria RAM: Wazuh requiere un m√≠nimo de 4GB de RAM libres solo para el stack. Si tu DXP4800 Plus tiene los 8GB de serie, estar√°s al l√≠mite si tienes m√°s servicios. Se recomienda ampliar a 16GB o 32GB si es posible. Almacenamiento (IOPS): Es obligatorio instalarlo en el Volumen SSD (M.2). El Indexer realiza constantes operaciones de lectura/escritura de logs; en discos mec√°nicos el rendimiento ser√° p√©simo y el sistema se volver√° inestable. CPU: El i5 del DXP4800 Plus es m√°s que suficiente para una peque√±a empresa. Al venir de Proxmox, est√°s acostumbrado al aislamiento r√≠gido (as√≠gnas 4GB a una VM y esos 4GB \u0026ldquo;desaparecen\u0026rdquo; del host). En Docker, por defecto, los contenedores comparten todo el hardware sin l√≠mites, pero para un servicio cr√≠tico como Wazuh, debemos limitar los recursos para evitar que un pico de logs bloquee el NAS entero.\nAqu√≠ tienes la configuraci√≥n √≥ptima para una peque√±a empresa (5-25 agentes) en tu UGREEN DXP4800 Plus.\n1. La realidad del hardware: Ampliaci√≥n de RAM Antes de pasar al despliegue, una advertencia seria: Wazuh con 8GB de RAM en el NAS funcionar√° muy mal. Entre el sistema operativo UGOS, Docker y el stack de Wazuh, agotar√°s la memoria, el NAS usar√° \u0026ldquo;SWAP\u0026rdquo; (disco) y el panel ir√° lent√≠simo.\nRecomendaci√≥n Pro: Ampl√≠a el NAS a 16GB o 32GB (usa m√≥dulos DDR5 SO-DIMM compatibles). Es una inversi√≥n m√≠nima para un SIEM empresarial. 2. Asignaci√≥n de Recursos (Docker Compose) En Docker, los l√≠mites se definen en la secci√≥n deploy. Aqu√≠ tienes el reparto de \u0026ldquo;raciones\u0026rdquo; recomendado:\nComponente RAM M√≠nima RAM √ìptima CPU (Cores) Rol Wazuh Indexer 3 GB 4 GB 2 Cores El motor de b√∫squeda (el m√°s pesado). Wazuh Server 1.5 GB 2 GB 1 Core An√°lisis de logs y gesti√≥n de agentes. Wazuh Dashboard 1 GB 1.5 GB 0.5 Core Interfaz gr√°fica. TOTAL STACK 5.5 GB 7.5 GB 3.5 Cores 3. C√≥mo aplicarlo en docker-compose.yml A diferencia de Proxmox, donde lo haces en la GUI, aqu√≠ lo a√±ades al c√≥digo. Este es un ejemplo de c√≥mo limitar el Indexer (el m√°s cr√≠tico):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 services: wazuh.indexer: image: wazuh/wazuh-indexer:4.7.2 environment: # MUY IMPORTANTE: El \u0026#34;Heap Size\u0026#34; de Java debe ser el 50% de la RAM asignada - \u0026#34;OPENSEARCH_JAVA_OPTS=-Xms2g -Xmx2g\u0026#34; deploy: resources: limits: memory: 4G # No permite que use m√°s de esto (como en Proxmox) cpus: \u0026#39;2.0\u0026#39; # M√°ximo 2 n√∫cleos del i5 reservations: memory: 2G # Garantiza que el NAS le reserve esto al arrancar ulimits: # Requisito espec√≠fico de OpenSearch memlock: soft: -1 hard: -1 nofile: soft: 65536 hard: 65536 4. Gesti√≥n del Almacenamiento (Diferencias con Proxmox) En Proxmox creas un disco virtual (.qcow2). En Docker en UGREEN, usas Bind Mounts (carpetas directas):\nUbicaci√≥n: /volume1/Docker/wazuh/... Asignaci√≥n de espacio: Docker no limita el tama√±o de la carpeta por defecto. Usar√° todo el espacio disponible en tu volumen M.2. Tip de Seguridad (ENS): Crea una cuota de carpeta en el panel de UGREEN para la carpeta /Docker si no quieres que un error de logs llene el SSD por completo. 5. Comparativa Proxmox vs Docker Concepto Proxmox (VM) Docker (UGREEN) CPU Cores fijos o sockets. cpus: '2.0' (unidades de procesamiento). RAM Est√°tica (la bloquea al iniciar). Din√°mica con limits (solo usa lo que necesita). Disco Fichero de disco virtual (.raw/.qcow2). Carpetas locales del NAS (Filesystem directo). Kernel Cada VM tiene su propio kernel. Todos comparten el kernel de UGOS (Debian). 2. Preparaci√≥n del Sistema El componente Wazuh Indexer (OpenSearch) no arrancar√° a menos que el sistema operativo UGOS tenga un par√°metro del kernel espec√≠fico configurado.\nOpenSearch crea miles peque√±os mapas de memoria para gestionar sus √≠ndices. Por defecto, Linux (y por tanto el sistema UGOS de UGREEN basado en Debian) viene configurado con un l√≠mite de 65,530. OpenSearch necesita al menos 262,144 para arrancar.\nAjuste de \u0026ldquo;vm.max_map_count\u0026rdquo; Debes entrar por SSH a tu NAS (act√≠valo en Panel de Control \u0026gt; Terminal y SNMP) y ejecutar: 1 2 3 4 5 # Para aplicar el cambio inmediatamente sudo sysctl -w vm.max_map_count=262144 # Para que el cambio persista tras reiniciar el NAS echo \u0026#34;vm.max_map_count=262144\u0026#34; | sudo tee -a /etc/sysctl.conf Si no haces esto, el contenedor del Indexer entrar√° en un bucle de reinicio (Bootloop).\nError en log:\n1 \u0026#34;max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\u0026#34; 3. M√©todo de Instalaci√≥n: Docker Compose (Portainer) No intentes instalar Wazuh imagen por imagen desde la interfaz de UGREEN. La complejidad de las redes internas y vol√∫menes requiere Docker Compose.\nPara desplegar Wazuh de forma profesional en tu UGREEN NASync, vamos a seguir este ejemplo pr√°ctico paso a paso. Olv√≠date de la interfaz \u0026ldquo;App Center\u0026rdquo; de UGREEN para esto; usaremos SSH para la preparaci√≥n y Portainer para el despliegue.\nPaso 1: Creaci√≥n de la Estructura de Carpetas (v√≠a SSH o App Archivos) Necesitamos carpetas persistentes para que, si el contenedor se actualiza, no pierdas los logs ni las alertas.\nEntra por SSH y ejecuta:\n1 2 3 4 5 6 7 8 # Crear la estructura exacta para el Manager y Dashboard mkdir -p /volume1/Docker/wazuh/wazuh_indexer_data mkdir -p /volume1/Docker/wazuh/wazuh_etc mkdir -p /volume1/Docker/wazuh/wazuh_var mkdir -p /volume1/Docker/wazuh/certs # Permisos para el Indexer (Usuario 1000) sudo chown -R 1000:1000 /volume1/Docker/wazuh/wazuh_indexer_data Paso 2: Generaci√≥n de Certificados (El paso clave) Wazuh no arranca sin certificados TLS v√°lidos para cifrar la comunicaci√≥n entre sus 3 nodos internos. La forma m√°s f√°cil de hacerlo es usando el generador oficial de Wazuh mediante un contenedor temporal:\nDescarga el configurador: 1 2 cd /volume1/Docker/wazuh curl -sO https://packages.wazuh.com/4.7/config.yml Edita el config.yml (opcional) si quieres cambiar nombres, pero para un \u0026ldquo;Single Node\u0026rdquo; el que viene por defecto sirve. Ejecuta el generador: 1 docker run --rm -it -v $(pwd)/config.yml:/config.yml -v $(pwd)/certs:/nodedir wazuh/wazuh-certs-generator:4.7.2 Esto llenar√° tu carpeta /volume1/Docker/wazuh/certs con todos los .pem necesarios. Paso 3: El Stack de Portainer (Docker Compose) Ahora ve a tu Portainer \u0026gt; Stacks \u0026gt; Add Stack y pega este c√≥digo adaptado para las rutas que creamos antes de tu UGREEN.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 version: \u0026#39;3.8\u0026#39; services: wazuh.indexer: image: wazuh/wazuh-indexer:4.7.2 hostname: wazuh.indexer restart: always environment: - OPENSEARCH_JAVA_OPTS=-Xms2g -Xmx2g # Ajustado para tus 8GB-16GB de RAM deploy: resources: limits: memory: 4G volumes: - /volume1/Docker/wazuh/wazuh_indexer_data:/var/lib/opensearch/data - /volume1/Docker/wazuh/certs:/usr/share/opensearch/config/certs:ro ports: - \u0026#34;9200:9200\u0026#34; wazuh.manager: image: wazuh/wazuh-manager:4.7.2 hostname: wazuh.manager restart: always environment: - INDEXER_URL=https://wazuh.indexer:9200 - INDEXER_USER=admin - INDEXER_PASSWORD=TuPasswordSegura123! # CAMBIA ESTO deploy: resources: limits: memory: 2G volumes: - /volume1/Docker/wazuh/wazuh_etc:/var/ossec/etc - /volume1/Docker/wazuh/wazuh_var:/var/ossec/var - /volume1/Docker/wazuh/certs:/var/ossec/etc/indexer-certs:ro ports: - \u0026#34;1514:1514/tcp\u0026#34; # Logs de agentes - \u0026#34;1514:1514/udp\u0026#34; - \u0026#34;1515:1515\u0026#34; # Registro de agentes - \u0026#34;55000:55000\u0026#34; # API wazuh.dashboard: image: wazuh/wazuh-dashboard:4.7.2 hostname: wazuh.dashboard restart: always environment: - INDEXER_URL=https://wazuh.indexer:9200 - WAZUH_API_URL=https://wazuh.manager:55000 - INDEXER_USER=admin - INDEXER_PASSWORD=TuPasswordSegura123! # DEBE COINCIDIR CON EL INDEXER deploy: resources: limits: memory: 1.5G volumes: - /volume1/Docker/wazuh/certs:/usr/share/wazuh-dashboard/config/certs:ro ports: - \u0026#34;8443:5601\u0026#34; # Acceder√°s por https://IP-DEL-NAS:8443 networks: default: name: wazuh_network driver: bridge Paso 4: Consideraciones Finales tras el Despliegue Primer Inicio: La primera vez puede tardar hasta 3-5 minutos en levantar todos los servicios. OpenSearch (Indexer) es lento al inicializar los √≠ndices en el SSD. Acceso: Abre tu navegador y ve a https://192.168.1.100:8443 (usa la IP de tu NAS). User: admin Pass: La que pusiste en el YAML (o la por defecto si no la cambiaste en el script de certs). Verificaci√≥n de Agentes: Para a√±adir un PC, ve a \u0026ldquo;Add Agent\u0026rdquo; en el Dashboard. Te dar√° un comando de PowerShell o Bash. Aseg√∫rate de que la IP que aparece en ese comando sea la IP de tu NAS o el dominio de Tailscale. ¬øPor qu√© este m√©todo es mejor para el ENS? Al tener los datos en /volume1/Docker/wazuh/wazuh_etc, puedes incluir esa carpeta en tus copias de seguridad programadas (Hyper Backup o similar en UGREEN). Si el NAS falla, mueves esas carpetas a otro equipo con Docker, levantas el stack y tienes toda la configuraci√≥n y evidencias del ENS intactas.\n4. Puertos Clave a Gestionar Si vas a monitorizar equipos que est√°n fuera de la red local del NAS (en la misma empresa o sucursales), aseg√∫rate de que estos puertos est√©n operativos:\n1514 (TCP/UDP): Comunicaci√≥n de los Agentes (Logs). 1515 (TCP): Registro de nuevos Agentes. 55000 (TCP): API de Wazuh. 8443 (o el que asignes): Para acceder al Dashboard (Panel de control). 5. Tips de Mantenimiento en UGREEN Tip 1: Logs Rotativos e √çndices (Gesti√≥n de Almacenamiento) En una empresa, Wazuh puede recolectar gigabytes de logs diariamente. Si no lo controlas, el SSD M.2 del NAS se llenar√° y el sistema colapsar√°. Para el ENS, normalmente se exige una retenci√≥n m√≠nima de logs (ej. 1 a√±o para auditor√≠a), pero no todos tienen que estar \u0026ldquo;en caliente\u0026rdquo;.\nEjemplo Pr√°ctico: Pol√≠tica de Retenci√≥n (Index State Management - ISM) Wazuh Indexer (OpenSearch) gestiona los datos en \u0026ldquo;√≠ndices\u0026rdquo;. Vamos a crear una pol√≠tica para borrar datos autom√°ticamente tras 90 d√≠as:\nEntra en el Wazuh Dashboard \u0026gt; Men√∫ (hamburguesa) \u0026gt; Index Management. Ve a Policies \u0026gt; Create Policy. Usa el editor JSON para crear una pol√≠tica de \u0026ldquo;Borrado autom√°tico\u0026rdquo;: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 { \u0026#34;policy\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;Borrar logs de seguridad tras 90 dias.\u0026#34;, \u0026#34;default_state\u0026#34;: \u0026#34;hot\u0026#34;, \u0026#34;states\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;hot\u0026#34;, \u0026#34;actions\u0026#34;: [], \u0026#34;transitions\u0026#34;: [ { \u0026#34;state_name\u0026#34;: \u0026#34;delete\u0026#34;, \u0026#34;conditions\u0026#34;: { \u0026#34;min_index_age\u0026#34;: \u0026#34;90d\u0026#34; } } ] }, { \u0026#34;name\u0026#34;: \u0026#34;delete\u0026#34;, \u0026#34;actions\u0026#34;: [ { \u0026#34;delete\u0026#34;: {} } ], \u0026#34;transitions\u0026#34;: [] } ] } } Aplica esta pol√≠tica a los √≠ndices wazuh-alerts-*. De esta forma, tu NAS siempre tendr√° espacio libre. Tip 2: Alertas por Email y Slack (Notificaci√≥n de Incidentes) El ENS exige que la organizaci√≥n sea capaz de detectar y notificar incidentes. No sirve de nada que el NAS registre un ataque si nadie se entera hasta el lunes.\nA. Configuraci√≥n de Email (SMTP) Debes editar el archivo de configuraci√≥n del Wazuh Manager. En tu UGREEN, lo mapeamos a /volume1/Docker/wazuh/wazuh_etc/ossec.conf.\nAbre el archivo y busca la secci√≥n \u0026lt;global\u0026gt;:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;ossec_config\u0026gt; \u0026lt;global\u0026gt; \u0026lt;email_notification\u0026gt;yes\u0026lt;/email_notification\u0026gt; \u0026lt;smtp_server\u0026gt;smtp.gmail.com\u0026lt;/smtp_server\u0026gt; \u0026lt;email_from\u0026gt;seguridad-nas@tuempresa.com\u0026lt;/email_from\u0026gt; \u0026lt;email_to\u0026gt;tu-correo@gmail.com\u0026lt;/email_to\u0026gt; \u0026lt;email_maxperhour\u0026gt;12\u0026lt;/email_maxperhour\u0026gt; \u0026lt;email_ids_name\u0026gt;Alertas Seguridad UGREEN\u0026lt;/email_ids_name\u0026gt; \u0026lt;/global\u0026gt; \u0026lt;alerts\u0026gt; \u0026lt;log_alert_level\u0026gt;3\u0026lt;/log_alert_level\u0026gt; \u0026lt;email_alert_level\u0026gt;10\u0026lt;/email_alert_level\u0026gt; \u0026lt;!-- Solo env√≠a email si la alerta es grave (nivel 10+) --\u0026gt; \u0026lt;/alerts\u0026gt; \u0026lt;/ossec_config\u0026gt; Nota: Para Gmail/Outlook necesitar√°s una \u0026ldquo;Contrase√±a de Aplicaci√≥n\u0026rdquo; si tienes 2FA.\nB. Configuraci√≥n de Slack (M√°s moderno y efectivo) Slack es mucho mejor para ver alertas en el m√≥vil en tiempo real.\nCrea un Incoming Webhook en Slack (o Teams). A√±ade este bloque al final de tu ossec.conf: 1 2 3 4 5 6 \u0026lt;integration\u0026gt; \u0026lt;name\u0026gt;slack\u0026lt;/name\u0026gt; \u0026lt;hook_url\u0026gt;https://hooks.slack.com/services/T000000/B000000/XXXXXXXXXXXX\u0026lt;/hook_url\u0026gt; \u0026lt;level\u0026gt;10\u0026lt;/level\u0026gt; \u0026lt;!-- Nivel de alerta m√≠nimo para disparar el mensaje --\u0026gt; \u0026lt;alert_format\u0026gt;json\u0026lt;/alert_format\u0026gt; \u0026lt;/integration\u0026gt; Reinicia el contenedor de Wazuh Manager desde Portainer para aplicar los cambios. Tip 3: Para que el NAS te avise si alguien intenta entrar en el propio panel de UGREEN por fuerza bruta El panel de UGREEN (UGOS) corre sobre el NAS, pero Wazuh corre dentro de un contenedor. Para que Wazuh pueda \u0026ldquo;leer\u0026rdquo; los intentos de login fallidos del NAS, necesitamos mapear los logs del sistema operativo host al contenedor del Manager.\nPaso 1: Mapear los Logs del NAS al Contenedor Debes modificar tu archivo docker-compose.yml en Portainer para que el servicio wazuh.manager tenga acceso a los logs de autenticaci√≥n del NAS:\n1 2 3 4 5 6 services: wazuh.manager: # ... resto de la configuraci√≥n ... volumes: - /var/log/auth.log:/var/log/ugreen_auth.log:ro # Mapea el log de auth del NAS # ... otros vol√∫menes ... Nota: En sistemas basados en Debian (como UGOS), /var/log/auth.log registra los intentos de SSH y logins del sistema.\nPaso 2: Configurar Wazuh para leer ese archivo Edita el archivo de configuraci√≥n de Wazuh (/volume1/Docker/wazuh/wazuh_etc/ossec.conf) y a√±ade este bloque para que empiece a monitorizar el nuevo archivo:\n1 2 3 4 5 6 \u0026lt;ossec_config\u0026gt; \u0026lt;localfile\u0026gt; \u0026lt;log_format\u0026gt;syslog\u0026lt;/log_format\u0026gt; \u0026lt;location\u0026gt;/var/log/ugreen_auth.log\u0026lt;/location\u0026gt; \u0026lt;/localfile\u0026gt; \u0026lt;/ossec_config\u0026gt; Paso 3: Crear la Regla Personalizada Wazuh ya tiene reglas para SSH, pero el panel web de UGREEN puede tener un formato de log espec√≠fico. Vamos a crear una regla que detecte m√∫ltiples fallos y dispare una alerta nivel 10 (la que configuramos para Slack/Email).\nEdita el archivo de reglas locales: /volume1/Docker/wazuh/wazuh_etc/rules/local_rules.xml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;group name=\u0026#34;ugreen,bruteforce,\u0026#34;\u0026gt; \u0026lt;!-- Regla base: Detectar un fallo de login en el panel UGREEN --\u0026gt; \u0026lt;rule id=\u0026#34;100001\u0026#34; level=\u0026#34;5\u0026#34;\u0026gt; \u0026lt;decoded_as\u0026gt;syslog\u0026lt;/decoded_as\u0026gt; \u0026lt;match\u0026gt;web login failed|authentication failure\u0026lt;/match\u0026gt; \u0026lt;description\u0026gt;Fallo de inicio de sesi√≥n en el panel UGREEN.\u0026lt;/description\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;!-- Regla de Fuerza Bruta: 5 fallos en menos de 2 minutos --\u0026gt; \u0026lt;rule id=\u0026#34;100002\u0026#34; level=\u0026#34;10\u0026#34;\u0026gt; \u0026lt;if_matched_sid\u0026gt;100001\u0026lt;/if_matched_sid\u0026gt; \u0026lt;same_source_ip /\u0026gt; \u0026lt;frequency\u0026gt;5\u0026lt;/frequency\u0026gt; \u0026lt;timeframe\u0026gt;120\u0026lt;/timeframe\u0026gt; \u0026lt;description\u0026gt;Ataque de fuerza bruta detectado en el panel UGREEN de la empresa.\u0026lt;/description\u0026gt; \u0026lt;mitigation\u0026gt;active-response\u0026lt;/mitigation\u0026gt; \u0026lt;!-- Opcional: para bloquear la IP --\u0026gt; \u0026lt;/rule\u0026gt; \u0026lt;/group\u0026gt; Paso 4: Ejemplo de Alerta en tu M√≥vil (Slack/Email) Una vez reinicies el stack en Portainer, si alguien intenta adivinar la contrase√±a de tu NAS 5 veces, recibir√°s una notificaci√≥n autom√°tica:\nWAZUH Alert\nLevel: 10 (Critical)\nRule: 100002 - Ataque de fuerza bruta detectado en el panel UGREEN de la empresa.\nLocation: (IP del atacante)\nDescription: 5 login failures from same IP in 120 seconds.\nCompliance: ENS op.exp.4 (Detecci√≥n de intrusi√≥n), PCI DSS 10.2.4.\n¬øQu√© hace?\nCuando Wazuh detecta la fuerza bruta (Regla 100002), env√≠a una orden al NAS UGREEN para que ejecute un script que bloquee la IP del atacante en el firewall (iptables) autom√°ticamente durante 24 horas.\nProtecci√≥n 24/7: No dependes de que t√∫ veas el email a las 3 de la ma√±ana. Evidencia de Cumplimiento: Para el ENS, no solo est√°s monitorizando (detecci√≥n), sino que tienes una medida de protecci√≥n activa (reacci√≥n ante incidentes). 6. Resoluci√≥n de problemas comunes en UGREEN Contenedor \u0026ldquo;Unhealthy\u0026rdquo;: Generalmente es falta de RAM o no haber aplicado el vm.max_map_count. Permisos de Carpeta: Si el Indexer falla al escribir, aseg√∫rate de que las carpetas en el NAS tengan permisos totales (chmod 777 o asignaci√≥n al usuario Docker) ya que OpenSearch usa un ID de usuario interno (1000). Resumen de Mantenimiento Mensual: Revisar Espacio: Mira en el panel de UGREEN que el volumen SSD no pase del 80%. Actualizar Stack: En Portainer, haz un \u0026ldquo;Pull and Redeploy\u0026rdquo; de vez en cuando para tener la √∫ltima versi√≥n de Wazuh (que incluye nuevas reglas de detecci√≥n de amenazas). Verificar Agentes: Entra una vez por semana al Dashboard para ver si alg√∫n agente ha dejado de reportar (posible equipo infectado o apagado). ","description":"Gu√≠a t√©cnica y las consideraciones cr√≠ticas para desplegar Wazuh en un UGreen DXP4800 Plus.","id":3,"section":"posts","tags":["wazuh","siem","seguridad","docker","homelab"],"title":"Wazuh en UGreen","uri":"http://localhost:1313/es/posts/ugreen_wazuh/"},{"content":"\nRescatando recuerdos digitales: Migraci√≥n masiva de CDs antiguos a Nextcloud Recientemente me embarqu√© en el proyecto de digitalizar y centralizar a√±os de fotograf√≠as (muchas en formato RAW .NEF) almacenadas en CDs antiguos hacia un servidor casero con Nextcloud y la aplicaci√≥n Memories.\n1. El escenario base: Montaje y copia simple Para los discos en buen estado, el proceso en Linux (Debian/Ubuntu) es directo. Identificamos la unidad y montamos.\n1 2 3 4 5 6 # Identificar la unidad (usualmente sr0) lsblk # Crear punto de montaje y montar mkdir -p /media/cdrom mount /dev/sr0 /media/cdrom Para la transferencia, rsync es superior a cp porque permite verificar tama√±os y reanudar si algo falla:\n1 2 # Copia recursiva verificando por tama√±o rsync -rv --size-only /media/cdrom/ /mnt/nextcloud_data/usuario/files/Photos/ Una vez copiados, Nextcloud no ve los archivos m√°gicamente. Hay que indexarlos manualmente:\n1 2 # Escaneo de archivos (Ajustar ruta y usuario seg√∫n instalaci√≥n) sudo -u www-data php /var/www/html/nextcloud/occ files:scan --all 2. Obst√°culo: Incompatibilidad de versiones PHP Mi sistema ten√≠a instalada una versi√≥n muy reciente de PHP (8.5) por defecto en el CLI, pero Nextcloud requiere una versi√≥n estable (ej. 8.3). Esto causaba errores al ejecutar comandos occ.\nSoluci√≥n: Invocar expl√≠citamente el binario de la versi√≥n correcta.\n1 2 # En lugar de \u0026#39;php\u0026#39;, usamos la ruta completa sudo -u www-data /usr/bin/php8.3 /var/www/html/nextcloud/occ files:scan --all Tambi√©n fue necesario ajustar el Crontab para evitar que las tareas de fondo fallaran silenciosamente:\n1 crontab -u www-data -e Contenido corregido:\n1 2 */5 * * * * /usr/bin/php8.3 -f /var/www/html/nextcloud/cron.php */10 * * * * /usr/bin/php8.3 /var/www/html/nextcloud/occ preview:pre-generate 3. Visualizaci√≥n de archivos RAW (.NEF) Al subir archivos Nikon RAW (.NEF), el navegador no pod√≠a mostrarlos. Fue necesario activar ImageMagick y configurar Nextcloud.\nInstalaci√≥n: apt install imagemagick php8.3-imagick Configuraci√≥n: Editar /var/www/html/nextcloud/config/config.php. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026lt;?php $CONFIG = array ( // ... otras configuraciones ... \u0026#39;enable_previews\u0026#39; =\u0026gt; true, \u0026#39;enabledPreviewProviders\u0026#39; =\u0026gt; array ( 0 =\u0026gt; \u0026#39;OC\\\\Preview\\\\HEIC\u0026#39;, 1 =\u0026gt; \u0026#39;OC\\\\Preview\\\\Image\u0026#39;, 2 =\u0026gt; \u0026#39;OC\\\\Preview\\\\TIFF\u0026#39;, 3 =\u0026gt; \u0026#39;OC\\\\Preview\\\\Movie\u0026#39;, 4 =\u0026gt; \u0026#39;OC\\\\Preview\\\\Imagick\u0026#39;, // \u0026lt;--- Clave para RAW/NEF ), // ... ); Generaci√≥n masiva: 1 sudo -u www-data /usr/bin/php8.3 /var/www/html/nextcloud/occ preview:generate-all -vvv 4. El desaf√≠o final: CDs da√±ados (Input/Output Error) Varios discos presentaban errores de lectura (Input/output error (5) en rsync). Aunque intent√© crear im√°genes ISO con ddrescue, el sistema de archivos l√≥gico estaba corrupto, haciendo imposible montar o copiar los archivos de forma tradicional.\nSoluci√≥n definitiva: PhotoRec\nLa herramienta PhotoRec (del paquete testdisk) ignora el sistema de archivos da√±ado y lee los sectores crudos buscando cabeceras de archivos (JPG, NEF, etc.).\nFlujo de trabajo para recuperaci√≥n masiva Para procesar varios discos da√±ados en serie, dise√±√© este procedimiento:\nPreparaci√≥n:\n1 mkdir -p /root/recuperacion_cd Extracci√≥n (Por cada disco):\nInsertar disco y esperar a que cargue. Limpiar temporales anteriores: rm -rf /root/recuperacion_cd/recup_dir* Ejecutar: photorec /dev/sr0 Opciones: Seleccionar unidad -\u0026gt; Partition \u0026ldquo;Unknown/Whole Disk\u0026rdquo; -\u0026gt; Filesystem \u0026ldquo;Other\u0026rdquo; -\u0026gt; Destino /root/recuperacion_cd. Organizaci√≥n y Mover:\nComo PhotoRec recupera archivos con nombres gen√©ricos (f001.jpg), es vital moverlos a carpetas separadas en Nextcloud inmediatamente.\n1 2 3 4 5 # Crear carpeta destino espec√≠fica para este CD mkdir -p /mnt/nextcloud_data/usuario/files/Photos/CD_Recuperado_01 # Mover archivos mv /root/recuperacion_cd/recup_dir.*/* /mnt/nextcloud_data/usuario/files/Photos/CD_Recuperado_01/ Finalizaci√≥n:\nAjustar permisos y notificar a Nextcloud.\n1 2 3 chown -R www-data:www-data /mnt/nextcloud_data/usuario/files/Photos/ sudo -u www-data /usr/bin/php8.3 /var/www/html/nextcloud/occ files:scan --all sudo -u www-data /usr/bin/php8.3 /var/www/html/nextcloud/occ memories:index Conclusi√≥n Migrar medios f√≠sicos antiguos no es solo \u0026ldquo;copiar y pegar\u0026rdquo;. Requiere:\nConsistencia en las versiones de software (PHP). Configuraci√≥n espec√≠fica para formatos profesionales (RAW). Herramientas forenses (PhotoRec) cuando el hardware falla. ","description":"Importaci√≥n Masiva de Fotos a Nextcloud CD y DVD","id":4,"section":"posts","tags":["Proxmox","nextcloud","debian","linux","homelab"],"title":"NEXTCLOUD Importaci√≥n Masiva CD y DVD","uri":"http://localhost:1313/es/posts/nextcloud_pasar_cd-dvd/"},{"content":"\nGu√≠a T√©cnica: Importaci√≥n Masiva de Fotos a Nextcloud y Configuraci√≥n de Memories Objetivo: Transferir una gran biblioteca de im√°genes desde un almacenamiento externo a un servidor Nextcloud, asegurar su indexaci√≥n correcta y visualizarlas cronol√≥gicamente en la aplicaci√≥n Memories, evitando ca√≠das del servidor por falta de recursos.\n1. Transferencia de Archivos y Permisos Lo primero es mover los datos f√≠sicos al directorio de datos de Nextcloud. No uses la interfaz web para cientos de gigabytes; usa la terminal.\nA. Montaje y Copia (Rsync) Montamos el disco externo y copiamos los datos usando rsync para mantener la integridad y ver el progreso.\n1 2 3 4 5 6 # 1. Montar disco externo (ejemplo) sudo mount /dev/sdb1 /mnt/disco_externo # 2. Copiar archivos a la carpeta del usuario de Nextcloud # Ruta destino t√≠pica: /var/www/html/nextcloud/data/[USUARIO]/files/[CARPETA_DESTINO] sudo rsync -avP /mnt/disco_externo/MisFotos/ /var/www/html/nextcloud/data/USER/files/Photos/ B. Correcci√≥n de Permisos (Cr√≠tico) Al copiar desde un externo, los archivos suelen pertenecer a root. Nextcloud (Apache/Nginx) necesita ser el due√±o (www-data).\n1 2 3 4 5 6 # Ajustar propietario recursivamente sudo chown -R www-data:www-data /var/www/html/nextcloud/data/USER/files/Photos/ # Ajustar permisos de directorios (755) y archivos (644) sudo find /var/www/html/nextcloud/data/USER/files/Photos/ -type d -exec chmod 755 {} \\; sudo find /var/www/html/nextcloud/data/USER/files/Photos/ -type f -exec chmod 644 {} \\; 2. Optimizaci√≥n del Servidor (Prevenci√≥n de Crashes) El procesamiento de miles de im√°genes (thumbnails, reconocimiento facial, transcodificaci√≥n de video) consume mucha RAM. Sin esta configuraci√≥n, MariaDB o PHP morir√°n por OOM (Out Of Memory).\nA. Aumentar memoria SWAP Si el servidor tiene \u0026lt;8GB de RAM, es obligatorio un archivo de intercambio (Swap) para absorber picos de carga.\n1 2 3 4 5 6 7 # Crear swap de 2GB (o 4GB si hay mucho video) sudo fallocate -l 2G /swapfile sudo chmod 600 /swapfile sudo mkswap /swapfile sudo swapon /swapfile # Hacer persistente echo \u0026#39;/swapfile none swap sw 0 0\u0026#39; | sudo tee -a /etc/fstab B. Limitar la concurrencia en config.php Editamos /var/www/html/nextcloud/config/config.php para evitar que Nextcloud intente procesar 20 fotos a la vez.\nA√±adir/Modificar al final del array $CONFIG:\n1 2 3 4 5 6 \u0026#39;enable_previews\u0026#39; =\u0026gt; true, \u0026#39;preview_max_x\u0026#39; =\u0026gt; 2048, \u0026#39;preview_max_y\u0026#39; =\u0026gt; 2048, \u0026#39;preview_concurrency_all\u0026#39; =\u0026gt; 1, // CLAVE: Procesa 1 a 1 para no saturar CPU/RAM \u0026#39;preview_concurrency_new\u0026#39; =\u0026gt; 1, \u0026#39;jpeg_quality\u0026#39; =\u0026gt; 60, 3. Registro de Archivos en Nextcloud Aunque los archivos est√°n en el disco, la base de datos de Nextcloud no sabe que existen. Hay que escanearlos.\n1 2 # Escanear archivos para el usuario espec√≠fico (o --all para todos) sudo -u www-data php /var/www/html/nextcloud/occ files:scan --all Salida esperada:\n+---------+-------+\n| Folders | Files |\n| 974 | 17101 |\n4. Configuraci√≥n de la App Memories Antes de indexar, debemos decirle a Memories qu√© carpetas debe incluir en la l√≠nea de tiempo.\nIr a Nextcloud Web -\u0026gt; Configuraci√≥n de Administraci√≥n -\u0026gt; Memories. Buscar la secci√≥n \u0026ldquo;Ruta de la L√≠nea de tiempo\u0026rdquo; (o General). Seleccionar las carpetas: Aseg√∫rate de marcar la carpeta donde copiaste las fotos (ej: /Photos o /_Contacts-Backup). Nota: Si no se marcan aqu√≠, las fotos existen en \u0026ldquo;Archivos\u0026rdquo; pero el Timeline de Memories saldr√° vac√≠o. 5. Indexaci√≥n y Generaci√≥n de Vistas Previas El paso final es leer los metadatos EXIF (fechas de captura) y generar las miniaturas.\nA. Indexar Metadatos (Memories) 1 2 # -f fuerza el reescaneo, -vvv muestra detalles sudo -u www-data php /var/www/html/nextcloud/occ memories:index -vvv B. Pre-generar Previews (Opcional pero recomendado) Para que la navegaci√≥n en el m√≥vil sea fluida, generamos las miniaturas de antemano.\n1 sudo -u www-data php /var/www/html/nextcloud/occ preview:generate-all -vvv Resoluci√≥n de Problemas Comunes Error: SQLSTATE[HY000] [2002] Connection refused durante el escaneo.\nCausa: La base de datos se ha cerrado inesperadamente porque el servidor se qued√≥ sin RAM (OOM Killer mat√≥ a MariaDB). Soluci√≥n: Reiniciar MariaDB (sudo systemctl restart mariadb), verificar que el SWAP est√° activo (free -h) y asegurar que preview_concurrency est√° en 1 en el config.php. S√≠ntoma: Las fotos aparecen en \u0026ldquo;Archivos\u0026rdquo; pero no en \u0026ldquo;Memories\u0026rdquo;.\nCausa: La carpeta no est√° seleccionada en la configuraci√≥n de Memories. Soluci√≥n: Revisar el Paso 4 de esta gu√≠a. ","description":"Importaci√≥n Masiva de Fotos a Nextcloud y Configuraci√≥n de Memories","id":5,"section":"posts","tags":["Proxmox","nextcloud","debian","linux","homelab"],"title":"NEXTCLOUD Importaci√≥n Masiva","uri":"http://localhost:1313/es/posts/nextcloud_subida_masiva_fotos/"},{"content":" Optimizaci√≥n y Orquestaci√≥n del Orden de Arranque en Proxmox VE Fecha: 08 de Diciembre de 2025\nCategor√≠a: SysAdmin / Proxmox / HomeLab\nEstado: Implementado\n1. El Problema: La \u0026ldquo;Tormenta de Arranque\u0026rdquo; En un entorno de virtualizaci√≥n donde conviven servicios cr√≠ticos de infraestructura (Router, DNS, VPN) con aplicaciones de usuario (Dom√≥tica, Nube), el orden de encendido es vital.\nTras un corte de energ√≠a o un mantenimiento, si todos los contenedores (LXC) y m√°quinas virtuales (VM) intentan arrancar simult√°neamente, ocurren dos problemas:\nSaturaci√≥n de I/O y CPU: El host se ralentiza intentando levantar todo a la vez. Fallos de Dependencia: Home Assistant falla porque no hay red; Nextcloud falla porque no resuelve el DNS; la VPN falla porque el Router a√∫n no ha negociado la IP p√∫blica. 2. Diagn√≥stico: Visualizaci√≥n del Estado Actual Para auditar la configuraci√≥n actual sin ir una por una en la interfaz web, utilic√© el siguiente one-liner en la shell del nodo. Esto lista todos los servicios, si tienen activado el arranque autom√°tico (onboot) y su configuraci√≥n de orden (startup).\nScript de Auditor√≠a:\n1 2 3 4 5 6 7 8 9 # Listar LXCs pct list | awk \u0026#39;{print $1, $4}\u0026#39; | while read id name; do [ \u0026#34;$id\u0026#34; != \u0026#34;VMID\u0026#34; ] \u0026amp;\u0026amp; echo \u0026#34;LXC $id ($name): $(pct config $id | grep -E \u0026#39;onboot|startup\u0026#39;)\u0026#34; done # Listar VMs qm list | awk \u0026#39;{print $1, $2}\u0026#39; | while read id name; do [ \u0026#34;$id\u0026#34; != \u0026#34;VMID\u0026#34; ] \u0026amp;\u0026amp; echo \u0026#34;VM $id ($name): $(qm config $id | grep -E \u0026#39;onboot|startup\u0026#39;)\u0026#34; done 3. La Estrategia: Anillos de Prioridad Se ha dise√±ado una estrategia de arranque escalonado en 5 niveles (de 0 a 5), asegurando que la capa inferior est√© estable antes de iniciar la siguiente.\nPrioridad Nivel Servicios Retardo (Delay) Justificaci√≥n 1 Core Network OPNsense (Router) 60 seg Necesita tiempo para negociar WAN/DHCP. 2 Infraestructura Tailscale (VPN), AdGuard (DNS) 5 seg Resoluci√≥n de nombres y acceso remoto. 3 Acceso Nginx Proxy Manager 5 seg Enrutamiento inverso de dominios. 4 Aplicaciones Home Assistant, Nextcloud, Vaultwarden 10 seg Apps de usuario final. Requieren DB y Red estables. 5 Monitorizaci√≥n Wazuh, Uptime Kuma 5 seg Vigilancia. Arrancan al final para evitar falsos positivos. 4. Implementaci√≥n Se aplicaron las configuraciones mediante CLI (qm set para VMs y pct set para LXC) para agilizar el proceso y evitar errores manuales.\nNivel 1: El Router (OPNsense) El router es el Gateway de la red. Debe ser el primero absoluto. Le damos 60 segundos de margen para estabilizar la conexi√≥n a internet.\n1 qm set 1110 -onboot 1 -startup order=1,up=60 Nivel 2: Servicios de Red (DNS y VPN) Una vez el router est√° vivo, levantamos el DNS y la VPN.\n1 2 pct set 100 -onboot 1 -startup order=2,up=5 # Tailscale pct set 110 -onboot 1 -startup order=2,up=5 # AdGuard Nivel 3: Proxy Inverso 1 pct set 8300 -onboot 1 -startup order=3,up=5 # NPM Nivel 4: Aplicaciones Cr√≠ticas Aqu√≠ residen los servicios pesados. Home Assistant tiene un retardo extra (up=10) para asegurar que su base de datos interna cargue bien.\n1 2 3 qm set 188 -onboot 1 -startup order=4,up=10 # Home Assistant OS pct set 8200 -onboot 1 -startup order=4,up=5 # Vaultwarden qm set 101 -onboot 1 -startup order=4,up=5 # Nextcloud Nivel 5: Monitorizaci√≥n 1 2 pct set 8800 -onboot 1 -startup order=5,up=5 # Wazuh pct set 8900 -onboot 1 -startup order=5 # Uptime Kuma 5. Resultado Final y Validaci√≥n Tras aplicar los cambios, el sistema presenta la siguiente configuraci√≥n de arranque, garantizando una recuperaci√≥n de desastres limpia y aut√≥noma.\n1 2 3 4 5 6 7 8 9 LXC 100 (Tailscale): startup: order=2,up=5 LXC 110 (AdGuard): startup: order=2,up=5 LXC 8300 (NPM): startup: order=3,up=5 VM 1110 (OPNsense): startup: order=1,up=60 VM 188 (HAOS): startup: order=4,up=10 VM 101 (Nextcloud): startup: order=4,up=5 LXC 8200 (Vault): startup: order=4,up=5 LXC 8800 (Wazuh): startup: order=5,up=5 LXC 8900 (Kuma): startup: order=5 Cronolog√≠a de arranque simulada (T=0 Recuperaci√≥n de energ√≠a) T+00:00: Arranca Host Proxmox. T+00:01: Inicia OPNsense. (Espera 60s). T+01:01: Inician Tailscale y AdGuard. (Red operativa y accesible remotamente). T+01:06: Inicia Nginx Proxy Manager. (Dominios operativos). T+01:11: Inician Home Assistant y resto de Apps. (Base de datos y red estables). T+01:21: Inicia Monitorizaci√≥n. Con esta configuraci√≥n, el servidor es capaz de recuperarse de un apagado total sin intervenci√≥n humana y sin errores de servicios ca√≠dos por falta de dependencias.\n¬¥¬¥¬¥\n","description":"Orquestaci√≥n del Orden de Arranque en Proxmox VE","id":6,"section":"posts","tags":["lxc","proxmox","contenedores","virtualizaci√≥n","devops"],"title":"Orquestaci√≥n de Arranque PVE","uri":"http://localhost:1313/es/posts/proxmox_pve_boot_order/"},{"content":"Nube pivada con Nextcloud: Viaje hacia la atogobernanza dgital Despu√©s de un proceso de investigaci√≥n y configuraci√≥n, ¬°finalmente he puesto en producci√≥n mi propia nube privada familiar basada en Nextcloud! Este proyecto no solo ha sido un viaje entretenido a nivel t√©cnico, sino tambi√©n un paso consciente hacia una mayor privacidad y control sobre nuestros datos digitales.\n¬øPor qu√© una Nube Privada? En la era digital actual, la mayor√≠a de nuestras fotos y documentos importantes residen en servicios en la nube de terceros. Si bien estos servicios ofrecen comodidad, tambi√©n plantean preguntas sobre la privacidad, la seguridad y la propiedad de nuestros datos. Mi objetivo principal era tener una soluci√≥n de almacenamiento:\nPropia: Con control total sobre la infraestructura y los datos. Segura: Protegida contra accesos no autorizados y posibles brechas de seguridad. Estable y Duradera: Una plataforma fiable que sirva a mi familia durante muchos a√±os. Privada: Asegurando que nuestros recuerdos y documentos personales permanezcan solo nuestros. La Pila Tecnol√≥gica: Nextcloud, Proxmox y Nginx Proxy Manager La implementaci√≥n se basa en una combinaci√≥n robusta de tecnolog√≠as de c√≥digo abierto:\nProxmox VE: El hipervisor de virtualizaci√≥n. Nextcloud se ejecuta como una m√°quina virtual (VM) invitada sobre Proxmox. Esto ofrece una gran flexibilidad para gestionar recursos, realizar copias de seguridad y, si fuera necesario, migrar la VM.\nNextcloud: El coraz√≥n de la nube. Nextcloud es una suite de productividad autoalojada que ofrece almacenamiento de archivos, sincronizaci√≥n, uso compartido y una gran cantidad de aplicaciones adicionales. Para el uso familiar, la aplicaci√≥n \u0026ldquo;Memorias\u0026rdquo; es fant√°stica para organizar y visualizar fotos, mientras que la funcionalidad b√°sica de almacenamiento y compartici√≥n de archivos cubre el resto de las necesidades.\nNginx Proxy Manager (NPM): Un proxy inverso con interfaz gr√°fica que facilita la gesti√≥n de certificados SSL/TLS y el enrutamiento de solicitudes. Aunque el servidor Nextcloud no est√° directamente expuesto a Internet, NPM es crucial para gestionar el subdominio y los certificados Let\u0026rsquo;s Encrypt dentro de la red local.\nSubdominio: Mi instancia de Nextcloud es accesible a trav√©s de https://nextcloud.dominio.tal/. Certificados Let\u0026rsquo;s Encrypt: Gestionados autom√°ticamente por NPM, estos certificados garantizan una conexi√≥n HTTPS segura y cifrada, lo cual es fundamental incluso dentro de una red local. Acceso Seguro: Tailscale VPN Uno de los pilares de la seguridad de esta implementaci√≥n es que el servidor Nextcloud no es directamente accesible desde Internet. El acceso se realiza exclusivamente a trav√©s de una Red Privada Virtual (VPN) utilizando Tailscale.\n¬øQu√© es Tailscale? Es una VPN mesh que utiliza el protocolo WireGuard. Simplifica enormemente la configuraci√≥n de una VPN al no requerir configuraciones de puertos o routers complejos. Crea una red segura entre todos los dispositivos autorizados, est√©n donde est√©n. Beneficios: Esto significa que, ya sea que est√© en casa o fuera, mi familia puede acceder a la nube como si estuviera en la red local, con toda la seguridad que ofrece WireGuard, sin exponer el servidor Nextcloud al p√∫blico de Internet. Todos los datos viajan cifrados de extremo a extremo a trav√©s de la red de Tailscale. Consideraciones T√©cnicas Adicionales Hardware: El servidor Proxmox se ejecuta en un hardware dedicado (ej. un mini PC, un servidor dom√©stico reciclado) que ofrece la capacidad de almacenamiento y RAM adecuadas para la VM de Nextcloud. Almacenamiento: Para las fotos y archivos familiares, es crucial tener un almacenamiento redundante. Esto podr√≠a ser un RAID de software o hardware en el servidor Proxmox, o un sistema de copias de seguridad robusto que replique los datos a otra ubicaci√≥n. Mantenimiento: Actualizaciones: Es vital mantener tanto Nextcloud como el sistema operativo subyacente de la VM actualizados para garantizar la seguridad y el rendimiento. Copias de Seguridad: Implementar una estrategia de copias de seguridad regular de la VM de Nextcloud (incluyendo la base de datos y los archivos) es imprescindible para proteger los datos contra fallos de hardware o corrupci√≥n de datos. Proxmox facilita las copias de seguridad de las VMs. Monitorizaci√≥n: Aunque sea una instalaci√≥n dom√©stica, una monitorizaci√≥n b√°sica (ej. espacio en disco, uso de RAM) puede ayudar a anticipar problemas. Conclusi√≥n Este proyecto de Nextcloud ha sido una experiencia muy gratificante. Tener el control total sobre nuestra nube privada nos proporciona tranquilidad y la certeza de que nuestros datos est√°n seguros y privados. La combinaci√≥n de Proxmox para la virtualizaci√≥n, Nextcloud como la plataforma de nube y Tailscale para el acceso seguro y privado, crea una soluci√≥n potente y f√°cil de mantener.\nAnimo a cualquiera que valore su privacidad digital a explorar el camino de la autogobernanza. ¬°Es un viaje que vale la pena!\n","description":"Un Viaje hacia la Autogobernanza Digital","id":7,"section":"posts","tags":["Let's Encrypt","NPM","Nextcloud","privacidad","proxmox","homelab"],"title":"Nube Privada Familiar con Nextcloud: Un Viaje hacia la Autogobernanza Digital","uri":"http://localhost:1313/es/posts/proxmox_nextcloud/"},{"content":"ZFS, es un sistema de archivos robusto dise√±ado precisamente para estas situaciones. Recientemente, mi servidor comenz√≥ a reportar errores en uno de los discos de mi pool.\nCompartir√© el proceso exacto que segu√≠ para detectar el problema, identificar el disco f√≠sico culpable y reemplazarlo de forma segura, todo sin perder un solo byte de datos.\nPaso 1: Detecci√≥n del Problema con zpool status El primer indicio de un problema suele venir del comando zpool status. Al ejecutarlo, recib√≠ una salida que, aunque preocupante, me dio toda la informaci√≥n necesaria para empezar.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 usuario@servidor:~# zpool status mi-pool-raid10 pool: mi-pool-raid10 state: ONLINE status: One or more devices has experienced an unrecoverable error. An attempt was made to correct the error. Applications are unaffected. action: Determine if the device needs to be replaced, and clear the errors using \u0026#39;zpool clear\u0026#39; or replace the device with \u0026#39;zpool replace\u0026#39;. see: https://openzfs.github.io/openzfs-docs/msg/ZFS-8000-9P scan: scrub repaired 56.2M in 00:14:03 with 0 errors on [Fecha del escaneo] config: NAME STATE READ WRITE CKSUM mi-pool-raid10 ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 sda ONLINE 0 0 0 sdb ONLINE 0 0 0 mirror-1 ONLINE 0 0 0 sdc ONLINE 0 0 0 sdd ONLINE 0 0 3.53K errors: No known data errors An√°lisis de la salida:\nstate: ONLINE: ¬°Buenas noticias! El pool sigue en l√≠nea y funcionando. status: One or more devices has experienced an unrecoverable error: Aqu√≠ est√° la alerta. Algo no va bien. sdd ONLINE 0 0 3.53K: El culpable. El disco /dev/sdd tiene m√°s de 3.500 errores de checksum (CKSUM). Esto significa que ZFS intent√≥ leer datos de √©l, pero no coincid√≠an con la suma de verificaci√≥n guardada. Gracias a la redundancia del mirror-1, pudo corregir el error al vuelo usando los datos del disco sdc. errors: No known data errors: Lo m√°s importante. Mis datos est√°n √≠ntegros. Intent√© ejecutar zpool clear mi-pool-raid10, pero los errores volvieron a aparecer, una se√±al inequ√≠voca de que el disco ten√≠a un fallo de hardware persistente. Era hora de reemplazarlo.\nOtro ejemplo de errores encontrados,\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 usuario@server:~# zpool status zfs-raid10 pool: zfs-raid10 state: DEGRADED status: One or more devices has experienced an unrecoverable error. An attempt was made to correct the error. Applications are unaffected. action: Determine if the device needs to be replaced, and clear the errors using \u0026#39;zpool clear\u0026#39; or replace the device with \u0026#39;zpool replace\u0026#39;. see: https://openzfs.github.io/openzfs-docs/msg/ZFS-8000-9P scan: resilvered 155M in 00:00:03 with 0 errors on [Fecha del escaneo] config: NAME STATE READ WRITE CKSUM zfs-raid10 DEGRADED 0 0 0 mirror-0 DEGRADED 0 0 0 sda DEGRADED 0 0 0 too many slow I/Os sdb ONLINE 0 0 0 mirror-1 DEGRADED 0 0 0 sdc DEGRADED 0 0 1 too many errors ata-TOSHIBA ONLINE 0 0 0 errors: No known data errors usuario@server:~# zpool clear zfs-raid10 usuario@server:~# usuario@server:~# usuario@server:~# zpool status zfs-raid10 pool: zfs-raid10 state: ONLINE scan: resilvered 155M in 00:00:03 with 0 errors on [Fecha del escaneo] config: NAME STATE READ WRITE CKSUM zfs-raid10 ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 sda ONLINE 0 0 0 sdb ONLINE 0 0 0 mirror-1 ONLINE 0 0 0 sdc ONLINE 0 0 0 ata-TOSHIBA ONLINE 0 0 0 errors: No known data errors usuario@server:~# Otro fallo de disco\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 usuario@servidor:~# zpool status zfs-raid10 pool: zfs-raid10 state: DEGRADED status: One or more devices has experienced an unrecoverable error. An attempt was made to correct the error. Applications are unaffected. action: Determine if the device needs to be replaced, and clear the errors using \u0026#39;zpool clear\u0026#39; or replace the device with \u0026#39;zpool replace\u0026#39;. see: https://openzfs.github.io/openzfs-docs/msg/ZFS-8000-9P scan: resilvered 155M in 00:00:03 with 0 errors on Mon Sep 8 20:38:48 2025 config: NAME STATE READ WRITE CKSUM zfs-raid10 DEGRADED 0 0 0 mirror-0 DEGRADED 0 0 0 sda DEGRADED 0 0 35 too many errors \u0026lt;-- OJO sdb ONLINE 0 0 0 mirror-1 ONLINE 0 0 0 sdc ONLINE 0 0 24 ata-TOSHIBA_ ONLINE 0 0 0 errors: No known data errors usuario@servidor:~# ^C usuario@servidor:~# zpool clear missing pool name usage: clear [[--power]|[-nF]] \u0026lt;pool\u0026gt; [device] usuario@servidor:~# zpool clear rpool zfs-raid10 usuario@servidor:~# zpool clear zfs-raid10 usuario@servidor:~# usuario@servidor:~# usuario@servidor:~# zpool status zfs-raid10 pool: zfs-raid10 state: ONLINE scan: resilvered 155M in 00:00:03 with 0 errors on Mon Sep 8 20:38:48 2025 config: NAME STATE READ WRITE CKSUM zfs-raid10 ONLINE 0 0 0 mirror-0 ONLINE 0 0 0 sda ONLINE 0 0 0 sdb ONLINE 0 0 0 mirror-1 ONLINE 0 0 0 sdc ONLINE 0 0 0 ata-TOSHIBA_ ONLINE 0 0 0 errors: No known data errors usuario@servidor:~# Paso 2: Identificaci√≥n F√≠sica del Disco Saber que /dev/sdd es el disco problem√°tico no me ayuda a encontrarlo dentro de una caja con varios discos id√©nticos. Necesitaba un identificador √∫nico: el n√∫mero de serie.\nM√©todo A: El N√∫mero de Serie (El m√°s fiable) La herramienta smartctl es perfecta para esto.\n1 2 3 4 5 6 7 8 9 10 11 12 usuario@servidor:~# smartctl -i /dev/sdd smartctl 7.3 2022-02-28 r5338 [x86_64-linux-X.X.X] (local build) Copyright (C) 2002-22, Bruce Allen, Christian Franke, www.smartmontools.org === START OF INFORMATION SECTION === Model Family: Seagate Enterprise Series Device Model: ST4000NMXXXX-XXXXXX Serial Number: ABC123XYZ LU WWN Device Id: 5 000c50 0XXXXXXXX Firmware Version: EN09 User Capacity: 4,000,787,030,016 bytes [4.00 TB] # ... resto de la salida Con el n√∫mero de serie ABC123XYZ en mano, solo tuve que buscar la etiqueta en cada uno de los discos f√≠sicos de mi servidor hasta encontrar el correcto.\nA las 48 horas el error era ya desastroso.\n1 2 3 4 5 6 7 usuario@servidor:~# smartctl -i /dev/sdd smartctl 7.3 2022-02-28 r5338 [x86_64-linux-6.8.12-11-pve] (local build) Copyright (C) 2002-22, Bruce Allen, Christian Franke, www.smartmontools.org Short INQUIRY response, skip product id A mandatory SMART command failed: exiting. To continue, add one or more \u0026#39;-T permissive\u0026#39; options. usuario@servidor:~# Esto pasa por comprar discos recuperados.\nOtros M√©todos de Identificaci√≥n, Si tienes LED en tu NAS. Si el n√∫mero de serie no fuera accesible, existen otras t√©cnicas:\nHacer parpadear el LED del disco: En hardware de servidor, el comando ledctl locate=/dev/sdd puede encender un LED de localizaci√≥n en la bah√≠a del disco. Generar actividad en el disco: Con el comando sudo dd if=/dev/sdd of=/dev/null bs=1M podemos forzar una lectura constante. El LED de actividad del disco culpable parpadear√° fren√©ticamente, delatando su posici√≥n. ¬°Mucho cuidado al escribir este comando! Paso 3: El Proceso de Reemplazo Con el disco identificado, el proceso de reemplazo es met√≥dico y seguro.\nMi estructura de RAID-10 se ve as√≠:\ngraph TD\rPool[mi-pool-raid10] --\u003e Mirror0[Mirror-0]\rPool --\u003e Mirror1[Mirror-1]\rMirror0 --\u003e sda[sda: Disco 1]\rMirror0 --\u003e sdb[sdb: Disco 2]\rMirror1 --\u003e sdc[sdc: Disco 3]\rMirror1 --\u003e sdd((sdd: Disco 4 - CON FALLOS))\rAdquirir un disco de reemplazo: Compr√© un disco nuevo de capacidad igual o superior (4 TB en mi caso). Es un requisito indispensable para ZFS.\nReemplazo F√≠sico: Apagu√© el servidor, localic√© el disco con el n√∫mero de serie ABC123XYZ, lo desconect√© y lo sustitu√≠ por el nuevo en la misma bah√≠a y con los mismos cables.\nReemplazo L√≥gico en ZFS: Una vez encendido el servidor, el nuevo disco fue detectado como /dev/sdd. El siguiente comando le ordena a ZFS que reemplace el dispositivo \u0026ldquo;viejo\u0026rdquo; (identificado por su path) con el nuevo que ahora est√° en su lugar.\n1 sudo zpool replace mi-pool-raid10 sdd Si el nuevo disco apareciera con otro nombre (ej. /dev/sdh), se usar√≠a el ID del disco viejo: sudo zpool replace mi-pool-raid10 [ID-del-disco-viejo] /dev/sdh.\nMonitorizar la Reconstrucci√≥n (Resilvering): ZFS inici√≥ inmediatamente el proceso de \u0026ldquo;resilvering\u0026rdquo;, que consiste en copiar los datos del disco sano del espejo (sdc) al nuevo disco. Se puede monitorizar el progreso en tiempo real.\n1 watch zpool status La salida mostrar√° el porcentaje de reconstrucci√≥n y el tiempo estimado. Para un disco de 4 TB, este proceso puede tardar varias horas.\nUna vez finalizado el resilver, el pool volvi√≥ a su estado ONLINE y saludable, sin errores y con todos los datos intactos.\nGu√≠a T√©cnica: Reemplazo de un Disco Fallido en un Pool ZFS RAID10 Introducci√≥n Este documento detalla el procedimiento completo seguido para reemplazar un disco duro fallido en un pool ZFS configurado en RAID10. El proceso abarca desde la detecci√≥n inicial del fallo hasta la verificaci√≥n final del estado del pool, incluyendo los imprevistos encontrados y las lecciones aprendidas. El objetivo es servir como gu√≠a de mejores pr√°cticas para administradores de sistemas que enfrenten una situaci√≥n similar.\n1. Detecci√≥n y Diagn√≥stico Inicial del Fallo La monitorizaci√≥n proactiva del estado del pool ZFS es fundamental. El primer indicio del problema se obtuvo mediante el comando est√°ndar de estado:\n1 # zpool status mi-pool-raid10 La salida fue inequ√≠voca, indicando que uno de los dispositivos estaba en estado FAULTED debido a un n√∫mero excesivo de errores de lectura/escritura y checksum.\npool: mi-pool-raid10\rstate: ONLINE\rstatus: One or more devices are faulted in response to persistent errors.\r...\rconfig:\rNAME STATE READ WRITE CKSUM\rmi-pool-raid10 ONLINE 0 0 0\rmirror-0 ONLINE 0 0 0\rdisco_sano_1 ONLINE 0 0 0\rdisco_sano_2 ONLINE 0 0 0\rmirror-1 ONLINE 0 0 0\rdisco_sano_3 ONLINE 0 0 0\rdisco_malo FAULTED 3 80 3.53K too many errors El pool permanec√≠a ONLINE gracias a la redundancia del mirror-1, pero en un estado degradado que requer√≠a acci√≥n inmediata.\n2. Identificaci√≥n F√≠sica del Disco Defectuoso Un identificador l√≥gico como /dev/sdX es ef√≠mero y no fiable para la identificaci√≥n f√≠sica, ya que puede cambiar en cada arranque. Es imperativo utilizar un identificador persistente.\nPrecauci√≥n: Nunca se debe asumir que /dev/sdX corresponde a una bah√≠a f√≠sica espec√≠fica sin una verificaci√≥n rigurosa.\nSe emplearon dos m√©todos para la identificaci√≥n inequ√≠voca:\nComando ls -l /dev/disk/by-id/: Este comando lista los enlaces simb√≥licos persistentes a los dispositivos, incluyendo el modelo y n√∫mero de serie en el nombre del enlace. Se busc√≥ el enlace que apuntaba al dispositivo l√≥gico disco_malo.\n1 2 3 4 # ls -l /dev/disk/by-id/ ... lrwxrwxrwx 1 root root 9 Jun 17 12:00 ata-SEAGATE_MODEL_SERIALNUMBER -\u0026gt; ../../disco_malo ... Comando smartctl -i /dev/disco_malo: Se utiliz√≥ para obtener directamente la informaci√≥n de identidad del disco, incluyendo el n√∫mero de serie. El disco fallido estaba tan degradado que este comando fall√≥, confirmando la severidad del problema y reforzando la identificaci√≥n obtenida con el m√©todo anterior.\nCon el n√∫mero de serie en mano, se procedi√≥ a la localizaci√≥n f√≠sica del disco en el chasis del servidor.\n3. Procedimiento de Reemplazo F√≠sico Se sigui√≥ un protocolo de reemplazo \u0026ldquo;cold-swap\u0026rdquo; para minimizar riesgos:\nApagado Programado: Se realiz√≥ un apagado controlado del servidor. Extracci√≥n: Se retir√≥ el disco f√≠sicamente identificado por su n√∫mero de serie. Instalaci√≥n: Se instal√≥ un nuevo disco de capacidad igual o superior en la misma bah√≠a, utilizando los mismos cables de datos y alimentaci√≥n. Encendido: Se arranc√≥ el servidor. 4. Incidente Cr√≠tico: Detecci√≥n de Doble Fallo Tras el reinicio, una revisi√≥n del estado del pool revel√≥ una situaci√≥n cr√≠tica:\n# zpool status mi-pool-raid10\r...\rstatus: One or more devices has experienced an error resulting in data corruption.\r...\rmirror-1 DEGRADED\rdisco_fantasma FAULTED ... was /dev/sdX\rdisco_que_era_sano ONLINE ... 28.2K (CKSUM errors) El disco que formaba el espejo del dispositivo reci√©n fallado (disco_que_era_sano) comenz√≥ a registrar miles de errores de checksum (CKSUM). Esto indicaba un fallo casi simult√°neo del segundo miembro del espejo, la peor contingencia posible en un RAID1.\nLecci√≥n Aprendida: Un fallo en un disco de un mirror ejerce una carga adicional sobre el disco restante durante la degradaci√≥n y el resilvering. Si este segundo disco ya estaba envejecido o ten√≠a problemas latentes, el riesgo de un fallo en cascada es significativo.\n5. Recuperaci√≥n y Reconstrucci√≥n del Pool La estrategia se centr√≥ en estabilizar el pool y reemplazar el disco fallido original, confiando en que el segundo disco aguantar√≠a el proceso de reconstrucci√≥n.\nRevisi√≥n de Conexiones: Se realiz√≥ un nuevo ciclo de apagado para revisar y reasentar firmemente las conexiones de todos los discos, lo cual mejor√≥ notablemente el estado del segundo disco afectado.\nComando de Reemplazo: Se ejecut√≥ el comando zpool replace, utilizando el identificador num√©rico del disco ausente y la ruta persistente (by-id) del nuevo disco para evitar ambig√ºedades.\n1 # zpool replace mi-pool-raid10 \u0026lt;GUID_DISCO_AUSENTE\u0026gt; /dev/disk/by-id/\u0026lt;ID_DISCO_NUEVO\u0026gt; Monitorizaci√≥n del Resilvering: El proceso de reconstrucci√≥n se inici√≥ inmediatamente. Se monitoriz√≥ en tiempo real con watch zpool status.\nscan: resilver in progress... XX% done, HH:MM:SS to go Al finalizar, el pool volvi√≥ al estado ONLINE, aunque con contadores de error persistentes del incidente.\n6. Limpieza Final y Verificaci√≥n de Integridad Para devolver el pool a un estado impecable, se siguieron dos pasos finales:\nAuditor√≠a de Datos (scrub): Se inici√≥ un scrub manual para forzar a ZFS a leer cada bloque de datos y verificar su integridad contra la copia redundante.\n1 # zpool scrub mi-pool-raid10 Limpieza de Errores (clear): Una vez verificado que el scrub no reportaba errores incorregibles, se reiniciaron los contadores de errores del pool. Esto es crucial para que cualquier futuro error sea indicativo de un nuevo problema.\n1 # zpool clear mi-pool-raid10 Tras estos pasos, el comando zpool status finalmente report√≥ un estado ONLINE limpio, sin errores pendientes y con todos los discos funcionando correctamente.\n7. Post-Recuperaci√≥n: Estandarizaci√≥n de Identificadores Para mejorar la robustez y legibilidad de la configuraci√≥n, se procedi√≥ a actualizar las referencias de los discos antiguos (que usaban /dev/sdX) a sus rutas persistentes /dev/disk/by-id/.\nProcedimiento: Se realiz√≥ un \u0026ldquo;auto-reemplazo\u0026rdquo; para cada disco, de uno en uno, esperando a que cada resilver terminara antes de proceder con el siguiente.\n1 # zpool replace -f mi-pool-raid10 /dev/sda /dev/disk/by-id/ata-SEAGATE_MODEL_SERIAL_SDA Nota: El flag -f (force) es necesario para que ZFS acepte reemplazar un disco por s√≠ mismo.\nAl finalizar este proceso, la configuraci√≥n del pool muestra exclusivamente identificadores persistentes, haci√©ndolo inmune a cambios de nombre de dispositivo tras reinicios.\nConclusi√≥n El reemplazo de un disco en un pool ZFS, aunque te√≥ricamente sencillo, puede presentar complicaciones graves. Esta experiencia subraya la importancia de:\nMonitorizaci√≥n constante. Identificaci√≥n f√≠sica precisa mediante n√∫meros de serie. Uso exclusivo de identificadores persistentes (/dev/disk/by-id/) en las operaciones de ZFS. Actuar con rapidez ante el primer fallo, ya que el riesgo de fallos en cascada es real. Mantener copias de seguridad externas y verificadas, ya que la redundancia no es infalible. Reemplazo del Disco /dev/sda\nIdentifica el disco f√≠sico sda:\nUsa ls -l /dev/disk/by-id/ para ver los identificadores persistentes de tus discos y encontrar cu√°l apunta a /dev/sda. Esto te ayudar√° a identificar el disco f√≠sico correcto en tu servidor. ls -l /dev/disk/by-id/ | grep sda Una vez que lo tengas, busca el disco f√≠sico correspondiente. Prepara el nuevo disco:\nAseg√∫rate de que el nuevo disco no contenga datos importantes ni particiones que quieras conservar. Inicia el reemplazo del disco en ZFS:\nEjecuta el siguiente comando para decirle a ZFS que reemplace sda con el nuevo disco. Aseg√∫rate de que /dev/sdX_NUEVO sea el identificador correcto del nuevo disco (por ejemplo, /dev/sde, /dev/sdf, etc.). Si tienes un identificador /dev/disk/by-id/ para el nuevo disco, es m√°s seguro usarlo. 1 sudo zpool replace zfs-raid10-8tb sda /dev/sdX_NUEVO Ejemplo: Si el nuevo disco se detecta como /dev/sde, el comando ser√≠a: 1 sudo zpool replace zfs-raid10-8tb sda /dev/sde Monitorea el proceso de \u0026ldquo;resilver\u0026rdquo;:\nDespu√©s de ejecutar el comando zpool replace, ZFS comenzar√° a copiar todos los datos del otro disco del espejo (sdb) al nuevo disco (/dev/sdX_NUEVO). Este proceso se llama \u0026ldquo;resilver\u0026rdquo;. Puedes monitorear el progreso con: 1 zpool status zfs-raid10-8tb Ver√°s que el pool estar√° en estado DEGRADED durante el resilver (ya que un disco est√° siendo reemplazado), y el nuevo disco aparecer√° como \u0026ldquo;replacing\u0026rdquo;. Una vez completado, el pool volver√° a ONLINE. Limpia los errores (opcional pero recomendado):\nUna vez que el \u0026ldquo;resilver\u0026rdquo; haya terminado y el pool vuelva a estar ONLINE (sin dispositivos en estado DEGRADED o \u0026ldquo;replacing\u0026rdquo;), puedes limpiar los errores registrados: 1 sudo zpool clear zfs-raid10-8tb Esto restablecer√° el contador de errores del pool. Nota importante: Aunque solo est√©s reemplazando sda ahora, recuerda que el disco sdd tiene 21 sectores reasignados, lo cual es una se√±al clara de falla. Es muy recomendable que tambi√©n planifiques su reemplazo. Tu pool estar√° m√°s vulnerable hasta que sdd tambi√©n sea reemplazado o retirado si no es parte del pool principal.\n","description":"Tutorial paso a paso sobre c√≥mo detectar, identificar f√≠sicamente y reemplazar un disco duro con fallos en un pool ZFS","id":9,"section":"posts","tags":["homelab","privacidad","selfhosting","opensource","zfs","raid"],"title":"Disco ZFS Fallando: Detecci√≥n y Reemplazo","uri":"http://localhost:1313/es/posts/proxmox_fallo_disco_zfs/"},{"content":"intro\nEliminar todos los backups de un ID LXC Importante: ¬øD√≥nde guardas tus backups? Este m√©todo funciona para almacenamientos basados en archivos, como Directory, NFS o CIFS.\n¬°Atenci√≥n! Si est√°s usando Proxmox Backup Server (PBS), este m√©todo NO funcionar√° y no debes intentarlo. Los backups en PBS se gestionan a trav√©s de su propia interfaz o con el comando proxmox-backup-client. El m√©todo que te describo a continuaci√≥n es para los backups tradicionales de Proxmox (archivos .vma.zst, .tar.gz, etc.).\nPaso 1: Con√©ctate al Shell de tu Host Proxmox Puedes hacerlo a trav√©s de la interfaz web (TuNodo -\u0026gt; Shell) o conect√°ndote directamente por SSH.\nPaso 2: Identifica la Ruta Exacta de tu Almacenamiento de Backups Los archivos de backup se guardan en un subdirectorio llamado dump dentro de la ruta que configuraste para tu almacenamiento.\nPara encontrar la ruta:\nVe a la interfaz web de Proxmox: Datacenter -\u0026gt; Storage. Busca tu almacenamiento de backups en la lista. F√≠jate en la columna Path. Esa es la ruta base. Ejemplo:\nSi tu almacenamiento se llama backups_locales y su Path es /mnt/backups, entonces los archivos de backup estar√°n en:\n/mnt/backups/dump/\nSi usas el almacenamiento local por defecto, la ruta suele ser:\n/var/lib/vz/dump/\nPara los siguientes pasos, usar√© /ruta/de/tus/backups/ como ejemplo.\nPaso 3: El Paso de Verificaci√≥n (¬°El m√°s importante!) Nunca borres nada sin antes verificar qu√© vas a borrar. Usaremos el comando ls para listar todos los archivos que coinciden con el patr√≥n de backups del contenedor 101.\nLos archivos de backup de Proxmox siguen un patr√≥n: vzdump-lxc-ID-FECHA-HORA.extension\nEjecuta el siguiente comando (reemplazando la ruta):\n1 ls -lh /ruta/de/tus/backups/dump/vzdump-lxc-101-* Desglose del comando:\nls: Comando para listar archivos. -lh: Opciones para mostrar el tama√±o en formato legible (-h) y en una lista detallada (-l). /ruta/de/tus/backups/dump/: La ruta a la carpeta de backups. No olvides el /dump/ al final. vzdump-lxc-101-*: Este es el patr√≥n m√°gico. vzdump-lxc-: Prefijo para backups de contenedores LXC. 101: El ID de tu contenedor. -: Separador. *: El comod√≠n. Le dice a la shell \u0026ldquo;coincide con cualquier cosa que venga despu√©s\u0026rdquo;. Esto incluir√° las fechas, horas y extensiones (.tar.zst, etc.) de todos los backups del CT 101. Revisa la salida de este comando. Deber√≠as ver una lista de todos y cada uno de los archivos de backup del contenedor 101, y ning√∫n otro. Si la lista es correcta, puedes proceder al siguiente paso.\nPaso 4: La Eliminaci√≥n Definitiva Una vez que has verificado con ls que el patr√≥n es correcto, simplemente reemplaza ls -lh por rm -v.\n1 rm -v /ruta/de/tus/backups/dump/vzdump-lxc-101-* Desglose del comando:\nrm: El comando para eliminar (remover) archivos. ¬°Este comando es irreversible! -v: Opci√≥n de \u0026ldquo;verbose\u0026rdquo; (detallado). Imprimir√° en pantalla el nombre de cada archivo a medida que lo borra. Esto te da una confirmaci√≥n visual de lo que se est√° haciendo. La terminal te mostrar√° algo como:\nremoved \u0026#39;/ruta/de/tus/backups/dump/vzdump-lxc-101-2024_01_10-10_00_01.tar.zst\u0026#39;\rremoved \u0026#39;/ruta/de/tus/backups/dump/vzdump-lxc-101-2024_01_11-10_00_02.tar.zst\u0026#39;\rremoved \u0026#39;/ruta/de/tus/backups/dump/vzdump-lxc-101-2024_01_12-10_00_01.tar.zst\u0026#39; Eliminar todos los backups de un ID VM El proceso para las m√°quinas virtuales (VMs) es muy similar al de los contenedores LXC. La herramienta principal y la l√≥gica son las mismas, solo cambia un peque√±o detalle en el nombre de los archivos.\nUsaremos la herramienta pvesm (Proxmox VE Storage Manager), que es la forma correcta y segura de gestionar vol√∫menes (como los backups) desde la shell.\nResumen R√°pido La diferencia principal entre un backup de LXC y uno de VM es el nombre del archivo:\nLXC Container: vzdump-lxc-CONTAINER_ID-... VM (QEMU): vzdump-qemu-VM_ID-... Instrucciones Paso a Paso para Eliminar Backups de VMs Paso 1: Identificar el ID del Storage Primero, necesitas saber el nombre (ID) del almacenamiento donde se guardan tus backups. Puedes verlo en la interfaz web de Proxmox en Datacenter -\u0026gt; Storage o con este comando en la shell:\n1 pvesm status El resultado ser√° algo as√≠. F√≠jate en la columna Storage:\nName Type Status Total Used Available %\rlocal dir active 98226068 31046484 62143004 31.61%\rlocal-backups dir active 960348088 219277564 692254540 22.83% En este ejemplo, mis backups est√°n en local-backups.\nPaso 2: Listar los Backups de una VM Espec√≠fica Ahora, vamos a listar todos los backups que existen para una m√°quina virtual concreta. Necesitas el ID del Storage (del paso 1) y el ID de la VM.\nUsa el siguiente comando, reemplazando \u0026lt;STORAGE_ID\u0026gt; y \u0026lt;VM_ID\u0026gt;:\n1 pvesm list \u0026lt;STORAGE_ID\u0026gt; --vmid \u0026lt;VM_ID\u0026gt; Ejemplo pr√°ctico: Para listar los backups de la VM con ID 101 que est√°n en el storage local-backups:\n1 pvesm list local-backups --vmid 101 La salida se ver√° as√≠, mostrando cada backup como un \u0026ldquo;VolId\u0026rdquo;:\nVolId Format Type Size VMID\rlocal-backups:backup/vzdump-qemu-101-2025_06_14-11_30_01.vma.zst vma backup 17179869184 101\rlocal-backups:backup/vzdump-qemu-101-2025_06_15-11_30_02.vma.zst vma backup 17205211136 101\rlocal-backups:backup/vzdump-qemu-101-2025_06_16-11_30_03.vma.zst vma backup 17231265792 101 La columna VolId contiene el identificador √∫nico que necesitas para el siguiente paso.\nPaso 3: Eliminar el Backup Seleccionado Este es el comando de eliminaci√≥n. Usa el comando pvesm free. Es crucial que copies el VolId exacto del listado anterior.\nLa sintaxis es:\n1 pvesm free \u0026lt;VolId\u0026gt; Ejemplo pr√°ctico: Para eliminar el backup m√°s antiguo del ejemplo anterior (2025_06_14):\n1 pvesm free local-backups:backup/vzdump-qemu-101-2025_06_14-11_30_01.vma.zst Proxmox te pedir√° confirmaci√≥n (a menos que uses la opci√≥n --force, no recomendada a menos que est√©s en un script). Tras confirmar, el backup se eliminar√° del disco y del √≠ndice de Proxmox.\nPoni√©ndolo todo junto: Un caso de uso completo Objetivo: Eliminar el backup m√°s antiguo de la VM 105, que est√° en el storage nfs-storage.\nListar los backups:\n1 pvesm list nfs-storage --vmid 105 Salida de ejemplo:\nVolId Format Type Size VMID\rnfs-storage:backup/vzdump-qemu-105-2025_05_01-22_00_01.vma.zst vma backup 8589934592 105\rnfs-storage:backup/vzdump-qemu-105-2025_06_01-22_00_01.vma.zst vma backup 8623489024 105 Identificar el VolId a eliminar: nfs-storage:backup/vzdump-qemu-105-2025_05_01-22_00_01.vma.zst\nEjecutar el comando de eliminaci√≥n:\n1 pvesm free nfs-storage:backup/vzdump-qemu-105-2025_05_01-22_00_01.vma.zst M√©todo Alternativo (No Recomendado) Al igual que con los LXC, podr√≠as ir directamente al directorio de backups y usar rm para borrar el archivo.\nEncuentra la ruta del storage con pvesm status. Navega a esa ruta. Por defecto, para el storage local suele ser /var/lib/vz/dump/. Usa rm para borrar el archivo: 1 2 # ¬°CUIDADO! Este comando es destructivo e irreversible rm /var/lib/vz/dump/vzdump-qemu-101-....vma.zst ¬øPor qu√© no se recomienda? Porque esto solo borra el archivo del disco. El backup podr√≠a seguir apareciendo en la interfaz gr√°fica de Proxmox hasta que el almacenamiento se vuelva a escanear (o \u0026ldquo;prune\u0026rdquo;). Usar pvesm free es m√°s limpio porque actualiza el √≠ndice de Proxmox al instante.\nPuntos Clave y Precauciones ¬°La eliminaci√≥n es permanente! No hay papelera de reciclaje. Siempre usa pvesm list primero para asegurarte de que tienes el nombre de archivo (VolId) correcto. Copiar y pegar el VolId es la forma m√°s segura de evitar errores de tipeo. Recuerda la diferencia: qemu en el nombre de archivo es para VMs, lxc es para contenedores. ","description":"Gesti√≥n de backups desde la shell","id":10,"section":"posts","tags":["homelab","privacidad","selfhosting","opensource","zfs","raid"],"title":"Gesti√≥n de backups ","uri":"http://localhost:1313/es/posts/proxmox_gestion_backups/"},{"content":"Gu√≠a Definitiva: Vaultwarden y Tailscale Despu√©s de un intenso viaje de configuraci√≥n, aqu√≠ se presenta una gu√≠a completa sobre c√≥mo montar un entorno homelab seguro, privado y accesible desde cualquier lugar. El objetivo final: tener nuestro propio gestor de contrase√±as (Vaultwarden) funcionando a la perfecci√≥n, sin exponer un solo puerto a internet.\nEste post resume la arquitectura final, la configuraci√≥n clave de cada componente y las valiosas lecciones aprendidas durante el proceso.\nüöÄ Arquitectura El error m√°s com√∫n es no entender c√≥mo deben comunicarse los servicios. Despu√©s de todo el troubleshooting, la arquitectura correcta es simple y elegante:\nDispositivo (petici√≥n) -\u0026gt; AdGuard (DNS) -\u0026gt; Nginx Proxy Manager (Recepci√≥n) -\u0026gt; Vaultwarden (Servicio)\nEn una analog√≠a m√°s clara:\nAdGuard (La Gu√≠a Telef√≥nica): Tu dispositivo pregunta por subdominio.dominio.com. AdGuard le da el n√∫mero de la Recepci√≥n del Edificio, no el de la oficina interna. Nginx Proxy Manager (La Recepci√≥n Segura): Es la √∫nica puerta de entrada. Recibe la llamada en un idioma seguro (HTTPS), verifica la identidad (el dominio) y transfiere la llamada a la oficina correcta en un idioma interno (HTTP). Vaultwarden (La Oficina Privada): Hace el trabajo real. No tiene puerta a la calle y solo habla con la recepci√≥n. üõ†Ô∏è Componentes del Ecosistema Componente Rol Plataforma IP Ejemplo Proxmox La base de virtualizaci√≥n (Hipervisor) Servidor F√≠sico N/A Cloudflare Gesti√≥n de dominio y API para certificados Servicio Externo N/A AdGuard Home Servidor DNS local y bloqueo de anuncios Contenedor LXC 192.168.100.110 Nginx Proxy Mgr Reverse Proxy y gesti√≥n de SSL Contenedor LXC 192.168.100.183 Vaultwarden Servidor de contrase√±as (Bitwarden) Contenedor LXC 192.168.100.182 Tailscale VPN segura para acceso remoto (Overlay Net) Todos los equipos N/A ‚öôÔ∏è Gu√≠a de Configuraci√≥n Clave Aqu√≠ no se detallar√° la instalaci√≥n b√°sica de cada LXC (que se ha hecho con los scripts de https://tteck.github.io/) sino los puntos de configuraci√≥n cr√≠ticos que hicieron que todo funcionara.\n1. Cloudflare: El Dominio Rol: √önicamente gestionar el nombre del dominio y subdominios. No usaremos su proxy. Configuraci√≥n Cr√≠tica: Crea los registros DNS de tipo A para tus servicios (subdominios, ej. vault, adguard, npm) apuntando a sus IPs locales. Aseg√∫rate de que el Estado del Proxy est√© en \u0026ldquo;Solo DNS\u0026rdquo; (nube gris). Esto es fundamental. 2. AdGuard Home: La Gu√≠a Telef√≥nica Rol: Resolver nuestros dominios locales a las IPs correctas. Configuraci√≥n Cr√≠tica: Filters -\u0026gt; DNS rewrites. Crea una reescritura para tu servicio. Dominio: subdominio.dominio.com IP de Respuesta: ¬°DEBE APUNTAR AL REVERSE PROXY (NPM)!. 192.168.100.183 3. Vaultwarden: La Oficina Privada Rol: Almacenar de forma segura nuestras contrase√±as.\nConfiguraci√≥n Cr√≠tica: El fichero /opt/vaultwarden/.env. Debe contener estas cuatro variables para funcionar detr√°s de un reverse proxy:\n1 2 3 4 5 6 7 8 9 10 11 12 13 # Fichero: /opt/vaultwarden/.env # 1. Tu dominio completo con HTTPS. Obligatorio para los WebSockets. DOMAIN=https://subdominio.dominio.com # 2. Habilita el soporte de WebSockets para que la web no se quede en \u0026#34;LOADING\u0026#34;. WEBSOCKET_ENABLED=true # 3. El token para acceder a la p√°gina de administraci√≥n (/admin). ADMIN_TOKEN=TU_TOKEN_SEGURO_AQU√ç # 4. ¬°CRUCIAL! Para que Vaultwarden acepte conexiones de otros contenedores (NPM). ROCKET_ADDRESS=0.0.0.0 Despu√©s de editar, reinicia el servicio: systemctl restart vaultwarden.\n4. Nginx Proxy Manager: La Recepci√≥n Segura Rol: Recibir el tr√°fico HTTPS, desencriptarlo y pasarlo a Vaultwarden. Configuraci√≥n Cr√≠tica: Crear un Proxy Host. Pesta√±a Details:\nDomain Names: subdominio.dominio.com Scheme: http Forward Hostname / IP: 192.168.100.182 (La IP de Vaultwarden) Forward Port: 8000 Pesta√±a SSL:\nSelecciona tu certificado SSL (puedes usar el desaf√≠o DNS de Cloudflare para obtenerlo). Activa Force SSL y HTTP/2 Support. Pesta√±a Advanced (Opcional): El toggle de \u0026ldquo;Websocket Support\u0026rdquo; a veces no es suficiente. Usar esta configuraci√≥n personalizada es m√°s robusto.\n1 2 3 4 5 6 7 8 9 10 11 12 13 location / { proxy_pass http://192.168.100.182:8000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } location /notifications/hub { proxy_pass http://192.168.100.182:8000; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } 5. Tailscale: La C√∫pula de Acceso Remoto Rol: Crear una red privada virtual (VPN) segura para acceder a nuestro homelab desde cualquier lugar del mundo, sin abrir puertos y funcionando perfectamente detr√°s de CG-NAT. Configuraci√≥n: Crea una cuenta en Tailscale. Instala el cliente de Tailscale en tus dispositivos (PC, m√≥vil) y en los servidores a los que quieras acceder (¬°incluso puedes instalarlo en el contenedor de NPM o en una VM separada!). Activa Magic DNS en la consola de administraci√≥n de Tailscale si quieres acceder a tus servicios por su nombre de host simple. Con Tailscale activo, puedes acceder a https://subdominio.dominio.com desde tu m√≥vil en una red 4G como si estuvieras en casa, de forma totalmente segura.\nüí° Lecciones Aprendidas en el Camino (Troubleshooting) Este setup es robusto, pero el camino para llegar a √©l estuvo lleno de pistas falsas. Estos fueron los problemas m√°s destacados:\nFirewall de OPNsense/pfSense: La causa inicial fue un proxy transparente que interceptaba el tr√°fico HTTPS, causando ERR_CONNECTION_REFUSED. Atenci√≥n a los firewall y reglas residuales. DNS Rebinding Protection: Una funci√≥n de seguridad en routers avanzados que evita que dominios p√∫blicos resuelvan a IPs privadas. Se soluciona a√±adiendo tu dominio a una lista de excepciones. DNS del Navegador vs. Sistema: Los navegadores modernos con \u0026ldquo;DNS Seguro\u0026rdquo; (DoH) pueden ignorar tu DNS local (AdGuard). Desactivarlo o usar el fichero hosts de Windows fue clave para diagnosticar. Configuraci√≥n de Vaultwarden: La variable ROCKET_ADDRESS=0.0.0.0 es imprescindible para que el servicio acepte conexiones externas a su contenedor. Si se queda en 127.0.0.1, nadie excepto √©l mismo puede hablarle. El Destino del DNS Rewrite: El error m√°s simple. La reescritura en AdGuard siempre debe apuntar al Reverse Proxy (NPM), no al servicio final (Vaultwarden). Imprescindible contratar un dominio En verdad es justo y necesario Cloudflare es una opci√≥n econ√≥mica y solida. Espero que este post sirva de ayuda como una gu√≠a clara y una fuente de motivaci√≥n.\nMontar un homelab privado y seguro es un viaje de aprendizaje incre√≠blemente satisfactorio.\n","description":"Vaultwarden","id":11,"section":"posts","tags":null,"title":"Vaultwarden","uri":"http://localhost:1313/es/posts/proxmox_vaultwarden/"},{"content":"üîç ¬øQu√© es LXC ? LXC (Linux Containers) es una tecnolog√≠a de virtualizaci√≥n a nivel de sistema operativo que permite ejecutar m√∫ltiples sistemas Linux aislados, conocidos como contenedores (CTs), en un √∫nico host. A diferencia de las M√°quinas Virtuales (VMs) tradicionales que emulan hardware completo, los contenedores LXC comparten el kernel del host.\nEsto se traduce en eficiencia :\nArranque Instant√°neo: Los contenedores se inician en segundos. Bajo Overhead: Consumo m√≠nimo de RAM y CPU, permitiendo una mayor densidad de servicios en el mismo hardware. Integraci√≥n Nativa: Se sienten como una VM ligera, con su propia IP y servicios, pero sin el peso del hipervisor. Conceptos Clave en Proxmox Template (Plantilla): Im√°genes de sistema operativo preconfiguradas (Ubuntu, Debian, Alpine, etc.) que sirven como base para tus contenedores. Contenedor Privilegiado: Tiene acceso casi total a los recursos del host. M√°s compatible, pero menos seguro. Contenedor No Privilegiado: Mapea los UIDs/GIDs, aislando el contenedor del host. Es la opci√≥n recomendada por seguridad. Bind Mount: Permite compartir un directorio del host de Proxmox directamente dentro de un contenedor. Ideal para datos compartidos. Integraci√≥n con ZFS: Si usas ZFS como almacenamiento, los snapshots y clones de contenedores son casi instant√°neos y muy eficientes en espacio. üõ†Ô∏è Comandos pct para LXC en Proxmox Olv√≠date de lxc-*. En Proxmox, el comando pct (Proxmox Container Toolkit) manda. Comandos esenciales .\n(Ejemplo: 100 es el ID de tu contenedor)\n1. Gesti√≥n B√°sica del Ciclo de Vida 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # Listar todos los contenedores en el nodo pct list # Crear un nuevo contenedor (CT) desde una plantilla descargada pct create 100 local:vztmpl/ubuntu-22.04-standard.tar.zst \\ --hostname mi-super-ct --storage local-lvm --memory 1024 --cores 2 \\ --net0 name=eth0,bridge=vmbr0,ip=dhcp --password \u0026#39;TuContrase√±aSegura\u0026#39; # Iniciar, detener, y reiniciar un contenedor pct start 100 pct stop 100 pct reboot 100 # Acceder a la consola del contenedor pct enter 100 # Clonar un contenedor existente pct clone 100 101 --hostname mi-clon # Eliminar un contenedor (¬°con cuidado!) pct destroy 100 2. Configuraci√≥n y Recursos 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Cambiar recursos (CPU y RAM) en caliente pct set 100 --cores 4 --memory 2048 # Ver la configuraci√≥n completa de un CT pct config 100 # Configurar una red est√°tica pct set 100 --net0 name=eth0,bridge=vmbr0,ip=192.168.1.100/24,gw=192.168.1.1 # A√±adir un \u0026#34;bind mount\u0026#34; para compartir datos # Sintaxis: --mp[id] /ruta/en/host,mp=/ruta/en/contenedor pct set 100 --mp0 /mnt/data/media,mp=/media # Aumentar el tama√±o del disco ra√≠z (ej. +5GB) pct resize 100 rootfs +5G 3. Snapshots y Backups 1 2 3 4 5 6 7 8 9 10 11 # Crear un snapshot con descripci√≥n pct snapshot 100 pre-actualizacion --description \u0026#34;Antes de instalar Nginx\u0026#34; # Listar todos los snapshots de un CT pct listsnapshot 100 # Revertir a un snapshot anterior (¬°acci√≥n destructiva!) pct rollback 100 pre-actualizacion # Crear un backup completo y comprimido vzdump 100 --compress zstd --storage mi-storage-de-backups --mode snapshot üß† Buenas Pr√°cticas Seguridad Primero: Usa siempre contenedores no privilegiados (--unprivileged 1 al crear) a menos que una aplicaci√≥n lo requiera espec√≠ficamente (ej. Docker dentro de LXC). Limita los Recursos: No asignes m√°s CPU o RAM de la necesaria. Usa --cpulimit y --cpuunits para controlar el rendimiento. Usar pct exec para Comandos R√°pidos: En lugar de entrar a la consola, puedes ejecutar comandos directamente desde el host. Es ideal para scripts de automatizaci√≥n. 1 2 # Actualizar un contenedor sin entrar en √©l pct exec 100 -- apt update \u0026amp;\u0026amp; apt upgrade -y Aprovecha ZFS: Si tienes la opci√≥n, usa ZFS para tu almacenamiento de contenedores. Los snapshots y clones son una maravilla. Plantillas Personalizadas: Una vez que tengas un contenedor base configurado a tu gusto (con tus usuarios, paquetes, etc.), crea una plantilla a partir de √©l para desplegar nuevos servicios en segundos. 1 2 # (Desde la GUI de Proxmox) Convertir CT a Plantilla pct set 100 --features nesting=1,fuse=1 --hookscript local:snippets/hookscript.pl üìä Comparativa R√°pida: LXC vs. Docker vs. VM Caracter√≠stica LXC (en Proxmox) Docker VM Tradicional Aislamiento Nivel de SO (medio-alto) Nivel de Proceso (bajo) Nivel de Hardware (muy alto) Overhead M√≠nimo M√≠nimo Alto (RAM, CPU, Disco) Arranque Instant√°neo (\u0026lt; 3 seg) Instant√°neo (\u0026lt; 1 seg) Lento (segundos a minutos) Gesti√≥n Sistema completo (como una VM) Aplicaci√≥n √∫nica y ef√≠mera Sistema completo Caso de Uso Ideal Servicios de infraestructura (DNS, VPN, DBs) Microservicios, aplicaciones web Sistemas operativos diferentes (Windows, BSD) üéØ Casos de Uso Perfectos para LXC Servidores Web y Reverse Proxies: Nginx, Apache, Caddy, Nginx Proxy Manager. Servicios de Red: AdGuard Home, Pi-hole, Unbound, WireGuard. Bases de Datos Ligeras: SQLite, PostgreSQL, MariaDB para proyectos peque√±os/medianos. Bots y Scripts de Automatizaci√≥n: Contenedores dedicados para bots de Discord, Telegram, o scripts de Python. Entornos de Desarrollo: Un contenedor por proyecto para aislar dependencias sin el peso de Docker. ¬° Al ataque ! üöÄ ","description":"Contenedores LXC en entorno Proxmox.","id":12,"section":"posts","tags":["lxc","proxmox","contenedores","virtualizaci√≥n","devops"],"title":"LXC en Proxmox","uri":"http://localhost:1313/es/posts/proxmox_lxc/"},{"content":"üåê ¬øQu√© es Wazuh? Wazuh es una plataforma de seguridad de c√≥digo abierto, gratuita y universalmente reconocida. Funciona como una soluci√≥n XDR (Detecci√≥n y Respuesta Extendidas) y SIEM (Gesti√≥n de Eventos e Informaci√≥n de Seguridad) todo en uno.\nWazuh centraliza, analiza y responde a eventos de seguridad de toda tu infraestructura, desde servidores y PCs hasta dispositivos m√≥viles.\n¬øQu√© Hace? Detecci√≥n de Intrusiones (HIDS): Monitoriza tus sistemas en busca de actividad sospechosa, cambios no autorizados en ficheros y malware. An√°lisis de Logs: Recopila y analiza logs de cualquier fuente (aplicaciones, sistemas operativos, firewalls) para detectar patrones de ataque. Monitorizaci√≥n de Integridad de Ficheros (FIM): Te alerta si ficheros cr√≠ticos del sistema o de tus aplicaciones son modificados. Evaluaci√≥n de Vulnerabilidades: Detecta software obsoleto o con vulnerabilidades conocidas en tus equipos. Cumplimiento Normativo: Ayuda a cumplir con est√°ndares de seguridad como PCI DSS, GDPR o HIPAA mediante reglas predefinidas. Respuesta Activa: Puede tomar acciones autom√°ticas, como bloquear una direcci√≥n IP en el firewall o detener un proceso malicioso. üõ†Ô∏è Instalaci√≥n del Servidor Wazuh en Proxmox LXC Vamos a instalar la pila completa de Wazuh (Indexer, Server y Dashboard) en un √∫nico contenedor LXC, una opci√≥n eficiente y potente para un homelab.\n1. Preparar el Contenedor LXC Crea un Contenedor LXC en Proxmox:\nPlantilla: Ubuntu 22.04 (Jammy) es una opci√≥n excelente y recomendada. Recursos: Wazuh consume recursos, especialmente el Indexer. Asigna como m√≠nimo: CPU: 4 Cores RAM: 4 GB (8 GB es ideal) Disco: 30-50 GB (dependiendo de cu√°ntos logs vayas a almacenar) Networking: Asigna una IP est√°tica para facilitar la gesti√≥n. Accede al Contenedor y Actualiza:\n1 2 3 4 5 # Entra a la consola del CT pct enter ID_DEL_CT # Actualiza el sistema apt update \u0026amp;\u0026amp; apt upgrade -y 2. Instalaci√≥n de Wazuh (M√©todo Asistido) Wazuh proporciona un script que simplifica enormemente la instalaci√≥n \u0026ldquo;todo en uno\u0026rdquo;.\nDescarga el Asistente de Instalaci√≥n:\n1 curl -sO https://packages.wazuh.com/4.x/wazuh-install.sh Ejecuta el Asistente:\n1 bash wazuh-install.sh -a El flag -a significa \u0026ldquo;all-in-one\u0026rdquo; (todo en uno). El script se encargar√° de instalar Wazuh Indexer, Wazuh Server y Wazuh Dashboard, y de configurarlos para que se comuniquen entre s√≠.\n¬°Ten Paciencia! Este proceso puede tardar entre 15 y 30 minutos. Al final, el script te mostrar√° un resumen con las credenciales de administrador (usuario admin). ¬°Guarda esta contrase√±a en un lugar seguro!\nVerifica los Servicios:\n1 systemctl status wazuh-indexer wazuh-manager wazuh-dashboard Los tres servicios deber√≠an estar active (running).\n¬°Y listo! Ya puedes acceder a tu interfaz de Wazuh en https://IP_DEL_LXC.\nüíª Instalaci√≥n del Agente en Windows Ahora vamos a conectar un PC con Windows a nuestro servidor Wazuh.\nDescarga el Agente: Ve a la p√°gina oficial de descargas de Wazuh y descarga el agente para Windows.\nInstalaci√≥n Gr√°fica:\nEjecuta el instalador. Durante la instalaci√≥n, te pedir√° la direcci√≥n del servidor Wazuh. Introduce la IP de tu contenedor LXC (ej. 192.168.100.101). Deja el resto de opciones por defecto y finaliza la instalaci√≥n. Configuraci√≥n y Arranque:\nEl agente se instalar√° como un servicio de Windows. Para gestionarlo, abre PowerShell como Administrador. Inicia el servicio: 1 net start WazuhSvc Verificaci√≥n:\nEn tu Dashboard de Wazuh, despu√©s de unos minutos, ve a la secci√≥n Agents. Ver√°s tu nuevo agente de Windows conectado y reportando datos. üì± Instalaci√≥n del Agente en Android S√≠, tambi√©n puedes monitorizar tu dispositivo Android para detectar aplicaciones maliciosas y configuraciones inseguras.\nDescarga la APK:\nDesde tu tel√©fono Android, ve a la p√°gina de GitHub de Wazuh para Android. Descarga el fichero .apk de la √∫ltima versi√≥n. Es posible que tengas que permitir la instalaci√≥n desde fuentes desconocidas. Configuraci√≥n de la App:\nAbre la aplicaci√≥n de Wazuh. Te pedir√° la IP del servidor y el puerto. IP del Servidor: La IP de tu servidor Wazuh (ej. 192.168.88.101). Puerto: 1514 (es el puerto por defecto para la comunicaci√≥n de los agentes). Autenticaci√≥n: Puedes dejar la contrase√±a vac√≠a para que el servidor registre el agente autom√°ticamente (si la configuraci√≥n por defecto lo permite). Guarda la configuraci√≥n y pulsa \u0026ldquo;Start\u0026rdquo;. Permisos: La aplicaci√≥n te pedir√° varios permisos para poder monitorizar el estado del tel√©fono. Conc√©deselos para que pueda funcionar correctamente.\nVerificaci√≥n:\nAl igual que con el agente de Windows, tu dispositivo Android aparecer√° en la lista de agentes del Dashboard de Wazuh pasados unos minutos. Con estos pasos, has creado un centro de mando de seguridad centralizado y potente. Ahora puedes empezar a explorar las reglas, crear alertas personalizadas y tener una visibilidad completa de lo que ocurre en tu red. üõ°Ô∏è\nInstalaci√≥n del Agente en Debian Pre-instalaci√≥n de Dependencias: lsb-release primero. Esto evita cualquier error con dpkg. Instalaci√≥n del Agente: dpkg con las variables de entorno, incluyendo un WAZUH_AGENT_NAME √∫nico y descriptivo (NOMBRE-DESCRIPTIVO). Activaci√≥n y Arranque del Servicio: sudo systemctl enable wazuh-agent para asegurarte de que sobreviva a los reinicios. sudo systemctl start wazuh-agent para iniciarlo en el momento. Estado Final: El √∫ltimo systemctl status wazuh-agent muestra claramente Active: active (running) y todos los sub-procesos de Wazuh iniciados correctamente. Comandos Aislados Debian/Ubuntu. Paso 1: Actualizar la lista de paquetes\n1 sudo apt-get update Paso 2: Instalar la dependencia lsb-release (si no est√° presente)\n1 sudo apt-get install -y lsb-release Paso 3: Descargar e instalar el agente Wazuh\n(Recuerda cambiar WAZUH_AGENT_NAME por el nombre de la nueva m√°quina)\n1 wget https://packages.wazuh.com/4.x/apt/pool/main/w/wazuh-agent/wazuh-agent_4.12.0-1_amd64.deb 1 sudo WAZUH_MANAGER=\u0026#39;192.168.88.188\u0026#39; WAZUH_AGENT_GROUP=\u0026#39;center\u0026#39; WAZUH_AGENT_NAME=\u0026#39;nombre-del-nuevo-agente\u0026#39; dpkg -i ./wazuh-agent_4.12.0-1_amd64.deb Paso 4: Habilitar el servicio para que inicie autom√°ticamente\n1 sudo systemctl enable wazuh-agent Paso 5: Iniciar el servicio del agente\n1 sudo systemctl start wazuh-agent Paso 6: Verificar el estado del servicio\n1 systemctl status wazuh-agent ","description":"Aprende qu√© es Wazuh, c√≥mo funciona y c√≥mo instalar el servidor en Proxmox LXC y los agentes en Windows y Android para una seguridad total.","id":13,"section":"posts","tags":["wazuh","siem","xdr","seguridad","proxmox","homelab"],"title":"Wazuh: Tu Centro de Seguridad Open Source (Gu√≠a Completa)","uri":"http://localhost:1313/es/posts/proxmox_wazuh/"},{"content":"Neofetch Instalaci√≥n Neofetch es una herramienta ligera y obsoleta que muestra informaci√≥n del sistema junto a un logotipo ASCII.\nActualiza los paquetes del sistema con:\nsudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y\nInstala Neofetch desde los repositorios oficiales:\nsudo apt install -y neofetch\nPara ejecutarlo, simplemente escribe:\nneofetch\n-\u0026ndash;\nConfiguraci√≥n Para personalizar Neofetch, edita su archivo de configuraci√≥n ubicado en:\ncp ${HOME}/.config/neofetch/config.conf_ORI ${HOME}/.config/neofetch/config.conf *\n~/.config/neofetch/config.conf\no\n${HOME}/.config/neofetch/config.conf\nSi deseas que Neofetch se ejecute autom√°ticamente al abrir una nueva terminal, a√±ade el comando neofetch al final del archivo de configuraci√≥n de tu shell:\nneofetch\nEn bash:\nnano ~/.bashrc\nEn zsh:\nnano ~/.zshrc\nGuarda los cambios y recarga la configuraci√≥n con:\nsource ~/.bashrc\no\nsource ~/.zshrc\nSi necesitas restaurar la configuraci√≥n original, elimina el archivo de configuraci√≥n y ejecuta Neofetch nuevamente:\nrm ~/.config/neofetch/config.conf\nneofetch\nZSH Instalaci√≥n Oh My Zsh es una herramienta de gesti√≥n de configuraciones para el shell Zsh, dise√±ada para facilitar y mejorar el uso del terminal. Con el soporte de una amplia variedad de plugins, temas y configuraciones, Oh My Zsh permite personalizar tu experiencia en el terminal de manera sencilla y eficiente.\nsudo apt update \u0026amp;\u0026amp; sudo apt upgrade -y\nsudo apt install zsh\nConfigurar Zsh como shell predeterminado:\nchsh -s $(which zsh)\nInstalaci√≥n de Oh My Zsh: sh -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\u0026#34;\rO wget\rsh -c \u0026#34;$(wget https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)\u0026#34;* Configuraci√≥n de Plugins de Autocompletar\nActivaci√≥n del Plugin de Autocompletar:\nOh My Zsh viene con un plugin de autocompletado que se puede activar editando el archivo de configuraci√≥n .zshrc:\nnano ~/.zshr\nDentro del archivo, encuentra la l√≠nea plugins=(git) y a√±ade zsh-autosuggestions y zsh-syntax-highlighting para habilitar el autocompletado y resaltado de sintaxis:\nplugins=(git zsh-autosuggestions zsh-syntax-highlighting)\nInstalaci√≥n del Plugin zsh-autosuggestions: Clona el repositorio del plugin en el directorio de plugins de Oh My Zsh:\ngit clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions\nInstalaci√≥n del Plugin zsh-syntax-highlighting: Clona el repositorio del plugin en el directorio de plugins de Oh My Zsh:\ngit clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\nAplicar los Cambios: Despu√©s de a√±adir los plugins y clonar los repositorios, aplica los cambios reiniciando la terminal o ejecutando:\nsource ~/.zshrc\nüòä\n","description":"Neofetch y Oh My Zsh","id":14,"section":"posts","tags":["consola"],"title":"Terminal custom","uri":"http://localhost:1313/es/posts/terminal_custom/"},{"content":"¬øPor qu√© un homelab y no solo un NAS? M√°s que un simple NAS, quiero construir un homelab: un espacio para servicios familiares, privados y seguros. Un acto de rebeld√≠a contra la erosi√≥n de la privacidad y una forma de recuperar el control sobre nuestros datos.\nObjetivos: Aprendizaje: Experimentar con ZFS, virtualizaci√≥n, redes y autohospedaje. Privacidad: Dejar de depender de servicios cloud que monetizan tus datos. Autonom√≠a: Tener control total sobre tu infraestructura digital. Componentes clave üîß Hardware Componente Especificaci√≥n Notas Placa base + CPU Intel N100/N6005 o RK3588 (ARM) Equilibrio entre potencia y eficiencia energ√©tica. RAM 32-64 GB DDR4 ZFS y m√°quinas virtuales son √°vidas de memoria. Almacenamiento 2x NVMe (256 GB) + 4x HDD (8 TB SATA) NVMe para sistema/VM, HDD para almacenamiento masivo con ZFS. Fuente de alimentaci√≥n 180W 80+ Platinum Suficiente para picos de arranque (‚âà77W en operaci√≥n normal). Caja Jonsbo N1 o alternativa DIY Priorizar ventilaci√≥n y espacio para discos. Opciones de placa base: RK3588 (ARM)\nFriendlyElec CM3588\nVentaja: Eficiencia energ√©tica. Desventaja: Compatibilidad con software x86. Intel N100 (x86)\nCWWK N100 4xNVMe\nTopton N100 6xSATA\nIntel N6005 (x86)\nCWWK N6005 6xSATA\nAviso: BIOS compleja (descarga aqu√≠). üì¶ Cajas recomendadas Modelo Enlace Imagen Homelabs HL1 Mini-ITX Jonsbo N1 6xHDD DIY (reciclaje) Ejemplo con caja vieja üí° Con creatividad, cualquier caja puede convertirse en un homelab. ¬°Incluso con un asa para \u0026ldquo;escapar\u0026rdquo; de la nube!\n‚ö° Consumo energ√©tico Estimaci√≥n por componente: Componente Consumo (W) Placa base + CPU 15 RAM (2x32GB) 10 2x NVMe 7 4x HDD SATA 40 Red/otros 5 Total (operaci√≥n) 77 W Recomendaci√≥n: Fuente de 160-180W para manejar picos (ej. arranque de discos).\nüöÄ M√°s all√° del almacenamiento Este homelab ser√° el coraz√≥n de:\nServicios familiares: Nextcloud, Photoprism, Jellyfin. Seguridad: AdGuard Home, VPN WireGuard. Aprendizaje: Kubernetes, Proxmox, monitorizaci√≥n con Grafana. Filosof√≠a \u0026ldquo;Gobernanza tecnol√≥gica es rebelarse contra el status quo: autohospedar es un acto pol√≠tico.\u0026rdquo;\nPr√≥ximos pasos En futuros posts:\nInstalaci√≥n de Proxmox/ZFS. Configuraci√≥n de redes aisladas. Migraci√≥n de servicios desde la nube. ¬øTe unes a la rebeli√≥n? üö™üîë\n","description":"Construye tu propio homelab: privado, seguro y libre.","id":15,"section":"posts","tags":["homelab","privacidad","selfhosting","opensource"],"title":"De NAS a Homelab: Privacidad, Aprendizaje y Rebeli√≥n Tecnol√≥gica","uri":"http://localhost:1313/es/posts/proxmox_nas/"},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 # Recuperaci√≥n de un Datastore de Proxmox Backup Server (PBS) tras Fallo del Hardware/SO En el mundo de los respaldos, la capacidad de recuperar tus datos es tan importante como la capacidad de crearlos. Proxmox Backup Server (PBS) est√° dise√±ado para la resiliencia, permitiendo que tus Datastores sean port√°tiles y recuperables incluso si el servidor PBS original falla por completo (ya sea por un problema de hardware o una corrupci√≥n del sistema operativo). Este post detalla los pasos y comandos esenciales para recuperar un Datastore de PBS montado en un disco externo USB en una m√°quina PBS completamente nueva. --- ## Escenario de Cat√°strofe Imagina la siguiente situaci√≥n: * Tu servidor PBS original (por ejemplo, un ThinkPad T430s) ha dejado de funcionar. * El Datastore de PBS reside en un disco externo USB (ej., `/dev/sdc` montado en `/mnt/backup_hdd`). * Necesitas acceder a esos respaldos lo antes posible. --- ## Proceso de Recuperaci√≥n Paso a Paso El proceso se divide en dos fases principales: **Preparaci√≥n del Disco en el Nuevo Sistema** y **Configuraci√≥n del Datastore en la Nueva Instancia de PBS**. ### Fase 1: Preparaci√≥n del Disco en el Nuevo Sistema Esta fase se realiza en la terminal de la nueva m√°quina que ejecutar√° Proxmox Backup Server. Asumimos que la nueva m√°quina ya tiene un sistema operativo compatible con PBS (Debian/Ubuntu Server) y que PBS est√° instalado. 1. **Conecta el Disco Externo USB** Conecta f√≠sicamente tu disco externo USB (que contiene el Datastore de PBS) a la nueva m√°quina. 2. **Identifica el Disco y la Partici√≥n** Es crucial identificar correctamente el nuevo nombre del dispositivo para tu disco de respaldo. Puede que ya no sea `/dev/sdc`. Usa `lsblk` para listar todos los dispositivos de bloque: ```bash lsblk ``` Busca tu disco por su tama√±o y particiones. Por ejemplo, si tu disco de 8TB se muestra como `/dev/sdb` y la partici√≥n principal es `/dev/sdb1`, ese ser√° tu objetivo. 3. **Crea un Punto de Montaje** Necesitas un directorio donde montar la partici√≥n del Datastore. Es buena pr√°ctica usar un nombre descriptivo, similar a tu configuraci√≥n anterior. ```bash mkdir /mnt/backup_hdd ``` *(Ajusta `/mnt/backup_hdd` seg√∫n tu preferencia o configuraci√≥n original).* 4. **Monta la Partici√≥n del Datastore** Monta la partici√≥n identificada en el punto de montaje que acabas de crear. ```bash mount /dev/sdb1 /mnt/backup_hdd ``` *(Reemplaza `/dev/sdb1` con el nombre de tu partici√≥n y `/mnt/backup_hdd` con tu punto de montaje).* 5. **Verifica el Montaje** Confirma que el disco se ha montado correctamente y es accesible. ```bash df -h ``` Deber√≠as ver `/dev/sdb1` (o el nombre de tu partici√≥n) listado con su tama√±o y uso, montado en `/mnt/backup_hdd`. 6. **Configura el Montaje Autom√°tico (Persistencia)** Para asegurar que el Datastore se monte autom√°ticamente despu√©s de cada reinicio, a√±ade una entrada a `/etc/fstab`. Primero, obt√©n el UUID (Universally Unique Identifier) de la partici√≥n. Esto es m√°s robusto que usar `/dev/sdX` ya que los nombres de los dispositivos pueden cambiar. ```bash blkid /dev/sdb1 ``` Copia el valor `UUID=\u0026#34;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\u0026#34;`. Ahora, edita `/etc/fstab` con un editor de texto como `nano`: ```bash nano /etc/fstab ``` A√±ade la siguiente l√≠nea al final del archivo, reemplazando el `UUID` con el valor que copiaste y ajustando la ruta y el tipo de sistema de archivos (`ext4` o `zfs` si lo configuraste as√≠ originalmente): ``` UUID=XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX /mnt/backup_hdd ext4 defaults 0 2 ``` Guarda y cierra el archivo (Ctrl+O, Enter, Ctrl+X en `nano`). **Opcional: Prueba `fstab`** Puedes probar si la nueva entrada de `fstab` es correcta sin reiniciar: ```bash mount -a ``` Si no hay errores, significa que la configuraci√≥n es v√°lida. ### Fase 2: Configuraci√≥n del Datastore en la Nueva Instancia de PBS Una vez que el disco externo est√° montado y accesible en el sistema de archivos del nuevo servidor PBS, el √∫ltimo paso es informarle a Proxmox Backup Server sobre este Datastore. 1. **Accede a la Interfaz Web de PBS** Abre tu navegador web y navega a la direcci√≥n IP de tu **nueva** m√°quina PBS en el puerto 8007: `https://[IP_DEL_NUEVO_PBS]:8007`. 2. **Inicia Sesi√≥n** Ingresa tus credenciales de usuario (ej., `root` y tu contrase√±a). 3. **Navega a la Secci√≥n \u0026#34;Datastores\u0026#34;** En el men√∫ de navegaci√≥n de la izquierda, haz clic en **Datastores**. 4. **A√±ade el Datastore Existente** Haz clic en el bot√≥n **Add Datastore**. * **Name:** **¬°MUY IMPORTANTE!** Debes introducir el **mismo nombre** que ten√≠a tu Datastore en el servidor PBS original. Si no recuerdas el nombre, puedes listarlos haciendo `ls /mnt/backup_hdd/` en la terminal, y ver√°s un directorio con el nombre del Datastore. * **Path:** Introduce la ruta de montaje que configuraste en el paso 3 de la Fase 1, ej., `/mnt/backup_hdd`. * **Owner:** Generalmente, `root@pam` (el valor predeterminado). * **Comment (opcional):** A√±ade una descripci√≥n si lo deseas. 5. **Confirma y A√±ade** Haz clic en el bot√≥n **Add**. ### Verificaci√≥n Final Una vez a√±adido, el nuevo servidor PBS escanear√° autom√°ticamente el Datastore. Deber√≠as ver los mismos grupos de respaldo, snapshots y m√©tricas que ten√≠as en el servidor PBS original. Ahora puedes proceder a verificar la integridad de los respaldos y realizar restauraciones. ","description":"PBS_recuperacion de fallo catastr√≥fico","id":16,"section":"posts","tags":["lxc","proxmox","contenedores","virtualizaci√≥n","devops"],"title":"PBS recuperacion","uri":"http://localhost:1313/es/posts/proxmox_pbs_recuperacion/"},{"content":"Backup y Restauraci√≥n de M√°quinas Virtuales Proxmox VE (Gu√≠a Avanzada) Este post detalla el proceso para realizar un backup completo de una M√°quina Virtual (VM) en Proxmox VE a un disco externo o directorio no gestionado por Proxmox, y c√≥mo restaurarla, manteniendo la distribuci√≥n original de los discos en diferentes almacenamientos. Se asume un entorno Proxmox VE con ZFS pools (local-zfs, dual-mirror-8_TB) y un disco externo (/dev/sda) montado.\nEscenario de la VM a Respaldar (ID 100) La VM con ID 100 (NEXT) tiene la siguiente configuraci√≥n de discos:\nscsi0: local-zfs:vm-100-disk-0,backup=1,iothread=1,size=50G\rscsi1: dual-mirror-8_TB:vm-100-data-new,backup=0,discard=on,iothread=1,size=509G Notamos que scsi1 tiene backup=0, lo que significa que vzdump lo ignorar√≠a por defecto.\nPreparaci√≥n del Destino del Backup (/dev/sda1) El disco de 3 TB (/dev/sda) se ha formateado con ext4 y se ha montado en /mnt/backup_3tb.\n1 2 3 4 5 6 7 8 # Verificaci√≥n de la partici√≥n y punto de montaje lsblk -f /dev/sda df -h /mnt/backup_3tb # Salida esperada (ejemplo): # NAME FSTYPE FSVER LABEL UUID FSAVAIL FSUSE% MOUNTPOINTS # sda # ‚îî‚îÄsda1 ext4 1.0 Backup3TB da4caf-da99-4886-8107-e5731d0090992 2.6T 1% /mnt/backup_3tb Proceso de Backup Completo de la VM 100 Dado que vzdump en algunas versiones de Proxmox puede no reconocer opciones avanzadas como --all-volumes o --include-post-vmdisks para discos con backup=0, la estrategia m√°s robusta para un backup completo es modificar temporalmente la configuraci√≥n de la VM.\nPre-requisito: La VM 100 debe estar detenida. (Verificar con qm status 100).\nPaso 1: Modificar Temporalmente la Configuraci√≥n del Disco scsi1 Activamos la opci√≥n backup=1 para el disco scsi1 en la configuraci√≥n de la VM 100. Esto asegura que vzdump lo incluya en el backup.\n1 qm set 100 -scsi1 dual-mirror-8_TB:vm-100-data-new,backup=1,discard=on,iothread=1,size=509G Paso 2: Verificar la Configuraci√≥n Modificada Confirmamos que scsi1 ahora tiene backup=1.\n1 qm config 100 La salida deber√≠a mostrar: scsi1: dual-mirror-8_TB:vm-100-data-new,backup=1,discard=on,iothread=1,size=509G\nPaso 3: Ejecutar el Backup con vzdump Utilizamos el comando vzdump con las opciones b√°sicas y el destino directo para el archivo de backup.\n1 vzdump 100 --mode stop --compress zstd --dumpdir /mnt/backup_3tb --tmpdir /var/tmp --maxfiles 3 --mode stop: La VM est√° detenida, garantizando un estado consistente del disco. --compress zstd: Utiliza el algoritmo de compresi√≥n Zstandard para optimizar el tama√±o del archivo. --dumpdir /mnt/backup_3tb: Especifica el directorio de destino para el archivo de backup (el disco externo montado). --tmpdir /var/tmp: Directorio temporal para vzdump (asegurar espacio suficiente). --maxfiles 3: Mantiene las √∫ltimas 3 versiones del backup. Durante la ejecuci√≥n, la salida de vzdump confirmar√° la inclusi√≥n de ambos discos:\nINFO: include disk \u0026#39;scsi0\u0026#39; \u0026#39;local-zfs:vm-100-disk-0\u0026#39; 50G\rINFO: include disk \u0026#39;scsi1\u0026#39; \u0026#39;dual-mirror-8_TB:vm-100-data-new\u0026#39; 509G\r# ... (progreso del backup) ...\rINFO: backup is sparse: 357.83 GiB (64%) total zero data\rINFO: transferred 559.00 GiB in 1345 seconds (425.6 MiB/s)\rINFO: archive file size: 193.36GB\rINFO: Backup job finished successfully Paso 4: Verificar el Archivo de Backup Comprobamos que el archivo de backup se ha creado correctamente en el destino.\n1 ls -lh /mnt/backup_3tb/ Se espera un archivo similar a vzdump-qemu-100-YYYY_MM_DD-HH_MM_SS.vma.zst con el tama√±o comprimido (ej. 194G).\nPaso 5: Revertir la Configuraci√≥n del Disco scsi1 (CR√çTICO) Una vez completado el backup, es imperativo restaurar la configuraci√≥n original del disco scsi1 a backup=0 para evitar comportamientos inesperados en futuros backups o operaciones de la VM.\n1 qm set 100 -scsi1 dual-mirror-8_TB:vm-100-data-new,backup=0,discard=on,iothread=1,size=509G Paso 6: Verificar que la Configuraci√≥n ha sido Revertida 1 qm config 100 La salida deber√≠a mostrar nuevamente: scsi1: dual-mirror-8_TB:vm-100-data-new,backup=0,discard=on,iothread=1,size=509G\nProceso de Restauraci√≥n del Backup (a VM ID 101) Para probar la integridad del backup, restauraremos la VM en un nuevo ID (101), replicando la distribuci√≥n original de los discos en sus respectivos almacenamientos.\nPaso 1: Identificar el Archivo de Backup y Nuevo ID Archivo de backup: /mnt/backup_3tb/vzdump-qemu-100-2025_11_10-15_28_24.vma.zst Nuevo ID de VM: 101 (Asegurarse de que no est√© en uso con qm status 101). Paso 2: Ejecutar el Comando de Restauraci√≥n qmrestore Utilizamos la opci√≥n --disk para especificar d√≥nde se restaurar√° cada disco del backup.\n1 2 3 qmrestore /mnt/backup_3tb/vzdump-qemu-100-2025_11_10-15_28_24.vma.zst 101 \\ --disk scsi0:local-zfs \\ --disk scsi1:dual-mirror-8_TB --disk scsi0:local-zfs: Restaura el disco scsi0 al almacenamiento local-zfs. --disk scsi1:dual-mirror-8_TB: Restaura el disco scsi1 al almacenamiento dual-mirror-8_TB. Verificaci√≥n de Espacio: Aseg√∫rese de que local-zfs tenga al menos 50GB libres y dual-mirror-8_TB al menos 509GB libres.\nPaso 3: Verificar la Configuraci√≥n de la VM Restaurada Una vez finalizada la restauraci√≥n, se inspecciona la configuraci√≥n de la VM 101.\n1 qm config 101 La salida mostrar√° los discos restaurados en sus respectivos almacenamientos, por ejemplo:\n# ...\rscsi0: local-zfs:vm-101-disk-0,size=50G\rscsi1: dual-mirror-8_TB:vm-101-disk-1,size=509G\r# ... Paso 4: Arrancar y Validar la VM Restaurada 1 qm start 101 Acceda a la consola de la VM (v√≠a la interfaz web de Proxmox o qm console 101) para confirmar que el sistema operativo arranca correctamente y que todos los datos en ambos discos son accesibles y consistentes.\nPaso 5: Limpieza (Post-Validaci√≥n) Una vez confirmada la funcionalidad del backup, se procede a eliminar la VM de prueba para liberar recursos.\n1 2 qm stop 101 # Detener la VM si est√° en ejecuci√≥n qm destroy 101 --purge # Eliminar la VM y sus discos La opci√≥n --purge es esencial para asegurar la eliminaci√≥n de todos los vol√∫menes de disco asociados.\nEste procedimiento garantiza un backup completo y una restauraci√≥n fiable de VMs en Proxmox VE, incluso en escenarios con configuraciones de disco espec√≠ficas y restricciones de versiones de herramientas.\n","description":"Backup de una VM a HDD en Proxmox.","id":17,"section":"posts","tags":["lxc","proxmox","contenedores","virtualizaci√≥n","devops"],"title":"Backup en Proxmox","uri":"http://localhost:1313/es/posts/proxmox_backup_a_hdd/"},{"content":"Como al actulizar me he cargado la maquina virtual de servidor de SNNMP Librenms al volver a instalar de 0 me ha costado un poco por que no me acordaba de nada.\nVoy a instalar la misma que tenia, la 18.04 y voy a ir actualizando para ver si le cojo el punto a Ubuntu, nunca me habia cargado nada actualizando Debian.\nCrear de nuevo la maquina virtual en proxmox https://docs.librenms.org/Installation/Images/\nLa imagen en OVA de Librenms est√° disponible en:\nhttps://github.com/librenms/packer-builds/releases?page=1\nPara convertir el archivo de imagen .ova en VM Proxmox segu√≠ los pasos de este tutorial:\nhttps://www.itsfullofstars.de/2019/07/import-ova-as-proxmox-vm/\nPoner en marcha la RED De primeras la imagen est√° lista para trabajar pero faltan algunas cosillas.\nDefault password:\nlibrenms login: librenms password: CDne3fwdfds Para ponerse en modo root\nsudo su Para cambiar el password:\npasswd librems Pero para configurar la red no es como en debian,\nLo primero es sacar el mombre de la interface en mi caso la ethernet\u0026hellip; como no funciona ifconfig:\nsudo systemctl start systemd-networkd sudo systemctl enable systemd-networkd networkctl list networkctl status Una vez que sabemos el nombre de la interface ethernet configuramos la ip en mi caso ip fija, el archivo de configuracion no est√° en /etc/network/interfaces est√° en el arhivo:\n/etc/netplan/50-cloud-init.yaml\nTiene que quedar con este formato para ip fija:\nnetwork: version: 2 renderer: networkd ethernets: ens19: dhcp4: no addresses: [192.168.1.10/24] gateway4: 192.168.1.254 nameservers: addresses: [8.8.8.8, 8.8.4.4] Si lo colocas tal cual como te muestro no tendr√°s problemas, el truco es:\nDeja 2 espacios por cada nivel. Por ejemplo, la linea que dice version: 2 tiene dos espacios al inicio. La que dice ens19: tiene 4\nDeja un espacio entre los dos puntos y el valor. Por ejemplo, entre dhcp4: y no hay un espacio.\nLuego aplicamos los cambios ejecutando el siguiente comando:\nsudo netplan apply Otras Ahora que ya hay salida a internet vamos a dar otros retoques:\nTeclado en castellano ISO\nsudo dpkg-reconfigure locales nano\nCon vi es que no tengo practica https://www.linuxtotal.com.mx/index.php?cont=info_admon_010\nbash-completion\nindispensable para mi\nnano /etc/bash.bashrc enable # bash completion in interactive shells if ! shopt -oq posix; then if [ -f /usr/share/bash-completion/bash_completion ]; then . /usr/share/bash-completion/bash_completion elif [ -f /etc/bash_completion ]; then . /etc/bash_completion fi fi SSH\nenable sshd\nnano /etc/ssh/sshd_config enable delete # lines Port 2023 AddressFamily any ListenAddress 0.0.0.0 ListenAddress :: neofetch\nAdd neofetch end file .bashrc user\nlibrenms@librenms:~$ sudo su .-/+oossssoo+/-. root@librenms `:+ssssssssssssssssss+:` ------------- -+ssssssssssssssssssyyssss+- OS: Ubuntu 18.04.6 LTS x86_64 .ossssssssssssssssssdMMMNysssso. Host: KVM/QEMU (Standard PC (i440FX + PIIX, 1996) pc-i440fx-5.2) /ssssssssssshdmmNNmmyNMMMMhssssss/ Kernel: 4.15.0-96-generic +ssssssssshmydMMMMMMMNddddyssssssss+ Uptime: 2 hours, 7 mins /sssssssshNMMMyhhyyyyhmNMMMNhssssssss/ Packages: 727 .ssssssssdMMMNhsssssssssshNMMMdssssssss. Shell: bash 4.4.20 +sssshhhyNMMNyssssssssssssyNMMMysssssss+ CPU: Common KVM (1) @ 2.266GHz ossyNMMMNyMMhsssssssssssssshmmmhssssssso GPU: Vendor 1234 Device 1111 ossyNMMMNyMMhsssssssssssssshmmmhssssssso Memory: 221MiB / 1992MiB +sssshhhyNMMNyssssssssssssyNMMMysssssss+ .ssssssssdMMMNhsssssssssshNMMMdssssssss. /sssssssshNMMMyhhyyyyhdNMMMNhssssssss/ +sssssssssdmydMMMMMMMMddddyssssssss+ /ssssssssssshdmNNNNmyNMMMMhssssss/ .ossssssssssssssssssdMMMNysssso. -+sssssssssssssssssyyyssss+- `:+ssssssssssssssssss+:` .-/+oossssoo+/-. root@librenms:/ net-tools\narp se usa para manipular la cach√© ARP del n√∫cleo, usualmente para a√±adir o borrar una entrada o volcar la cach√© completa.\ndnsdomainname muestra el nombre del dominio DNS del sistema.\ndomainname muestra o establece el nombre del dominio NIS/YP del sistema.\nhostname muestra o establece el nombre del sistema actual.\nifconfig es la utilidad principal usada para configurar las interfaces de red.\nnameif nombra interfaces de red bas√°ndose en las direcciones MAC.\nnetstat se usa para mostrar las conexiones de red, tablas de encaminamiento y estad√≠sticas de las interfaces.\nnisdomainname hace lo mismo que domainname.\nplipconfig se usa para afinar los par√°metros del dispositivo PLIP, para mejorar su rendimiento.\nrarp se usa para manipular la tabla RARP del n√∫cleo.\nroute se usa para manipular la tabla de encaminamiento IP.\nslattach conecta una interfaz de red a una l√≠nea serie. Esto permite usar l√≠neas de terminales normales para crear enlaces punto a punto con otras computadoras.\nNTP\nsudo dpkg-reconfigure tzdata root@librenms:~# timedatectl Local time: Thu 2022-09-15 19:05:03 CEST Universal time: Thu 2022-09-15 17:05:03 UTC RTC time: Thu 2022-09-15 17:05:03 Time zone: Europe/Madrid (CEST, +0200) System clock synchronized: no systemd-timesyncd.service active: yes RTC in local TZ: no root@librenms:~# para instalar todo esto\napt update \u0026amp;\u0026amp; sudo apt upgrade apt install net-tools neofetch bash-completion nano BACKUP VM Y llegados a este punto, a respaldar la VM para no perder todo el trabajo.\nActualizar Ubuntu root@librenms:~# lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 18.04.6 LTS Release: 18.04 Codename: bionic root@librenms:~# La quiero acutualizar 18.04 \u0026ldquo;Bionic Beavera\u0026rdquo; la siguiente LTS la 20.04 \u0026ldquo;Focal Fossa\u0026rdquo; con soporte hasta 2025\nhttps://www.fosslinux.com/38303/how-to-upgrade-to-ubuntu-20-04-lts-focal-fossa.htm\nEsta vez que ten√≠a hecho el backup ha funcionado todo perfectamente siguiendo las indicaciones estasy por ssh.\nroot@librenms:/opt/librenms# lsb_release -a No LSB modules are available. Distributor ID: Ubuntu Description: Ubuntu 20.04.5 LTS Release: 20.04 Codename: focal root@librenms:/opt/librenms# librenms@librenms:~$ sudo su .-/+oossssoo+/-. root@librenms `:+ssssssssssssssssss+:` ------------- -+ssssssssssssssssssyyssss+- OS: Ubuntu 20.04.5 LTS x86_64 .ossssssssssssssssssdMMMNysssso. Host: KVM/QEMU (Standard PC (i440FX + PIIX, 1996) pc-i440fx-5.2) /ssssssssssshdmmNNmmyNMMMMhssssss/ Kernel: 5.4.0-125-generic +ssssssssshmydMMMMMMMNddddyssssssss+ Uptime: 4 mins /sssssssshNMMMyhhyyyyhmNMMMNhssssssss/ Packages: 795 (dpkg) .ssssssssdMMMNhsssssssssshNMMMdssssssss. Shell: bash 5.0.17 +sssshhhyNMMNyssssssssssssyNMMMysssssss+ Resolution: 1024x768 ossyNMMMNyMMhsssssssssssssshmmmhssssssso CPU: Common KVM (1) @ 2.266GHz ossyNMMMNyMMhsssssssssssssshmmmhssssssso GPU: 00:02.0 Vendor 1234 Device 1111 +sssshhhyNMMNyssssssssssssyNMMMysssssss+ Memory: 178MiB / 1983MiB .ssssssssdMMMNhsssssssssshNMMMdssssssss. /sssssssshNMMMyhhyyyyhdNMMMNhssssssss/ +sssssssssdmydMMMMMMMMddddyssssssss+ /ssssssssssshdmNNNNmyNMMMMhssssss/ .ossssssssssssssssssdMMMNysssso. -+sssssssssssssssssyyyssss+- `:+ssssssssssssssssss+:` .-/+oossssoo+/-. root@librenms:/opt/librenms# PROXMOX VE Y ya de paso subo a bullseye el servidor con apt:\n.://:` `://:. root@cepeda `hMMMMMMd/ /dMMMMMMh` ----------- `sMMMMMMMd: :mMMMMMMMs` OS: Proxmox VE 7.2-11 x86_64 `-/+oo+/:`.yMMMMMMMh- -hMMMMMMMy.`:/+oo+/-` Host: IBM System x -[794732G]- 00 `:oooooooo/`-hMMMMMMMyyMMMMMMMh-`/oooooooo:` Kernel: 5.15.53-1-pve `/oooooooo:`:mMMMMMMMMMMMMm:`:oooooooo/` Uptime: 5 mins ./ooooooo+- +NMMMMMMMMN+ -+ooooooo/. Packages: 807 (dpkg) .+ooooooo+-`oNMMMMNo`-+ooooooo+. Shell: bash 5.1.4 -+ooooooo/.`sMMs`./ooooooo+- Resolution: 1280x1024 :oooooooo/`..`/oooooooo: Terminal: /dev/pts/0 :oooooooo/`..`/oooooooo: CPU: Intel Xeon E5520 (16) @ 2.394GHz -+ooooooo/.`sMMs`./ooooooo+- GPU: 07:00.0 Matrox Electronics Systems Ltd. MGA G200EV .+ooooooo+-`oNMMMMNo`-+ooooooo+. Memory: 2736MiB / 7948MiB ./ooooooo+- +NMMMMMMMMN+ -+ooooooo/. `/oooooooo:`:mMMMMMMMMMMMMm:`:oooooooo/` `:oooooooo/`-hMMMMMMMyyMMMMMMMh-`/oooooooo:` `-/+oo+/:`.yMMMMMMMh- -hMMMMMMMy.`:/+oo+/-` `sMMMMMMMm: :dMMMMMMMs` `hMMMMMMd/ /dMMMMMMh` `://:` `://:` /etc/apt/sources.list\n# oficiales deb http://deb.debian.org/debian/ bullseye main contrib non-free #deb-src http://deb.debian.org/debian/ buster main contrib non-free # seguridad deb http://security.debian.org/debian-security bullseye-security main contrib non-free #deb-src http://security.debian.org/debian-security buster/updates main contrib non-free # actualizaciones deb http://deb.debian.org/debian/ bullseye-updates main contrib non-free #deb-src http://deb.debian.org/debian/ buster-updates main contrib non-free # MULTIMEDIA deb http://www.deb-multimedia.org bullseye main non-free # PVE pve-no-subscription repository provided by proxmox.com, # NOT recommended for production use deb http://download.proxmox.com/debian/pve bullseye pve-no-subscription Me sigue gustando mas debian. ","description":"Librenms VM","id":18,"section":"posts","tags":["Ubuntu","Linux","Proxmox","Librenms"],"title":"Librenms VM","uri":"http://localhost:1313/es/posts/librenms-vm/"},{"content":"Voy a intentar explicar como he hecho esta web. En la asociaci√≥n quieren tener una web y creo que de esta manera se puede hacer bien, r√°pido, fiable, colaborativa, segura \u0026hellip;\nIngredientes HUGO https://gohugo.io/\nComo generador de sitio web est√°tico Go, escribes los contenidos en Markdown (lenguaje humano) y HUGO lo transforma a HTML y CCS\nChuleta Markdown:\nhttps://dl.icdst.org/pdfs/files3/c79990b0b853932d36ddc117ce2503e3.pdf\nhugo server --\u0026gt; Crea un servidor local con tu web en http://localhost:1313/ es LIVE. hugo -d docs/ --\u0026gt; Vuelca contenido a HTML CCS en la carpeta \u0026#34;docs\u0026#34; que es la que pilla github para hacer la web GitHub https://github.com/hotspotcepeda/hotspotcepeda.github.io\nComo controlador de versiones en nube.\nChuleta con comandos y resumen git aqu√≠\ngit clone https://github.com/hotspotcepeda/cepeda.git --\u0026gt; Clona a local el repositorio git pull --\u0026gt; Compara diferencias entre local y en repositorio git add . --\u0026gt; marca todo para subir a repositorio los cambios git commit -m \u0026#34;mensaje para control de versiones\u0026#34; --\u0026gt; sube cambios git push --\u0026gt; Sube los cambios marcados de local a repositorio hugo -d docs \u0026amp;\u0026amp; git add . \u0026amp;\u0026amp; git commit -m \u0026#34;Actualizaci√≥n\u0026#34; \u0026amp;\u0026amp; git push --\u0026gt; todo en uno Google Una cuenta de correo google o el correo que sea va ha hacer falta, para logarse en github, para hacer indexation, posicionamiento, de contacto del sitio, etc\u0026hellip;\nVisual Code Studio https://code.visualstudio.com/\nEsto es lo mejor para perderle el respeto a la programaci√≥n, Cuando est√° instalado y configurado se pueden hacer los post en 1 minuto, y muchas cosas m√°s.\nNetlify https://www.netlify.com/\nSi ya tenemos un nombre de dominio para nuestro sitio de guithub lo podemos sincronizar con netlify. Gratis. Solo se pagar√≠a por el dominio.\nPreparaci√≥n Yo lo que hice fue pillar una plantilla de HUGO, descargarla a una carpeta de mi m√°quina, trabajarla con el Visual Code, subirla a github e ir modificando con mi contenido.\nQue te equivocas y te los cargas todo, pues no pasa nada, pasito para atr√°s y a probar de nuevo, es lo bueno de git.\nLos pasos ser√≠an:\nHUGO : Instalar: Windows / macOS / Linux https://gohugo.io/getting-started/installing/ Git : Instalar: Windows / macOS / Linux https://git-scm.com/downloads Visual Studio Code : Instalar: Windows / macOS / Linux https://code.visualstudio.com/ Configurar: Terminal para usar el bash de git. Instalar extensiones. Y luego ya descargar y trabajar con la plantilla que m√°s te guste de HUGO\nhttps://themes.gohugo.io/\nCada plantilla suele tener su propia documentaci√≥n, su repositorio, su soporte, su equipo de trabajo\u0026hellip;\nEstos videos me vinieron muy bien para empezar.\nHUGO\nhttps://www.youtube.com/playlist?list=PLIcuwIrm4rKe5VEaiD59Ix3AklqYxiG2f Git\nhttps://www.youtube.com/playlist?list=PLIcuwIrm4rKddeIBeA_8HrXE27ZaDZoQE Visual Studio Code\nhttps://www.youtube.com/watch?v=HVzFLw5r2EM\nhttps://www.youtube.com/watch?v=AYbgqmyg7dk Netlify\nhttps://youtu.be/OomyaFBGlyU La p√°gina tambi√©n tiene indexation en google y microsoft, Google Analytics\u0026hellip; ","description":"La Web","id":19,"section":"posts","tags":["github","Visual Studio Code","markdown","cepeda la mora","HUGO","hotspotcepeda","git","netlify"],"title":"La Web","uri":"http://localhost:1313/es/posts/la_web/"},{"content":"Por si alguien se lo quiere montar por su cuenta.\n¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå Material necesario Antena Puedes usar cualquier antena de la lista http://fw.qmp.cat/ que trabaje en 802.11a/ wifi 5GHz\nNosotros empezamos desplegando con NanoStation Loco M5\nPero como cada vez hay m√°s problemas para cargar el qMp ahora usamos como CPE las COMFAST CF-E120A\nhttp://en.comfast.com.cn/index.php?m=content\u0026c=index\u0026a=show\u0026catid=19\u0026id=23\nhttps://openwrt.org/toh/comfast/cf-e120a\nhttp://fw.qmp.cat/experimental/qMp_trunk-Kalimotxo_Comfast_CF-E120A-v3_sysupgrade_20210325-2110.bin\nLas antenas se han comportado muy bien, aguantan frio y calor, hielo, agua, nieve\u0026hellip; estamos a unos 1500 msnm y sin problema.\nRouter neutro Para tener se√±al dentro de casa sirve cualquier router neutro, ya va a depender de nuestras necesidades la capacidad del router.\nSirve cualquier router de operadoras reciclado con firmware OpenWrt. Lista de hardware compatible https://openwrt.org/toh/start Hemos usado tambi√©n los Next 3020 (que admiten qMp) https://openwrt.org/toh/nexx/wt3020 Los Mikrotik hAP lite TC / RB941-2nD-TC https://mikrotik.com/product/RB941-2nD-TC Y los que m√°s por calidad precio TP-Link TL-WR841N https://www.tp-link.com/es/home-networking/wifi-router/tl-wr841n/ (ojo con la versi√≥n) En el mercado de segunda mano siempre se pueden encontrar routers a buen precio. Herramientas Las herramientas necesarias dependen de cada escenario, si vamos a poner el CPE en el tejado se puede usar el m√°stil de la antena de TV, tambi√©n se pueden usar soportes de pared o de ventana con una ventosa. Hay que poner la antena en una posici√≥n en la que se vea f√≠sicamente con al menos otra antena de la red. Se tiene que trabajar con las herramientas adecuadas y con los materiales adecuados, para cableados expuestos a la intemperie hay que usar cable especifico que soporte intemperie, buena crimpadora, conectores RJ-45 fiables \u0026hellip;\nAlta de nodo en la web guifi.net Registro Lo primero hay que crearse un usuario en la web guifi.net en caso de que no lo tengamos ya.\nCrear el nodo Vamos a la web guifi.net, disponibilidad, https://guifi.net/es/node/66713/view/availability y nos fijamos la √∫ltima red que se est√© usado, nos vamos a adue√±ar de la siguiente red (asegurando que est√© libre y que no se est√© usando ya en otro nodo).\nSi no tenemos habilidades de subneting vamos a una web de subneting y ponemos la ip. Por ejemplo en http://jodies.de/\nAddress: 10.0.21.144 00001010.00000000.00010101.10010 000 Netmask: 255.255.255.248 = 29 11111111.11111111.11111111.11111 000 Wildcard: 0.0.0.7 00000000.00000000.00000000.00000 111 =\u0026gt; Network: 10.0.21.144/29 00001010.00000000.00010101.10010 000 (Class A) Broadcast: 10.0.21.151 00001010.00000000.00010101.10010 111 HostMin: 10.0.21.145 00001010.00000000.00010101.10010 001 HostMax: 10.0.21.150 00001010.00000000.00010101.10010 110 Hosts/Net: 6 (Private Internet) Vemos que la primera ip de la siguiente red es la 10.0.21.145/29 esta ser√° la ip de nuestra antena.\nVamos a agregar el nodo, click en Crear contenido y se nos abre el men√∫ de crear contenido, ahora click en Nodo guifi.net.\nPara poner el nombre de la ubicaci√≥n seguimos este criterio:\nmunicipio-callen√∫mero-qmp\nLo siguiente y m√≠nimo indispensable es la ubicaci√≥n, leemos y aceptamos la Licencia y acuerdo de utilizaci√≥n, el Pro-Com√∫n de la Red Abierta, Libre y Neutral \u0026ldquo;XOLN\u0026rdquo; https://guifi.net/es/ProcomunXOLN, Vamos a la zona que nos corresponde 66713-Cepeda la Mora y en el mapa buscamos la ubicaci√≥n en el mapa de nuestro nodo, hacemos click en la posici√≥n y se autocompletaran las coordenadas, tambi√©n se puede poner una descripci√≥n del sitio y obligatoriamente hay que poner la elevaci√≥n que tendr√° la antena en metros, la distancia al suelo.\nHacemos click en GUARDAR y ya est√° creado el nodo!\nLo siguiente es agregar la antena al nodo.\nVamos a A√±adir nuevo dispositivo: y a√±adimos un router.\nEn el router vamos a poner como nombre corto el mismo que pusimos en la ubicaci√≥n del nodo \u0026ldquo;cpd-Fe10-qmp\u0026rdquo;\nRellenamos la seccion \u0026ldquo;Modelo de dispositivo, firmware y direcci√≥n MAC ()\u0026rdquo; , Wireless networking section y Par√°metros de antena Tal cual, con las mismas MAC, igual si usamos NanoStation Loco M5 √≥ Comfast\nPor √∫ltimo fijamos la ip y la red de la antena, la que hab√≠amos previsto en el primer paso, dejo un comentario para acordarme que en realidad es Comfast.\nClick en guardar y salir y ya est√°, ya tenemos presencia en la web guifi.net\nEste es el nodo que hemos creado, https://guifi.net/es/node/129487 es para una amiga y espero ponerlo en producci√≥n muy pronto.\nConfiguraci√≥n de equipos Una vez que tenemos el trasto con el firmware qMp configuramos lo primero el modo de trabajo, nosotros estamos en modo Community.\nAsignamos los par√°metros de configuraci√≥n que tenemos en la web guifi.net\nIP y red, SSID, Canal y codificaci√≥n de pa√≠s.\nCon esto ser√≠a suficiente para que la antena de manera aut√≥noma se conectara con la red y se pusiera a prestar servicio.\nEs conveniente establecer hostname y SSID seg√∫n web guifi.net.\nHay un otro camino para hacer la configuraci√≥n de los equipos, una vez hemos creado el nodo y el equipo en la web guifi.net, se puede descargar y aplicar en en el router un archivo de configuraci√≥n, es un script que nos asignar√° todos los par√°metros de la web a nuestro equipo f√≠sico. Se llama UNSOLOCLICK.\nTambi√©n configurar NTP y Cron con reinicio nocturno para evitar bloqueos.\nPara el router de la wifi interior, la WAN es cliente de DHCP, lo conectaremos directamente al POE de la antena y la LAN ser√° servidor de DHCP por wifi o cable.\nEstablecer password y hacer backup de las configuraciones de los equipos.\nConectar a la red comunitaria Una vez que los equipos est√°n configurados si todo va bien, tendremos visibilidad de la toda la red y salida a internet en unos segundos. No hay que hacer nada m√°s. Es routig es transparente, no necesita configuraci√≥n a menos que se se quiera tomar un camino en concreto.\nAntes de subir al tejado para hacer la instalaci√≥n definitiva es importante tener la seguridad de que el equipo funciona. No cuesta m√°s de 10 minutos hacer una instalaci√≥n provisional para comprobar y nos ahorrar√° muchos quebraderos de cabeza y tiempo.\nNo hay un esquema de red fijo. Depende de las antenas que est√©n operativas. Un nodo se conecta con todos los nodos que que puede alcanzar y a su vez extiende la red dando cobertura, por eso en el mapa de Cepeda no salen las l√≠neas de los enlaces, esto solo aparece en los enlaces punto a punto.\n","description":"Autoprovisi√≥n de nodo qMp","id":20,"section":"posts","tags":["guifi.net","qMp","mesh","cepeda la mora","wifi","autoprovision"],"title":"Autoprovisi√≥n","uri":"http://localhost:1313/es/posts/autoprovision_nodo_qmp/"},{"content":"Voy a intentar explicar como funciona la red en Cepeda, en resumidas cuentas es f√°cil, solo hay que asignar a los nodos √≥ antenas, las ips de la web guifi.net para que darle un poco de orden y la frecuencia de trabajo para que se entiendan, el canal y el pa√≠s en el que est√° trabajando la red comunitaria.\nLos enlaces los negocia el qMp en base a lo que tenga al alcance. Es una red con vida propia.\n¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå Esquema de red No hay un esquema de red fijo. Depende de las antenas que est√©n operativas. Un nodo se conecta con todos los nodos que que puede alcanzar y a su vez extiende la red dando cobertura, por eso en el mapa de Cepeda no salen las l√≠neas de los enlaces, esto solo aparece en los enlaces punto a punto.\nEn la p√°gina de guifi.net lo normal es ver lineas verdes de un nodo a otro para ver los enlaces, pero con la red en mesh las antenas se conectan con todas las antenas que tienen disponibles. Se conectan todas con todas y llevan el tr√°fico por el camino m√°s conveniente seg√∫n protocolo de routing. Los tiempos de respuesta entre nodos son muy buenos, 1 ms. El routig es transparente, es din√°mico y no hay que configurarlo de manera manual a no ser que queramos tomar un camino especial.\nEl qMp tambi√©n est√° pensado para despliegues en caso de emergencia como cat√°strofes usando el modo roaming.\nEs autoconfigurable.\nNosotros en Cepeda estamos en modo community los nodos se ven entre si para poder compartir servicios.\nCuando agregamos un nuevo nodo a la red solo tenemos que configurar manualmente la frecuencia de trabajo, el canal. Para agregar un nodo de manera ordenada especificamos ip, mascara, frecuencia, pa√≠s, hostname y SSID.\nIPs La asignaci√≥n de ip para los nodos se hace seg√∫n https://guifi.net/es/node/66713/view/availability para cada nodo se est√°n reservando 8 ips, 6 host, /29. Cuando se agrega un nodo vamos a la web guifi.net de Cepeda y asignamos la siguiente /29 siguiendo el orden, por defecto al agregar un nodo y solicitar ip se asigna una IP m√°scara /24 de 255 direcciones, esto se puede modificar a m√°scara /29 manualmente.\nEl direccionamiento que estamos usando es 10.0.20.0/23 para los nodos y 10.228.150.0/24 para los servidores y salida internet, seg√∫n el direccionamiento guifi.net https://guifi.net/es/node/66713/view/ipv4\n","description":"Topolog√≠a de la red","id":21,"section":"posts","tags":["guifi.net","qMp","mesh","cepeda la mora","wifi"],"title":"Topolog√≠a","uri":"http://localhost:1313/es/posts/topologia/"},{"content":"El prop√≥sito de este sitio es:\nCompartir la experiencia del proyecto de red comunitaria en Cepeda. Archivar y mantener disponible la documentaci√≥n t√©cnica. Dar las gracias por la ayuda recibida e intentar ayudar al que lo necesite para replicar este proyecto de red comunitaria en otros lugares. Si quiere colaborar en el proyecto de red comunitaria en Cepeda la Mora, en este sitio para aportar contenido, como redactor, traductor o simplemente para expresar su opini√≥n, le invito a contactar mediante el canal de matrix creado para esto y contribuir en github.\nPienso que las telecomunicaciones en nuestra sociedad actual tienen que estar al alcance de todas las personas y por ello las considero un derecho fundamental, como lo son la educaci√≥n o la sanidad p√∫blica. Quiero agradecer a todas esas personas que comparten su experiencia, conocimientos e informaci√≥n para ponerlas al servicio del desarrollo de la humanidad de manera desinteresada.\nTambi√©n quiero a√±adir que no soy programador profesional y que no hago esto con fines lucrativos, solo hago esto porque me gustan las telecomunicaciones y la tecnolog√≠a. Si de alguna manera me equivoco acepte mis m√°s sinceras disculpas y no dude en corregirme. ","description":"Archivo de documentaci√≥n t√©cnica del proyecto de red comunitaria de Cepeda la Mora, √Åvila","id":22,"section":"","tags":null,"title":"Sitio","uri":"http://localhost:1313/es/sitio/"},{"content":"Fotos de Cepeda la Mora, panor√°mica desde el Ayto.\n","description":"Fotos de Cepeda la Mora, panor√°mica desde el Ayto.","id":23,"section":"gallery","tags":null,"title":"Paisaje","uri":"http://localhost:1313/es/gallery/paisaje/"},{"content":"Equipamiento e instalaciones.\n","description":"Fotos de equipamiento de Red","id":24,"section":"gallery","tags":null,"title":"Red","uri":"http://localhost:1313/es/gallery/red/"},{"content":" ¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå Comfast http://en.comfast.com.cn/index.php?m=content\u0026c=index\u0026a=show\u0026catid=19\u0026id=23\nOpenWRT https://openwrt.org/toh/comfast/cf-e120a\nqMp http://fw.qmp.cat/experimental/qMp_trunk-Kalimotxo_Comfast_CF-E120A-v3_sysupgrade_20210325-2110.bin\n","description":"COMFAST CF-E120A v3 modo Bootloader","id":25,"section":"posts","tags":["OpenWRT","qMp","COMFAST","wifi","CF-E120A"],"title":"COMFAST CF-E120A v3 Bootloader","uri":"http://localhost:1313/es/posts/comfast_cf-e120a_v3_bootloader/"},{"content":"BBDD\n1 2 3 4 5 6 docker run -d \\ -v `pwd`/mysql:/var/lib/mysql \\ -v `pwd`/50-server.cnf:/etc/mysql/mariadb.conf.d/50-server.cnf:ro \\ -e MYSQL_ROOT_PASSWORD=mysqlPASWORD \\ ‚Äìname librenms-db \\ mariadb:latest Lanza librenms, se asocia a la BBDD\n1 2 3 4 5 6 7 8 9 10 11 12 13 docker run -d \\ -v `pwd`/data:/data \\ -p 888:80 \\ -e TZ=¬ªEurope/Madrid¬ª \\ ‚Äìlink 0bd3a3993581(id container BBDD):mysql \\ -e POLLER=24 \\ -e DB_TYPE=mysql \\ -e DB_HOST=mysql \\ -e DB_NAME=librenms \\ -e DB_USER=root \\ -e DB_PASS=mysqlPASWORD \\ ‚Äìname librenms \\ seti/librenms Al navegador http://ipserver:888/install.php\n","description":"Instalar LibreNMS en un contenedor de Docker","id":31,"section":"posts","tags":["docker","librenms","debian"],"title":"Librenms Docker install","uri":"http://localhost:1313/es/posts/librenms_docker_install/"},{"content":"https://ralph-ng.readthedocs.io/\nRalph es un sistema de gesti√≥n de activos, DCIM y CMDB simple pero potente para centros de datos y back office.\nCaracter√≠sticas:\nrealizar un seguimiento de las compras de activos y su ciclo de vida sistema de flujo flexible para el ciclo de vida de los activos centro de datos y soporte de back office Visualizaci√≥n dc incorporada Ralph en Docker 1 2 3 docker run -i -t --name=\u0026#34;mysql_ralph\u0026#34; -v /var/lib/mysql -v /home/ralph/.ralph busybox /bin/sh -c \u0026#34;chown root /home/ralph; chown root /home/ralph/.ralph\u0026#34; docker run -P -t -i --volumes-from mysql_ralph allegrogroup/ralph:latest /bin/bash /home/ralph/init.sh docker run -P -p 8000:8000 -t -i --name ralph --mac-address=02:42:ac:11:ff:ff --volumes-from mysql_ralph allegrogroup/ralph:latest Compose\nhttps://ralph-ng.readthedocs.io/en/stable/\nInstall\nInstall docker and docker-compose first.\nCreate compose configuration\nCopy docker-compose.yml.tmpl outside ralph sources to docker-compose.yml and tweak it.\nBuild\nThen build ralph:\n1 docker-compose build To initialize database run:\n1 docker-compose run --rm web /root/init.sh Notice that this command should be executed only once, at the very beginning.\nIf you need to populate Ralph with some demonstration data run:\n1 docker-compose run --rm web ralph demodata Run ralph at the end:\n1 docker-compose up -d Ralph should be accessible at http://127.0.0.1 (or if you are using boot2docker at $(boot2docker ip)). Documentation is available at http://127.0.0.1/docs.\nIf you are upgrading ralph image (source code) run:\n1 docker-compose run --rm web /root/upgrade.sh ","description":"Ralph Docker install","id":32,"section":"posts","tags":["ralph","docker","cdp","isp","gestion"],"title":"Ralph en Docker","uri":"http://localhost:1313/es/posts/ralph/"},{"content":"\nADD NEXTCLOUD REPOSITORY\nAdd the Nextcloud repository in the /etc/apt/sources.d/nextcloud.list\n1 echo \u0026#39;deb http://apt.jurisic.org/debian/ jessie main contrib non-free\u0026#39; \u0026gt;\u0026gt; /etc/apt/sources.list.d/nextcloud.list Install release key of Nextcloud repository:\n1 wget -q http://apt.jurisic.org/Release.key -O- | apt-key add - And run apt-get update to download the list of packages.\n1 apt-get update INSTALL NEXTCLOUD CLIENT\nInstall Nextcloud server with:\n1 apt-get install nextcloud-client INSTALL NEXTCLOUD SERVER\nINSTALL POSTGRESQL AND SETUP NEW USER \u0026amp; DATABASE\nInstall PostgreSQL with:\n1 apt-get install postgresql The PostgreSQL package will install all required dependencies. Choose ¬´y¬ª to start the installation. Add a PostgreSQL database The next step is to create a PostgreSQL database for nextcloud. Login to PostgreSQL on the commandline by running this command: 1 2 su - postgres psql Enter the following commands to create a database user with the name ¬´nextuser¬ª and and a database name ¬´nextcloud¬ª. Replace the word ¬´StorngPasswordHere¬ª with your own password in the commands.\n1 2 3 CREATE DATABASE nextcloud; CREATE USER nextuser WITH PASSWORD \u0026#39;StorngPasswordHere\u0026#39;; GRANT ALL PRIVILEGES ON DATABASE nextcloud to nextuser; Install Nextcloud server with:\n1 apt-get install nextcloud-server When the shell part of the installation is finished, proceed by opening the Nextcloud web installer in your browser. The URL is http://[YOURIP]/nextcloud. In my case the IP is 192.168.1.100 so I enter http://192.168.1.100/nextcloud in my browser to get the installer:\nEnter the desired administrator username and password in the login fields. Please choose a secure password and also a username that is not ¬´admin¬ª or ¬´administrator¬ª might be a good choice to make it less easy for attackers to guess your admin login.\nNextcloud is using sqlite as storage engine by default. This is not a good choice performace wise, so I will choose PostgreSQL as database backend. We have created a PostgreSQL database above, enter the details of that database now:\nUsername: nextuser\nPassword: The password that you have choosen for the database.\nDatabase name: nextcloud\nHostname: localhost\nACCESS NEXTCLOUD WITH SSL (HTTPS)\nThe default installation of Nextcloud is not secured by SSL. To enable SSL in your webserver, run these commands:\n1 2 3 a2enmod ssl a2ensite default-ssl service apache2 restart Now you can access the web interface with https://[YOURIP]/nextcloud. You will probably get a SSL warning, this warning should be accepted. To avoid such warnings, get a free officially signed SSL certificate e.g. from Startssl (or check LetsEncrypt).\nLETSENCRYPT\nSTEP 1 ‚Äî DOWNLOAD THE LET‚ÄôS ENCRYPT CLIENT\nThe first step to using Let‚Äôs Encrypt to obtain an SSL certificate is to install the certbot software on your server. The Certbot developers maintain their own Ubuntu software repository with up-to-date versions of the software. Because Certbot is in such active development it‚Äôs worth using this repository to install a newer Certbot than provided by Ubuntu.\nFirst, add the repository:\n1 sudo add-apt-repository ppa:certbot/certbot You‚Äôll need to press ENTER to accept. Afterwards, update the package list to pick up the new repository‚Äôs package information:\n1 sudo apt-get update And finally, install Certbot from the new repository with apt-get:\n1 sudo apt-get install python-certbot-apache The certbot Let‚Äôs Encrypt client is now ready to use.\nSTEP 2 ‚Äî SET UP THE SSL CERTIFICATE\n1 letsencrypt --apache ","description":"Servidor NEXTCLOUD DEBIAN y CLIENTE","id":33,"section":"posts","tags":["docker","nextcloud","debian","linux"],"title":"NEXTCLOUD DEBIAN SERVER AND CLIENT","uri":"http://localhost:1313/es/posts/nextcloud_debian/"},{"content":"Listar imagenes\n#docker images REPOSITORY TAG IMAGE ID CREATED SIZE borrar imagenes\n#docker images #docker rmi¬†IMAGEN-ID Borra todas la imagenes\n#docker rmi $(docker images -q) Entrar en la consola de una imagen¬†docker run -t -i debian /bin/bash listar contenedores\n#docker ps -a borra contenedor\n#docker rm -f ad287f00940b borra todos los contenedores\n#docker stop $(docker ps -a -q) #docker rm $(docker ps -a -q) borra vol√∫menes huerfanos\n#docker volume rm $(docker volume ls -qf dangling=true) Cada vez que se lanza una imagen con docker run -t -i debian /bin/bash se crea un contenedor asociado, ver con:\n#docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\neb714a2b0b90 1b8740b73d63 \u0026#34;/bin/bash\u0026#34; 3 minutes ago Up 3 minutes jolly_spence 72eabf0db5d5 1b8740b73d63 \u0026#34;/bin/bash\u0026#34; 7 minutes ago Exited (0) 3 minutes ago affectionate_jang dec292ad6ef4 debian \u0026#34;/bin/bash\u0026#34; 21 minutes ago Exited (0) 10 minutes ago suspicious_babbage Para salir del contenedor en el que estamos trabajando y dejarlo funcionando lo hacemos con la teclas\nCtrt+p+q\nPara volver a un contenedor que est√° corriendo\n#docker attach CONTAINER ID Para guardar los cambios en el contenedor donde hemos estado trabajando tecleamos\n#docker commit CONTAINER ID #docker commit dec292ad6ef4 sha256:1b8740b73d63b18d701b2964b8953e33635aeee39b0fa474981fffaf3b451d18 #docker images REPOSITORY TAG IMAGE ID CREATED SIZE \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; 1b8740b73d63 16 minutes ago 116MB debian latest a2ff708b7413 8 days ago 100MB para guardar una imagen de nuestro contenedor\n# docker commit CONTAINER ID pull:TAG # docker commit dec292ad6ef4 jv4nj0/juanjo:test sha256:a5f831c9b55167935094995005c837866499d76ada585629735a28630f496caf para guardar una imagen de nuestro contenedor en nuestro repositorio de docker https://hub.docker.com\n#docker login user /pass de la cuenta docker #docker images REPOSITORY¬†TAG IMAGE ID CREATED SIZE xxxxx/yyyyy test 82efda58c6f¬†12 seconds ago¬†116MB xxxxx/yyyyy latest 19c1de4a47d0 48 seconds ago¬†116MB \u0026lt;none\u0026gt; \u0026lt;none\u0026gt;¬†a5f831c9b551¬†31 minutes ago 116MB \u0026lt;none\u0026gt; \u0026lt;none\u0026gt;¬†1b8740b73d63¬†About an hour ago¬†116MB debian latest a2ff708b7413 8 days ago¬†100MB #docker push IMAGE ID:TAG #docker history imagen entrega todas las modificaciones de la imagen\n#dcoker inspect imagen entrega info de configuracion de de la imagen firma cuando fue creado imegen de la que depende. hostname puertos gw mac Busca imagenes relacionadas\n#docker search nembre de imagen ALMACENAMIENTO\ndata volumen Directorios del host montados en un directorio del docker contenedores Data volumen LOGS docker logs id RUN image docker run -ti -d --name prueba IMAGEN conectar a docker\ndocker exec -ti prueba /bin/bash VOLUMENES\ndocker create docker volume create NOMBRE docker volume ls docker volume rm docker volume ls ej\ndocker create -v /tmp --name datacontainer ubuntu Network9000/#/ docker network connect/disconnect | create | inspect * construir docker: dos vias docker file o docker compose evitar modificar contenedor y guardarlo como imagen se usa un docker file para crear el contenedor nano dockerfile\nFROM nombre /nombre:version MANTAINER xxxxxxx RUN apt-get update etc despues para guardar\ndocker buid -t nombrenuevo/nombrenuevo:version ./ BRIDGE HOST NONE interface equipo fisico solo loopback docker0 ","description":"Gu√≠a Docker","id":35,"section":"posts","tags":["docker","debian"],"title":"Docker","uri":"http://localhost:1313/es/posts/docker/"},{"content":"Gr√°ficas luci-app-vnstat A parte de las gr√°ficas en tiempo real que vienen de serie \u0026ldquo;Realtime Traffic\u0026rdquo; he puesto el \u0026ldquo;VnStat Graphs\u0026rdquo; que almacena en el router gr√°ficas de trafico en las interfaces.\nMas gr√°ficas, CPU, memoria, temperatura\u0026hellip; luci-app-statistics https://echt.guth.so/persistent-traffic-log-and-more-in-openwrt/\nSmart Queue Management¬†luci-app-sqm\nSe configura por luci , sirve para limitar el trafico de las interfaces, se instala con varios script de gesti√≥n de trafico, en este caso se usa para limitar el caudal de salida a internet se puede usar por ejemplo, para reservar un caudal m√°ximo en la wifi y otro en las interfaces f√≠sicas. O para asignar un caudal fijo a las conexiones de la LAN.\nDinamic DNS luci-app-ddns Se puede configurar por luci o en el archivo /etc/config/ddns en este caso va a preguntar la ip p√∫blica a\nhttp://checkip.dyndns.com\ny se la dice a changeip.com donde tenemos configurado un nombre de dominio asociado.\nconfig ddns \u0026#39;global\u0026#39; option date_format \u0026#39;%F %R\u0026#39; option log_lines \u0026#39;250\u0026#39; option allow_local_ip \u0026#39;0\u0026#39; config service \u0026#39;myddns_ipv4\u0026#39; option interface \u0026#39;wan\u0026#39; option enabled \u0026#39;1\u0026#39; option service_name \u0026#39;changeip.com\u0026#39; option domain \u0026#39;dominio.changeip\u0026#39; option username \u0026#39;user_changeip\u0026#39; option password \u0026#39;password_changeip\u0026#39; option use_syslog \u0026#39;2\u0026#39; option use_logfile \u0026#39;1\u0026#39; option ip_source \u0026#39;web\u0026#39; option ip_url \u0026#39;http://checkip.dyndns.com\u0026#39; option force_interval \u0026#39;72\u0026#39; option force_unit \u0026#39;minutes\u0026#39; config service \u0026#39;myddns_ipv6\u0026#39; option update_url \u0026#39;http://[USERNAME]:[PASSWORD]@your.provider.net/nic/update?hostname=[DOMAIN]\u0026amp;myip=[IP]\u0026#39; option domain \u0026#39;yourhost.example.com\u0026#39; option username \u0026#39;your_username\u0026#39; option password \u0026#39;your_password\u0026#39; option use_ipv6 \u0026#39;1\u0026#39; option interface \u0026#39;wan6\u0026#39; option ip_source \u0026#39;network\u0026#39; option ip_network \u0026#39;wan6\u0026#39; Cliente mail ssmtp Para enviar log y alarmas de reinicios. Se configura seg√∫n el enlace y funciona ok, /etc/ssmtp/ssmtp.conf.\nroot=tu_mail@gmail.com hostname=localhost mailhub=smtp.gmail.com:587 FromLineOverride=YES UseTLS=YES USESTARTTLS=YES AuthUser=tu_mail@gmail.com AuthPass=tu_password Y enn /etc/ssmtp/revaliases: # sSMTP aliases # # Format:¬†local_account:outgoing_address:mailhub # # Example: root:your_login@your.domain:mailhub.your.domain[:port] # where [:port] is an optional port number that defaults to 25. root:tu_mail@gmail.com:smtp.gmail.com:587 Script reboot. https://wiki.openwrt.org/doc/techref/initscripts\nPreparamos un script para que se env√≠e un correo de alarma cuando est√© arrancando el router. Seguir los pasos de Automatic email¬†sending.\nScript log diario. Env√≠o de ficheros con mpack\nmaillog.txt¬†mpack maillog.txt tu_mail@gmail.com Subject: asunto CRON Programar que nos env√≠e un correo con el log diario.\n","description":"Configuraciones y gesti√≥n de tr√°fico en OpenWRT","id":36,"section":"posts","tags":["OpenWRT"],"title":"Gesti√≥n OpenWRT","uri":"http://localhost:1313/es/posts/gestion_openwrt/"},{"content":"Configuraci√≥n en MikroTik Configuraci√≥n en servidor debian jessie: # apt-get update \u0026amp;\u0026amp; apt-get upgrade wget http://apt-stable.ntop.org/14.04/all/apt-ntop-stable.deb sudo dpkg -i apt-ntop-stable.deb sudo apt-get update sudo apt-get install nprobe config nProbe sudo nano /etc/nprobe/nprobe-none.conf --zmq=\u0026#34;tcp://127.0.0.1:1234\u0026#34; --collector-port=5556 -n=none -i=none sudo touch /etc/nprobe/nprobe-none.start sudo service nprobe start Instalacion de ntopng\nwget http://apt-stable.ntop.org/14.04/all/apt-ntop-stable.deb sudo dpkg -i apt-ntop-stable.deb apt-get install topng config ntopng nano /etc/ntopng/ntopng.conf -G=/var/run/ntopng.pid -i tcp://127.0.0.1:1234 sudo touch /etc/ntopng/ntopng.start sudo service ntopng start reboot DOCKER docker run -d --name nprobe --net=host xdrum/nprobe nprobe --collector-port 5556 --zmq tcp://*:1234 -i none docker run -d --name ntopng --net=host -p 3000:3000 vostro/ntopng ntopng -i tcp://127.0.0.1:1234 ","description":"Configuracion de netflow en MikroTik servidor Debian nprobe","id":37,"section":"posts","tags":["mikrotik","nprobe","debian","netflow"],"title":"MikroTik netflow","uri":"http://localhost:1313/es/posts/mikrotik_netflow/"},{"content":"SERVIDOR Agregar en\n# nano /etc/ssh/sshd_config X11Forwarding yes # service ssh restart CLIENTE $ ssh -X -Y user@maquina -p puerto aplicaci√≥n ","description":"Como ejecutar aplicaciones por ssh de manera remota","id":38,"section":"posts","tags":["debian","linux","ssh","gestion"],"title":"Ejecutar aplicaci√≥n por ssh","uri":"http://localhost:1313/es/posts/ssh_remote_comand/"},{"content":" http://wiki.mikrotik.com/wiki/Manual:CRS_examples para una RB850\n/interface ethernet set ether3 master-port=ether2 set ether4 master-port=ether2 /interface ethernet switch vlan add ports=ether2,ether3 switch=switch1 vlan-id=200 add ports=ether2,ether4 switch=switch1 vlan-id=300 /interface ethernet switch port set ether2 vlan-mode=secure vlan-header=add-if-missing set ether3 vlan-mode=secure vlan-header=always-strip default-vlan-id=200 set ether4 vlan-mode=secure vlan-header=always-strip default-vlan-id=300 ","description":"Configuracion de vlan en nodo MikroTik","id":39,"section":"posts","tags":["mikrotik","guifi.net"],"title":"Nodo MikroTik vlan","uri":"http://localhost:1313/es/posts/mikrotik_nodo/"},{"content":" http://ca.wiki.guifi.net/wiki/Gestio_de_antenes_ubnt_a_trav%C3%A9s_de_VLAN_de_gesti%C3%B3 Lo que queremos es mantener gesti√≥n de las antenas de manera directa. En los equipos Ubiquiti se permiten hacer vlans, desde la version 5.5.\nSe define una VLAN de gesti√≥n: vlan666\nSe define una VLAN de tr√°fico general: vlan10\nSe configura la antena en bridge, se le a√±ade dos interfaces VLANs, y se configura la IP manual en la LAN0.X X = vlan ID (en nuestro caso 666)\nSe configura la VLAN de gesti√≥n a la RB: a√±adir VLAN a la interfaz de la antena\nSe a√±ade la VLAN de gesti√≥n de una o todas las antenas al bridge WLAN / Lan. De esta manera podremos darle direccionamiento 10.x de gesti√≥n del supernodo\nEste modelo lleva una ventaja muy interesante, y es que podemos configurar un servidor DHCP para todo el management de las antenas, ya que las integramos al bridge WLAN / LAN\n","description":"Configurar vlan de gesti√≥n en Ubiquiti","id":40,"section":"posts","tags":["ubiquiti","gesti√≥n"],"title":"Configurar vlan de gesti√≥n en Ubiquiti","uri":"http://localhost:1313/es/posts/vlan_gestion_ubiquiti/"},{"content":" https://github.com/brndnmtthws/conky # apt-get install conky conky-all # apt-get install curl lm-sensors hddtemp Para autoarranque agregar en programas al inicio:\nconky p -15\nstart conky -d stop\npkill conky restart\npkill -HUP conky Config nano /etc/conky/conky.conf\nbackground yes font Zekton:size=8 xftfont Zekton:size=8 use_xft yes xftalpha 0.4 update_interval 1.0 total_run_times 0 own_window yes own_window_type override own_window_transparent yes own_window_hints undecorated,below,skip_taskbar,skip_pager double_buffer yes draw_shades no draw_outline no draw_borders no draw_graph_borders no minimum_size 220 5 maximum_width 220 default_color ffffff default_shade_color black default_outline_color black alignment top_right gap_x 10 gap_y 90 no_buffers yes cpu_avg_samples 2 override_utf8_locale no uppercase no # set to yes if you want all text to be in uppercase use_spacer no TEXT ${font Zekton:style=Bold:pixelsize=42}${alignc}${time %H:%M:%S}${font Zekton:size=8} lenovo T430s ${hr 1 } Hostname: $alignr$nodename IP: $alignr${addr eth0} Kernel: $alignr$kernel Uptime: $alignr$uptime Processes: ${alignr}$processes ($running_processes running) Load: ${alignr}$loadavg CPU0 ${alignc} ${freq}MHz ${alignr}(${cpu cpu0}%) ${cpubar cpu0 4} CPU1 ${alignc} ${freq}MHz ${alignr}(${cpu cpu1}%) ${cpubar 4 cpu1} CPU2 ${alignc} ${freq}MHz ${alignr}(${cpu cpu2}%) ${cpubar 4 cpu2} CPU3 ${alignc} ${freq}MHz ${alignr}(${cpu cpu3}%) ${cpubar 4 cpu3} CPU AVG ${cpugraph} RAM ${alignr}$mem / $memmax ($memperc%) ${membar 4} SWAP ${alignr}$swap / $swapmax ($swapperc%) ${swapbar 4} Maximos de CPU $alignr CPU% MEM% ${top name 1}$alignr${top cpu 1}${top mem 1} ${top name 2}$alignr${top cpu 2}${top mem 2} ${top name 3}$alignr${top cpu 3}${top mem 3} Maximos de MEM $alignr CPU% MEM% ${top_mem name 1}$alignr${top_mem cpu 1}${top_mem mem 1} ${top_mem name 2}$alignr${top_mem cpu 2}${top_mem mem 2} ${top_mem name 3}$alignr${top_mem cpu 3}${top_mem mem 3} HDD FREE ${hr 1}${color} / : ${alignr}${fs_free /} / ${fs_size /} ${fs_bar 4 /} eth0 ${hr 1}${color} Down ${downspeed eth0} k/s ${alignr}Up ${upspeed eth0} k/s ${downspeedgraph eth0 25,107} ${alignr}${upspeedgraph eth0 25,107} Total ${totaldown eth0} ${alignr}Total ${totalup eth0} wlan0 ${hr 1}${color} Intensidad WIFI $alignr ${wireless_link_qual wlan0}% Down ${downspeed wlan0} k/s ${alignr}Up ${upspeed wlan0} k/s ${downspeedgraph wlan0 25,107} ${alignr}${upspeedgraph wlan0 25,107} Total ${totaldown wlan0} ${alignr}Total ${totalup wlan0} BATERIA${hr 1}${color} ${battery_bar BAT0} ${font Arial:style=Bold:size=12} ","description":"Instalaci√≥n de conky system monitor en Debian","id":41,"section":"posts","tags":["debian","conky","linux"],"title":"Instalar conky en Debian","uri":"http://localhost:1313/es/posts/debian_conky/"},{"content":" https://github.com/LibVNC/x11vnc Instalamos servidor:\n$ sudo apt-get update $ sudo apt-get install x11vnc Poner el password:\n$ x11vnc -storepasswd Enter VNC password: ********* Verify password: ********* Write password to /home/USUARIO/.vnc/passwd? [y]/n y Password written to: /home/USUARIO/.vnc/passwd Opciones para lanzar el servidor en\n$ man x11vnc : -forever : Mantiene el servidor en funcionamiento despu√©s de la sesion. -rfbauth /home/USUARIO/.vnc/passwd : Para que pida el password de la ruta que queramos. -usepw : pide el password default ~/.vnc/passwd -rfbport 5900 : Indicamos el puerto de trabajo, el que queramos, si no ponemos nada es el :5900 -display :0 : Display independiente del puerto 0 1 2 3 4 5 -bg : Lanza el server en background, segundo plano. -auth : indicamos el gestor de escritorio que queremos usar, si no lo sabemos lanzar: $ x11vnc -findauth Opciones para arrancar el servidor x11vnc: - Entrar por SSH y lanzarlo para una vez o para que se quede abierto.\nEjemplo para conectarse usando cliente vinagre, remmina, tincvnc \u0026hellip; En el servidor ejecutamos:\n# iptables -A INPUT -p tcp -s 0.0.0.0/0 --dport 5900 -j ACCEPT¬†# Abrimos el puerto si fuera necesario x11vnc -findauth¬†# Buscamos la ruta del XAUTHORITY XAUTHORITY=/var/lib/xdm/authdir/authfiles/A:0-w1exWB Tiene que haber escritorio para tener escritorio remoto de algo\u0026hellip;\napt-get install xfce4 xorg si no arranca el entorno gr√°fico arrancar con startx comprobar con\necho $DISPLAY localhost:10.0 en el caso de no tener¬†.Xauthority entrar un par de veces por SSH¬†$ ssh -X myname@somehost¬†y se generar√°\nUSUARIO@Cldy1:/home/USUARIO# xauth xauth: file /USUARIO/.Xauthority does not exist Using authority file /USUARIO/.Xauthority xauth\u0026gt; $xauth Using authority file /home/pi/.Xauthority empezamos,\nx11vnc -bg -usepw -auth /var/lib/xdm/authdir/authfiles/A:0-w1exWB -display :0 # Arrancamos el servicio en display :0 que corresponde con puerto 5900 # netstat -tulpn # Comprobar si el servicio est√° arrancado en el puerto Otro ejemplo\nx11vnc -bg -usepw -auth /var/lib/xdm/authdir/authfiles/A:0-53cTfA -display :0 Ejemplo para conectarse con un navegador web https, con Java, (con OpenJRE funciona ok).\nx11vnc -rfbport 5901 -http_ssl -svc -usepw -env FD_GEOM=1280x720 -loop -auth /var/lib/xdm/authdir/authfiles/A:0-53cTfA -display :0 Otros ejemplos:\nx11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1280x720 -auth guess -loop --display :0 x11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1599x1196 -auth guess -loop --display :0 -o /var/log/x11vnc.log x11vnc -rfbport 5901 -forever -http_ssl -svc -usepw -env FD_GEOM=1599x1196 -loop -auth /usr/bin/xauth -display :0 x11vnc -rfbport 33334 -http_ssl -svc -usepw -clip 1280x720+0+0 -scale 1280x720 -loop -auth /var/lib/xdm/authdir/authfiles/A:0-Da2eQG -display :0 Java SSL viewer URL:¬†https://ip:5901/¬†(single port) Java SSL viewer URL:¬†http://ip:5801/ Comprobar si el servicio abre el puerto con:\n# netstat -tulpn Podemos ver el log en: /var/log/upstart/x11vnc.log\n","description":"Instalaci√≥n de servidor de escritorio remoto en Debian con x11vnc","id":42,"section":"posts","tags":["debian","x11vnc","linux"],"title":"Escritorio remoto debian con x11vnc","uri":"http://localhost:1313/es/posts/debian_escritorio_remoto/"},{"content":"Unninstall DESINSTALACION TOTAL de todo lo relacionado con Java, Sun, Oracle, OpenJDK, IcedTea plugins, GIJ\ndpkg-query -W -f=\u0026#39;${binary:Package}\\n\u0026#39; | grep -E -e \u0026#39;^(ia32-)?(sun|oracle)-java\u0026#39; -e \u0026#39;^openjdk-\u0026#39; -e \u0026#39;^icedtea\u0026#39; -e \u0026#39;^(default|gcj)-j(re|dk)\u0026#39; -e \u0026#39;^gcj-(.*)-j(re|dk)\u0026#39; -e \u0026#39;^java-common\u0026#39; | xargs sudo apt-get -y remove sudo apt-get -y autoremove Purge config files:\ndpkg -l | grep ^rc | awk \u0026#39;{print($2)}\u0026#39; | xargs sudo apt-get -y purge Remove Java config and cache directory:\nsudo bash -c \u0026#39;ls -d /home/*/.java\u0026#39; | xargs sudo rm -rf Remove manually installed JVMs:\nsudo rm -rf /usr/lib/jvm/* Remove Java entries, if there is still any, from the alternatives:\nfor g in ControlPanel java java_vm javaws jcontrol jexec keytool mozilla-javaplugin.so orbd pack200 policytool rmid rmiregistry servertool tnameserv unpack200 appletviewer apt extcheck HtmlConverter idlj jar jarsigner javac javadoc javah javap jconsole jdb jhat jinfo jmap jps jrunscript jsadebugd jstack jstat jstatd native2ascii rmic schemagen serialver wsgen wsimport xjc xulrunner-1.9-javaplugin.so; do sudo update-alternatives --remove-all $g; done Search for possible remaining Java directories: sudo updatedb sudo locate -b \u0026#39;\\pack200\u0026#39; If the command above produces any output like /path/to/jre1.6.0_34/bin/pack200 remove the directory that is parent of bin, like\nthis: sudo rm -rf /path/to/jre1.6.0_34. Install OpenJRE\nsudo apt-get install openjdk-7-jre IcedTea Plugin\nsudo apt-get install icedtea-plugin Ver que java est√° activo:\n# update-alternatives --config java Existen 2 opciones para la alternativa java (que provee /usr/bin/java). Selecci√≥n Ruta Prioridad Estado ------------------------------------------------------------ 0 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1071 modo autom√°tico * 1 /usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java 1071 modo manual 2 /usr/lib/jvm/java-8-oracle/jre/bin/java 1001 modo manual Pulse \u0026lt;Intro\u0026gt; para mantener el valor por omisi√≥n [*] o pulse un n√∫mero de selecci√≥n: 0 # java -version java version \u0026#34;1.7.0_131\u0026#34; OpenJDK Runtime Environment (IcedTea 2.6.9) (7u131-2.6.9-2~deb8u1) OpenJDK 64-Bit Server VM (build 24.131-b00, mixed mode) Cambiar prioridad\n# update-alternatives --install \u0026#34;/usr/bin/javac\u0026#34; \u0026#34;javac\u0026#34; \u0026#34;/usr/lib/jvm/java-8-oracle/jre/bin/java\u0026#34; 1001 update-alternatives: utilizando /usr/lib/jvm/java-8-oracle/jre/bin/java para proveer /usr/bin/javac (javac) en modo autom√°tico ``` ","description":"Instalaci√≥n de Java en Linux Debian 8","id":43,"section":"posts","tags":["debian","fotos"],"title":"Instalaci√≥n de Java en Linux Debian","uri":"http://localhost:1313/es/posts/instalar_java_linux_debian/"},{"content":" ","description":"Configuraci√≥n LAN WAN en NanoStation M5 para GW internet","id":44,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","mesh","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 GW","uri":"http://localhost:1313/es/posts/nanostationm5_cliente_qmp/"},{"content":"Pasos para usar una antena Ubiquiti Nano Station en una red qmp con Lan y Wan. Las configuraciones de Vlan las vamos a hacer desde el men√∫ de administraci√≥n en el apartado de switch e interfaces.\nLa Lan es servidor de dhcp, con la configuraci√≥n inicial tiene la ip 172.30.22.1/24 user/password root/13f y nos proporciona una IP de ese rango al conectarnos. Tenemos conectado en el POE que va a la boca Main del router y viene como la Vlan1\nLa Wan es cliente de dhcp, conectamos la boca Secondary a un servidor de dhcp como nuestro router domestico de ASDL o Fibra.¬†Vamos a crear una nueva Vlan2 y asociarla a la Wan.\nPartimos de la configuracion inicial que tenemos nada mas instalar el firmware de qmp.cat\nqMp-Guifi_3.2-Clearance_Ubiquiti_NanoStation-M5-XW_sysupgrade_20151026-1823\nModificaci√≥n en switch.\nPara que funcione la Wan no vale con agregar una nueva Vlan a eth0.2 al port 1,\nSolo me funciona con normalidad cuando se elimina la Vlan 12 y se agrega una nueva Vlan 2 , revisar la parte de interfaces y firewall. Untagged.\nModificaci√≥n de interfaces.\nAsegurarse que la interface se est√° conectando a internet por la interface f√≠sica Secondary eth0.2 = Vlan 2\n","description":"Configuraci√≥n qMp para antena gateway con salida a internet","id":45,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 gateway internet","uri":"http://localhost:1313/es/posts/nanostationm5_gw/"},{"content":" La idea es poner un ap en 2.4 Ghz con un portal cautivo para tratar de dar a conocer el proyecto y ver si se anima alguien en el barrio a compartir la salida a internet. Antes de empezar vamos a configurar los servicios b√°sicos.\nDNS Para sacarle partido a la RouterBoard se configura una cache DNS\n/ip dns set allow-remote-requests=yes cache-size=4096KiB servers=91.239.100.100,89.233.43.71 Rechaza peticiones dns externas:\n/ip firewall filter add chain=input in-interface=ether1 protocol=udp dst-port=53 action=drop add chain=input in-interface=ether1 protocol=tcp dst-port=53 action=drop Y en el firewall una nueva redirecci√≥n interna del puerto 53\n/ip firewall nat add action=redirect chain=dstnat comment=\u0026#34;Cacheo de DNS\u0026#34; dst-port=53 protocol=udp to-ports=53 NTP /system ntp client set enabled=yes primary-ntp=130.206.0.1 secondary-ntp=130.206.3.166 USB Como vamos a montar un proxy que lo que hace b√°sicamente es cachear las conexiones y almacenarlas para entregar inmediatamente, vamos a preparar el espacio de almacenamiento, en este caso un pendrive de 1Gb conectado a una RB951.\nPara que la RB se entienda con la memoria USB tenemos que formatearlo desde la propia RB, en Fat32, con ext3 no funcionara. Conectamos nuestro pendrive. System-\u0026gt;Disks\nProxy Ahora vamos a preparar la parte del proxy en IP-\u0026gt;Web Proxy, con el Proxy ya trabajando lo vamos a hacer transparente, pasamos las peticiones del puerto 80 al 8080.\nIP-\u0026gt;Firewall pesta√±a de NAT Nueva regla\nREDIRECCI√ìN DE PETICIONES :80 AL :8080 (puerto del proxy cache TRANSPARENTE), SOLO PARA ether5 (puerto de captaci√≥n del hotspot)\nProxy cache:\n\u0026gt; ip proxy print enabled: yes src-address: :: port: 8080 anonymous: no parent-proxy: :: parent-proxy-port: 0 cache-administrator: webmaster max-cache-size: unlimited max-cache-object-size: 2048KiB cache-on-disk: yes max-client-connections: 600 max-server-connections: 600 max-fresh-time: 3d serialize-connections: no always-from-cache: no cache-hit-dscp: 4 cache-path: disk1 /ip proxy set cache-on-disk=yes cache-path=disk1 enabled=yes Y en el firewall una nueva redirecci√≥n del puerto 80 al 8080\n/ip firewall nat add action=redirect chain=dstnat dst-port=80 protocol=tcp to-ports=8080 Hotspot Generamos el hotspot IP -\u0026gt; HOTSPOT\nYo antes de hacer el SETUP del hotspot asigno IP a la interface de captaci√≥n, en este caso ether5, le he asignado la ip 192.168.100.1/24 que ser√° la gateway de los clientes del hotspot. Creo un pool por ejemplo de 192.168.100.100-192.168.100.200 y un servidor DHCP que use el pool que hemos creado.\nDespu√©s en el wizard del hotspot, solo hay que pulsar en todo siguiente, cuando nos pregunta el nombre del DNS ponemos \u0026ldquo;guifi.net_Acceso_Abierto\u0026rdquo; ser√° la direcci√≥n que aparezca en la p√°gina de redirecci√≥n, el archivo login.html que encontraremos en FILES.\nCuando termina el wizard del hotspot vemos que se han creado una serie de regla en IP-\u0026gt;Firewal Filter Rules, Nat y en m√°s sitios\u0026hellip;\nTener en cuenta que si el usuario no pasa por el portal cautivo no va a tener salida a internet.\nSecurizar Es conveniente seguir las indicaciones de seguridad.\nhttps://wiki.mikrotik.com/wiki/Manual:Securing_Your_Router\nhttps://hotspotcepeda.github.io/es/posts/mikrotik_seguridad_basico/\n","description":"Un hotspot es una buena manera para encontrar alguien con quien compartir salida a internet","id":46,"section":"posts","tags":["mikrotik","hotspot","wifi"],"title":"Hotspot MikroTik con proxy transparente","uri":"http://localhost:1313/es/posts/mikrotik_hotspot/"},{"content":"Antes de instalar: Llevar los equipos configurados. Si a la hora de poner en funcionamiento el enlace surgen problemas: como que el equipo no enciende, mala transferencia de datos\u0026hellip; ser√° m√°s f√°cil localizar aver√≠as en el cableado, conectores y alimentaci√≥n, POE.\nPlanificar el enlace: Si es posible hacer una primera visita para saber como planificar la instalaci√≥n y saber que material puede hacer falta, cableados, herramienta que tenemos que llevar, accesos a zonas comunes bajo llave, etc\u0026hellip; tomar notas y fotos, ortofotos, l√≠nea de visi√≥n directa entre antenas, referencias para orientar las anteas.\nDocumentar Es muy importante mantener la documentaci√≥n actualizada durante toda la vida del enlace.\nEn la instalaci√≥n: Alimentaci√≥n el√©ctrica. Mantener el uso de buenas practicas trabajado con electricidad.\nCajas estancas, diferenciales de rearme autom√°tico en instalaciones que tienen cortes en el suministro, UPS como estabilizadores de corriente, regletas de corriente con protectores de sobrecarga.\nCableado. Usar cable y conectores de buena calidad y adaptado a las necesidades de la instalaci√≥n.\nCables para interior/exterior, FTP, TFTP, Cat.5, Cat6. Rotular conectores.\nTiempo. Si es posible calcular el tiempo necesario y limitarse a llevar a cavo la instalaci√≥n. Hay instalaciones que se complican y se alargan, algo que nos¬†puede ahorrar mucho tiempo es volver al d√≠a siguiente con una nueva estrategia.\nSeguridad. Mantener buenas pr√°cticas en todo, no correr, cuidado con los trabajos en altura, precauciones con las herramientas el√©ctricas\u0026hellip;\nFactor humano. Mantener un horario planificado con descansos cada 2 horas nos ayuda a mantener la atenci√≥n y el control en el trabajo.\nMantener buenas relaciones con todos los actores de la instalaci√≥n. \u0026ldquo;CCCC\u0026rdquo;: Conserjes, Clientes, Contactos, Curiosos\u0026hellip;\nEn explotaci√≥n: Monitores de red. SNMP, netflow, ICMP. Mantener control de caudales y tr√°fico de datos.\nMantenimiento. Comprobar con periodicidad, mantenimiento preventivo: herrajes, √≥xidos, cableados, orientaciones, torres y vientos.\nPrestar especial atenci√≥n durante la primera etapa de la instalaci√≥n.\nDocumentar. Documentar, documentar y documentar.\nOtros recursos. BUENAS PRACTICAS EN TORRES Y EMPLAZAMIENTOS DE TELECOMUNICACIONES Parece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nRadioenlaces anal√≥gicos y digitales: Una buena soluci√≥n cuando no es posible tender cables http://fibraoptica.blog.tartanga.eus/2014/02/27/enlaces-de-microondas-una-buena-solucion-cuando-no-es-posible-tender-un-cable/\nMejores Pr√°cticas para un Enlace Inal√°mbrico con Ubiquiti ","description":"A tener en cuenta para los despliegues de radio","id":47,"section":"posts","tags":["guifi.net","hotspot","mikrotik","cepeda la mora","Ubiquiti"],"title":"Buenas practicas en la realizacion de tus radioenlaces","uri":"http://localhost:1313/es/posts/buenas_practicas_radioenlaces/"},{"content":"Muy f√°cil, para tener la vista en miniatura de archivos de imagen NEF, RAW y dem√°s en Nautilus primero instalamos el UFRaw, si es que no lo tenemos ya:\n# apt-get update # apt-get install ufraw Ahora generamos este archivo /usr/share/thumbnailers/raw.thumbnailer\n# nano /usr/share/thumbnailers/raw.thumbnailer Copiamos este contenido en el archivo:\n[Thumbnailer Entry] Exec=/usr/bin/ufraw-batch --embedded-image --out-type=png --size=%s %u --overwrite --silent --output=%o MimeType=image/x-3fr;image/x-adobe-dng;image/x-arw;image/x-bay;image/x-canon-cr2;image/x-canon-crw;image/x-cap;image/x-cr2;image/x-crw;image/x-dcr;image/x-dcraw;image/x-dcs;image/x-dng;image/x-drf;image/x-eip;image/x-erf;image/x-fff;image/x-fuji-raf;image/x-iiq;image/x-k25;image/x-kdc;image/x-mef;image/x-minolta-mrw;image/x-mos;image/x-mrw;image/x-nef;image/x-nikon-nef;image/x-nrw;image/x-olympus-orf;image/x-orf;image/x-panasonic-raw;image/x-pef;image/x-pentax-pef;image/x-ptx;image/x-pxn;image/x-r3d;image/x-raf;image/x-raw;image/x-rw2;image/x-rwl;image/x-rwz;image/x-sigma-x3f;image/x-sony-arw;image/x-sony-sr2;image/x-sony-srf;image/x-sr2;image/x-srf;image/x-x3f; Salvar el archivo y ya est√°.\n","description":"Para ver una foto en miniatura de los archivos raw y nef en el navegador","id":48,"section":"posts","tags":["debian","fotos"],"title":"VISTA EN MINIATURA DE ARCHIVOS DE IMAGEN NEF, RAW","uri":"http://localhost:1313/es/posts/imagen_raw_nef_miniatura/"},{"content":"Script /system/script new and paste: # Written by Sam Norris, ChangeIP.com # Copyright ChangeIP.com 2009 # For support send mail to Support@ChangeIP.com # # 2009-06-22 RouterOS 3.25 Tested # 2009-10-05 RouterOS 4.01rc1 Tested # # OVERVIEW:¬†% #¬†This script will update a ChangeIP.com dynamic dns hostname #¬†with an ip address located directly on an interface. #¬†% # NOTES:¬†% #¬†IF THIS SCRIPT DOES NOT PRODUCE ANY OUTPUT PLEASE COPY AND PASTE IT #¬†AGAIN.¬†THERE PROBABLY IS A LINE BREAK IN THE WRONG PLACE! Once you #¬†have created this script and tested that it works by running it #¬†manually you can schedule it to run every few minutes. #¬†% # CONFIGURATION FIELD DEFINITIONS: #¬†ddnsuser:¬†Enter your ChangeIP.com user id. #¬†ddnspass:¬†Enter your ChangeIP.com password. #¬†ddnshost:¬†Enter the hostname (www.example.com) to update. #¬†ddnsinterface:¬†Enter an interface name to watch - case sensative. #¬†% #¬†% #¬†% #¬†% #¬†%¬†%¬†% #¬†%¬†%¬†% #¬†% % % #¬†% # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ # EDIT YOUR DETAILS / CONFIGURATION HERE # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ :global ddnsuser \u0026#34;user\u0026#34; :global ddnspass \u0026#34;pass\u0026#34; :global ddnshost \u0026#34;ddnsname.net\u0026#34; # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ # END OF USER DEFINED CONFIGURATION # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ :global ddnssystem (\u0026#34;mt-\u0026#34; . [/system package get [/system package find name=system] version] ) /tool fetch url=\u0026#34;http://myip.dnsomatic.com/\u0026#34; mode=http dst-path=mypublicip.txt :global ddnsip [file get mypublicip.txt contents ] :global ddnslastip :if ([ :typeof $ddnslastip ] = \u0026#34;nothing\u0026#34; ) do={ :global ddnslastip 0.0.0.0/0 } :if ([ :typeof $ddnsip ] = \u0026#34;nothing\u0026#34; ) do={ :log info (\u0026#34;DDNS: No ip address present on contents , please check.\u0026#34;) } else={ :if ($ddnsip != $ddnslastip) do={ :log info \u0026#34;DDNS: Sending UPDATE!\u0026#34; :log info [ :put [/tool dns-update name=$ddnshost address= $ddnsip key-name=$ddnsuser key=$ddnspass ] ] :log info $ddnsip :global ddnslastip $ddnsip } else={ :log info \u0026#34;DDNS: No changes necessary.\u0026#34; } } Schedule /system/schedule Interval: 00:10:00 ","description":"Script para renovar IP DDNS MikroTik","id":49,"section":"posts","tags":["mikrotik","debian","ddsns"],"title":"DDNS Change IP MikroTik script","uri":"http://localhost:1313/es/posts/ddns_change_ip_script_mikrotik/"},{"content":" https://aacable.wordpress.com/2011/11/29/howto-save-mikrotik-logs-to-remote-syslog-server/\nConviene tener los trastos en hora, configure NTP en todas sus m√°quinas. Cliente Mikrotik Con¬†ip 10.38.15.10\n/system logging action set 0 memory-lines=100 set 1 disk-file-count=30 disk-file-name=MT-log-zaib disk-lines-per-file=500 set 3 remote=10.38.15.3 # 10.38.15.3 ip del servidor syslog-ng :514 default port /system logging add action=remote topics=critical add action=remote topics=error add action=remote topics=info add action=remote topics=warning # registro remoto de lo que se quiera Cliente Ubiquiti Con ip 10.38.15.1\nServidor IP 10.38.15.3 servidor donde se almacenan los LOG\n#apt-get install syslog-ng #mkdir /var/log/mikrotik #mkdir /var/log/ubnt en nano /etc/syslog-ng/syslog-ng.conf agregar y despu√©s reiniciar con \u0026ldquo;service syslog-ng restart\u0026rdquo;\nAccept connection on UDP source s_net { udp (); }; # MIKROTIK ########### esto genera de manera autom√°tica un fichero tipo \u0026#34;mikrotik.2016.11.01.log\u0026#34; # Add Filter to add our mikrotik filter f_mikrotik { host( \u0026#34;10.38.15.10\u0026#34; ); }; # Add destination file where logs will be stored #destination df_mikrotik { file(\u0026#34;/var/log/mikrotik.log\u0026#34;); }; log { source ( s_net ); filter( f_mikrotik ); destination ( df_mikrotik ); }; destination df_mikrotik { file(\u0026#34;/var/log/mikrotik/mikrotik.${YEAR}.${MONTH}.${DAY}.log\u0026#34; # template(\u0026#34;${HOUR}:${MIN}:${SEC} ${HOST} ${MSG} ${MSG}\\n\u0026#34;) template-escape(no)); }; # UBNT ########### esto genera de manera autom√°tica un fichero tipo \u0026#34;ubnt.2016.11.01.log\u0026#34; # Add Filter to add our ubnt filter f_ubnt { host( \u0026#34;10.38.15.1\u0026#34; ); }; # Add destination file where logs will be stored #destination df_ubnt { file(\u0026#34;/var/log/ubnt.log\u0026#34;); }; log { source ( s_net ); filter( f_ubnt ); destination ( df_ubnt ); }; destination df_ubnt { file(\u0026#34;/var/log/ubnt/ubnt.${YEAR}.${MONTH}.${DAY}.log\u0026#34; # template(\u0026#34;${HOUR}:${MIN}:${SEC} ${HOST} ${MSG} ${MSG}\\n\u0026#34;) template-escape(no)); }; Ver log live tail -f /var/log/mikrotik/mikrotik*.log ","description":"Guardar log de MikroTik y Ubiqiti en servidor remoto Linux Debian","id":51,"section":"posts","tags":["mikrotik","debian","linux","log","Ubiquiti"],"title":"Guardar log de MikroTik y Ubiqiti en servidor","uri":"http://localhost:1313/es/posts/log_remoto_syslog-ng/"},{"content":"Instalaci√≥n # apt-get install snmp snmpd snmp-mibs-downloader Configurac√≥n Cambiar en nano /etc/snmp/snmpd.conf:\nagentAddress udp:127.0.0.1:161 ... rocommunity public default -V systemonly por:\nagentAddress udp::161 ... rocommunity public cambiar en nano /etc/snmp/snmp.conf:\nmibs : por:\n#mibs : Reiniciar snmpd\n# service snmpd restart Comprobar: snmpwalk -v 2c -c public IP ","description":"Configuracion de cliente SNMP en linux Debian","id":52,"section":"posts","tags":["debian","jessie","SNMP","linux"],"title":"Cliente SNMP linux","uri":"http://localhost:1313/es/posts/cliente_snmp_linux/"},{"content":" http://gregsowell.com/classes/mtk-security/GregSowell-mikrotik-security.pdf\nSi el router est√° conectado a internet puedes tener seguro que lo van a intentar dominar de todas las maneras posibles. System -\u0026gt; Password Poner una contrase√±a segura,¬†con PassGen se pueden generar passwords seguras, pero no olvidar !\nSystem -\u0026gt; Users Es buena idea cambiar el nombre del usuario administrador, Cambiar admin por lo que sea. Los zombis est√°n todo el santo d√≠a dando la matraca y probando con usuarios y password default. no olvidar !\nIp -\u0026gt; Services Aqu√≠ es donde se abren y cierran las puertas de gesti√≥n de la RB. Es recomendable deshabilitar todo lo que no se use y personalizar lo que se use.\nEs buena idea cambiar el puerto por defecto del winbox :8291 a otro puerto no olvidar !.\nPara invocar al equipo desde winbox por otro puerto¬†IP_DE_LA_RB:PUERTO..\nTambi√©n¬†se pueden permitir gesti√≥n solo a ip o redes concretas. Si¬†queremos activar el FTP o otro servicio hacerlo solo cuando se valla a usar y por un puerto distinto para que no se identifique el servicio, porque si est√°s conectado a internet te van a escanear los puertos todo el rato.\nHay configuraciones para detectar y parar los escaneos de puertos, ataques Syn Flod y los ataques ssh.\nIp -\u0026gt; Neighborgs Deshabilitar las interfaces no confiables, se genera broadcast para descubrir equipos.\nTools -\u0026gt; BTest Server Desh√°bilitar todo y habilitar solo cuando se use.\nSystem Logging EL log que guarda la RB es limitado, lo recomendable es usar otro servidor para ir guardando los log.\nhttps://aacable.wordpress.com/2011/11/29/howto-save-mikrotik-logs-to-remote-syslog-server/\nEn el router indicar la ip del servidor de logs y los temas que queremos enviar al servidor.\nEn el servidor:\n# apt-get update # apt-get install syslog-ng # mkdir /var/log/mikrotik # touch /var/log/mikrotik/mikrotik.log #¬†nano /etc/syslog-ng/syslog-ng.conf Agregamos esto antes de la secci√≥n de sources\n## # Aceptar conexiones UDP source s_net { udp (); }; # agragar filtro de la mikrotik filter f_mikrotik { host( \u0026#34;IP_DE_MIKROTIK\u0026#34; ); }; # lugar donde se van a ir guardando los log destination df_mikrotik { file(\u0026#34;/var/log/mikrotik/mikrotik.log\u0026#34;); }; log { source ( s_net ); filter( f_mikrotik ); destination ( df_mikrotik ); }; ## ``` Guardar archivo y reiniciar servicio ``` # service syslog-ng restart ``` Para ver si nos funciona el invento hacer algo en la RB y ver el archivo. ``` # cat /var/log/mikrotik/mikrotik.log ``` Para ver en live el log de la mikrotik ``` # tail -f /var/log/mikrotik/mikrotik.log ``` Para hacer rotaci√≥n diaria de log, editar y agregar al principio del archivo. ``` # nano¬†/etc/logrotate.d/syslog-ng /var/log/mikrotik/mikrotik.log { daily rotate 90 compress notifempty missingok sharedscripts /etc/init.d/syslog-ng restart endscript } ``` Guardar archivo y reiniciar servicio ``` # service syslog-ng restart ``` ","description":"Medidas b√°sicas de seguridad con MikroTik al poner en producci√≥n","id":53,"section":"posts","tags":["mikrotik"],"title":"Seguridad b√°sica con MikroTik","uri":"http://localhost:1313/es/posts/mikrotik_seguridad_basico/"},{"content":" ¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå 27/03/2021 Ojo con las nuevas remesas de de equipamiento Ubiquiti, las nuevas revisiones 2000K y superiores de NanoStation Loco M5 no funcionan ni con OpenWRT ar71xx ni con OpenWRT ath79, ni tan siquiera probando OpenWRT ath79 para Bullet M XW que s√≠ funciona en las Rocket M XW. Al parecer hay dos arquitecturas distintas que sirven para distintas revisiones de hardware de Ubiquiti .La ar71xx es la de siempre, antes funcionaba, la ath79 es la nueva. No s√© sabe todav√≠a la manera de flashearlas. Preparaci√≥n Si el trasto viene con un firmware XW.v5.5.10-u2.28005.150723.1358 hacer ftp de qmp directamente.\nSi viene con un firmware superior hacer downgrade a la versi√≥n XW.v5.5.10-u2.28005.150723.1358 desde el men√∫ de la web.\nA tener en cuenta:\nConectar m√°s de 1 router como gw a la red qMp no funciona bien, si se quiere conectar a otra wan vale, pero no a la misma, hace bucle y asigna pipa 169. Despues de flasear y configurar el router para a√±adirlo a la red qMp es recomendable apagar y encender. Kalimotxo + Kalimotxo ok, pero no funciona bien kalimotxo + RC2 o RC3 # apt-get install tftp-hpa # para poder hacer ftp Cargar el firmware: Con el trasto apagado pisar el reset y encender = TRENECITO \u0026ndash;\u0026gt; PARPADEO X3 LUCES Y SOLTAR RESET entramos en modo bootloader ftp. Fijar una IP en el rango del trasto que es 192.168.1.20/24 http://fw.qmp.cat/stable/ para seleccionar el FW ir a directorio que corresponda. Selecionar el .bin guifi master factory del cacharro M2 o M5 (presta gr√°ficas de ping a mayores de consumo),\ndescargarlo como qMp.bin \u0026gt;tftp 192.168.1.20 desde el directorio donde esta el qMp.bin \u0026gt;mode binary \u0026gt;trace on \u0026gt;put qMp.bin Si se interrumpe la alimentaci√≥n cuando estamos editando el firmware desp√≠dete del aparato. Se instala el nuevo FW, pasado un tiempo el cacharro se reinicia con el nuevo FW\nPoner la interface en auto DHCP, entrarle al cacharro desde el navegador 172.30.22.1 root ‚Äì 13f\nLos dispositivos se conectan a la red sin hacer nada m√°s quie configurar los par√°metros de la wifi, pa√≠s, canal, hostname e IP.\nIr a configuraci√≥n del nodo qMp \u0026ndash;\u0026gt; qMp easy setup Cambiamos el modo de roadming a comunity\nPoner el nombre del nodo de acuerdo al nombre del nodo guifi.net o hacer el 1 solo click dede el menu guifi.net de la web qmp.\nIP address de acuerdo a la de guifi.net con su mascara.\nAtento a la denominaci√≥n del nodo = hostname es qMpX-YYYY\nAtenci√≥n Si queremos separar la red en dos o mas:\nCada red usar√° un canal, en un primer momento todos est√°n en el mismo canal y misma red. Ir a configuraci√≥n del nodo wireless setings para cambiar canal a los equipos que queramos que est√©n en otra red. Hay dos menus de administraci√≥n del qMp y del WRT / Para descubrir redes qMp hacemos un SCAN desde las redes qMp, son ad-Hoc. ","description":"Instalar qMp en NanoStation M5","id":54,"section":"posts","tags":["OpenWRT","qMp","ubiquiti","wifi","internet","cepeda la mora","NanoStation M5"],"title":"NanoStation M5 qMp","uri":"http://localhost:1313/es/posts/qmp_nanostation_m5/"},{"content":"Modos de trabajo,\nClient configuration for an ethernet bridge VPN tap Client configuration for a routed multi-client VPN tun Simple client configuration for a routed point-to-point VPN tun Server configuration for an ethernet bridge VPN tap Server configuration for a routed multi-client VPN¬†tun Simple server configuration for a routed point-to-point VPN tun Tipo de servidor opci√≥n: Server configuration for a routed multi-client VPN ","description":"OpenVNP en OpenWRT server","id":55,"section":"posts","tags":["OpenWRT","OpenVPN"],"title":"OpenVNP en OpenWRT server","uri":"http://localhost:1313/es/posts/openwrt_openvpn/"},{"content":"Para hacer un USB boot con varios SO ya sea de diagnostico o live la mejor herramienta que he encontrado es MULTISYSTEM.\nAdmite trabajar en modo persistente guardando los cambios o en live.\nhttp://liveusb.info/dotclear/index.php?pages/install\nEs buena cosa contar con un USB con herramientas de diagnostico y lives de SO para instalar, siempre que la maquina donde lo conectemos tenga capacidad de arrancar desde USB.\n","description":"USB MULTIBOOT MULTISYSTEM genial","id":56,"section":"posts","tags":["USB","multisystem","debian"],"title":"USB MULTIBOOT MULTISYSTEM","uri":"http://localhost:1313/es/posts/multiboot_multisystem/"},{"content":" https://openvpn.net/index.php/open-source/documentation/howto.html\nhttps://aula128.wordpress.com/2015/02/07/openvpn-instalacion-y-configuracion-del-servidor-en-linux-y-autentificacion-de-un-cliente-windows-7/\nhttp://www.redeszone.net/redes/openvpn/ apt-get install easy-rsa apt-get install openvpn Copiar los DIRECTORIOS easy-rsa y sample-config-files a /etc/openvpn/\n/usr/share/doc/openvpn/examples# cp -R sample-config-files/ /etc/openvpn/ /usr/share# cp -R easy-rsa/ /etc/openvpn/ /etc/openvpn# ls easy-rsa sample-config-files update-resolv-conf /etc/openvpn# cd sample-config-files/ /etc/openvpn/sample-config-files# ls client.conf home.up loopback-server openvpn-shutdown.sh README static-home.conf tls-home.conf xinetd-client-config firewall.sh loopback-client office.up openvpn-startup.sh server.conf.gz static-office.conf tls-office.conf xinetd-server-config Crear carpeta de claves\n/etc/openvpn/easy-rsa# mkdir keys /etc/openvpn/easy-rsa# ls build-ca build-key build-key-server changelog.Debian.gz inherit-inter openssl-0.9.6.cnf pkitool revoke-full whichopensslcnf build-dh build-key-pass build-req clean-all keys openssl-0.9.8.cnf README-2.0.gz sign-req build-inter build-key-pkcs12 build-req-pass copyright list-crl openssl-1.0.0.cnf README.Debian vars Editamos vars y modificamos KEY_COUNTRY, KEY_PROVINCE, KEY_CITY, KEY_ORG y KEY_MAIL‚Ä¶ a nuestro gusto, Tambi√©n modificamos la ruta de salida de claves export KEY_DIR=‚Äù/etc/openvpn/easy-rsa/keys/‚Äù y guardamos cambios.\nLos par√°metros Diffie Hellman se generar para el servidor. Si se genera en una maquina potente tarda unos segundos, si lo generamos en un router domestico m√°s de 40 minutos.\n/etc/openvpn/easy-rsa# ./build-dh Certificado para la CA\n/etc/openvpn/easy-rsa# ./pkitool --initca Certificado y llaves para el SERVER\n/etc/openvpn/easy-rsa# ./pkitool --server servidor Certificado y llaves para el CLIENTE\n/etc/openvpn/easy-rsa# ./pkitool clienteA /etc/openvpn/easy-rsa# ./pkitool clienteB /etc/openvpn/easy-rsa# ./pkitool clienteX Llave para servidor y cliente TLS-AUTH; Las directivas tls-auth ofrecen un nivel adicional de seguridad por encima de la proporcionada por SSL / TLS\n/etc/openvpn/easy-rsa/keys# openvpn --genkey --secret sanpe.key Se coloca en el mismo directorio que el .key RSA y archivos .crt.\nEn la configuraci√≥n del servidor, a√±adir:\nTLS-auth sanpe.key 0 En la configuraci√≥n del cliente, a√±adir:\nTLS-auth sanpe.key 1 Nuevo contenido de la carpeta keys.\n/etc/openvpn/easy-rsa/keys# ls -sal total 336 4 drwx------ 2 root root 4096 abr 16 14:55 . 4 drwxr-xr-x 3 root root 4096 abr 16 14:55 .. 8 -rw-r--r-- 1 root root 5715 abr 16 14:41 01.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:48 02.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 03.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 04.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 05.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 06.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 07.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 08.pem 8 -rw-r--r-- 1 root root 5593 abr 16 14:51 09.pem 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0A.pem 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0B.pem 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 0C.pem 4 -rw-r--r-- 1 root root 1801 abr 16 14:40 ca.crt 4 -rw------- 1 root root 1704 abr 16 14:40 ca.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:48 clienteA.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:48 clienteA.csr 4 -rw------- 1 root root 1708 abr 16 14:48 clienteA.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteB.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteB.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteB.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteC.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteC.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteC.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteD.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteD.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteD.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteE.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteE.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteE.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteF.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteF.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteF.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:50 clienteG.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:50 clienteG.csr 4 -rw------- 1 root root 1704 abr 16 14:50 clienteG.key 8 -rw-r--r-- 1 root root 5593 abr 16 14:51 clienteH.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteH.csr 4 -rw------- 1 root root 1704 abr 16 14:51 clienteH.key 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteI.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteI.csr 4 -rw------- 1 root root 1704 abr 16 14:51 clienteI.key 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteJ.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteJ.csr 4 -rw------- 1 root root 1708 abr 16 14:51 clienteJ.key 8 -rw-r--r-- 1 root root 5594 abr 16 14:51 clienteK.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:51 clienteK.csr 4 -rw------- 1 root root 1704 abr 16 14:51 clienteK.key 4 -rw-r--r-- 1 root root 424 abr 16 14:38 dh2048.pem 4 -rw-r--r-- 1 root root 1800 abr 16 14:51 index.txt 4 -rw-r--r-- 1 root root 21 abr 16 14:51 index.txt.attr 4 -rw-r--r-- 1 root root 21 abr 16 14:51 index.txt.attr.old 4 -rw-r--r-- 1 root root 1650 abr 16 14:51 index.txt.old 4 -rw------- 1 root root 636 abr 16 14:55 sanpe.key 4 -rw-r--r-- 1 root root 3 abr 16 14:51 serial 4 -rw-r--r-- 1 root root 3 abr 16 14:51 serial.old 8 -rw-r--r-- 1 root root 5715 abr 16 14:41 servidor.crt 4 -rw-r--r-- 1 root root 1102 abr 16 14:41 servidor.csr 4 -rw------- 1 root root 1704 abr 16 14:41 servidor.key El paso final en el proceso de generaci√≥n de claves es copiar todos los archivos en las m√°quinas que los necesitan, teniendo cuidado de copiar los archivos secretos por un canal seguro.\n","description":"Crear CERTIFICADOS OPENVNP en Debian","id":57,"section":"posts","tags":["debian","openVPN","linux"],"title":"CERTIFICADOS OPENVNP","uri":"http://localhost:1313/es/posts/certificado_openvpn/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones.\nCambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes alg√∫n router viejo por casa y es compatible. Dependiendo del router es m√°s o menos f√°cil cargar el firmware, este router que tiene USB es f√°cil y va genial.\nhttps://wiki.openwrt.org/toh/huawei/hg556a\n1. Seleccionar firmware: Seleccionamos el firmware en base al modelo y sacamos el modelo en base al numero de serie del trasto:\nRouter version\tBoard model\tWifi chip\tVdf Version *\nSerial number (first 5 digits)\tFlash chip erasesize **\tcal_data offset\tSupported\tNotes\nA\tHG55VDFA VER.C\tAtheros AR9223\tHG556AVDFA\t30462, 30562, 30605, 30608, 30634\t0x10000\t0xf7e000\tYes\tADSL not supported\nVoIP not supported\nB\tHG556BVDFA\t30692, 30693, 31110, 31300\t0x20000\t0xefe000\nC\tHG56BZRB VER.A\tRalink RT3062F\tHG556CVDFA\t30555, 30694, 30695, 31301, 31507, 31525, 31901, 31902, 31935, 32505\t0x20000\t0xeffe00\tYes\n2. Instalar el firmware Si en alg√∫n momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que p√°gina entregarnos, la cache no coincide con la realidad. Selecionamos el .bin, como mi numero de serie de mi trasto empieza por 30692 me corresponde la versi√≥n B:\nopenwrt-15.05-brcm63xx-generic-HG556a_B-squashfs-cfe.bin\nPisamos el boton restart del trasto y le damos corriente, mantenemos pulsado unos 15 segundos para acceder a la web de carga del firmware del bootloader.\nNos conectamos en la LAN2 del router y nos ponemos una ip del rango 192.168.1.x/24\nY a cargar el Firmware‚Ä¶ Seleccionamos el .bin y Update Software, dice que tarda unos 2 minutos, vemos que el led del power parpadea y se van encendiendo otros led, vamos a dejarlo un buen rato. Esperamos a que la luz del power se quede fija y nos entregue ip.\nSi se interrumpe la alimentaci√≥n cuando estamos editando el firmware desp√≠dete del aparato. 3. Configuraci√≥n como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contrase√±a, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1 dhclient eth0 Nos conectamos a la LAN, vamos al navegador, 192.168.1.1 y ya nos aparece el user password de administraci√≥n del LUCI que nos sugiere fijar un password de root.\nPrestar atenci√≥n al la IP de la LAN, para que al poner router conectado al router con internet no est√©n los dos con los mismos rangos..\nclick en Go to password configuration‚Ä¶ para cambiar el password de root, con esto se activa el acceso SSH por consola, si no, solo funciona telnet.\nVamos a convertirlo en router neutro, una boca wan y el resto lan.\nClick en network Switch add y lo dejamos as√≠.\nVamos a Network interfaces y lo dejamos as√≠:\nCon el servidor de DHCP de la LAN en un rango distinto a la WAN , interface VLAN2 eth0.2\nLa WAN cliente de DHCP conectada a aun router que entregue IP y con salida a internet, interface VLAN1 eth0.1\nEn este caso el firmware viene con los drivers WIFI y USB, si hubiera que instalarlos entrar por SSH y ejecutar:\nopkg update\nopkg install kmod-ath9k\nopkg install kmod-usb-ohci kmod-usb2\nopkg install usbutils\nreboot \u0026amp;\u0026amp; exit\nlsusb\n4 Comprobaciones Se accede a lUCI perfectamente, la wifi es muy buena.\nSoC Broadcom 6358 / 64MB RAM / 16MB Flash.\n","description":"OPENWRT en HUAWEI ECHOLIFE HG556A Una joya!","id":58,"section":"posts","tags":["OpenWRT","router neutro","wifi"],"title":"OPENWRT EN HUAWEI ECHOLIFE HG556A","uri":"http://localhost:1313/es/posts/openwrt-huawei_echolife_hg556a/"},{"content":"Repositorios: # nano /etc/apt/sources.list Instalar KEYS de los repos\ngpg --keyserver pgpkeys.mit.edu --recv-key C90F9CB90E1FAD0C gpg --export --armor C90F9CB90E1FAD0C | sudo apt-key add - apt-get install debian-keyring debian-archive-keyring apt-get install deb-multimedia-keyring Raspbian\ndeb http://mirrordirector.raspbian.org/raspbian/ jessie main contrib non-free rpi # Uncomment line below then \u0026#39;apt-get update\u0026#39; to enable \u0026#39;apt-get source\u0026#39; #deb-src http://archive.raspbian.org/raspbian/ jessie main contrib non-free rpi The directory /etc/apt/sources.list.d contains the file\nraspi.list\n/etc/apt/sources.list.d/raspi.list deb http://archive.raspberrypi.org/debian/ jessie main ui # Uncomment line below then \u0026#39;apt-get update\u0026#39; to enable \u0026#39;apt-get source\u0026#39; #deb-src http://archive.raspberrypi.org/debian/ jessie main ui Jessie\n## DEBIAN OFICIAL deb http://ftp.fi.debian.org/debian/ jessie main contrib non-free # deb-src http://ftp.fi.debian.org/debian/ jessie main contrib non-free ## DEBIAN SECURITY deb http://security.debian.org/ jessie/updates main contrib non-free # deb-src http://security.debian.org/ jessie/updates main contrib non-free ## Debian JESSIE-UPDATES deb http://ftp.fi.debian.org/debian/ jessie-updates main contrib non-free # deb-src http://ftp.fi.debian.org/debian/ jessie-updates main contrib non-free ## DEBIAN JESSIE BACKPORTS deb http://ftp.fi.debian.org/debian/ jessie-backports main contrib non-free # deb-src http://ftp.fi.debian.org/debian/ jessie-backports main contrib non-free ## MULTIMEDIA ## Instalar key # apt-get install deb-multimedia-keyring deb http://www.deb-multimedia.org jessie main non-free # i2p # deb http://deb.i2p2.no/ jessie main # deb-src http://deb.i2p2.no/ jessie main # VirtualBox # deb http://httpredir.debian.org/debian/ jessie main contrib # winehq # deb https://dl.winehq.org/wine-builds/debian/ jessie main # virtualBox # deb http://download.virtualbox.org/virtualbox/debian jessie non-free contrib # Multisystem para hacer USB multiboot # deb http://liveusb.info/multisystem/depot all main # Ubiquiti UniFi updates # deb http://www.ubnt.com/downloads/unifi/debian stable ubiquiti # Java 8 9 siempre update deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main ## Firefox Debian Mozilla team # Instalar key # apt-get install pkg-mozilla-archive-keyring# Instalar Firefox # apt-get update \u0026amp;\u0026amp; apt-get install -t jessie-backports firefox firefox-l10n-es-$ # deb http://mozilla.debian.net/ jessie-backports firefox-release # Repositorios guifi.net # deb http://serveis.guifi.net/debian guifi/ # repositorios webmin # deb http://download.webmin.com/download/repository jessie contrib # Repositorios AirControl ubiquiti # deb http://ftp.uk.debian.org/debian squeeze main non-free Driver de la tarjeta wifi: # apt-get update \u0026amp;\u0026amp; apt-get install firmware-iwlwifi # modprobe -r iwlwifi ; modprobe iwlwifi Auto login\nhttp://www.linuxserve.com/2015/06/how-to-enable-automatic-login-on-debian.html Con GDM3 # nano /etc/gdm3/daemon.conf AutomaticLoginEnable = true AutomaticLogin = USUARIO Con LightDM nano /etc/lightdm/lightdm.conf autologin-user=USUARIO autologin-user-timeout=0 Autocompletar con tabulador # apt-get install bash-completion # vi /etc/bash.bashrc # enable bash completion in interactive shells if ! shopt -oq posix; then if [ -f /usr/share/bash-completion/bash_completion ]; then . /usr/share/bash-completion/bash_completion elif [ -f /etc/bash_completion ]; then . /etc/bash_completion fi fi Interfaces de red # nano /etc/network/interfaces # cat /etc/network/interfaces # This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). # source /etc/network/interfaces.d/* # The loopback network interface auto lo iface lo inet loopback # The eth0 network interface auto eth0 allow-hotplug eth0 iface eth0 inet dhcp # Static IP address # auto eth0 # iface eth0 inet static # address 192.168.1.100 # netmask 255.255.255.0 # network 192.168.1.0 # broadcast 192.168.1.255 # gateway 192.168.1.1 Mantiene DNS con reinicio # apt-get install resolvconf # cat /etc/resolv.conf # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8) # DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN nameserver 80.58.61.250 nameserver 80.58.61.254 search Home # nano /etc/resolvconf/resolv.conf.d/base Poner aqu√≠ los DNS que queramos guardar permanentemente y actualizar con resolvconf -u nameserver 8.8.8.8 nameserver 8.8.4.4 Retoques en grub # nano /etc/default/grub # sudo update-grub Migrar correo icedove o thunderbird Se copia la carpeta del profile y se borra la que tenga, para ver la ruta de la carpeta del profile\nmenu help -\u0026gt; Troubleshooting Information\n","description":"Rutina para despu√©s de instalar Debian Jessie ","id":59,"section":"posts","tags":["debian","jessie","linux"],"title":"Rutina para despu√©s de instalar Debian","uri":"http://localhost:1313/es/posts/postinstalacion_debian/"},{"content":"VirtualBox Vamos a virtualizar RouterOS en una vieja maquina para convertirlo en hotspot MikroTik.\nNecesitamos una maquina que tenga m√°s de una interfaz de red, un router con una sola interfaz no tiene mucho sentido.\nUn PC Pentium 4 completo se puede encontrar de segunda mano por 50 euros, y tarjetas de red 10/100 las regalan.\nEn el servidor nos aseguramos que en la bios est√© marcada la casilla de virtualizaci√≥n, (la m√°quina tiene que soportar virtualizaci√≥n VT-x o AMD-V) ya de paso en la secci√≥n de power management que el servidor se encienda si hay una interrupci√≥n de la alimentaci√≥n el√©ctrica.\nTambi√©n vamos a decirle al servidor que arranque autom√°ticamente nuestro router virtualizado cuando se encienda.\nPara ver si nuestra maquina Linux cumple con los requisitos para virtualizar podemos ejecutar unos comandos desde la consola:\negrep -c \u0026#39;(vmx|svm)\u0026#39; /proc/cpuinfo # Nos dice el n√∫mero de procesadores que soportan virtualizaci√≥n 4 uname -m # Nos dice si el kernel es de 32 o de 64 bit: x86_64 Primero se instala una Debian y sobre √©sta el VirtualBox.\nAhora importamos la imagen MikroTik-6.29.1.ova desde el VirtualBox.\nSe ajustan las opciones de red de la maquina virtual, en este caso se elige la opci√≥n sencilla y se pone la interfaz de red en bridge con la maquina virtual para tener salida a internet.\nMikroTik Y vamos con la configuraci√≥n del MikroTik.\nPara configurar el router descargar WinBox, esto es gracioso, por que es una aplicaci√≥n para windows que se usa para gestionar un sistema basado en linux, y de momento no hay WinBox para linux as√≠ que tenemos que instalar Wine para poder trabajar desde linux con WinBox.\nHotspot Aqu√≠ una gu√≠a para HotSpot guifi.net https://guifi.net/node/31382\nEn nuestro HotSpot vamos a tener 2 modelos de usuarios en ‚Äúuser profiles‚Äù.\nTrial, es un usuario ocasional con caudal limitado y tiempo de sesi√≥n de 1 hora al d√≠a, el contador de tiempo se resetea cada 12 horas. El usuario accede a internet con un click. Registrado, es un usuario que ha solicitado acceso mediante registro, (enviando un mail al administrador) cuenta con un usuario (mail) y una contrase√±a que le permite el acceso ilimitado en tiempo de sesi√≥n. Tambi√©n tiene el caudal limitado. Firewall, adem√°s de las reglas b√°sicas vamos a eliminar el uso de P2P para todos los clientes del HotSpot.\nhttps://wiki.mikrotik.com/wiki/Basic_universal_firewall_script\nLos router MikroTik pueden ejecutar script y tienen un programador de tareas. Esto viene muy bien para hacer copias de seguridad peri√≥dicas, enviar log de actividad por mail, programar reinicios automaticos, hacer limpiezas de cach√©, avisarnos de alarmas o alertas de funcionamiento.\nhttps://wiki.mikrotik.com/wiki/Scripts\nhttps://wiki.mikrotik.com/wiki/Manual:System/Scheduler\nLas restricciones en navegaci√≥n se van ha hacer en base a la salida a internet que tengamos. El HotSpot de acceso abierto es un servicio limitado o muy limitado, dependiendo del ancho de banda con el que se cuente, est√° orientado a dar a conocer nuestro proyecto y fomentar el uso de las redes comunitarias como guifi.net.\n","description":"Virtualizando hotspot MikroTik RouterOS con VirtualBox","id":60,"section":"posts","tags":["mikrotik","hotspot","VirtualBox","RouterOS","wifi","guifi.net","cepeda la mora"],"title":"Virtualizar hotspot MikroTik","uri":"http://localhost:1313/es/posts/virtualizar_hotspot_mikrotik/"},{"content":" Vista la experiencia no soy partidario de usar hotspot con portal cautivo, entiendo que en algunos escenarios puede ser de utilidad. Intro La cosa es que cuando hacemos un hotspot con MikroTik una de los problemas que nos encontramos tras hacer el wizard es que el usuario que se conecta obtiene ip de manera correcta pero a la hora de ser redireccionado al portal cautivo si va a una direcci√≥n https no se le muestra la p√°gina y le sale un error 404.\nY es que dentro de la Router Board hay un servidor web donde tenemos que hacer nuestra p√°gina web.\nPara solucionar la redireecion con https hay que generar un par de archivos e importarlos en el Mikrotik, ya sea por consola o por winbox. Necesitamos un certificado y una clave, .crt y .key, para generarlos necesitamos la herramienta openssl, si no la tenemos lo primero seria instalarlos, bueno lo primero ser√≠a instalar una distribuci√≥n de Linux.\n# apt-get update # apt-get install openssl Clave privada Generamos una clave privada y una key, nos pedir√° un password que debemos recordar.\n# openssl genrsa -des3 -out ca.key 4096 Enter pass phrase for ca.key: (password) Ya tenemos un archivo que se llama ca.key,\nCertificado Ahora vamos a generar el .crt con esa key en este caso es para 3650 d√≠as, 10 a√±os.\n# openssl req -new -x509 -days 3650 -key ca.key -out ca.crt Empieza el dialogo donde nos va preguntando datos y vamos poniendo lo que nos pide.\nAhora generamos la key/certificado par para el servidor, nos pide de nuevo contrase√±a, recordar:\n# openssl genrsa -des3 -out server.key 4096 Generating RSA private key, 4096 bit long modulus ...........................................................................................................................++ ....................................++ e is 65537 (0x10001) Enter pass phrase for server.key: (passwor) Verifying - Enter pass phrase for server.key: (password) Se asocia la key al certificado y de nuevo el dialogo donde vamos poniendo lo que nos pida:\n# openssl req -new -key server.key -out server.csr Enter pass phrase for server.key: (password) You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [AU]: State or Province Name (full name) [Some-State]: Locality Name (eg, city) []: Organization Name (eg, company) [Internet Widgits Pty Ltd]: Organizational Unit Name (eg, section) []: Common Name (e.g. server FQDN or YOUR name) []: Email Address []: Please enter the following \u0026#39;extra\u0026#39; attributes to be sent with your certificate request A challenge password []:(password) An optional company name []: Asociar los crs y la key al crt Ejecutamos:\n# openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt Signature ok subject=/C= /ST= /L= /O= /OU= /CN= /emailAddress= Getting CA Private Key Enter pass phrase for ca.key: (password) Estos son los archivos que nos quedan al finalizar si hay algo raro o que no os guste, pues se repiten todos los pasos.\n# ls ca.crt ca.key server.crt server.csr server.key Importar a la MikroTik Luego para importarlos solo tenemos que copiar 2 archivos, el server.crt y server.key en el MikroTik, los otros archivos los guardamos. Por ftp o por WinBox los pasamos a files y los importamos por consola o desde el menu SYSTEM-\u0026gt;CERTIFICATES del WinBox. Este es el ejemplo de importaci√≥n desde la consola del MikroTik.\n[admin@MikroTik] /certificate\u0026gt; import file-name=server.crt passphrase:(password) certificates-imported: 1 private-keys-imported: 0 files-imported: 1 decryption-failures: 0 keys-with-no-certificate: 0 [admin@MikroTik] /certificate\u0026gt; import file-name=server.key passphrase:(password) certificates-imported: 0 private-keys-imported: 1 files-imported: 1 decryption-failures: 0 keys-with-no-certificate: 0 Configurar en hotspot Ya solo nos queda marcar en la casilla del hotspot -\u0026gt; ¬´login by¬ª https y en services el https seleccionando el certificado que hemos importado.\nAhora cuando se conecte al hotspot y se tenga una p√°gina https como pag√≠na de inicio en su navegador (que es lo m√°s normal), se le redireccionar√° al portal cautivo donde se presentar√° al HotSpot y ya sea con usuario y contrase√±a o como invitado, podr√° navegar y hacer uso del servicio.\nEste es el portal cautivo que ten√≠amos en Cepeda.\n","description":"Portal cautivo y la redirecci√≥n de https","id":61,"section":"posts","tags":["mikrotik","hotspot","wifi","cepeda la mora"],"title":"Portal cautivo hotspot mikrotik","uri":"http://localhost:1313/es/posts/portal_cautivo_hotspot_mikrotik/"},{"content":" Este banner bash requiere de:\n# apt-get install uprecords hddtemp lm-sensors 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 #!/bin/bash $\u0026gt;\u0026gt; _ txtblk=\u0026#39;\\e[0;30m\u0026#39; # Black - Regular txtred=\u0026#39;\\e[0;31m\u0026#39; # Red txtgrn=\u0026#39;\\e[0;32m\u0026#39; # Green txtylw=\u0026#39;\\e[0;33m\u0026#39; # Yellow txtblu=\u0026#39;\\e[0;34m\u0026#39; # Blue txtpur=\u0026#39;\\e[0;35m\u0026#39; # Purple txtcyn=\u0026#39;\\e[0;36m\u0026#39; # Cyan txtwht=\u0026#39;\\e[0;37m\u0026#39; # White bldblk=\u0026#39;\\e[1;30m\u0026#39; # Black - Bold bldred=\u0026#39;\\e[1;31m\u0026#39; # Red bldgrn=\u0026#39;\\e[1;32m\u0026#39; # Green bldylw=\u0026#39;\\e[1;33m\u0026#39; # Yellow bldblu=\u0026#39;\\e[1;34m\u0026#39; # Blue bldpur=\u0026#39;\\e[1;35m\u0026#39; # Purple bldcyn=\u0026#39;\\e[1;36m\u0026#39; # Cyan bldwht=\u0026#39;\\e[1;37m\u0026#39; # White unkblk=\u0026#39;\\e[4;30m\u0026#39; # Black - Underline undred=\u0026#39;\\e[4;31m\u0026#39; # Red undgrn=\u0026#39;\\e[4;32m\u0026#39; # Green undylw=\u0026#39;\\e[4;33m\u0026#39; # Yellow undblu=\u0026#39;\\e[4;34m\u0026#39; # Blue undpur=\u0026#39;\\e[4;35m\u0026#39; # Purple undcyn=\u0026#39;\\e[4;36m\u0026#39; # Cyan undwht=\u0026#39;\\e[4;37m\u0026#39; # White bakblk=\u0026#39;\\e[40m\u0026#39; # Black - Background bakred=\u0026#39;\\e[41m\u0026#39; # Red bakgrn=\u0026#39;\\e[42m\u0026#39; # Green bakylw=\u0026#39;\\e[43m\u0026#39; # Yellow bakblu=\u0026#39;\\e[44m\u0026#39; # Blue bakpur=\u0026#39;\\e[45m\u0026#39; # Purple bakcyn=\u0026#39;\\e[46m\u0026#39; # Cyan bakwht=\u0026#39;\\e[47m\u0026#39; # White txtrst=\u0026#39;\\e[0m\u0026#39; # Text Reset clear echo \u0026#34;\u0026#34; echo -e \u0026#34;\\033[44m Welcome server Ayto Cepeda guifi.net! \u0026#34; echo -en \u0026#34;\\033[1;32m \\033[0;36m+++++++++++++++++: \\033[0;37m${undylw}System Data\\033[0;36m :++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ + \\033[0;37mHostname \\033[0;36m = \\033[1;32m`hostname` \\033[0;36m+ \\033[0;37mAddress \\033[0;36m = \\033[1;32mCepeda La Mora, Avila \\033[0;36m+ \\033[0;37mKernel \\033[0;36m = \\033[1;32m`uname -r` \\033[0;36m+ \\033[0;37mUptime \\033[0;36m =\\033[1;32m`uptime | awk \u0026#39;{ $1=$2=$(NF-6)=$(NF-5)=$(NF-4)=$(NF-3)=$(NF-2)=$(NF-1)=$NF=\u0026#34;\u0026#34;; print}\u0026#39;` \\033[0;36m+ \\033[0;37mMemory \\033[0;36m = \\033[1;32m`free -m | awk \u0026#39;NR==2 {print $2}\u0026#39;` MB \\033[0;36m+\\033[0;37mFree Memory \\033[0;36m= \\033[1;32m`free -m | awk \u0026#39;NR==3 {print $4}\u0026#39;` MB \\033[0;36m++++++++++++++++++: \\033[0;37m${undylw}User Data\\033[0;36m :+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ + \\033[0;37mUsername \\033[0;36m = \\033[1;32m`whoami` \\033[0;36m+++++++++++: \\033[0;31m${undred}Maintenance Information\\033[0;36m :++++++++++++++++++++++++++++++++++++++++++++++++++++ \u0026#34; echo -e \u0026#34;\\033[0;37msessions \\033[0;36m \\033[1;32m`w`\u0026#34; echo -e \u0026#34;\\033[0;37mreboots \\033[0;36m \\033[1;32m`uprecords`\u0026#34; echo -e \u0026#34;\\033[0;37mhddtemp \\033[0;36m \\033[1;32m`hddtemp /dev/sda`\u0026#34; echo -e \u0026#34;\\033[0;37msensors \\033[0;36m \\033[1;32m`sensors`\u0026#34; echo -e \u0026#34;\\033[0;37mcat /var/log/auth* | grep Failed #ver los fail SSH\u0026#34; echo -e \u0026#34;\\033[0;36m++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\\033[0m\u0026#34; echo -e \u0026#34;\\033[34mEn la calle tenemos:\u0026#34; METRIC=1 # 0 for F, 1 for C # Fill in form to find your weather code here: # http://netweather.accuweather.com/signup-page2.asp # If code has a space remove it or replace it with %20 or a dash; - LOCCOD=\u0026#34;EUR|ES|GM002|CEPEDA-LA-MORA\u0026#34; #Example: NAM|MX|MX009|MEXICO-CITY if [ -z $1 ] \u0026amp;\u0026amp; [ -x $LOCCOD ] ; then echo echo \u0026#34;USAGE: $0 [locationcode]\u0026#34; echo exit 0; elif [ ! -z $1 ] ; then LOCCOD=$1 fi curl -s http://rss.accuweather.com/rss/liveweather_rss.asp\\?metric\\=${METRIC}\\\u0026amp;locCode\\=$LOCCOD \\ | sed -n \u0026#39;/Currently:/ s/.*: \\(.*\\): \\([0-9]*\\)\\([CF]\\).*/\\2¬∞\\3, \\1/p\u0026#39; echo -e \u0026#34;\\e[0m\u0026#34; Queda cosa as√≠:\n","description":"Banner ssh linux","id":62,"section":"posts","tags":["debian","ssh","linux"],"title":"Banner ssh","uri":"http://localhost:1313/es/posts/banner_ssh/"},{"content":" https://wiki.openwrt.org/doc/howto/cron Me est√°n dando guerra una serie de router. El usuario se queja de que de vez en cuando el router pierde la salida a internet, una de las veces que estaba teniendo el problema me conect√© y era como que perd√≠a la ip WAN del cliente dhcp, la red local segu√≠a funcionando y la wifi tambi√©n,la parte lan estaba ok y he pensado que programando un reinicio diario de madrugada se pod√≠a arreglar el problema. (No ser√° la mejor soluci√≥n pero se arregl√≥ el problema)\nEs f√°cil solo hay que decirle al cron del router que se reinicie a una hora en la que no tenga actividad, por ejemplo las 04:30 de la madrugada. Primero hay que ponerlo en hora, activar el cliente ntp para que el trasto se ponga en hora cada vez que se encienda‚Ä¶ si no tiene ntp configurado se va a reiniciar a lo loco, y queremos que se reinicie cada d√≠a a las 04:30.\nEste es el formato de cron: * * * * * comando a ejecutar - - - - - | | | | | | | | | +----- D√≠a de la semana (0-7) | | | +----------- Mes (1 - 12) | | +----------------- D√≠a del mes (1 - 31) | +----------------------- Hora (0 - 23) +----------------------------- Minuto (0 - 59) Para insertar una nueva tarea en el cron:\n# crontab -e Se nos abre un fichero en el que ponemos esto, se trata de confirmar la hora antes de hacer el reboot para no dejar un reinicio en bucle y cargarse el trasto.\n# Reinicio todos los dias a las 04:30 # Nota: Para evitar el bucle de reinicio infinito, espera 70 segundos # y crea un archivo en /etc comprueba que la fecha de creaci√≥n # marca las 4:31 antes de ejecutar el comando de reinicio de cron. 30 4 * * * sleep 70 \u0026amp;\u0026amp; touch /etc/banner \u0026amp;\u0026amp; reboot Para salir de la edici√≥n del archivo usando vi:\nPresionar tecla Esc y escribir :wq , para salir sin guardar :q!\nArrancamos y activamos el servicio:\n# /etc/init.d/cron start # /etc/init.d/cron enable Comprobamos que permanece y esperamos que funcione. Hasta ma√±ana!\n# crontab -l Al d√≠a siguiente ejecutamos un:\n# uptime Para ver cuanto lleva funcionando.\n","description":"Programar reinicio en OpenWRT","id":63,"section":"posts","tags":["OpenWRT","router neutro","reinicio"],"title":"Programar reinicio en OpenWRT","uri":"http://localhost:1313/es/posts/programar_reinicio_openwrt/"},{"content":"Se trata de interconectar a tres vecinos, el escenario es una comunidad de vecinos de pisos donde se van compartir los gastos en infraestructura com√∫n de telecomunicaciones y conexi√≥n a internet. Como los tres vecinos est√°n en el mismo edificio, se conectan con cable de red, se instala un router central junto al router de proveedor 300/30 Mb y un router de cliente para cada¬†nodo se est√° usando firmware openWRT en los equipos.\nRouter central 10/100/1000 TP-Link TL-WR1043ND\nRouter cliente 10/100 Nexx WT3020\nRouter central de segunda mano 20 ‚Ç¨, y router de cliente 15x3=45 ‚Ç¨. Cable y conectores 20 ‚Ç¨\nTotal unos 85 ‚Ç¨ en materiales.\nLa configuraci√≥n se llev√≥ una hora. El cableado y la instalaci√≥n menos de 3 horas.\nLas viviendas est√°n conectadas entre si con una red plana y cada una tiene una red wifi privada con salida a internet. La sensaci√≥n de los vecinos es la de tener un router de proveedor propio pero est√°n compartiendo solo una conexi√≥n, pasan de tener 3 conexiones contratadas a pagar una conexi√≥n entre 3.\nLa red est√° aislada, no est√° conectada con el resto de usuarios de la red guifi.net. Para conectar con la red guifi.net y compartir servicios comunitarios habr√≠a que hacerlo mediante tunel VPN o mediante enlace f√≠sico a un segmento de red que ya est√© integrado.\nLa red se est√° comportando bien, pero no se le est√° sacando todo el rendimiento, los vecinos nunca alcanzan los 300 Mbit/s. Como los router finales son 10/100¬†Mbit/s solo llegan unos 80 Mbit/s a cada casa.\nLa red est√° limitada en cuanto a su crecimiento como red comunitaria de infraestructura com√∫n, para progresar es necesario regular el servicio de salida a internet y abrir las puertas a todas las personas que quieran formar parte de ella. Vamos con un ejemplo:\nS√≠ el d√≠a de ma√±ana otro vecino quiere sumarse a la red comunitaria, con tirar un cable hasta el router central tendr√≠a conexi√≥n con el resto de vecinos y de manera autom√°tica salida a internet. ¬øPero que pasa el d√≠a que un vecino toma la decisi√≥n de no pagar la parte de la cuota de salida a internet que le corresponde? La soluci√≥n es f√°cil, el vecino que tiene el router central desconecta el cable, por que no le parece bien que el resto de los vecinos sigan pagando y este no.\nMal hecho, ya que cuando se desconecta al vecino moroso se le interrumpe la salida a internet pero adem√°s se le deja fuera de la red comunitaria, deja de alcanzar directamente a sus otros vecinos con los que compart√≠a servicios, de p2p, impresoras en red o telefon√≠a IP.\nSoluci√≥n: En guifi.net el servicio de salida a internet est√° regulado de 3 maneras, Hotspot de acceso abierto, PROXY y tunnel VPN.\nLos hotspot son puntos de conexi√≥n directa por wifi, generalmente estos accesos est√°n limitados en tiempo y caudal se prestan para facilitar conexiones puntuales a internet. Estas redes no tienen cifrado, los SSID de se llaman \u0026ldquo;guifi.net_AccesoAbierto\u0026rdquo;.\nLos proxys son salidas a internet que facilitan los miembros de guifi.net, ceden una porci√≥n de ancho de banda. En guifi.net son proxys federados, no est√°n abiertos a todo el mundo, para poder acceder al servicio el propietario o el administrador del proxy tiene que facilitar una contrase√±a y se mira a quien se da acceso, normalmente a nodos que llevan operativos un tiempo. El caudal es limitado y solo se puede navegar desde dispositivos que admitan configuraci√≥n de proxy cliente con usuario y contrase√±a.\nLos tunel VPN son enlaces punto a punto desde el cliente hasta la salida a internet, caminos virtuales que trabajan por debajo de los enlaces f√≠sicos. Lo ideal seria que todas las zonas tuvieran los tres servicios. Son generalmente un servicio de pago, por que salir a internet cuesta dinero. Los proveedores de servicio de guifi.net tienen servidores de tunel y venden caudales de salida a los usuarios de las redes comunitarias que lo necesitan. De esta forma al usuario que no paga el servicio se le desconecta del tunel de salida a internet, pero sigue teniendo presencia en la red comunitaria guifi.net.\nEquipamiento 350 ‚Ç¨\nRouter 10/100/1000, como servidor se VPN para gestionar la salida a internet. RB850Gx2.¬†+ Carcasa CA150\nRouter 10/100/1000 + Wifi, como router de cliente final. RB951G-2HnD\nAl adaptar la red a Giga Bit se asegura un aprovechamiento √≥ptimo de la salida a internet.Este equipamiento permite hacer t√∫neles cliente servidor para salir a internet e interconexi√≥n por VPN con otras redes comunitarias como guifi.net. El router MikroTik sustituye al de proveedor eliminando el doble NAT.\nguifi.net Este es el esquema de red y servicios b√°sicos de un super nodo integrado en guifi.net. Se agrega un servidor y un switch que puede permitir mas conexiones al supernodo, Hotspot y enlaces punto a punto con otras redes o con otros nodos.\n","description":"guifi.net y redes comunitarias en comunidades de vecinos","id":64,"section":"posts","tags":["comunidad de vecinos","guifi.net","openwrt","wifi"],"title":"Compartir salida a internet con guifi.net","uri":"http://localhost:1313/es/posts/compartir-internet/"},{"content":" ¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå Modos de trabajo de la radio con qMp 3.2.1 Estos son los modos de trabajo en modo community, opciones de Wireless interface wlan0.\nAd_hoc_(mesh)_+access_point(Lan) Ad_hoc_(mesh) Access_point_(mesh) Access_point_(Lan) Client_(WAN) EXPERIMENTAL_802.11s_(mesh) EXPERIMENTAL_802.11s_(mesh)+Access_point_(Lan) Disabled la opci√≥n desaparece ","description":"Modos de trabajo de la radio con qMp","id":65,"section":"posts","tags":["OpenWRT","qMp","wifi","mesh"],"title":"Modos de trabajo qMp","uri":"http://localhost:1313/es/posts/modos_de_trabajo_qmp/"},{"content":" ¬øQue qu√© es qMp? Visite http://qmp.cat/Inicio para conocerlo.\nEsta es la p√°gina de desarrollo proyecto https://dev.qmp.cat/projects/qmp üôå Este es el archivo de configuraci√≥n qMp 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 /etc/config/qmp Node configuration: config \u0026#39;qmp \u0026#39; \u0026#39;node \u0026#39; option \u0026#39;community_node_id \u0026#39;\t\u0026#39;901 \u0026#39; # An number identifying the node. In this case node name will be: \u0026#34;qmp901\u0026#34;. If not specified it will be auto-configured based on the last byte of the MAC address. option \u0026#39;key \u0026#39;\t\u0026#39;/tmp/ qmp_key \u0026#39; # Path to file containing the QMP key. It is a hash generated randomly on each boot used by some QMP applications for security purposes. Interfaces config \u0026#39;qmp \u0026#39; \u0026#39;interfaces \u0026#39; option \u0026#39;lan_devices \u0026#39;\t\u0026#39;eth0 wlan1 \u0026#39; # Interfaces used for nal client connection, a bridge between them will be created and the DHCP server will be enabled. option \u0026#39;wan_device \u0026#39;\t\u0026#39;eth1 \u0026#39; # Interface connection with another network. A DHCP client will be enabled in this interface to automatically get the network con\fguration. option \u0026#39;mesh_devices \u0026#39;\t\u0026#39;wlan0 wlan2 \u0026#39; # Interfaces used for meshing. Several VLAN will be created and routing protocols will be enabled. Networks config \u0026#39;qmp \u0026#39; \u0026#39;networks \u0026#39; option \u0026#39;dns \u0026#39;\t\u0026#39;141.1.1.1 \u0026#39; # Nameservers used for the device and final clients option \u0026#39;lan_address \u0026#39;\t\u0026#39;172.30.22.1 \u0026#39; # lan address: IPv4 address used for final client bridge interface (see 7.3.2) option \u0026#39;lan_netmask \u0026#39;\t\u0026#39;255.255.255.0 \u0026#39; # lan netmask: IPv4 netmask used for final client bridge interface option \u0026#39;niit_prefix96 \u0026#39;\t\u0026#39;0:0:0:0:0: ffff \u0026#39; # niit prefix96: Niit is used for 4in6 tunneling, see 7.2.4 option \u0026#39;mesh_protocol_vids \u0026#39;\t\u0026#39;olsr6 :1 bmx6 :2\u0026#39; # VLAN tag suffix added for routing protocol interfaces (mesh vid - offset + mesh protocol vids) option \u0026#39;mesh_vid_offset \u0026#39;\t\u0026#39;10\u0026#39; # VLAN tag offset used for routing protocol interfaces (e. eth0.10) option \u0026#39;olsr6_mesh_prefix48 \u0026#39;\t\u0026#39;fd01 :0:0 \u0026#39; # First 48 bits used for IPv6 calculation, see IP structure chapter option \u0026#39;bmx6_mesh_prefix48 \u0026#39;\t\u0026#39;fd02 :0:0 \u0026#39; option \u0026#39;babel_mesh_prefix48 \u0026#39;\t\u0026#39;fd03 :0:0 \u0026#39; option \u0026#39;netserver \u0026#39; \u0026#39;1\u0026#39; Wireless General section config \u0026#39;qmp \u0026#39; \u0026#39;wireless \u0026#39; option \u0026#39;driver \u0026#39;\t\u0026#39;mac80211 \u0026#39; # Which driver to use: mac80211 or madwi\foption \u0026#39;country \u0026#39;\t\u0026#39;ES \u0026#39; # country: Country code to use for WiFi devices option \u0026#39;bssid \u0026#39;\t\u0026#39;02: CA:FF:EE:BA:BE \u0026#39; # bssid: BSSID to use for Ad-Hoc devices Specific device section looks like that: config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39;\t\u0026#39;adhoc \u0026#39; # WiFi supported modes are \u0026#34;adhoc\u0026#34;, \u0026#34;ap\u0026#34; or \u0026#34;none\u0026#34; option \u0026#39;name \u0026#39;\t\u0026#39;qMp \u0026#39; # WiFi SSID to use in this device option \u0026#39;txpower \u0026#39;\t\u0026#39;20\u0026#39; # txpower: Transmit power for this device option \u0026#39;channel \u0026#39;\t\u0026#39;48+ \u0026#39; # channel: Channel for this device. If +/- added, 802.11n in mode HT40 will be used option \u0026#39;mac \u0026#39;\t\u0026#39;00: AA:BB:CC:DD:EE \u0026#39; # mac: MAC identify the device option \u0026#39;device \u0026#39;\t\u0026#39;wlan0 \u0026#39; # device: Interface name used for this device Tunnels config \u0026#39;qmp \u0026#39; \u0026#39;tunnels \u0026#39; option \u0026#39;search_ipv4_tunnel \u0026#39;\t\u0026#39;0.0.0.0/0 \u0026#39; option \u0026#39;offer_ipv6_tunnel \u0026#39;\t\u0026#39;::/0 \u0026#39; Autoconfiguration system: /qmp_autoconf\t# se ejecuta solo en el primer arranque, si ya existe no se ejecuta /etc/init.d/qmp_autoconf # a init script # pasos del autoconf 1. Check if control file exist 2. Configure wireless devices 3. Configure networking 4. Restart affected services 5. Create control file Wireless config /etc/qmp/qmp_wireless.sh # dos funciones 1 qmp_configure_wifi_initial # config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39; \u0026#39;adhoc \u0026#39; option \u0026#39;name \u0026#39; \u0026#39;qMp -MESH \u0026#39; config \u0026#39;wireless \u0026#39; option \u0026#39;mode \u0026#39; \u0026#39;ap \u0026#39; option \u0026#39;name \u0026#39; \u0026#39;qMp -AP \u0026#39; 2 qmp_configure_wifi # in /etc/qmp/templates wireless .# QMP_DEVICE =wifi - device wireless .# QMP_DEVICE. type = mac80211 wireless .# QMP_DEVICE. macaddr =# QMP_MAC wireless .# QMP_DEVICE. channel =# QMP_CHANNEL wireless .@wifi - iface [# QMP_INDEX ]. mode = adhoc wireless .@wifi - iface [# QMP_INDEX ]. bssid =# QMP_BSSID MANAGEMENT TOOLS qmpcontrol # is located on /etc/qmp/qmp_control.sh Usage : /usr/bin/qmpcontrol \u0026lt;function \u0026gt; [ params ] Available functions : offer_default_gw\t: Offers default gw to the network search_default_gw\t: Search for a default gw in the network configure_wifi\t: Configure and apply current wifi settings configure_network\t: Configure and apply current network settings apply_netserver\t: Start / stop netserver depending on configuration enable_ns_ppt\t: Enable POE passtrought from NanoStation M2/5 devices . Be careful with this qmpinfo # It uses the library provided by OpenWRT libiwinfo which gives information about WiFi devices. Usage : qmpinfo \u0026lt;question \u0026gt; [ options ] Available questions : modes \u0026lt;dev \u0026gt;\t: supported modes by the wireless card channels \u0026lt;dev \u0026gt;\t: supported channels and supported HT40 type (+/ -) ipv4\t: print all ipv4 from this computer ( excluding localhost ) hostname\t: print device hostname bwtest \u0026lt;ipv6 \u0026gt;\t: perform a bandwidth test nodes\t: list all nodes on MESH network key\t: print qmp key ","description":"UCI qMp archivo de configuraci√≥n","id":66,"section":"posts","tags":["OpenWRT","qMp","wifi","mesh","cepeda la mora"],"title":"UCI qMp archivo de configuraci√≥n","uri":"http://localhost:1313/es/posts/uci_qmp_configuration_file/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones.\nCambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes alg√∫n router viejo por casa y es compatible. Dependiendo del router es m√°s o menos f√°cil cargar el firmware, este router no es f√°cil y va corto de memoria pero se puede.\nhttps://openwrt.org/toh/comtrend/ct5365\n1. Seleccionar firmware: Este es un Router muy parecido al CT-5361 es un poco m√°s moderno, pero no deja de ser una patatilla, ojo puede dar mucho juego aunque tenga poca memoria.\nEstos son los ensayos que hice:\nAttitude Adjustment: http://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/openwrt-96348GW-generic-squashfs-cfe.bin\nSe reinicia el router al navegar por luci üëé\nhttp://downloads.openwrt.org/attitude_adjustment/12.09/brcm63xx/generic/openwrt-96348A-122-generic-squashfs-cfe.bin\nSe reinicia el router al navegar por luci. Por consola responde, se satura cuando navegas por el luci con pinchar un par de pesta√±as se bloquea a continuaci√≥n p√°gina de tiempo agotado y termina por reiniciarse. üëé\nBackfire http://downloads.openwrt.org/backfire/10.03.1/brcm63xx/openwrt-96348GW-generic-squashfs-cfe.bin\nNo se enciende el power despu√©s de cargar el firmware, no da ip üëé\nhttp://downloads.openwrt.org/backfire/10.03/brcm63xx/openwrt-96348GW-generic-squashfs-cfe.bin\nNo se enciende el power despu√©s de cargar el firmware, no da ip üëé\nhttp://downloads.openwrt.org/backfire/10.03/brcm63xx/openwrt-96348GW-11-squashfs-bc300-cfe.bin\nNo se enciende el power despu√©s de cargar el firmware, no da ip üëé\nhttps://dl.dropbox.com/u/4708147/openwrt/bcm63xx/CT-5365/openwrt-96348GW-generic-squashfs-cfe_backfire_10.03.1.bin\nEnlace roto, no pude probar. ‚úã\nBarrier Breaker http://downloads.openwrt.org/barrier_breaker/14.07-rc2/brcm63xx/generic/openwrt-96348A-122-generic-squashfs-cfe.bin\nSe reinicia el router al navegar por luci. üëé\nBackfire (10.03.1, unknown) Compartido por plumanegra.\nhttp://www.4shared.com/file/yGiVhj8ice/openwrt-96348GW-generic-squash.html\nFunciona el luci y se mantiene !!! üëç\n2. Instalar el firmware Antes de instalar el firmware conviene visitar la wiki openWRT del modelo http://wiki.openwrt.org/toh/comtrend/ct5365 para echar un vistazo.\nEncender el router con el bot√≥n de reset pulsado unos 10 segundos para entrar al modo bootloader.\nFijar una IP del rango del router\n1 ifconfig eth0 192.168.1.222 Nos conectamos al a la boca X3 por ejemplo y cargamos el .bin, desde el navegador a la ip del portal bootloader 192.168.1.1\nSi en alg√∫n momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que p√°gina entregarnos, la cache no coincide con la realidad. Ahora podemos acceder a la web para subir el firmware. Pasados unos minutos se solicita ip por dhcp.\n1 2 telnet 192.168.1.1 passwd root # para fijar el password y activar el SSH Si se interrumpe la alimentaci√≥n cuando estamos editando el firmware desp√≠dete del aparato. 3. Configuraci√≥n como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contrase√±a, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1 2 dhclient eth0 telnet 192.168.1.1 Fijar password\n1 passwd root Para ponerlo como router neutro editamos el /etc/config/network y lo dejamos tal que as√≠, (prestando atenci√≥n a las MAC, sumar 1 para la MAC de la WAN)\nvi /etc/config/network\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 config ‚Äòinterface‚Äô ‚Äòloopback‚Äô option ‚Äòifname‚Äô ‚Äòlo‚Äô option ‚Äòproto‚Äô ‚Äòstatic‚Äô option ‚Äòipaddr‚Äô ‚Äò127.0.0.1‚Äô option ‚Äònetmask‚Äô ‚Äò255.0.0.0‚Äô config ‚Äòswitch‚Äô ‚Äòeth1‚Äô option ‚Äòenable‚Äô ‚Äò1‚Äô option ‚Äòenable_vlan‚Äô ‚Äò1‚Äô option ‚Äòreset‚Äô ‚Äò1‚Äô config ‚Äòinterface‚Äô ‚Äòlan‚Äô option ‚Äòifname‚Äô ‚Äòeth1.1‚Äô option ‚Äòforce_link‚Äô ‚Äò1‚Äô option ‚Äòtype‚Äô ‚Äòbridge‚Äô option ‚Äòproto‚Äô ‚Äòstatic‚Äô option ‚Äòipaddr‚Äô ‚Äò192.168.1.1‚Äô option ‚Äònetmask‚Äô ‚Äò255.255.255.0‚Äô option ‚Äònat‚Äô ‚Äò1‚Äô option ip6assign ‚Äô60‚Äô option macaddr ‚Äô00:1D:XX:XX:XX:31‚Ä≤ config ‚Äòinterface‚Äô ‚Äòwan‚Äô option ‚Äòifname‚Äô ‚Äòeth1.0‚Äô option ‚Äòforce_link‚Äô ‚Äò1‚Äô option ‚Äòmacaddr‚Äô ‚Äô00:1D:XX:XX:XX:32‚Ä≤ option ‚Äòproto‚Äô ‚Äòdhcp‚Äô option ‚Äòdefaultroute‚Äô ‚Äò1‚Äô config ‚Äòswitch_vlan‚Äô option ‚Äòdevice‚Äô ‚Äòeth1‚Äô option ‚Äòvlan‚Äô ‚Äò1‚Äô option ‚Äòports‚Äô ‚Äò1 2 3 4 5t‚Äô config ‚Äòswitch_vlan‚Äô option ‚Äòdevice‚Äô ‚Äòeth1‚Äô option ‚Äòvlan‚Äô ‚Äò0‚Äô option ‚Äòports‚Äô ‚Äò0 5t‚Äô 4 Comprobaciones Guardamos los cambios y reiniciamos la configuraci√≥n de red con un /etc/init.d/network reload , lo dejamos unos minutos y conectamos la WAN, tener en cuenta que ahora los puertos del router se numeran al rev√©s, en la posici√≥n 4X est√° el port 0, es aqu√≠ donde conectamos el internet WAN. 3X 2X y 1X son las patas de LAN.\nApagamos y encendemos el router (al reiniciar interfaces se puede bloquear), y a navegar!.\nAhora podemos configurar c√≥modamente la WiFi y el resto de opciones desde los men√∫s del lUCI.\n","description":"OpenWRT en Comtrend CT-5365","id":67,"section":"posts","tags":["OpenWRT","Router neutro","wifi"],"title":"OpenWRT COMTREND CT-5365","uri":"http://localhost:1313/es/posts/openwrt-comtrend_ct-5365/"},{"content":"De como reciclar un viejo router ADSL y convertirlo en un router neutro con software libre. Se pueden usar como firewall, como AP o por entretenimiento para aprender redes porque ofrecen muchas funciones.\nCambiando el firmware del fabricante a OpenWRT se transforman en router Linux. Dejo un enlace de la lista de hardware compatible https://openwrt.org/toh/start porque seguro que tienes alg√∫n router viejo por casa y es compatible. Dependiendo del router es m√°s o menos f√°cil cargar el firmware, este router no es f√°cil y va corto de memoria pero se puede.\nhttps://openwrt.org/toh/comtrend/ct5361\n1. Seleccionar firmware: He intentado instalar un Barrier Breaker 14.07 ya compilado de seguridad wireless pero no he podido hacerlo funcionar, el router se reinicia, lo ponen como que ya tiene lUCI, pero tampoco me ha funcionado el acceso por web.\nLista de firmwares Stable:\nChaos Calmer 15.05\tDownload images\t2015 September\tr46767\nBarrier Breaker 14.07\tDownload images\t2014 October\tr42625\nAttitude Adjustment 12.09\tDownload images\t2013 April\tr36088\nBackfire 10.03.1\tDownload images\t2011 December\tr29592\nBackfire 10.03\tDownload images\t2010 April\tr20728\nKamikaze 8.09.2\tDownload images\t2010 January\tr18801\nKamikaze 8.09.1\tDownload images\t2009 June\tr16278\nKamikaze 8.09\tDownload images\t2008 September\tr14510\nKamikaze 7.09\tDownload images\t2007 September\tr7831\nKamikaze 7.07\tDownload images\t2007 July\nKamikaze 7.06\tDownload images\t2007 June\tr7204\nWhite Russian 0.9\tDownload images\t2007 January\tr6257\nAl final se han seguido los pasos de la wiki openWRT para este modelo y lo tengo funcionando con Backfire (10.03.1, r29592) el lUCI no es tan chulo como el Barrier Breaker pero sirve para trabajar igual de bien.\n2. Instalar el firmware Si en alg√∫n momento del proceso al acceder por web al router para cambiar el firmware nos aparece la pagina rosa con el texto:\n404 Not Found\nFile not found.\nmicro_httpd\nVamos a las preferencias de nuestro navegador, privacidad y limpiamos la cache, esto pasa por que le hacemos un lio al navegador y ya no sabe que p√°gina entregarnos, la cache no coincide con la realidad. Encender el router con el bot√≥n de reset pulsado unos 10 segundos para entrar al modo bootloader.\nFijar una IP del rango del router\n1 ifconfig eth0 192.168.1.222 Abrir en el navegador la direcci√≥n del router 192.168.1.1, seleccionar el fichero .bin cargarlo y esperar pacientemente a que se reinicie.\nSi se interrumpe la alimentaci√≥n cuando estamos editando el firmware desp√≠dete del aparato. 3. Configuraci√≥n como router neutro. Cuando se pone el nuevo firmware solo se puede acceder por telnet y sin contrase√±a, el SSH se activa cuando se fija el password de root.\nDesde PC pedir ip por dhcp:\n1 2 dhclient eth0 telnet 192.168.1.1 Fijar password\n1 passwd root Editar /etc/config/network.\n1 vi /etc/config/network Borramos todo el contenido del archivo y pegamos esto directamente. (Cambiar las MAC por las del router y en la mac de la wan sumar 1).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 config ‚Äòinterface‚Äô ‚Äòloopback‚Äô option ‚Äòifname‚Äô ‚Äòlo‚Äô option ‚Äòproto‚Äô ‚Äòstatic‚Äô option ‚Äòipaddr‚Äô ‚Äò127.0.0.1‚Äô option ‚Äònetmask‚Äô ‚Äò255.0.0.0‚Äô config globals ‚Äòglobals‚Äô option ula_prefix ‚Äòxxxx:001c:xxxx::/48‚Äô config ‚Äòswitch‚Äô ‚Äòeth1‚Äô option ‚Äòenable‚Äô ‚Äò1‚Äô option ‚Äòenable_vlan‚Äô ‚Äò1‚Äô option ‚Äòreset‚Äô ‚Äò1‚Äô config ‚Äòinterface‚Äô ‚Äòlan‚Äô option ‚Äòifname‚Äô ‚Äòeth1.1‚Äô option ‚Äòforce_link‚Äô ‚Äò1‚Äô option ‚Äòtype‚Äô ‚Äòbridge‚Äô option ‚Äòproto‚Äô ‚Äòstatic‚Äô option ‚Äòipaddr‚Äô ‚Äò192.168.1.1‚Äô option ‚Äònetmask‚Äô ‚Äò255.255.255.0‚Äô option ‚Äònat‚Äô ‚Äò1‚Äô option ip6assign ‚Äô60‚Äô option macaddr ‚Äô00:30:xx:xx:xx:7B‚Äô config ‚Äòinterface‚Äô ‚Äòwan‚Äô option ‚Äòifname‚Äô ‚Äòeth1.0‚Äô option ‚Äòforce_link‚Äô ‚Äò1‚Äô option ‚Äòmacaddr‚Äô ‚Äô00:30:xx:xx:xx:7C‚Äô option ‚Äòproto‚Äô ‚Äòdhcp‚Äô option ‚Äòdefaultroute‚Äô ‚Äò1‚Äô config ‚Äòswitch_vlan‚Äô option ‚Äòdevice‚Äô ‚Äòeth1‚Äô option ‚Äòvlan‚Äô ‚Äò1‚Äô option ‚Äòports‚Äô ‚Äò1 2 3 4 5t‚Äô config ‚Äòswitch_vlan‚Äô option ‚Äòdevice‚Äô ‚Äòeth1‚Äô option ‚Äòvlan‚Äô ‚Äò0‚Äô option ‚Äòports‚Äô ‚Äò0 5t‚Äô Guardar y reiniciar la configuraci√≥n de los interfaces, esto tarda:\n1 /etc/init.d/network reload 4 Comprobaciones Olv√≠date de la rotulaci√≥n de interfaces que tra√≠a el router de origen, ahora se quedan as√≠:\nConectar internet a la WAN 0 y pc a LAN 1 2 √≥ 3\n1 2 dhclient eth0 ssh 192.168.1.1 Ahora desde el router y desde nuestra maquina se alcanza internet ya se pueden actualizar o instalar paquetes.\n1 2 ping 8.8.8.8 opkg update Para configurar la wifi y resto de opciones ya se puede hacer por lUCI.\n","description":"Instalar OpenWRT en Comtrend CT-5361","id":68,"section":"posts","tags":["OpenWRT","router neutro","wifi"],"title":"OpenWRT en Comtrend CT-5361","uri":"http://localhost:1313/es/posts/openwrt-comtrend_ct-5361/"},{"content":" ¬øQu√© es guifi.net? guifi.net es una red libre. Los usuarios que quieren conectarse instalan dispositivos de red, normalmente inal√°mbricos, usando bandas de frecuencia de libre uso. Estos dispositivos de red se organizan para encaminar tr√°fico de otros usuarios. La organizaci√≥n es similar a la estructura que hace funcionar Internet. Para las direcciones IP por el momento se usan direcciones no v√°lidas para Internet, llamadas rangos de direcciones para redes privadas. Guifi.net forma parte de una estructura a nivel nacional y mundial en el que se coordinan estas direcciones de modo que si las comunidades se conectan, la red resultante tambi√©n funcione.\nDe lo anterior se deduce que guifi.net no es la √∫nica comunidad de red libre, en cambio tiene el m√©rito de ser la mayor en √°mbito geogr√°fico a nivel mundial, adem√°s de estar abierta a la interconexi√≥n con otras redes de forma organizada.\nLos usuarios de guifi.net deben hacerse responsables de sus actos y por tanto derimir a la propia red de esta responsabilidad. Asimismo deben comprometerse a no interferir con otras redes y a cumplir las normas legales de emisi√≥n vigentes.\nEn guifi.net pueden participar individuos, administraciones y entes privados o empresas.\nGuifi.net no pertenece exclusivamente a nadie m√°s que a sus usuarios.\nResumiendo, guifi.net es una red formada y mantenida por los propios usuarios, desde la cual se pueden ofrecer puentes hacia Internet, pero cuyo objetivo ser√≠a m√°s bien establecer una red propia con sus propios servicios y que conecte usuarios e intereses m√°s locales.\nEn guifi.net no existen cuotas ni pagos, exceptuando las aportaciones voluntarias para el mantenimiento y crecimiento de la red.\nAlgunos datos sobre guifi.net:\n-Premio Nacional de Telecomunicaciones de Catalu√±a 2007.\n-Ha sido nombrada \u0026ldquo;Living Lab\u0026rdquo; por la Comunidad Europea.\n-13754 nodos activos y 6000 mas proyectados.\n-Ritmo crecimiento 100% anual, actualmente alrededor de 500 nodos al mes.\n-Los enlaces cubren 22197 kil√≥metros lineales.\nM√°s informaci√≥n sobre los nodos existentes y otra documentaci√≥n a partir de guifi.net.\nSobre la legalidad 2.1- ¬øGuifi.net es legal?\nLey 32/2003 General de Telecomunicaciones:\n\u0026ldquo;Art√≠culo 6. Requisitos exigibles para la explotaci√≥n de las redes y la prestaci√≥n de los servicios de comunicaciones electr√≥nicas.\u0026rdquo;\n\u0026ldquo;6.2. Los interesados en la explotaci√≥n de una determinada red o en la prestaci√≥n de un determinado servicio de comunicaciones electr√≥nicas deber√°n, con anterioridad al inicio de la actividad, notificarlo fehacientemente a la Comisi√≥n del Mercado de las Telecomunicaciones en los t√©rminos que se determinen mediante real decreto, someti√©ndose a las condiciones previstas para el ejercicio de la actividad que pretendan realizar. Quedan exentos de esta obligaci√≥n quienes exploten redes y se presten servicios de comunicaciones electr√≥nicas en r√©gimen de auto-prestaci√≥n.\u0026rdquo;\nDe la cita textual anterior se desprende que cualquiera puede por auto-prestaci√≥n (los usuarios son los propietarios y se ocupan de sus tramos de red) crear una red. Tal es el caso de guifi.net y tal es el caso de miles de redes que la gente tiene en sus casas.\nLas frecuencias que no requieren licencia las puede usar todo el mundo (Cuadro Nacional de Atribuci√≥n de Frecuencias: 2.4 y 5 GHz).\nSi alguien quiere explotar una frecuencia de forma exclusiva, debe pagar una licencia para otra frecuencia diferente de las no licenciadas (por ejemplo para telefon√≠a m√≥vil).\nEn las no licenciadas y en exteriores, conviene que haya coordinaci√≥n para no molestarse entre diferentes redes. Esto significa que las administraciones no tienen preferencia sobre el uso respecto a los ciudadanos.\nLas bandas de frecuencia sin licencia tienen una limitaci√≥n en la potencia usada en la emisi√≥n. En guifi.net debe respetarse estas potencias (la cumplen los aparatos est√°ndar del mercado, homologaci√≥n con etiqueta CE) y se aconseja siempre usar la menor potencia posible (existe un c√≥digo de conducta de buenas pr√°cticas).\n2.2- ¬øLas administraciones pueden participar?\nLas administraciones obviamente pueden participar dado que la red es libre y no excluyente.\nSi se participa activamente en el despliegue de guifi.net, o si se decide realizar un despliegue propio para uso de los ciudadanos, conviene notificarlo a la Comisi√≥n del Mercado de las Telecomunicaciones. Se trata de una notificaci√≥n y no de una solicitud. En esa notificaci√≥n se debe indicar el tipo de uso o acceso a Internet que se va a realizar. Puede solicitar asesoramiento o realizar las gestiones a trav√©s de la Fundaci√≥n guifi.net (http://fundacio.guifi.net/).\nPor otro lado, dado que la conexi√≥n a Internet se realiza a trav√©s de alguna empresa de comunicaciones, no es necesario llevar un registro de las conexiones realizadas.\n2.3- ¬øSe puede dar acceso a Internet?\nUna cosa que permite guifi.net es que la gente puede ofrecer su acceso a Internet a otros usuarios. Se puede seleccionar el porcentaje de ancho de banda que se quiere prestar y a qui√©n se quiere prestar. Los contratos de ADSL no pueden oponerse puesto que el acceso se har√≠a desde el mismo ordenador o tarjeta de red. En este caso no puede haber una contrapartida econ√≥mica.\nLas administraciones o ayuntamientos tambi√©n pueden ofrecer ese servicio. Normalmente se ofrece un acceso autenticado y/o limitado como el que ya se aplica en telecentros, bibliotecas u otras oficinas de acceso a los ciudadanos. Estos accesos se hacen a trav√©s de un sistema proxy que limita el uso y tipo de servicios a los que se puede acceder (por ejemplo se suele eliminar las redes entre pares (p2p) sobre Internet debido al gran uso de ancho de banda).\nEn estos servicios para conectar con Internet, guifi.net no cambia la naturaleza del acceso, en cambio, gracias a la infraestructura que se puede crear con la red libre, los servicios se acercan a las casas de la gente. Por otro lado tambi√©n se aumenta su disponibilidad: por ejemplo, un telecentro estar√≠a operativo 24 horas en vez de tener un horario fijo de apertura y cierre. Hay que destacar que estos accesos son completamente legales, que ya est√°n funcionando en diversos municipios desde hace a√±os y que tienen un impacto muy positivo en la disminuci√≥n de la brecha digital.\n2.4- ¬øPuede haber actividades comerciales?, ¬øpueden participar empresas privadas?\nAl igual que las administraciones no hay ning√∫n impedimento en que las empresas usen guifi.net tanto para sus intereses propios como para ofrecer servicios, incluso en el caso de que sean con √°nimo de lucro.\n¬øC√≥mo puede participar un ayuntamiento o administraci√≥n? Hay varias formas de participaci√≥n. Intentamos enumerar algunas ordenadas de menor a mayor grado de implicaci√≥n:\n3.1- Ofreciendo ubicaciones donde instalar nodos.\nLas administraciones suelen disponer de ubicaciones estrat√©gicas: edificios, dep√≥sitos de agua, farolas, torres de comunicaciones. Simplemente el hecho de prestar estas ubicaciones para ubicar alguna antena es una gran ayuda para el despliegue de la red libre.\n3.2- Conect√°ndose a guifi.net y ofreciendo servicios e informaci√≥n que ya ofrecen a Internet.\nHay administraciones que ya tiene una red de libre acceso para acceder a servicios e informaci√≥n de la corporaci√≥n. Estas redes pueden conectar con guifi.net, con lo cual esos servicios pueden llegar m√°s lejos y ser m√°s accesible para la gente. Se accede a una red que puede ser mucho mayor que una serie de puntos de acceso conectados y adem√°s la corporaci√≥n no tiene que ocuparse del mantenimiento de esa infraestructura de comunicaciones.\n3.3- Informando a la gente. Organizando cursillos y charlas.\nGuifi.net no es una iniciativa comercial. Cualquier ayuda para difundirla y para dar una informaci√≥n m√≠nima para conectarse y extender la red es bienvenida.\n3.4- Montando algunos \u0026ldquo;nodos de cobertura\u0026rdquo; y conect√°ndolos a redes ya disponibles para los ciudadanos. Ofreciendo algunos accesos a Internet a trav√©s de proxys (telecentros, bibliotecas).\nEsta posibilidad se describe en el apartado 2.3. Como informaci√≥n orientativa podemos indicar que el coste de un nodo de cobertura de guifi.net puede oscilar entre 900‚Ç¨ y 2500‚Ç¨ dependiendo del √°ngulo de cobertura y de enlaces direccionales en los que se participe. Estos precios incluyen el material para la red pero excluyen mano de obra o infraestructura para el montaje. Un nodo normal (el que usan los usuarios dom√©sticos) ronda los 80/100‚Ç¨.\nLos proxys de acceso a Internet pueden \u0026ldquo;federarse\u0026rdquo; con los de otras poblaciones. De esta forma, un usuario puede hacer uso de su cuenta en una zona m√°s extensa. Es decir un usuario de la poblaci√≥n A puede conectarse con su usuario en la poblaci√≥n B ya que todos los proxys mantienen los mismos usuarios/contrase√±as.\n3.5- Otros proyectos que se pueden poner en marcha sin necesidad de que la gente se conecte a trav√©s de Internet (evitando as√≠ cuotas o gastos de conexi√≥n).\nServicios propios para el ayuntamiento (conexi√≥n de centros, servicios propios de control, comunicaciones en caso de cat√°strofes) y servicios para la gente (radio, televisi√≥n, teleasistencia social, actividades culturales, reservas en instalaciones, informaci√≥n de archivos y bibliotecas). En general los mismos que Internet pero se evita la exclusi√≥n digital.\n3.6- Si despu√©s llega otra comunidad de red libre o una empresa que quiere ofrecer cosas parecidas, ¬øqu√© debemos responder?\nHabr√≠a que coordinarse. Guifi.net es una red abierta a la interconexi√≥n con otras redes. Concesiones exclusivas son innecesarias y pueden ser ilegales ya que pueden vulnerar la libre competencia.\n3.7- Para ceder espacio o recursos necesitamos firmar un acuerdo con alguna entidad. ¬øCon qui√©n se tendr√≠a que firmar en el caso de guifi.net?\nEn realidad pensamos que no es necesario porque el material o el espacio cedido sigue siendo propiedad de la administraci√≥n que lo proporciona. En cualquier caso se pueden firmar convenios con la fundaci√≥n sin √°nimo de lucro que respalda guifi.net: Fundaci√≥ privada per a la xarxa oberta, lliure i neutral guifi.net (http://fundacio.guifi.net/). Cualquier beneficio obtenido por esta fundaci√≥n se destina √≠ntegramente a la mejora, defensa y desarrollo de la propia red. Para estudios de viabilidad o asesoramiento tambi√©n se puede contactar con algunos grupos de investigaci√≥n de universidades.\n¬øQu√© puede aportar guifi.net a los ayuntamientos y administraciones? En general el mayor inter√©s es que sus servicios se abren a los ciudadanos. Llegar√°n m√°s lejos y a una parte mayor de la poblaci√≥n. Todo esto a muy bajo coste porque gran parte de la red la mantiene y mejora los propios usuarios.\nSobre la red libre se pueden montar servicios que llegan m√°s f√°cilmente a la gente. Para una corporaci√≥n podr√≠a ser caro y complicado realizar todo el despliegue de la red hasta llegar a una gran parte de los usuarios finales.\nPor otro lado, debido al n√∫mero creciente de nodos ya funcionales, hay consecuentemente un gran n√∫mero de servicios disponibles. Por ejemplo, al conectar poblaciones, los servicios que se ofrecen desde un ayuntamiento tambi√©n son accesibles desde sus vecinos o comarcas.\n","description":"guifi.net y redes comunitarias en colaboraci√≥n con ayuntamientos","id":69,"section":"posts","tags":["guifi.net","cepeda la mora"],"title":"FAQ de ayuntamientos","uri":"http://localhost:1313/es/posts/ayuntamientos_y_guifi_net/"},{"content":"Me decid√≠ a formular una propuesta para el despliegue de la red en Cepeda, como no tenia ni idea, le present√© al alcalde de aquella √©poca Javier Garcia un pdf, a lo que el alcalde respond√≥:\n\u0026ldquo;Mira, a mi no me vengas con cosas t√©cnicas, si quieres hacerlo\u0026hellip; adelante. Te voy a ayudar en lo que pueda.\u0026rdquo;\nIdea inicial Est√° era la ida que ten√≠a para el despliegue en 2014:\nUna salida balanceada a internet con una RB-750 con un superservidor proxy para cachear a todo el que se asomara por all√≠ y otra RB-750 para gestionar las conexiones del hotspot, ah√≠ lo pone, 30 minutos al d√≠a con un caudal de 256 Kb en bajada y 64 Kb en subida. AP Unifi\nPara conectar las viviendas un modelo en Infraestructura AP cliente con una antena central a la que se conectan las estaciones de las casas.\nParece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nPropuesta Este es el documento que se present√≥ al Ayto, en nombre de la AC RASPUTIN. No me extra√±a que el alcalde me dijera que hiciera lo que quisiera.\nEl logo de la cabra es lo que m√°s me gusta, est√° a punto de embestir a los ISP tradicionales.\nParece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nLo que nos tenemos que tatuar es el procom√∫n de la Red Abierta Libre y Neutral:\nEl Procom√∫n de la RALN se fundamenta en las siguientes bases:\nEres libre de utilizar la red para cualquier prop√≥sito mientras no perjudiques el\nfuncionamiento de la propia red, la libertad de otros usuarios, y respetes las\ncondiciones de los contenidos y servicios que circulan libremente. Eres libre de conocer como es la red, sus componentes y su funcionamiento,\ntambi√©n puedes difundir su esp√≠ritu y funcionamiento libremente. Eres libre para incorporar servicios y contenidos a la red con las condiciones\nque quieras. Eres libre de Incorporarte a la red y ayudar a extender estas libertades y\ncondiciones. Es este documento est√° detallada la autoprovisi√≥n de nodos para el despliegue en modo infraestructura en la plataforma guifi.net\nParece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nPresupuesto Se present√≥ un presupuesto en base a la propuesta. Creo que me salian 900 euros, esto es lo que se aprob√≥ y lo que pag√≥ el ayuntamiento m√°s la salida a internet.\n600 euros para un ayuntamiento es un gasto rid√≠culo, en las empresas que trabajan este producto el precio habitual para un proyecto as√≠ es de 6000 a 10000 euros llave en mano + el coste de la gesti√≥n y el mantenimiento de la red. ¬øLo ves caro? pues hazlo t√∫ mismo.\nSolo necesitas tener los conocimientos adecuados, bueno tambi√©n te har√° falta un ordenador y una conexi√≥n a internet para hacer la gesti√≥n remota, un espacio de trabajo, carnet de conducir y un coche grande o una furgoneta para poder desplazarte y transportar el equipamiento, los tramos de las torres y los m√°stiles, ropa de trabajo, EPIs, herramienta de mano, escalera grande de 3 tramos y peque√±a, taladro, brocas, radial, discos, atornilladora, crimpadora, conectores, herrajes, abrazaderas, bridas, tacos, tornillos, cinta aislante, guiacables, aparatos de medida, comprobador de cables, cable ftp exterior, cable ftp interior, material el√©ctrico, conocimientos, negociaciones con proveedores, dinero para comprar el equipamiento, desplazamientos a proveedores, desplazamientos programados para labores preventivas, desplazamientos extraordinarios por aver√≠as, conocimientos, seguro de responsabilidad civil, titulaci√≥n para trabajo en altura, tasas e impuestos, combustible, dinero, conocimientos y lo m√°s valioso de todo, TU TIEMPO.\nSAX Lleg√≥ el SAX 2015. El SAX (Salut, Amor i Xarxa), es un encuentro anual de la comunidad guifi.net, all√≠ conoc√≠ al Sr. Roger Pueyo, le coment√© la idea que ten√≠amos para desplegar en Cepeda y despu√©s de una charla muy amena, llegue a la conclusion de que lo m√°s econ√≥mico y productivo que podia hacer era desplegar la red en modo adhoc con qMp, Quick Mesh Project.\nDesplegar en modo infraestructura puede est√°r bien en algunos escenarios, si tienes una ubicaci√≥n con alimentaci√≥n el√©ctrica y acceso asegurado desde la que se domine todo el √°rea que quieras iluminar, pues genial. Tendr√°s un punto central al que apuntar todas las conexiones, esto es una red centralizada punto-multipunto y si falla el punto central dejar√° de funcionar toda la red, puedes redundar la antena central para que esto no suceda. Cuando quieras conectar una nueva antena tendr√°s que configurar en los 2 extremos.\nPero en el escenario que tenemos en Cepeda no hay un s√≠tio m√°gico desde el que se pueda ver todo el pueblo, estuve mirando el deposito de agua, pero eran todo problemas, la alimentaci√≥n el√©ctrica, el acceso, la ubicaci√≥n expuesta a robos y sabotajes, aparte que la salida a internet est√° en el ayuntamiento, ten√≠a que hacer un enlace dedicado del Ayto al dep√≥sito con 2 equipos, 4 en caso de redundancia y otro equipo bien potente para conectar con todos los nodos.\nqMp Con el despliegue en mesh la cobertura se va extendiendo con cada equipo que se incorpora a la red, se convierte en una red descentralizada que es un valor a√±adido.\nLo primero que hay que hacer en montar toda la red sobre una mesa, elije un espacio de trabajo y empieza a configurar equipos, ponlos en producci√≥n y sometelos durante un tiempo a un estricto seguimiento. Cuando tengas la seguridad de que los equipos funcionan como t√∫ quieres los instalas, cuando estamos instalando no podemos hacer investigaciones ni pruebas ni otra cosa que no sea instalar, de est√° manera si falla algo en la instalaci√≥n autom√°ticamente se descartan problemas de configuraci√≥n.\nPara comenzar con el despliegue qMp recomiendo elegir ubicaciones elevadas y que siempre est√©n encendidas, de est√° manera la cobertura de la red se ir√° extendiendo sin esfuerzo a medida que se van agregando nuevos nodos.\nSe puede desplegar en 2.4 GHZ 802.11bg o en 5 GHz 802.11a, dependiendo del escenario, si queremos desplegar en el interior de un edificio podemos hacerlo con equipos indoor y en 2.4 GHz, si los equipos est√°n en la calle necesitamos CPE que soporten intemperie agua, hielo, sol y viento.\nHay que tener en cuenta que debemos elegir con mucha atenci√≥n el hardware, tiene que ser compatible con OpenWRT/qMp. Esta es la lista de hardware compatible https://qmp.cat/Supported_devices\n27/03/2021 Ojo con las nuevas remesas de equipamiento Ubiquiti, las nuevas revisiones 2000K y superiores de NanoStation Loco M5 no funcionan ni con OpenWRT ar71xx ni con OpenWRT ath79, ni tan siquiera probando OpenWRT ath79 para Bullet M XW que s√≠ funciona en las Rocket M XW. Al parecer hay dos arquitecturas distintas que sirven para distintas revisiones de hardware de Ubiquiti .La ar71xx es la de siempre, antes funcionaba, la ath79 es la nueva. No s√© sabe todav√≠a la manera de flashearlas. ","description":"La Propuesta de red comunitaria que se hizo al Ayto","id":70,"section":"posts","tags":["guifi.net","qMp","guifi.net","cepeda la mora","wifi"],"title":"La propuesta","uri":"http://localhost:1313/es/posts/la_propuesta/"},{"content":"Y se puso en producci√≥n el hotspot, un hotspot en wifi es un dispositivo con capacidades de enrutamiento que gestiona conexiones de otros dispositivos (punto caliente) y les da salida a internet, una especie de pasarela o gateway pero en este caso con capacidades de gesti√≥n del trafico.\nLa salida a internet para toda la red comunitaria la dona el excelent√≠simo Ayto de Cepeda la Mora, es un router 4G de 10 Mb dedicado.\nHardware MikroTik Para hacer la gesti√≥n de los dispositivos que se conectan a pie de calle se usa una ROUTERBOARD MIKROTIK RB750GL, este router est√° dedicado solo para esta tarea, lleva funcionando 24x7 desde el a√±o 2014 de la era pre-covid.\nUbiquiti La red de captaci√≥n del hotspot va toda en 2.4 Ghz, APs en 802.11b para que se puedan conectar dispositivos antiguos.\nEl AP de la plaza Ubiquiti NanoStation 2 est√° en modo AP bridge, debe de tener mas de 10 a√±os, es de cuando ven√≠an con un latiguillo de 3 metros de color azul, \u0026hellip; que tiempos aquellos.\nPara extender la red del hotspot hay en enlace en 2.4 del Ayto al Bar municipal \u0026ldquo;El Traite\u0026rdquo; con Ubiquiti NanoStation Loco M2.\nOpenWRT Para la captaci√≥n en el Bar se usa de AP un router Comtrend AR-5387un https://openwrt.org/toh/comtrend/ar5387un liberado con OpenWRT, ni un problema, 24x7 desde 2014 m√°s lo que llevara funcionando de antes.\nConexiones MikroTik graph TD; ROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;WAN_ether1; ROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;Libre_ether2; ROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;Gesti√≥n_ether3; ROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;bridge1_ether4; bridge1_ether4--\u0026gt;AP_NS2_plaza_Ayto; ROUTERBOARD_MIKROTIK_RB750GL--\u0026gt;bridge1_ether5; bridge1_ether5--\u0026gt;enl_NSlocoM2_a; enl_NSlocoM2_a--\u0026gt;enl_NSlocoM2_b; enl_NSlocoM2_b--\u0026gt;AP_OpenWRT_Bar_Municipal; Configuraci√≥n MikroTik 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 [admin@hostname] \u0026gt; export # mar/14/2021 01:23:15 by RouterOS 6.43.2 # software id = LVV0-IUW2 # # model = 750GL # serial number = 888A02585888 /interface bridge add comment=LAN fast-forward=no mtu=1500 name=bridge1 protocol-mode=none /interface ethernet set [ find default-name=ether1 ] comment=\u0026#34;WAN ether1\u0026#34; name=Lan speed=100Mbps set [ find default-name=ether2 ] speed=100Mbps set [ find default-name=ether3 ] comment=GESTION speed=100Mbps set [ find default-name=ether4 ] comment=-AP-HOSTSPOT disabled=yes speed=100Mbps set [ find default-name=ether5 ] comment=-HS_NANO_ENL speed=100Mbps /interface list add name=mactel add name=mac-winbox /interface wireless security-profiles set [ find default=yes ] supplicant-identity=hostname /ip firewall layer7-protocol add name=youtube regexp=\u0026#34;(GET \\\\/videoplayback\\\\\\?|GET \\\\/crossdomain\\\\.xml)\u0026#34; add name=torrentsites regexp=\u0026#34;^.*(get|GET).+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|torrentz|vertor|h33t|btscene|bitunity|bittoxic|thunderbytes|entertane|zoozle|vcdq|bitnova|bitsoup|meganova|fulldls|btbot|flixflux|\\ seedpeer|fenopy|gpirate|commonbits).*\\$\u0026#34; add name=p2p_www regexp=\u0026#34;^.*(get|GET).+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|vertor|h33t|zoozle|bitnova|bitsoup|meganova|fulldls|btbot|fenopy|gpirate|commonbits).*\\$\u0026#34; add name=p2p_dns regexp=\u0026#34;^.+(torrent|thepiratebay|isohunt|entertane|demonoid|btjunkie|mininova|flixflux|vertor|h33t|zoozle|bitnova|bitsoup|meganova|fulldls|btbot|fenopy|gpirate|commonbits).*\\$\u0026#34; /ip hotspot profile add dns-name=guifi.net_Acceso_Abierto hotspot-address=192.168.100.1 login-by=http-chap,trial name=hsprof2 trial-uptime-limit=2d trial-uptime-reset=23h59m /ip hotspot add interface=bridge1 name=hotspot1 profile=hsprof2 /ip hotspot user profile set [ find default=yes ] add-mac-cookie=no keepalive-timeout=none name=usuarios on-login=\u0026#34;#Keep alive para limitar la sesion diaria a un tiempo\u0026#34; open-status-page=http-login rate-limit=\u0026#34;1M/1M 2M/2M 320k/320k 8/8 1 320/320\u0026#34; shared-users=1000 \\ transparent-proxy=yes /ip ipsec proposal set [ find default=yes ] enc-algorithms=3des /ip pool add name=hs-pool-4 ranges=192.168.100.10-192.168.100.254 add name=pool_gestion ranges=192.168.88.100-192.168.88.200 /ip dhcp-server add add-arp=yes address-pool=hs-pool-4 authoritative=after-2sec-delay disabled=no interface=bridge1 lease-time=1d name=dhcp_HS add add-arp=yes address-pool=pool_gestion disabled=no interface=ether3 name=dhcp_gestion /ip hotspot user profile add address-pool=hs-pool-4 name=sincontrol transparent-proxy=yes /queue simple add burst-limit=3M/3M burst-threshold=256k/256k burst-time=8s/8s disabled=yes max-limit=2M/2M name=queue1 packet-marks=clientes_2M target=ether4 /queue tree add disabled=yes name=cliente_2M_up packet-mark=clientes_2M parent=ether4 priority=1 add disabled=yes name=cliente_2M_down packet-mark=clientes_2M parent=ether4 priority=1 add max-limit=5M name=Download parent=bridge1 priority=1 add max-limit=300k name=Upload parent=Lan priority=1 /queue type add kind=pcq name=PCQ_download_2mb pcq-classifier=dst-address pcq-rate=2M add kind=pcq name=PCQ_upload_300k pcq-classifier=src-address pcq-rate=300k add kind=sfq name=BAJADA add kind=sfq name=SUBIDA /queue simple add comment=\u0026#34;# l\\EDmite global (compartido por todos los usuarios):\\r\\ \\n# 5M subida\\r\\ \\n# 35M bajada\\r\\ \\n# \\r\\ \\n# segmento de red de los clientes con este paquete de datos,\\r\\ \\n# puede usarse una interfaz de ser necesario:\\r\\ \\n# 10.10.12.0/24\u0026#34; limit-at=384k/5M max-limit=384k/5M name=2MB_down_384MB_up queue=PCQ_upload_300k/PCQ_download_2mb target=bridge1 total-queue=default /queue tree add disabled=yes max-limit=32k name=P2P packet-mark=p2p-qos parent=bridge1 queue=default add comment=\u0026#34;una cola para el total del tr\\E1fico de bajada, aqu\\ED se especifica\\r\\ \\n# la interfaz desde la que se reparte el tr\\E1fico a los clientes\u0026#34; disabled=yes limit-at=8M max-limit=8M name=\u0026#34;Total download\u0026#34; parent=bridge1 priority=1 queue=default add comment=\u0026#34;una cola para el total del tr\\E1fico de subida, aqu\\ED se especifica\\r\\ \\n# la interfaz desde la que se env\\EDa el tr\\E1fico al gateway \u0026#34; disabled=yes limit-at=300k max-limit=300k name=\u0026#34;Total upload\u0026#34; parent=Lan priority=1 queue=default add comment=\u0026#34;hoja (cola hija) de bajada para el tr\\E1fico web (HTTP), utiliza\\r\\ \\n# la marca establecida en la tabla mangle del firewall\u0026#34; disabled=yes limit-at=1M max-limit=6M name=HTTP_D packet-mark=priority_packet parent=\u0026#34;Total download\u0026#34; priority=3 queue=default add comment=\u0026#34;hoja de subida para el tr\\E1fico web (HTTP), utiliza la misma marca\\r\\ \\n# de la cola anterior\u0026#34; disabled=yes limit-at=100k max-limit=200k name=HTTP_U packet-mark=priority_packet parent=\u0026#34;Total upload\u0026#34; priority=3 queue=default add comment=\u0026#34;los paquetes con marca \\\u0026#34;other-internet\\\u0026#34; tienen una menor prioridad\\r\\ \\n# que los paquetes web, es necesario especificar estas colas, de lo\\r\\ \\n# contrario el tr\\E1fico no gestionado pasar\\E1 con la mayor prioridad\u0026#34; disabled=yes limit-at=500k max-limit=1M name=OTHER_D packet-mark=no_priority_packet parent=\u0026#34;Total download\u0026#34; priority=4 queue=default add comment=\u0026#34;los paquetes con marca \\\u0026#34;other-internet\\\u0026#34; tienen una menor prioridad\\r\\ \\n# que los paquetes web, es necesario especificar estas colas, de lo\\r\\ \\n# contrario el tr\\E1fico no gestionado pasar\\E1 con la mayor prioridad\u0026#34; disabled=yes limit-at=50k max-limit=100k name=OTHER_U packet-mark=no_priority_packet parent=\u0026#34;Total upload\u0026#34; priority=4 queue=default add name=PRIO1 packet-mark=\u0026#34;PRIO 1\u0026#34; parent=Download priority=1 queue=BAJADA add name=PRIO2 packet-mark=\u0026#34;PRIO 2\u0026#34; parent=Download priority=2 queue=BAJADA add name=PRIO3 packet-mark=\u0026#34;PRIO 3\u0026#34; parent=Download priority=3 queue=BAJADA add name=PRIO4 packet-mark=\u0026#34;PRIO 4\u0026#34; parent=Download priority=4 queue=BAJADA add name=PRIO5 packet-mark=\u0026#34;PRIO 5\u0026#34; parent=Download priority=5 queue=BAJADA add name=PRIO7 packet-mark=\u0026#34;PRIO 7\u0026#34; parent=Download priority=7 queue=BAJADA add name=PRIO8 packet-mark=\u0026#34;PRIO 8\u0026#34; parent=Download queue=BAJADA add name=PRIO.1 packet-mark=\u0026#34;PRIO 1\u0026#34; parent=Upload priority=1 queue=SUBIDA add name=PRIO.2 packet-mark=\u0026#34;PRIO 2\u0026#34; parent=Upload priority=2 queue=SUBIDA add name=PRIO.3 packet-mark=\u0026#34;PRIO 3\u0026#34; parent=Upload priority=3 queue=SUBIDA add name=PRIO.4 packet-mark=\u0026#34;PRIO 4\u0026#34; parent=Upload priority=4 queue=SUBIDA add name=PRIO.5 packet-mark=\u0026#34;PRIO 5\u0026#34; parent=Upload priority=5 queue=SUBIDA add name=PRIO.7 packet-mark=\u0026#34;PRIO 7\u0026#34; parent=Upload priority=7 queue=SUBIDA add name=PRIO.8 packet-mark=\u0026#34;PRIO 8\u0026#34; parent=Upload queue=SUBIDA /snmp community set [ find default=yes ] addresses=0.0.0.0/0 /system logging action set 0 memory-lines=100 set 1 disk-lines-per-file=100 set 3 remote=192.168.1.213 /interface bridge port add bridge=bridge1 hw=no interface=ether4 add bridge=bridge1 hw=no interface=ether5 /interface bridge settings set use-ip-firewall=yes /interface list member add interface=ether2 list=mactel add interface=ether3 list=mactel add interface=ether2 list=mac-winbox add interface=ether4 list=mactel add interface=ether3 list=mac-winbox add interface=ether5 list=mactel add interface=ether4 list=mac-winbox add interface=ether5 list=mac-winbox /ip address add address=10.228.150.3/28 comment=\u0026#34;GW Ayto\u0026#34; interface=Lan network=10.228.150.0 add address=192.168.100.1/24 comment=\u0026#34;GW hotspot\u0026#34; interface=bridge1 network=192.168.100.0 add address=192.168.88.1/24 interface=ether3 network=192.168.88.0 /ip dhcp-server network add address=192.168.88.0/24 comment=\u0026#34;default configuration\u0026#34; gateway=192.168.88.1 add address=192.168.100.0/24 gateway=192.168.100.1 /ip dns set allow-remote-requests=yes cache-size=10096KiB max-udp-packet-size=512 servers=10.228.150.6,8.8.4.4 /ip firewall address-list add list=Syn_Flooder add disabled=yes list=spammers add disabled=yes list=support add address=192.168.100.0/24 list=Cliente_2M add address=10.228.150.0/28 list=guifi.net /ip firewall filter add action=accept chain=input comment=\u0026#34;Accept to established connections\u0026#34; connection-state=established add action=accept chain=input comment=\u0026#34;Accept to related connections\u0026#34; connection-state=related add action=drop chain=forward comment=\u0026#34;Filtra paquetes chungos\u0026#34; connection-state=invalid add action=passthrough chain=unused-hs-chain comment=\u0026#34;place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotspot rules here ----------- place hotsp\\ ot rules here ----------- place hotspot rules here ----------- \u0026#34; add action=jump chain=output comment=\u0026#34;Jump for icmp output\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=add-src-to-address-list address-list=Syn_Flooder address-list-timeout=30m chain=input comment=\u0026#34;Add Syn Flood IP to the list\u0026#34; connection-limit=30,32 protocol=tcp tcp-flags=syn add action=drop chain=input comment=\u0026#34;Drop to syn flood list\u0026#34; src-address-list=Syn_Flooder add action=drop chain=input comment=\u0026#34;Drop to syn flood list\u0026#34; disabled=yes src-address-list=Syn_Flooder add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;Port scanners to list \u0026#34; protocol=tcp psd=21,3s,3,1 add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp psd=21,3s,3,1 add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; disabled=yes log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp psd=21,3s,3,1 add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP FIN Stealth scan\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/FIN scan\u0026#34; protocol=tcp tcp-flags=fin,syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/RST scan\u0026#34; protocol=tcp tcp-flags=syn,rst add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/FIN scan\u0026#34; protocol=tcp tcp-flags=fin,syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;SYN/RST scan\u0026#34; protocol=tcp tcp-flags=syn,rst add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;FIN/PSH/URG scan\u0026#34; protocol=tcp tcp-flags=fin,psh,urg,!syn,!rst,!ack add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;FIN/PSH/URG scan\u0026#34; protocol=tcp tcp-flags=fin,psh,urg,!syn,!rst,!ack add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;ALL/ALL scan\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP NULL scan\u0026#34; protocol=tcp tcp-flags=!fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP FIN Stealth scan\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=Port_Scanner address-list-timeout=1w chain=input comment=\u0026#34;Port Scanner Detect\u0026#34; protocol=tcp psd=21,3s,3,1 add action=drop chain=input comment=\u0026#34;dropping port scanners\u0026#34; src-address-list=\u0026#34;port scanners\u0026#34; add action=jump chain=input comment=\u0026#34;Jump for icmp input flow\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=jump chain=forward comment=\u0026#34;Jump for icmp forward flow\u0026#34; disabled=yes jump-target=ICMP protocol=icmp add action=drop chain=input comment=\u0026#34;drop ftp brute forcers\u0026#34; dst-port=21 protocol=tcp src-address-list=ftp_blacklist add action=drop chain=input comment=\u0026#34;drop ssh brute forcers\u0026#34; dst-port=22 protocol=tcp src-address-list=ssh_blacklist add action=add-src-to-address-list address-list=ssh_blacklist address-list-timeout=1w3d chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage3 add action=add-src-to-address-list address-list=ssh_stage3 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage2 add action=add-src-to-address-list address-list=ssh_stage2 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp src-address-list=ssh_stage1 add action=add-src-to-address-list address-list=ssh_stage1 address-list-timeout=1m chain=input connection-state=new dst-port=22 protocol=tcp add action=drop chain=forward comment=\u0026#34;drop ssh brute downstream\u0026#34; dst-port=22 protocol=tcp src-address-list=ssh_blacklist add action=drop chain=ICMP comment=\u0026#34;Drop to the other ICMPs\u0026#34; disabled=yes protocol=icmp add action=drop chain=forward comment=\u0026#34;Drop to bogon list\u0026#34; dst-address-list=bogons add action=add-src-to-address-list address-list=spammers address-list-timeout=3h chain=forward comment=\u0026#34;Add Spammers to the list for 3 hours\u0026#34; connection-limit=30,32 dst-port=25,587 limit=30/1m,0 protocol=tcp add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;ALL/ALL scan\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;NMAP NULL scan\u0026#34; protocol=tcp tcp-flags=!fin,!syn,!rst,!psh,!ack,!urg add action=add-src-to-address-list address-list=Syn_Flooder address-list-timeout=30m chain=input comment=\u0026#34;Add Syn Flood IP to the list\u0026#34; connection-limit=30,32 protocol=tcp tcp-flags=syn add action=add-src-to-address-list address-list=\u0026#34;port scanners\u0026#34; address-list-timeout=2w chain=input comment=\u0026#34;Port scanners to list \u0026#34; protocol=tcp psd=21,3s,3,1 add action=drop chain=forward comment=\u0026#34;DENIEGO ICMP\u0026#34; disabled=yes protocol=icmp add action=accept chain=input comment=\u0026#34;Accept DNS - UDP\u0026#34; port=53 protocol=udp add action=accept chain=input comment=\u0026#34;Accept DNS - TCP\u0026#34; port=53 protocol=tcp add action=accept chain=forward comment=\u0026#34;ACEPTAR FTP \u0026#34; connection-state=established connection-type=ftp protocol=0 add action=accept chain=input comment=\u0026#34;Full access to SUPPORT address list\u0026#34; src-address-list=support add action=accept chain=ICMP comment=\u0026#34;Echo request - Avoiding Ping Flood\u0026#34; icmp-options=8:0 limit=1,5 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Echo reply\u0026#34; icmp-options=0:0 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Time Exceeded\u0026#34; icmp-options=11:0 protocol=icmp add action=accept chain=ICMP comment=\u0026#34;Destination unreachable\u0026#34; icmp-options=3:0-1 protocol=icmp add action=accept chain=ICMP comment=PMTUD icmp-options=3:4 protocol=icmp add action=drop chain=ICMP comment=\u0026#34;Drop to the other ICMPs\u0026#34; disabled=yes protocol=icmp add action=log chain=input log-prefix=\u0026#34;PING DENEGADO\u0026#34; protocol=icmp add action=drop chain=virus comment=\u0026#34;VIRUS DE WINDOWS\u0026#34; dst-port=135-139,445 protocol=tcp add action=log chain=virus comment=\u0026#34;LOG VIRUS DE WINDOWS\u0026#34; dst-port=135-139,445 log-prefix=\u0026#34;VIRUS WINDOWS\u0026#34; protocol=tcp add action=jump chain=input jump-target=virus add action=drop chain=input comment=\u0026#34;Bloqueo DNS cache externo\u0026#34; dst-port=53 protocol=udp add action=drop chain=forward comment=\u0026#34;Todo P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;DROP INPUT P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;DROP OUTPUT P2P\u0026#34; connection-mark=p2p-conn disabled=yes add action=drop chain=input comment=\u0026#34;corta ping packetes de 99 bytes a m\\E1s.\u0026#34; packet-size=128-65535 protocol=icmp add action=log chain=input log-prefix=\u0026#34;PING DENEGADO\u0026#34; protocol=icmp add action=drop chain=input comment=\u0026#34;corta ping\u0026#34; disabled=yes protocol=icmp src-address-list=!guifi.net add action=add-src-to-address-list address-list=\u0026#34;IP\u0026#39;s totales\u0026#34; address-list-timeout=none-dynamic chain=forward disabled=yes src-address=192.168.0.0/16 add action=add-src-to-address-list address-list=acceso-winbox address-list-timeout=none-dynamic chain=input dst-port=8291 protocol=tcp add action=add-src-to-address-list address-list=Port_Scanner address-list-timeout=1w chain=input comment=\u0026#34;Port Scanner Detect PUEDE LLEGAR A CERRAR EL PUERTO FPT SI HAY MUCHA ACTIVIDAD, LO PONE EN LA LISTA COMO SCANER DE PUERTOS \u0026#34; protocol=tcp psd=\\ 21,3s,3,1 add action=drop chain=forward comment=\u0026#34;Drop to bogon list\u0026#34; dst-address-list=bogons add action=add-src-to-address-list address-list=spammers address-list-timeout=3h chain=forward comment=\u0026#34;Add Spammers to the list for 3 hours\u0026#34; connection-limit=30,32 dst-port=25,587 limit=30/1m,0 protocol=tcp add action=drop chain=forward comment=\u0026#34;Avoid spammers action\u0026#34; dst-port=25,587 protocol=tcp src-address-list=spammers add action=drop chain=forward comment=\u0026#34;Limitar Numero de conexiones UDP por cliente\u0026#34; connection-state=new disabled=yes dst-port=!53,67,123 limit=30,40:packet protocol=udp add action=drop chain=forward comment=\u0026#34;default configuration\u0026#34; disabled=yes protocol=icmp add action=accept chain=input comment=\u0026#34;default configuration\u0026#34; connection-state=related disabled=yes add action=accept chain=input comment=\u0026#34;default configuration\u0026#34; connection-state=established disabled=yes add action=drop chain=input comment=\u0026#34;default configuration\u0026#34; disabled=yes in-interface=Lan add action=accept chain=input comment=\u0026#34;DENIEGO ICMP\u0026#34; disabled=yes protocol=icmp add action=accept chain=forward comment=\u0026#34;Reglas Firewall Basicas\u0026#34; connection-state=related add action=accept chain=forward connection-state=established add action=drop chain=input comment=\u0026#34;FIltra ICMP Redirect\u0026#34; icmp-options=5:0-255 protocol=icmp add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,!syn,!rst,!psh,!ack,!urg add action=log chain=input comment=\u0026#34;Port Scanner Detect LOG\u0026#34; log-prefix=\u0026#34;PORT SCAN\u0026#34; protocol=tcp tcp-flags=fin,syn,rst,psh,ack,urg,!syn,!rst,!ack,!urg add action=accept chain=output content=\u0026#34;530 Login incorrect\u0026#34; dst-limit=1/1m,9,dst-address/1m protocol=tcp add action=add-dst-to-address-list address-list=ftp_blacklist address-list-timeout=3h chain=output content=\u0026#34;530 Login incorrect\u0026#34; protocol=tcp add action=jump chain=input comment=\u0026#34;Jump for icmp input flow\u0026#34; jump-target=ICMP protocol=icmp add action=jump chain=forward comment=\u0026#34;Jump for icmp forward flow\u0026#34; jump-target=ICMP protocol=icmp add action=drop chain=input comment=\u0026#34;Block all access to the winbox - except to support list # DO NOT ENABLE THIS RULE BEFORE ADD YOUR SUBNET IN THE SUPPORT ADDRESS LIST\u0026#34; disabled=yes dst-port=8291 protocol=tcp src-address-list=!support add action=drop chain=input comment=\u0026#34;Drop anything else! # DO NOT ENABLE THIS RULE BEFORE YOU MAKE SURE ABOUT ALL ACCEPT RULES YOU NEED\u0026#34; disabled=yes add action=drop chain=input comment=\u0026#34;ultimo lugar todo lo que viene de fuera se descarta\u0026#34; disabled=yes in-interface=Lan add action=drop chain=input comment=\u0026#34;Block all access to the winbox - except to support list # DO NOT ENABLE THIS RULE BEFORE ADD YOUR SUBNET IN THE SUPPORT ADDRESS LIST\u0026#34; disabled=yes dst-port=8291 protocol=tcp src-address-list=!support add action=drop chain=forward disabled=yes p2p=all-p2p add action=drop chain=forward comment=\u0026#34;block p2p_www\u0026#34; layer7-protocol=p2p_www add action=drop chain=forward comment=\u0026#34;block p2p_dns\u0026#34; dst-port=53 layer7-protocol=p2p_dns protocol=udp add action=add-src-to-address-list address-list=acceso-winbox address-list-timeout=none-dynamic chain=input dst-port=8292 protocol=tcp /ip firewall mangle add action=mark-connection chain=prerouting comment=\u0026#34;PRIO - 7 MULTIDESCARGAS\u0026#34; connection-bytes=50000000-0 new-connection-mark=\u0026#34;PRIO 7\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 7\u0026#34; new-packet-mark=\u0026#34;PRIO 7\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 7\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 1\u0026#34; new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=icmp add action=mark-connection chain=output dst-port=53 new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=udp add action=mark-connection chain=prerouting dst-port=53 new-connection-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes protocol=udp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 1\u0026#34; new-packet-mark=\u0026#34;PRIO 1\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 1\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 2 , STREAMING - JUEGOS,VOIP\u0026#34; dst-port=5060-5061 new-connection-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes protocol=udp add action=mark-connection chain=prerouting dst-port=1863,5190,777 new-connection-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 2\u0026#34; new-packet-mark=\u0026#34;PRIO 2\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 2\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;marco prio 3 navegacion\u0026#34; dst-port=80,443,8000-9000 new-connection-mark=\u0026#34;PRIO 3\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 3\u0026#34; new-packet-mark=\u0026#34;PRIO 3\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 3\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;PRIO 4 - PUERTOS LABORALES\u0026#34; dst-port=25,110,143,3389,1723,21-23 new-connection-mark=\u0026#34;PRIO 4\u0026#34; passthrough=yes protocol=tcp add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 4\u0026#34; new-packet-mark=\u0026#34;PRIO 4\u0026#34; passthrough=yes add action=jump chain=prerouting jump-target=\u0026#34;TERMINO DE PROCESAR\u0026#34; packet-mark=\u0026#34;PRIO 4\u0026#34; add action=mark-connection chain=prerouting comment=\u0026#34;MARCO PRIO 5\u0026#34; new-connection-mark=\u0026#34;PRIO 5\u0026#34; passthrough=yes add action=mark-packet chain=prerouting connection-mark=\u0026#34;PRIO 5\u0026#34; new-packet-mark=\u0026#34;PRIO 5\u0026#34; passthrough=yes add action=accept chain=\u0026#34;TERMINO DE PROCESAR\u0026#34; /ip firewall nat add action=masquerade chain=srcnat comment=\u0026#34;default configuration\u0026#34; out-interface=Lan to-addresses=0.0.0.0 /ip firewall service-port set ftp disabled=yes set tftp disabled=yes set irc disabled=yes set h323 disabled=yes set sip disabled=yes set pptp disabled=yes /ip hotspot ip-binding ... ... /ip hotspot service-port set ftp disabled=yes /ip hotspot user add name=admin password=password profile=admin server=hotspot1 add name=usuario password=usuario server=hotspot1 add disabled=yes name=usuario@correo.com password=password123 server=hotspot1 /ip hotspot walled-garden add disabled=yes dst-host=www.google.es server=hotspot1 src-address=0.0.0.0 add comment=\u0026#34;place hotspot rules here\u0026#34; disabled=yes add dst-host=guifi.net add dst-host=*.guifi.net*/* add dst-host=gg.google.com add dst-host=maps.google.com add dst-host=khm0.google.com add dst-host=khm1.google.com add dst-host=khm2.google.com add dst-host=khm3.google.com add dst-host=mt0.google.com add dst-host=mt1.google.com add dst-host=mt2.google.com add dst-host=mt3.google.com add dst-host=maps.gstatic.com add dst-host=gg.google.com add dst-host=id.google.com add dst-host=www.google-analytics.com add dst-host=www.heywhatsthat.com add dst-host=ocsp.thawte.com add dst-host=https://securityinabox.org/es*/* add dst-host=http://www.eltiempo.es/* add dst-host=http://elrollodecepeda.wordpress.com/* add dst-host=http://cepedadelamora.blogspot.com/* add dst-host=https://llistes.guifi.net/sympa/info/guifi-gredos add dst-host=https://llistes.guifi.net/* add dst-host=http*://securityinabox.org/es*/* add dst-host=https://*llistes.guifi.net*/* add dst-host=https://llistes.guifi.net/sympa/subscribe/guifi-gredos add dst-host=https://llistes.guifi.net/sympa*/* add dst-host=https://llistes.guifi.net/sympa/* add dst-host=http://bin-short.whatsapp.net/ add dst-host=http://cepedadelamora.blogspot.com.es/ add dst-host=*.qui.guifi.net*/* /ip hotspot walled-garden ip add action=accept comment=10.0.0.0/8 disabled=no dst-address=10.0.0.0/8 !dst-port !protocol !src-address add action=accept comment=llistes.guifi.net disabled=no dst-address=109.69.12.15 !dst-port !protocol !src-address add action=accept comment=securityinabox.org disabled=no dst-address=88.198.62.144 !dst-port !protocol !src-address /ip ipsec policy set 0 dst-address=0.0.0.0/0 src-address=0.0.0.0/0 /ip proxy set cache-administrator=mail@gmail.com cache-path=web-proxy1 parent-proxy=0.0.0.0 /ip route add distance=1 gateway=10.228.150.1 /ip service set telnet disabled=yes set ftp address=0.0.0.0/0 disabled=yes set www address=192.168.1.0/24 set ssh address=0.0.0.0/0 disabled=yes set www-ssl address=0.0.0.0/0 certificate=cert1 disabled=no set api disabled=yes set winbox address=0.0.0.0/0 port=8291 set api-ssl disabled=yes /ip traffic-flow set active-flow-timeout=10m cache-entries=64k enabled=yes /ip traffic-flow target add dst-address=10.228.150.2 port=5556 /snmp set contact=guifi@guifi.net enabled=yes location=hostname /system clock set time-zone-autodetect=no time-zone-name=Europe/Madrid /system clock manual set dst-end=\u0026#34;feb/01/1970 00:00:00\u0026#34; dst-start=\u0026#34;feb/01/1970 00:00:00\u0026#34; /system identity set name=hostname /system logging add action=remote topics=critical add action=remote topics=error add action=remote topics=info add action=remote topics=warning add topics=e-mail add action=remote topics=e-mail add action=disk topics=critical add action=remote topics=firewall add action=disk topics=system add action=echo topics=warning /system note set note=\u0026#34;MMMMMMMMMMMMMMMMMMMMMXo,;:::;,;dXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMMWO;;OWMMWXo. :KMMMMMWKxoldkXWMMMMMMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMKc\u0026#39;lXMMMMMMX: ;KMMMXo;dk\u0026#39; .cx0KNWMMMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMO,,OWMMMMMMMWo ,oxxcc0WWx..\u0026#39;. .,.,dXMMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMK;:XMMMMMMMMMMXc..;cokKWMMXkl:clcc, :XMMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMK:lXMMMMMMMMMMMM0\u0026#39; .:cod0NWd..;,..\u0026#39;;,. oNMMMMMMMMMMMMM\\ \\nMMMMMMMMMMMMMXx;oNMMMMMMMMMMMMNOl:;:::cooddl:;,,\u0026#39; .cl;.;oOKNWMMMMMMMM\\ \\nMMMMMMMMMW0olcl0WMMMMMMMMMMMMMWK0NX0OdoooolccloOKkl:dklcc,..,oddKMMMMM\\ \\nMMMMMMMMKc\u0026#39;:kXWMMMMMMMMMMMMMMMMMMMMMWx;\u0026#39;..:cclllodxolo,.\u0026#39;:. .,..oKWMM\\ \\nMMMMMMNd,:0WMMMMMMMMMMMMMMMMMMMMMMNXo. .cooll;..,codc,. .,\u0026#39;,;,\u0026#39;:ON\\ \\nMMMWXd::kWMMMMMMMMMMMMMMMMMMMMMMMM0l\u0026#39; \u0026#39;;;:oollc,,dOdl;\u0026#39;;clodoolk\\ \\nN0kdooONMMMMMMMMMMMMMMMMMMMMMMMMMWd,\u0026#39;.. \u0026#39;loldXNkolllokxookKKXWNK\\ \\nXK0XWMMMMMMMMMMMMMMMMMMMMMMMMMMWKOdccoxc. \u0026#39;dOkOXN0x0XK0NMMMMMMMMMM\\ \\nMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKx0MXxdkxl:,::dKWMMWMMMWWMMMMMMMMMMMMM\\ \\n\u0026#34; /system ntp client set enabled=yes primary-ntp=158.227.98.15 secondary-ntp=193.136.164.1 /system ntp server set enabled=yes multicast=yes /system routerboard settings set silent-boot=no /system scheduler add comment=23:42:26 interval=23h54m name=LOG_MAIL on-event=\u0026#34;:local scheduleName \\\u0026#34;LOG_MAIL\\\u0026#34;\\r\\ \\n:local emailAddress \\\u0026#34;mail@gmail.com\\\u0026#34;\\r\\ \\n:local startBuf [:toarray [/log find message~\\\u0026#34;logged in\\\u0026#34; || message~\\\u0026#34;login failure\\\u0026#34;]]\\r\\ \\n:local removeThese (\\\u0026#34;\\\u0026#34;)\\r\\ \\n \\r\\ \\n:local lastTime [/system scheduler get [find name=\\\u0026#34;\\$scheduleName\\\u0026#34;] comment]\\r\\ \\n \\r\\ \\n:local currentBuf \\\u0026#34;\\\u0026#34;; :set currentBuf [:toarray \\$currentBuf]\\r\\ \\n \\r\\ \\n:foreach i in=\\$startBuf do={\\r\\ \\n :local toggle 1\\r\\ \\n :foreach j in=[:toarray \\$removeThese] do={\\r\\ \\n :if ([:typeof [:find [/log get \\$i message] \\\u0026#34;\\$j\\\u0026#34;]] = \\\u0026#34;num\\\u0026#34;) do={\\r\\ \\n :set toggle 0\\r\\ \\n }\\r\\ \\n }\\r\\ \\n :if (\\$toggle = 1) do={\\r\\ \\n :set currentBuf (\\$currentBuf , \\$i)\\r\\ \\n }\\r\\ \\n}\\r\\ \\n \\r\\ \\n:local currentLineCount [ :len \\$currentBuf ]\\r\\ \\n \\r\\ \\nif (\\$currentLineCount \u0026gt; 0) do={\\r\\ \\n :local currentTime \\\u0026#34;\\$[ /log get [ :pick \\$currentBuf (\\$currentLineCount -1) ] time ]\\\u0026#34;\\r\\ \\n \\r\\ \\n :if ([:len \\$currentTime] = 15 ) do={\\r\\ \\n :set currentTime [ :pick \\$currentTime 7 15 ]\\r\\ \\n }\\r\\ \\n \\r\\ \\n :local output \\\u0026#34;\\$currentTime \\$[/log get [ :pick \\$currentBuf (\\$currentLineCount-1) ] message ]\\\u0026#34;\\r\\ \\n \\r\\ \\n :if (([:len \\$lastTime] \u0026lt; 1) || (([:len \\$lastTime] \u0026gt; 0) \u0026amp;\u0026amp; (\\$lastTime != \\$currentTime))) do={\\r\\ \\n /system scheduler set [find name=\\\u0026#34;\\$scheduleName\\\u0026#34;] comment=\\$currentTime\\r\\ \\n /tool e-mail send to=\\\u0026#34;mail@gmail.com\\\u0026#34; port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=\\\u0026#34;hostname_LOG \\$currentTime\\\u0026#34; body=\\\u0026#34;\\$output\\\u0026#34;\\r\\ \\n }\\r\\ \\n}\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-time=startup add interval=23h53m name=SEND_BACKUP on-event=\u0026#34;/system script run SEND_BACKUP\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-time=startup add comment=\u0026#34;REINICIO CADA DIA\u0026#34; interval=1d name=schedule1 on-event=\u0026#34;/system script run reiniciar\u0026#34; policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive start-date=jun/03/2016 start-time=06:00:00 /system script add dont-require-permissions=no name=console_detail owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;:local content\\r\\ \\n:local logcontenttemp \\\u0026#34;\\\u0026#34;\\r\\ \\n:local logcontent \\\u0026#34;\\\u0026#34;\\r\\ \\n:local counter\\r\\ \\n:local v 0\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;You are logged into: \\$[/system identity get name]\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;############### system health ###############\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;Uptime: \\$[/system resource get uptime] d:h:m:s\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;CPU: \\$[/system resource get cpu-load]%\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;RAM: \\$(([/system resource get total-memory]-[/system resource get free-memory])/1024)/\\$([/system resource get total-memory]/1024)M\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n \\r\\ \\n##\\r\\ \\n#voltage and temp readout not available on x86, check for this before trying\\r\\ \\n#to record otherwise script will halt unexpectedly\\r\\ \\n##\\r\\ \\n \\r\\ \\n:if ([/system resource get architecture-name]=\\\u0026#34;x86\\\u0026#34;) do={\\r\\ \\n :set logcontenttemp \\\u0026#34;Voltage: NIL\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n :set logcontenttemp \\\u0026#34;Temp: NIL\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n} else={\\r\\ \\n :set logcontenttemp \\\u0026#34;Voltage: \\$[:pick [/system health get voltage] 0 2] v\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34; | \\\u0026#34;)\\r\\ \\n :set logcontenttemp \\\u0026#34;Temp: \\$[ /system health get temperature]c\\\u0026#34;\\r\\ \\n :set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n}\\r\\ \\n \\r\\ \\n:set logcontenttemp \\\u0026#34;############# user auth details #############\\\u0026#34;\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n:foreach counter in=[/ip hotspot active find ] do={:set v (\\$v + 1)}\\r\\ \\n:set logcontenttemp \\\u0026#34;Hotspot online: \\$v |\\\u0026#34;\\r\\ \\n:set v 0\\r\\ \\n:foreach counter in=[/ppp active find ] do={:set v (\\$v + 1)}\\r\\ \\n:set logcontenttemp (\\\u0026#34;\\$logcontenttemp\\\u0026#34; . \\\u0026#34; PPP online: \\$v\\\u0026#34;)\\r\\ \\n:set logcontent (\\\u0026#34;\\$logcontent\\\u0026#34; .\\\u0026#34;\\$logcontenttemp\\\u0026#34; .\\\u0026#34;\\\\n\\\u0026#34;)\\r\\ \\n \\r\\ \\n/system note set note=\\\u0026#34;\\$logcontent\\\u0026#34;\u0026#34; add dont-require-permissions=no name=reiniciar owner=admin policy=ftp,reboot,read,write,policy,test,password source=\u0026#34;/system reboot\u0026#34; add dont-require-permissions=no name=SEND_BACKUP owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;/system backup save name=hostname_email_backup dont-encrypt=no\\r\\ \\n/log print file=hostname_logmail.txt\\r\\ \\n\\r\\ \\n/tool e-mail send file=hostname_email_backup.backup to=mail@gmail.com port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=hostname_backup_diario body=hostname_backup_diario\\r\\ \\n/tool e-mail send file=hostname_logmail.txt to=mail@gmail.com port=25 server=74.125.133.108 user=mail@gmail.com password=password from=hostname start-tls=yes subject=hostname_log_diario body=hostname_log_diario\u0026#34; add dont-require-permissions=no name=address_list_winbox-acces owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive source=\u0026#34;ip firewall address-list print\u0026#34; /tool e-mail set address=74.125.133.108 from=hostname password=password start-tls=yes user=mail@gmail.com /tool graphing interface add add interface=bridge1 add add interface=ether1 add interface=ether3 add interface=ether4 add interface=ether5 add /tool graphing queue add simple-queue=2MB_down_384MB_up add simple-queue=queue1 /tool graphing resource add /tool mac-server set allowed-interface-list=mactel /tool mac-server mac-winbox set allowed-interface-list=mac-winbox /tool romon port add *\u0026gt; Tutorial de como montar un hotspot en MikroTik\nParece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nConclusi√≥n En este momento se intentan poner todas las facilidades posibles para que a pie de calle se pueda conectar al acceso abierto de la manera m√°s sencilla con cualquier dispositivo que cuente al menos con 802.11b.\nAl principio estaba el portal cautivo del hotspot con acceso limitado en tiempo y caudal (creo que eran 320k sim√©tricos para cada dispositivo por un tiempo de 2 horas al d√≠a por dispositivo), en esta gesti√≥n por MAC, el \u0026ldquo;cliente\u0026rdquo; ten√≠a que abrir una p√°gina cualquiera con el navegador del dispositivo y se le redireccionaba a la p√°gina del hotspot, despu√©s validarse en el hotspot con un link de pincha aqu√≠ para tener acceso, en fin, un l√≠o para cualquiera que quisiera conectarse a la wifi.\nTuve que poner un cartel en el bar con las indicaciones para conectarse:\nParece que no tienes plugin para visualizar PDF en tu navegador. Puedes descargar el archivo aqu√≠\nY se deshabilit√≥ el hotspot. Ahora para tener conexi√≥n a internet basta con conectar a la wifi. Hay un caudal l√≠mite para el global de todas las conexiones de acceso abierto, y el \"cliente\" cuando se quiere conectar solo tiene que conectar con el SSID del AP, se conecta a una wifi que no tiene contrase√±a, se asigna una IP y ya le funciona el WhatsApp y cualquier servicio de su dispositivo, antes para que funcionara el WhatsApp primero hab√≠a que conectase al portal cautivo con el navegador, y no val√≠a la barra de b√∫squeda de Google que usan muchos usuarios. Adem√°s que tener las conexiones limitadas en tiempo y caudal no tiene sentido hacerlo cuando hay poca demanda y es un caudal que se est√° desaprovechando. La gesti√≥n del tr√°fico en el acceso abierto se hace por QoS se asignan prioridades dependiendo del servicio.\nSi tuvi√©ramos 100 o 200 Mb de salida a internet no tendr√≠amos estos problemas y a pie de calle el grifo estar√≠a abierto a demanda, pero la salida a internet es limitada y requiere de gesti√≥n por QoS para evitar la congesti√≥n, llega un momento que se satura y deja de funcionar.\nLo que tenemos actualmente, en 2021, es un una salida global a internet por telefon√≠a m√≥vil que falla cuando quiere y que hay que repartir entre muchas conexiones. Hay un caudal limitado para el total de conexiones a pie de calle del hotspot y el resto es para las conexiones residenciales.\nEl invento funciona m√°s o menos 335 d√≠as al a√±o, hay 30 d√≠as cuando llegan las temporadas de m√°xima concurrencia de conexiones que da igual lo que tengas configurado porque la salida a internet es la misma todo el a√±o y no da para m√°s.\nPor ejemplo, en verano que son las temporadas de pico m√°ximo, con 30 nodos residenciales a 4 dispositivos de media por nodo son 120 dispositivos residenciales + de 20 a 40 dispositivos del hotspot son 150 dispositivos que tienen que salir a internet por una conexi√≥n que est√° dimensionada para tener de 1 a 4 dispositivos.\nQue quede claro que yo no soy partidario hacer gesti√≥n del tr√°fico en ning√∫n sitio y mucho menos en una red comunitaria, pero la salida a internet es la que es y hay momentos en los que hay muchas bocas que alimentar.\nSon los usuarios los que se tienen que responsabilizar de su uso.\nAhora en 2021, lo siguiente que voy a hacer es quitar el l√≠mite de caudal global de las conexiones del hotspot, porque quien soy yo para decidir que l√≠mite de datos tiene que haber en una conexi√≥n que est√° pagando el excelent√≠simo Ayto de Cepeda de la Mora para uso y disfrute de todos sus vecinos, el mismo derecho tienen los que est√°n en el cuarto de ba√±o de su casa que los que est√°n en la plaza del pueblo (ahora por orden de la diputaci√≥n se quit√≥ el AP de la plaza, dicen que es para evitar aglomeraciones de adolescentes), porque a lo mejor no quieren o no se pueden permitir tener un nodo propio en su casa.\nUna posible soluci√≥n a este problema de concurrencia seria aplicar QoS din√°micas en las que se hiciera la gesti√≥n del tr√°fico por prioridad, tiempo y caudal, bas√°ndose en el n√∫mero de conexiones y demanda de cada momento, pero volvemos a lo mismo. En una red comunitaria ni yo ni nadie tiene que decidir s√≠ un tipo de tr√°fico tiene m√°s o menos prioridad que otro.\n","description":"hotspot","id":71,"section":"posts","tags":["guifi.net","hotspot","mikrotik","cepeda la mora","Ubiquiti","wifi"],"title":"Hotspot","uri":"http://localhost:1313/es/posts/hotspot/"},{"content":"En este art√≠culo se comenta como intent√© buscar el apoyo en asociaciones locales para que promovieran la iniciativa de una red de telecomunicaciones comunitaria, de alguna manera, para conseguir tener una wifi p√∫bica, un acceso p√∫blico a internet en un √°rea rural desfavorecida. Por aquel entonces las conexiones a internet en Cepeda se hac√≠an mediante el ISP Iberbanda (que daba conexiones de 1 2 y 3 Mb sim√©tricos), y el 3G era un lujo.\nContactos Hab√≠an pasado unos cuantos de a√±os desde que vi la p√°gina de guifi.net por primera vez y navegando por la internet lo volv√≠ a ver, ahora hab√≠a un mont√≥n de nodos y la tela de ara√±a se estaba extendiendo incluso fuera de Catalu√±a. A m√≠ me gustaba la idea de la red libre abierta y neutral pero no ten√≠a ni idea de como empezar.\nEn Catalu√±a guifi.net llevaba 10 a√±os funcionando y el proyecto iba creciendo.\nYo acababa de ser despedido de manera improcedente de una empresa de telecomunicaciones en la que me dedicaba a instalar equipos de wifi para dar cobertura a nivel poblaci√≥n e interconectar dependencias municipales, ten√≠a mucha rabia acumulada y estaba viendo una sonrisa en los pueblos que ten√≠an wifi, la verdad es que era un trabajo que me gustaba mucho y me fastidi√≥ cuando me dijeron que me dejaban en la calle.\nHubo una persona que me sugiri√≥ la idea de la wifi comunitaria y fue entonces cuando se me meti√≥ en la cabeza la idea de aportar mi experiencia al pueblo que me hab√≠a visto crecer y del que estoy tan orgulloso.\nNo ten√≠a ni idea de como empezar, as√≠ que pens√© que contactar con asociaciones locales me pod√≠a iluminar y que iban a apoyar mi idea, que no era otra que compartir una salida a internet y ponerla a disposici√≥n del que la necesitara.\nAs√≠ qu√©, Intent√© buscar aliados, para por lo menos, presentar una propuesta.\nLo primero contact√© con la asociaci√≥n El Royo de Cepeda la Mora, la asociaci√≥n m√°s potente del pueblo https://www.facebook.com/elrollodecepeda/, se enviaron 2 correos a elrollodecepeda@gmail.com comentando la idea de la wifi en el pueblo y hablando del proyecto guifi.net, sin respuesta. Contact√© con ASENORG, Asociaci√≥n Empresarios Gredos al mail de Isabel S√°nchez Tejado isabelstejado@gmail.com, que era el que hab√≠a de contacto, sin respuesta (Ahora esta persona se dedica a \u0026ldquo;el cultivo de Piornos (no te pierdas nuestro Festival del Piorno)\u0026rdquo;. Me parto. Seg√∫n https://repueblo.es/cracksrurales/la-inspiradora-historia-de-una-repobladora-en-gredos). Y con voluntariadogredoslibre@gmail.com, sin respuesta, claro. Eran las asociaciones locales que hab√≠a en aquella √©poca.\nTener el respaldo de una asociaci√≥n consolidada dar√° fuerza al proyecto. Si no hay nada, es muy interesante contemplar la posibilidad de crear una fundaci√≥n, asociaci√≥n, cooperativa, grupo o colectivo de usuarios para fomentar la implicaci√≥n del grupo y para repartir la carga de trabajo. Tomar de decisiones es m√°s f√°cil cuando no est√°s solo. Pero tambi√©n ten en cuenta que si viajas solo, podr√°s volar a donde quieras y estar el tiempo que te d√© la gana.\nguifi.net Tambi√©n contact√© con guifi.net fundacio@guifi.net, sin respuesta.\nDescubr√≠ que las comunicaciones en guifi.net se hac√≠an mediante las listas de correo https://llistes.guifi.net/sympa y tiene sentido, es interesante tener un repositorio de informaci√≥n para poder hacer b√∫squedas y navegaci√≥n de hilos. Aunque las listas de correo son cada vez menos populares se siguen usando.\nY con la agrupaci√≥n guifi.net Extremadura, mediante las listas de correo ya hubo algo de di√°logo.\nUn d√≠a me present√© en el MediaLab Prado, un sitio maravilloso lleno de gente extraordinaria que el Ayto. de Madrid quiere desalojar para convertirlo en un museo, est√° claro que este pa√≠s no tiene mucho inter√©s en la cultura y que todo est√° orientado a vivir del turismo, un pa√≠s que es el chiringuito de Europa, con sol, playa y el producto estrella: El folclore.\nFinalmente con el apoyo de Gabi y Alex, las personas que conoc√≠ en el MediaLab Prado, se present√≥ una propuesta al ayuntamiento de Cepeda para poner un hotspot y un par de AP en 2.4 para conexi√≥n wifi p√∫blica a pie de calle, una antena en la plaza del Ayto. y otra en el bar municipal. La salida a internet la donaba el ayuntamiento que ten√≠a contratada una conexi√≥n de 3 Mb sim√©tricos y que la mayor√≠a del tiempo estaba sin uso.\nPara desplegar una red comunitaria local wireless vas a necesitar tener alg√∫nos conocimientos.\nHay un libro publicado bajo licencia Creative Commons que a m√≠ me gust√≥ mucho, \u0026ldquo;Redes inal√°mbricas en los pa√≠ses en desarrollo.\u0026rdquo;\nEs gratis y est√° traducido al espa√±ol y a muchos m√°s idiomas, se puede descargar en http://wndw.net/book.html\nTampoco es necesario que te conviertas en un experto en telecomunicaciones, para desplegar y mantener la red puedes contratar a un profesional de tu zona, qu√© para eso est√°n.\nIgualmente hay que valorar el tipo de despliegue que se quiere hacer y las necesidades que se quieren cubrir, por ejemplo, cada vez es m√°s barato desplegar con fibra √≥ptica.","description":"arrancando","id":72,"section":"posts","tags":["guifi.net","asociaciones","cepeda la mora","wifi"],"title":"Arrancando","uri":"http://localhost:1313/es/posts/arrancando/"}]